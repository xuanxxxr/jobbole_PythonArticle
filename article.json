{"fav_nums": 0, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000011365430\">PythonScientists</a>   </div><p>我想大部分Python开发者最先接触到的方向是WEB方向（因为总是有开发者希望马上给自己做个博客出来，例如我），既然是WEB，免不了接触到一些WEB框架，例如Django,Flask,Torando等等，在开发过程中，看过一些文档总会介绍生产环境和开发环境服务器的配置问题，服务器又设计web服务器和应用服务器，总而言之，我们碰到最多的，必定是这个词 — WSGI。</p>\n<p>接下来的文章，会分为以下几个部分：</p>\n<ul>\n<li>1.WSGI介绍\n<ul>\n<li>1.1什么是WSGI</li>\n<li>1.2怎么实现WSGI</li>\n</ul>\n</li>\n<li>2.由Django框架分析WSGI</li>\n<li>3.实际环境使用的wsgi服务器</li>\n<li>4.WSGI服务器比较</li>\n</ul>\n<hr>\n<h1>开始</h1>\n<h1>1 WSGI介绍</h1>\n<h2>1.1 什么是WSGI</h2>\n<p>首先介绍几个关于WSGI相关的概念</p>\n<p><strong>WSGI：</strong>全称是<strong>Web Server Gateway Interface</strong>，<strong>WSGI</strong>不是服务器，python模块，框架，API或者任何软件，只是一种规范，描述<strong>web server</strong>如何与<strong>web application</strong>通信的规范。<strong>server</strong>和<strong>application</strong>的规范在<a href=\"https://www.python.org/dev/peps/pep-3333/\">PEP 3333</a>中有具体描述。要实现WSGI协议，必须同时实现<strong>web serve</strong>r和<strong>web application</strong>，当前运行在WSGI协议之上的web框架有<strong>Torando</strong>,<strong>Flask</strong>,<strong>Django</strong></p>\n<p><strong>uwsgi：</strong>与<strong>WSGI</strong>一样是一种通信协议，是<strong>uWSGI</strong>服务器的独占协议，用于定义传输信息的类型(type of information)，每一个uwsgi packet前4byte为传输信息类型的描述，与<strong>WSGI</strong>协议是两种东西，据说该协议是<strong>fcgi</strong>协议的10倍快。</p>\n<p><strong>uWSGI：</strong>是一个<strong>web</strong>服务器，实现了<strong>WSGI</strong>协议、<strong>uwsgi</strong>协议、<strong>http</strong>协议等。</p>\n<p><strong>WSGI</strong>协议主要包括<strong>server</strong>和<strong>application</strong>两部分：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41347929558311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nWSGI server负责从客户端接收请求，将request转发给application，将application返回的response返回给客户端；\r\nWSGI application接收由server转发的request，处理请求，并将处理结果返回给server。application中可以包括多个栈式的中间件(middlewares)，这些中间件需要同时实现server与application，因此可以在WSGI服务器与WSGI应用之间起调节作用：对服务器来说，中间件扮演应用程序，对应用程序来说，中间件扮演服务器。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41347929558311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41347929558311-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41347929558311-1\"><span class=\"crayon-e\">WSGI </span><span class=\"crayon-i\">server</span>负责从客户端接收请求，将<span class=\"crayon-i\">request</span>转发给<span class=\"crayon-i\">application</span>，将<span class=\"crayon-i\">application</span>返回的<span class=\"crayon-i\">response</span>返回给客户端；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41347929558311-2\"><span class=\"crayon-e\">WSGI </span><span class=\"crayon-i\">application</span>接收由<span class=\"crayon-i\">server</span>转发的<span class=\"crayon-i\">request</span>，处理请求，并将处理结果返回给<span class=\"crayon-i\">server</span>。<span class=\"crayon-i\">application</span>中可以包括多个栈式的中间件<span class=\"crayon-sy\">(</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">)</span>，这些中间件需要同时实现<span class=\"crayon-i\">server</span>与<span class=\"crayon-i\">application</span>，因此可以在<span class=\"crayon-i\">WSGI</span>服务器与<span class=\"crayon-i\">WSGI</span>应用之间起调节作用：对服务器来说，中间件扮演应用程序，对应用程序来说，中间件扮演服务器。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p><strong>WSGI</strong>协议其实是定义了一种<strong>server</strong>与<strong>application</strong>解耦的规范，即可以有多个实现<strong>WSGI server</strong>的服务器，也可以有多个实现<strong>WSGI application</strong>的框架，那么就可以选择任意的server和application组合实现自己的web应用。例如<strong>uWSGI</strong>和<strong>Gunicorn</strong>都是实现了WSGI server协议的服务器，<strong>Django</strong>，<strong>Flask</strong>是实现了<strong>WSGI application</strong>协议的<strong>web</strong>框架，可以根据项目实际情况搭配使用。</p>\n<p>以上介绍了相关的常识，接下来我们来看看如何简单实现WSGI协议。</p>\n<h2>1.2 怎么实现WSGI</h2>\n<p>上文说过，实现WSGI协议必须要有wsgi server和application，因此，我们就来实现这两个东西。</p>\n<p>我们来看看官方WSGI使用WSGI的wsgiref模块实现的小demo</p>\n<blockquote><p>有关于wsgiref的快速入门可以看看<a href=\"http://python.jobbole.com/88637/\">这篇博客</a></p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41355612326750\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef demo_app(environ,start_response):  \r\n    from StringIO import StringIO  \r\n    stdout = StringIO()  \r\n    print &gt;&gt;stdout, \"Hello world!\"  \r\n    print &gt;&gt;stdout  \r\n    h = environ.items(); h.sort()  \r\n    for k,v in h:  \r\n        print &gt;&gt;stdout, k,'=', repr(v)  \r\n    start_response(\"200 OK\", [('Content-Type','text/plain')])  \r\n    return [stdout.getvalue()]  \r\n  \r\nhttpd = make_server('localhost', 8002,  demo_app)  \r\nhttpd.serve_forever()  # 使用select</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41355612326750-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41355612326750-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">demo_app</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StringIO</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StringIO</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello world!\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-i\">stdout</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">h</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">h</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'='</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">start_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"200 OK\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'text/plain'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getvalue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-11\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41355612326750-12\"><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_server</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8002</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">demo_app</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41355612326750-13\"><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">serve_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 使用select</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>实现了一个application，来获取客户端的环境和回调函数两个参数，以及httpd服务端的实现，我们来看看make_server的源代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a4135a601934743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef make_server(  \r\n    host, port, app, server_class=WSGIServer, handler_class=WSGIRequestHandler  \r\n):  \r\n  \"\"\"Create a new WSGI server listening on `host` and `port` for `app`\"\"\"  \r\n  server = server_class((host, port), handler_class)  \r\n  server.set_app(app)  \r\n  return server</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4135a601934743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4135a601934743-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4135a601934743-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4135a601934743-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4135a601934743-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4135a601934743-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4135a601934743-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a4135a601934743-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_server</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4135a601934743-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_class</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">WSGIServer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler_class</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">WSGIRequestHandler</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4135a601934743-3\"><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4135a601934743-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"\"\"Create a new WSGI server listening on `host` and `port` for `app`\"\"\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4135a601934743-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">server_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler_class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4135a601934743-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_app</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4135a601934743-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>接受一系列函数，返回一个server对象,实现还是比较简单，下面我们来看看在django中如何实现其自身的wsgi服务器的。</p>\n<p>下面我们自己来实现一遍：</p>\n<p>WSGI 规定每个 python 程序（Application）必须是一个可调用的对象（实现了__call__ 函数的方法或者类），接受两个参数 environ（WSGI 的环境信息） 和 start_response（开始响应请求的函数），并且返回 iterable。几点说明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41360325208527\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nenviron 和 start_response 由 http server 提供并实现\r\nenviron 变量是包含了环境信息的字典\r\nApplication 内部在返回前调用 start_response\r\nstart_response也是一个 callable，接受两个必须的参数，status（HTTP状态）和 response_headers（响应消息的头）\r\n可调用对象要返回一个值，这个值是可迭代的。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41360325208527-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41360325208527-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41360325208527-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41360325208527-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41360325208527-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41360325208527-1\"><span class=\"crayon-i\">environ</span><span class=\"crayon-h\"> </span>和<span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">_</span>response<span class=\"crayon-h\"> </span>由<span class=\"crayon-h\"> </span><span class=\"crayon-e\">http </span><span class=\"crayon-i\">server</span><span class=\"crayon-h\"> </span>提供并实现</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41360325208527-2\"><span class=\"crayon-i\">environ</span><span class=\"crayon-h\"> </span>变量是包含了环境信息的字典</div><div class=\"crayon-line\" id=\"crayon-59d04b1a41360325208527-3\"><span class=\"crayon-i\">Application</span><span class=\"crayon-h\"> </span>内部在返回前调用<span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41360325208527-4\"><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">_</span>response也是一个<span class=\"crayon-h\"> </span><span class=\"crayon-k \">callable</span>，接受两个必须的参数，<span class=\"crayon-i\">status</span>（<span class=\"crayon-i\">HTTP</span>状态）和<span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">_</span>headers（响应消息的头）</div><div class=\"crayon-line\" id=\"crayon-59d04b1a41360325208527-5\">可调用对象要返回一个值，这个值是可迭代的。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41364728917891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n # 1. 可调用对象是一个函数\r\ndef application(environ, start_response):\r\n \r\n   response_body = 'The request method was %s' % environ['REQUEST_METHOD']\r\n \r\n   # HTTP response code and message\r\n   status = '200 OK'\r\n \r\n   # 应答的头部是一个列表，每对键值都必须是一个 tuple。\r\n   response_headers = [('Content-Type', 'text/plain'),\r\n                       ('Content-Length', str(len(response_body)))]\r\n \r\n   # 调用服务器程序提供的 start_response，填入两个参数\r\n   start_response(status, response_headers)\r\n \r\n   # 返回必须是 iterable\r\n   return [response_body]    \r\n   \r\n# 2. 可调用对象是一个类\r\nclass AppClass:\r\n    \"\"\"这里的可调用对象就是 AppClass 这个类，调用它就能生成可以迭代的结果。\r\n        使用方法类似于： \r\n        for result in AppClass(env, start_response):\r\n             do_somthing(result)\r\n    \"\"\"\r\n \r\n    def __init__(self, environ, start_response):\r\n        self.environ = environ\r\n        self.start = start_response\r\n \r\n    def __iter__(self):\r\n        status = '200 OK'\r\n        response_headers = [('Content-type', 'text/plain')]\r\n        self.start(status, response_headers)\r\n        yield \"Hello world!\\n\"\r\n \r\n# 3. 可调用对象是一个实例 \r\nclass AppClass:\r\n    \"\"\"这里的可调用对象就是 AppClass 的实例，使用方法类似于： \r\n        app = AppClass()\r\n        for result in app(environ, start_response):\r\n             do_somthing(result)\r\n    \"\"\"\r\n \r\n    def __init__(self):\r\n        pass\r\n \r\n    def __call__(self, environ, start_response):\r\n        status = '200 OK'\r\n        response_headers = [('Content-type', 'text/plain')]\r\n        self.start(status, response_headers)\r\n        yield \"Hello world!\\n\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41364728917891-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41364728917891-52\">52</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 1. 可调用对象是一个函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">application</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">response_body</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'The request method was %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_METHOD'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># HTTP response code and message</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-7\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'200 OK'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-8\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 应答的头部是一个列表，每对键值都必须是一个 tuple。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/plain'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-11\"><span class=\"crayon-h\">                       </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-Length'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response_body</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-12\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 调用服务器程序提供的 start_response，填入两个参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-e\">start_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-15\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 返回必须是 iterable</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-17\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">response_body</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-18\"><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-19\"><span class=\"crayon-c\"># 2. 可调用对象是一个类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-20\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AppClass</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"这里的可调用对象就是 AppClass 这个类，调用它就能生成可以迭代的结果。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-22\"><span class=\"crayon-s\">        使用方法类似于： </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-23\"><span class=\"crayon-s\">        for result in AppClass(env, start_response):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-24\"><span class=\"crayon-s\">             do_somthing(result)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-25\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-26\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">environ</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-29\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-30\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-31\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__iter__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'200 OK'</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/plain'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello world!\\n\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-36\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-37\"><span class=\"crayon-c\"># 3. 可调用对象是一个实例 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-38\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AppClass</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"这里的可调用对象就是 AppClass 的实例，使用方法类似于： </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-40\"><span class=\"crayon-s\">        app = AppClass()</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-41\"><span class=\"crayon-s\">        for result in app(environ, start_response):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-42\"><span class=\"crayon-s\">             do_somthing(result)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-43\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-44\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-47\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'200 OK'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Content-type'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/plain'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41364728917891-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41364728917891-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello world!\\n\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0112 seconds] -->\r\n<p>服务器程序端</p>\n<p>上面已经说过，标准要能够确切地实行，必须要求程序端和服务器端共同遵守。上面提到， envrion 和 start_response 都是服务器端提供的。下面就看看，服务器端要履行的义务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41369257962421\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n准备 environ 参数\r\n定义 start_response 函数\r\n调用程序端的可调用对象</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41369257962421-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41369257962421-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41369257962421-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41369257962421-1\">准备<span class=\"crayon-h\"> </span><span class=\"crayon-i\">environ</span><span class=\"crayon-h\"> </span>参数</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41369257962421-2\">定义<span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">_</span>response<span class=\"crayon-h\"> </span>函数</div><div class=\"crayon-line\" id=\"crayon-59d04b1a41369257962421-3\">调用程序端的可调用对象</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a4136c756722952\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os, sys\r\n \r\ndef run_with_cgi(application):    # application 是程序端的可调用对象\r\n    # 准备 environ 参数，这是一个字典，里面的内容是一次 HTTP 请求的环境变量\r\n    environ = dict(os.environ.items())\r\n    environ['wsgi.input']        = sys.stdin\r\n    environ['wsgi.errors']       = sys.stderr\r\n    environ['wsgi.version']      = (1, 0)\r\n    environ['wsgi.multithread']  = False\r\n    environ['wsgi.multiprocess'] = True\r\n    environ['wsgi.run_once']     = True            \r\n    environ['wsgi.url_scheme'] = 'http'\r\n \r\n    headers_set = []\r\n    headers_sent = []\r\n \r\n    # 把应答的结果输出到终端\r\n    def write(data):\r\n        sys.stdout.write(data)\r\n        sys.stdout.flush()\r\n \r\n    # 实现 start_response 函数，根据程序端传过来的 status 和 response_headers 参数，\r\n    # 设置状态和头部\r\n    def start_response(status, response_headers, exc_info=None):\r\n        headers_set[:] = [status, response_headers]\r\n          return write\r\n \r\n    # 调用客户端的可调用对象，把准备好的参数传递过去\r\n    result = application(environ, start_response)\r\n    \r\n    # 处理得到的结果，这里简单地把结果输出到标准输出。\r\n    try:\r\n        for data in result:\r\n            if data:    # don't send headers until body appears\r\n                write(data)\r\n    finally:\r\n        if hasattr(result, 'close'):\r\n            result.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a4136c756722952-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a4136c756722952-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-2\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run_with_cgi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># application 是程序端的可调用对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 准备 environ 参数，这是一个字典，里面的内容是一次 HTTP 请求的环境变量</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.input'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stdin</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.errors'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stderr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.version'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.multithread'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.multiprocess'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.run_once'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.url_scheme'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http'</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-13\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">headers_set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">headers_sent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 把应答的结果输出到终端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">flush</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-21\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 实现 start_response 函数，根据程序端传过来的 status 和 response_headers 参数，</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 设置状态和头部</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exc_info</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">headers_set</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-26\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">write</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-27\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 调用客户端的可调用对象，把准备好的参数传递过去</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">application</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-30\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 处理得到的结果，这里简单地把结果输出到标准输出。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># don't send headers until body appears</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a4136c756722952-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hasattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'close'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a4136c756722952-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0123 seconds] -->\r\n<p></p>\n<h1>2 由Django框架分析WSGI</h1>\n<p>下面我们以<strong>django</strong>为例，分析一下<strong>wsgi</strong>的整个流程</p>\n<h2>django WSGI application</h2>\n<p><strong>WSGI application</strong>应该实现为一个可调用<strong>iter</strong>对象，例如函数、方法、类(包含<strong>**call**</strong>方法)。需要接收两个参数：一个字典，该字典可以包含了客户端请求的信息以及其他信息，可以认为是请求上下文，一般叫做<strong>environment</strong>（编码中多简写为environ、env），一个用于发送HTTP响应状态（HTTP status）、响应头（HTTP headers）的回调函数,也就是<strong>start_response()</strong>。通过回调函数将响应状态和响应头返回给server，同时返回响应正文(response body)，响应正文是可迭代的、并包含了多个字符串。</p>\n<p>下面是Django中application的具体实现部分：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41371950141380\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass WSGIHandler(base.BaseHandler): \r\n   initLock = Lock() \r\n   request_class = WSGIRequest \r\n   def __call__(self, environ, start_response): \r\n   # 加载中间件 \r\n    if self._request_middleware is None: \r\n         with self.initLock: \r\n             try: # Check that middleware is still uninitialized. \r\n                 if self._request_middleware is None: \r\n                    self.load_middleware() \r\n             except: # Unload whatever middleware we got \r\n                    self._request_middleware = None raise          \r\n     set_script_prefix(get_script_name(environ)) # 请求处理之前发送信号   \r\n     signals.request_started.send(sender=self.__class__, environ=environ) \r\n     try: \r\n          request = self.request_class(environ)  \r\n     except UnicodeDecodeError: \r\n           logger.warning('Bad Request (UnicodeDecodeError)',exc_info=sys.exc_info(), extra={'status_code': 400,}\r\n           response = http.HttpResponseBadRequest() \r\n     else: \r\n           response = self.get_response(request) \r\n     response._handler_class = self.__class__ status = '%s %s' % (response.status_code, response.reason_phrase) \r\n     response_headers = [(str(k), str(v)) for k, v in response.items()] for c in response.cookies.values(): response_headers.append((str('Set-Cookie'), str(c.output(header='')))) \r\n     # server提供的回调方法，将响应的header和status返回给server     \r\n     start_response(force_str(status), response_headers) \r\n     if getattr(response, 'file_to_stream', None) is not None and environ.get('wsgi.file_wrapper'): \r\n          response = environ['wsgi.file_wrapper'](response.file_to_stream) \r\n     return response</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41371950141380-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41371950141380-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">BaseHandler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">initLock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">request_class</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIRequest </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-4\"><span class=\"crayon-e\">   </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># 加载中间件 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_request_middleware </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">initLock</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-8\"><span class=\"crayon-h\">             </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Check that middleware is still uninitialized. </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-9\"><span class=\"crayon-h\">                 </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_request_middleware </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-10\"><span class=\"crayon-h\">                    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load_middleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-11\"><span class=\"crayon-h\">             </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Unload whatever middleware we got </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-12\"><span class=\"crayon-h\">                    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_request_middleware</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">set_script_prefix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">get_script_name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 请求处理之前发送信号   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-14\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">signals</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request_started</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sender</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__class__</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">UnicodeDecodeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-18\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">warning</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Bad Request (UnicodeDecodeError)'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">exc_info</span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exc_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">extra</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'status_code'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-19\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">HttpResponseBadRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-20\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-21\"><span class=\"crayon-h\">           </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-22\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_handler_class</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__class__ </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s %s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">status_code</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">reason_phrase</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-23\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Set-Cookie'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">output</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-24\"><span class=\"crayon-h\">     </span><span class=\"crayon-c\"># server提供的回调方法，将响应的header和status返回给server     </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-25\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">start_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">force_str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response_headers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-26\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'file_to_stream'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'wsgi.file_wrapper'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41371950141380-27\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'wsgi.file_wrapper'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">file_to_stream</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41371950141380-28\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0188 seconds] -->\r\n<p>可以看出application的流程包括:加载所有中间件，以及执行框架相关的操作，设置当前线程脚本前缀，发送请求开始信号；处理请求，调用get_response()方法处理当前请求，该方法的的主要逻辑是通过urlconf找到对应的view和callback，按顺序执行各种middleware和callback。调用由server传入的start_response()方法将响应header与status返回给server。返回响应正文</p>\n<h2>django WSGI Server</h2>\n<p>负责获取http请求，将请求传递给WSGI application，由application处理请求后返回response。以Django内建server为例看一下具体实现。通过runserver运行django<br>\n项目，在启动时都会调用下面的run方法，创建一个WSGIServer的实例，之后再调用其serve_forever()方法启动服务。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41378302659603\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef run(addr, port, wsgi_handler, ipv6=False, threading=False): \r\n   server_address = (addr, port) \r\n   if threading: \r\n        httpd_cls = type(str('WSGIServer'), (socketserver.ThreadingMixIn, WSGIServer), {}) \r\n   else: \r\n        httpd_cls = WSGIServer # 这里的wsgi_handler就是WSGIApplication \r\n   httpd = httpd_cls(server_address, WSGIRequestHandler, ipv6=ipv6) \r\n    if threading: \r\n        httpd.daemon_threads = True httpd.set_app(wsgi_handler)    \r\n     httpd.serve_forever()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41378302659603-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41378302659603-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41378302659603-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41378302659603-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41378302659603-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41378302659603-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41378302659603-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41378302659603-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41378302659603-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41378302659603-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41378302659603-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wsgi_handler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipv6</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41378302659603-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">server_address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41378302659603-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41378302659603-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">httpd_cls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'WSGIServer'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socketserver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ThreadingMixIn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WSGIServer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41378302659603-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41378302659603-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">httpd_cls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WSGIServer</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># 这里的wsgi_handler就是WSGIApplication </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41378302659603-7\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">httpd_cls</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_address</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WSGIRequestHandler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipv6</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">ipv6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41378302659603-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41378302659603-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">daemon_threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_app</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wsgi_handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41378302659603-10\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">serve_forever</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p>下面表示WSGI server服务器处理流程中关键的类和方法。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/c817a776a88a62b252eaaef8c27f8271.png\"><img class=\"aligncenter size-full wp-image-88655\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c817a776a88a62b252eaaef8c27f8271.png\" alt=\"3029445-fc4e37c4f5585b41\"></a></p>\n<p><strong>WSGIServer</strong>run()方法会创建<strong>WSGIServer</strong>实例，主要作用是接收客户端请求，将请求传递给<strong>application</strong>，然后将<strong>application</strong>返回的<strong>response</strong>返回给客户端。</p>\n<p>创建实例时会指定<strong>HTTP</strong>请求的<strong>handler：WSGIRequestHandler</strong>类，通过<strong>set_app</strong>和<strong>get_app</strong>方法设置和获取<strong>WSGIApplication</strong>实例<strong>wsgi_handler。</strong></p>\n<p>处理http请求时，调用<strong>handler_request</strong>方法，会创建<strong>WSGIRequestHandler，</strong>实例处理http请求。WSGIServer中<strong>get_request</strong>方法通过<strong>socket</strong>接受请求数据。</p>\n<p><strong>WSGIRequestHandler</strong>由WSGIServer在调用handle_request时创建实例，传入<strong>request</strong>、<strong>cient_address</strong>、<strong>WSGIServer</strong>三个参数，__init__方法在实例化同时还会调用自身的<strong>handle</strong>方法handle方法会创建<strong>ServerHandler</strong>实例，然后调用其<strong>run</strong>方法处理请求</p>\n<p><strong>ServerHandler</strong>WSGIRequestHandler在其handle方法中调用run方法，传入self.server.get_app()参数，获取<strong>WSGIApplication</strong>，然后调用实例(__call__)，获取<strong>response</strong>，其中会传入<strong>start_response</strong>回调，用来处理返回的<strong>header</strong>和<strong>status</strong>。通过application获取response以后，通过finish_response返回response</p>\n<p><strong>WSGIHandler</strong>WSGI协议中的application，接收两个参数，environ字典包含了客户端请求的信息以及其他信息，可以认为是请求上下文，start_response用于发送返回status和header的回调函数</p>\n<p>虽然上面一个WSGI server涉及到多个类实现以及相互引用，但其实原理还是调用WSGIHandler，传入请求参数以及回调方法start_response()，并将响应返回给客户端。</p>\n<h1>3 实际环境使用的wsgi服务器</h1>\n<p>因为每个web框架都不是专注于实现服务器方面的，因此，在生产环境部署的时候使用的服务器也不会简单的使用web框架自带的服务器，这里，我们来讨论一下用于生产环境的服务器有哪些？</p>\n<blockquote><p>1.<strong>gunicorn</strong></p></blockquote>\n<p>Gunicorn（从Ruby下面的Unicorn得到的启发）应运而生：依赖Nginx的代理行为，同Nginx进行功能上的分离。由于不需要直接处理用户来的请求（都被Nginx先处理），Gunicorn不需要完成相关的功能，其内部逻辑非常简单：接受从Nginx来的动态请求，处理完之后返回给Nginx，由后者返回给用户。</p>\n<p>由于功能定位很明确，Gunicorn得以用纯Python开发：大大缩短了开发时间的同时，性能上也不会很掉链子。同时，它也可以配合Nginx的代理之外的别的Proxy模块工作，其配置也相应比较简单。</p>\n<p>配置上的简单，大概是它流行的最大的原因。</p>\n<blockquote><p>2.<strong>uwsgi</strong></p></blockquote>\n<p>因为使用C语言开发，会和底层接触的更好，配置也是比较方便，目前和gunicorn两个算是部署时的唯二之选。</p>\n<p>以下是通常的配置文件</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b1a41381325475961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[uwsgi]\r\nhttp = $(HOSTNAME):9033\r\nhttp-keepalive = 1\r\npythonpath = ../\r\nmodule = service\r\nmaster = 1\r\nprocesses = 8\r\ndaemonize = logs/uwsgi.log\r\ndisable-logging = 1\r\nbuffer-size = 16384\r\nharakiri = 5\r\npidfile = uwsgi.pid\r\nstats = $(HOSTNAME):1733\r\n\r\n\r\n运行：uwsgi --ini   conf.ini</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b1a41381325475961-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b1a41381325475961-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">uwsgi</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-2\"><span class=\"crayon-v\">http</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOSTNAME</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">9033</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-3\"><span class=\"crayon-v\">http</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">keepalive</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-4\"><span class=\"crayon-v\">pythonpath</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-5\"><span class=\"crayon-v\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-6\"><span class=\"crayon-v\">master</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-7\"><span class=\"crayon-v\">processes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-8\"><span class=\"crayon-v\">daemonize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">logs</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">uwsgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-9\"><span class=\"crayon-v\">disable</span><span class=\"crayon-o\">-</span><span class=\"crayon-k \">logging</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-10\"><span class=\"crayon-k \">buffer</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16384</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-11\"><span class=\"crayon-v\">harakiri</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-12\"><span class=\"crayon-v\">pidfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uwsgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pid</span></div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-13\"><span class=\"crayon-v\">stats</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOSTNAME</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1733</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b1a41381325475961-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b1a41381325475961-16\">运行：<span class=\"crayon-v\">uwsgi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">ini   </span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ini</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0060 seconds] -->\r\n<p></p>\n<blockquote><p>3.<strong>fcgi</strong></p></blockquote>\n<p>不多数，估计使用的人也是比较少，这里只是提一下</p>\n<blockquote><p>4.<strong>bjoern</strong></p></blockquote>\n<p>Python WSGI界最牛逼性能的Server其中一个是bjoern，纯C，小于1000行代码，就是看不惯uWSGI的冗余自写的。</p>\n<h1>4 WSGI服务器比较</h1>\n<p>综合广大Python开发者的实际经历，我们可以得出，使用最广的当属uWSGI以及gunicorn，我们这里来比较比较两者与其他服务器的区别。<br>\n1.gunicorn本身是个多进程管理器，需要指定相关的不同类型的worker去工作，使用gevent作为worker时单机大概是3000RPS Hello World，胜过torando自带的服务器大概是2000左右，uWSGI则会更高一点。<br>\n2.相比于tornado对于现有代码需要大规模重构才能用上高级特性，Gevent只需要一个monkey，容易对代码进行快速加工。<br>\n3.gunicorn 可以做 pre hook and post hook.</p>\n<p>下面来对比以下uWSGI和gunicorn的速度差比</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/0d55de672c19ab755899b300d10fc7a6.png\"><img class=\"aligncenter size-full wp-image-88656\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0d55de672c19ab755899b300d10fc7a6.png\" alt=\"3029445-fc4e37c4f5585b41\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/cee19978ce4b0f6cbe0be34b8d9a6853.png\"><img class=\"aligncenter size-full wp-image-88657\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/cee19978ce4b0f6cbe0be34b8d9a6853.png\" alt=\"3029445-fc4e37c4f5585b41\"></a></p>\n<p>可以看到，如果单纯追求性能，那uWSGI会更好一点，而gunicorn则会更易安装和结合gevent。</p>\n<p>结合<a href=\"http://blog.csdn.net/orangleliu/article/details/49275687\">这篇文章</a>,我们也可以得出相同结论，在阻塞响应较多的情况下，gunicorn的gevent模式无疑性能会更加强大。</p>\n<p>功能实现方面，无疑uWSGI会更多一些，配置也会更加复杂一些，可以看看uWSGI的配置和gunicorn的<a href=\"http://gunicorn-docs.readthedocs.io/en/latest/design.html\">配置</a>。</p>\n<p>至于怎么去选择，就看大家的项目结构怎么样了。</p>\n<p>最后，宣传一下我们的开源组织，PSC开源组，希望以开源项目的方式让每个人都能更有融入性的去学习，公开化你的学习。</p>\n<ul>\n<li>github地址：<a href=\"https://github.com/PythonScientists\">https://github.com/PythonScie…</a></li>\n<li>官方论坛：<a href=\"http://www.pythonscientists.com\">http://www.pythonscientists.com</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88653\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88653votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88653\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/c817a776a88a62b252eaaef8c27f8271.png"], "tags": "基础知识,web开发,WSGI", "url_object_id": "df559c0439a675373458ea6b27640d77", "praise_nums": "1", "url": "http://python.jobbole.com/88653/", "title": "Python Web开发最难懂的WSGI协议，到底包含哪些内容？", "create_date": "2017/09/30", "comment_nums": 0}
{"fav_nums": 3, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/BaseHTTPServer%E2%80%94%E2%80%94%E5%AE%9E%E7%8E%B0Web%E6%9C%8D%E5%8A%A1%E5%99%A8/\">Learn Python</a>   </div><p>在<a title=\"SocketServer——网络通信服务器\" href=\"http://python.jobbole.com/88626/\">SocketServer——网络通信服务器</a>中我们介绍了Python标准库中的SocketServer模块，了解了要实现网络通信服务，就要构建一个服务器类和请求处理类。同时，该模块还为我们创建了不同的服务器类和请求处理类。</p>\n<p>1.服务器类</p>\n<ul>\n<li><strong>BaseServer</strong></li>\n<li><strong>TCPServer(BaseServer)</strong></li>\n<li><strong>UDPServer(TCPServer)</strong></li>\n<li><strong>UnixStreamServer</strong></li>\n<li><strong>UnixDatagramServer</strong></li>\n</ul>\n<p>2.请求处理类</p>\n<ul>\n<li><strong>BaseRequestHandler</strong></li>\n<li><strong>StreamRequestHandler(BaseRequestHandler)</strong></li>\n<li><strong>DatagramRequestHandler(BaseRequestHandler)</strong></li>\n</ul>\n<p>通过服务器类和请求处理类的搭配，我们可以创建不同类型的服务器，实现不同的协议类型。本文介绍的BaseHTTPServer模块便是继承TCPServer和StreamRequestHandler，实现了Web服务器的通信。</p>\n<h1 id=\"HTTP服务器\">HTTP服务器</h1>\n<p>HTTP服务器继承自SocketServer模块中的<strong>TCPServer</strong>类。它的定义非常简单，只是重写了其中的一个方法。</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4cf7d6932674172\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass HTTPServer(SocketServer.TCPServer):\r\n    allow_reuse_address = 1    # Seems to make sense in testing environment\r\n    def server_bind(self):\r\n        \"\"\"Override server_bind to store the server name.\"\"\"\r\n        SocketServer.TCPServer.server_bind(self)\r\n        host, port = self.socket.getsockname()[:2]\r\n        self.server_name = socket.getfqdn(host)\r\n        self.server_port = port</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4cf7d6932674172-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4cf7d6932674172-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4cf7d6932674172-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4cf7d6932674172-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4cf7d6932674172-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4cf7d6932674172-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4cf7d6932674172-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4cf7d6932674172-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4cf7d6932674172-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HTTPServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">SocketServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TCPServer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4cf7d6932674172-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allow_reuse_address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Seems to make sense in testing environment</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4cf7d6932674172-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">server_bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4cf7d6932674172-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"Override server_bind to store the server name.\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4cf7d6932674172-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">SocketServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">TCPServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">server_bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4cf7d6932674172-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getsockname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4cf7d6932674172-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">server_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getfqdn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4cf7d6932674172-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">server_port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>重写的<strong>server_bind()</strong>方法主要是为了获取服务器名和端口。其余方法以及服务器的实现过程详见<a title=\"SocketServer——网络通信服务器\" href=\"http://python.jobbole.com/88626/\">SocketServer——网络通信服务器</a>。</p>\n<p>此外，还可以从SocketServer模块中引入’mix-in’类，基于<strong>HTTPServer</strong>创建支持进程或线程的服务器。</p>\n<h1 id=\"HTTP请求处理基类\">HTTP请求处理基类</h1>\n<p>为了处理HTTP请求，BaseHTTPServer模块构造了HTTP请求处理基类<strong>BaseHTTPRequestHandler</strong>，它继承自SocketServer模块中的<strong>StreamRequestHandler</strong>类。</p>\n<p>HTTP请求处理基类中有一些重要的方法：</p>\n<p>1.<strong>handle()</strong> ——这个方法是请求处理类真正处理请求具体工作的方法，例如解析到来的请求，处理数据，并发回响应等。在<strong>BaseHTTPRequestHandler</strong>中它是一个入口文件，将调用其他的方法完成请求处理。</p>\n<p>2.<strong>handle_one_request()</strong> ——由<strong>handle()</strong>调用，用于处理请求。其主要工作包括：</p>\n<ul>\n<li>调用<strong>parse_request()</strong>方法，解析请求，获取请求报文中的信息，包括请求的方法、请求URL、请求的HTTP版本号、请求首部等。如果解析失败，则调用<strong>send_error()</strong>方法发回一个错误响应。</li>\n<li>调用<strong>do_SPAM()</strong> 方法。这个方法中的<strong>SPAM</strong>指代<strong>GET</strong>、<strong>POST</strong>、<strong>HEAD</strong>等请求方法，需要在请求处理类中构建具体的请求处理方法，例如<strong>do_GET</strong>处理<strong>GET</strong>请求，<strong>do_POST</strong>处理<strong>POST</strong>请求。<strong>do_SPAM()</strong> 方法可以调用<strong>send_response()</strong>、<strong>send_header()</strong>、<strong>end_headers()</strong>等方法创建响应首行和响应首部等内容。</li>\n</ul>\n<p>3.<strong>parse_request()</strong> ——解析请求。</p>\n<p>4.<strong>send_error()</strong> ——发回错误响应。</p>\n<p>5.<strong>send_response()</strong> ——创建响应首行和响应首部等内容。</p>\n<p>6.<strong>send_header()</strong> ——设置响应首部内容。</p>\n<p>7.<strong>end_headers()</strong> ——调用此方法可以在首部后增加一个空行，表示首部内容结束（不适用于HTTP/0.9）</p>\n<p>8.还包括其他的一些辅助函数。</p>\n<p>需要注意的是：<strong>BaseHTTPRequestHandler</strong>是HTTP请求处理的基类，并不包含诸如<strong>do_GET</strong>、<strong>do_POST</strong>等方法，其他继承该类的请求处理类需要自己实现这些方法，已完成对具体请求的处理。对此，可以参考<strong>SimpleHTTPServer</strong>模块，也可查看文章<a title=\"SimpleHTTPServer——一个简单的HTTP服务器\" href=\"http://python.jobbole.com/?p=88632&amp;preview=true\">SimpleHTTPServer——一个简单的HTTP服务器</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88629\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88629votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88629\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "tags": "基础知识,httpserver,web开发", "url_object_id": "cc9b55d94cd0e34594f0d4054f57b3fe", "praise_nums": "1", "url": "http://python.jobbole.com/88629/", "title": "BaseHTTPServer ——实现 Web 服务器", "create_date": "2017/09/20", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/SimpleHTTPServer%E2%80%94%E2%80%94%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8/\">Learn Python</a>   </div><p>Python标准库中的<strong>BaseHTTPServer</strong>模块实现了一个基础的HTTP服务器基类和HTTP请求处理类。这在文章<a title=\"BaseHTTPServer——实现Web服务器\" href=\"http://python.jobbole.com/88629/\">BaseHTTPServer——实现Web服务器</a>中进行了相关的介绍。然而，<strong>BaseHTTPServer</strong>模块中并没有定义相关的请求方法，诸如<strong>GET</strong>、<strong>HEAD</strong>、<strong>POST</strong>等。在<strong>BaseHTTPServer</strong>模块的基础上，Python标准库中的<strong>SimpleHTTPServer</strong>模块实现了简单的<strong>GET</strong>、<strong>HEAD</strong>请求。</p>\n<p>在该模块中，它沿用了<strong>BaseHTTPServer</strong>模块中实现的<strong>HTTPServer</strong>服务器，这里就不再赘述。而请求处理类则是继承了<strong>BaseHTTPServer</strong>模块中的<strong>BaseHTTPRequestHandler</strong>类。<strong>SimpleHTTPServer</strong>模块实现了具有<strong>GET</strong>、<strong>HEAD</strong>请求方法的HTTP通信服务。根据文章<a title=\"BaseHTTPServer——实现Web服务器\" href=\"http://python.jobbole.com/88629/\">BaseHTTPServer——实现Web服务器</a>中的介绍，只需要在请求处理类中定义<strong>do_GET()</strong>和<strong>do_HEAD()</strong>方法即可。</p>\n<h1 id=\"do-GET\"><strong><strong>do_GET()</strong></strong></h1>\n<p><strong>do_GET()</strong>方法的源码如下：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4de37b536721355\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef do_GET(self):\r\n    \"\"\"Serve a GET request.\"\"\"\r\n    f = self.send_head()\r\n    if f:\r\n        try:\r\n            self.copyfile(f, self.wfile)\r\n        finally:\r\n            f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4de37b536721355-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de37b536721355-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4de37b536721355-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de37b536721355-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4de37b536721355-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de37b536721355-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4de37b536721355-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de37b536721355-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4de37b536721355-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_GET</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de37b536721355-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Serve a GET request.\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4de37b536721355-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de37b536721355-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4de37b536721355-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de37b536721355-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copyfile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wfile</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4de37b536721355-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de37b536721355-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>在这个方法中，它调用了<strong>send_head()</strong>方法来返回一个响应。<strong>send_head()</strong>方法会调用<strong>send_response()</strong>、<strong>send_header()</strong>、<strong>send_error()</strong>方法等设置响应报文等。</p>\n<h1 id=\"do-HEAD\"><strong><strong>do_HEAD()</strong></strong></h1>\n<p><strong>do_HEAD()</strong>方法的源码如下：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4de397280700972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef do_HEAD(self):\r\n    \"\"\"Serve a HEAD request.\"\"\"\r\n    f = self.send_head()\r\n    if f:\r\n        f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4de397280700972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de397280700972-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4de397280700972-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4de397280700972-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4de397280700972-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4de397280700972-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_HEAD</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de397280700972-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Serve a HEAD request.\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4de397280700972-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4de397280700972-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4de397280700972-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p><strong>do_HEAD()</strong>方法和<strong>do_GET()</strong>方法的实现类似。</p>\n<h1 id=\"测试例子\">测试例子</h1>\n<p><strong>SimpleHTTPServer</strong>模块还提供了一个测试函数。只需要在命令行中运行如下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4de39f927378812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npython SimpleHTTPServer.py  # SimpleHTTPServer.py指代Python标准库中的SimpleHTTPServer模块，注意文件位置。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4de39f927378812-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4de39f927378812-1\"><span class=\"crayon-e\">python </span><span class=\"crayon-k \">SimpleHTTPServer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># SimpleHTTPServer.py指代Python标准库中的SimpleHTTPServer模块，注意文件位置。</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>如果在本地环境中运行以上代码，将会调用请求处理类的<strong>translate_path</strong>和<strong>list_directory</strong>方法展示一个文件目录。</p>\n<p>然后在浏览器中访问<strong>127.0.0.1:8000</strong>即可查看<strong>SimpleHTTPServer.py</strong>文件所在目录下的所有文件。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88632\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88632votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88632\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/3cccc8c943fe706b4be2fc3d02ba4a1e.jpg"], "tags": "基础知识,simpleHTTPServer", "url_object_id": "96b6b5fd5955a760fbf5f00cf9f14a92", "praise_nums": "1", "url": "http://python.jobbole.com/88632/", "title": "SimpleHTTPServer ——一个简单的HTTP服务器", "create_date": "2017/09/20", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Flask/Flask%E5%BA%94%E7%94%A8%E4%B8%AD%E7%9A%84URL%E5%A4%84%E7%90%86/\">Learn Python</a>   </div><p>在文章：<a title=\"一个Flask应用运行过程剖析\" href=\"/Flask/%E4%B8%80%E4%B8%AAFlask%E5%BA%94%E7%94%A8%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E5%89%96%E6%9E%90/\">一个Flask应用运行过程剖析</a>中，在一个上下文环境中可以处理请求。如果不考虑在处理请求前后做的一些操作，Flask源码中真正处理请求的是<strong>dispatch_request()</strong>方法。其源码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce011475777244\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef dispatch_request(self):\r\n    \"\"\"Does the request dispatching.  Matches the URL and returns the\r\n    return value of the view or error handler.  This does not have to\r\n    be a response object.  In order to convert the return value to a\r\n    proper response object, call :func:`make_response`.\r\n    \"\"\"\r\n    try:\r\n        endpoint, values = self.match_request()\r\n        return self.view_functions[endpoint](**values)\r\n    except HTTPException, e:\r\n        handler = self.error_handlers.get(e.code)\r\n        if handler is None:\r\n            return e\r\n        return handler(e)\r\n    except Exception, e:\r\n        handler = self.error_handlers.get(500)\r\n        if self.debug or handler is None:\r\n            raise\r\n        return handler(e)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce011475777244-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce011475777244-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dispatch_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Does the request dispatching.  Matches the URL and returns the</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-3\"><span class=\"crayon-s\">    return value of the view or error handler.  This does not have to</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-4\"><span class=\"crayon-s\">    be a response object.  In order to convert the return value to a</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-5\"><span class=\"crayon-s\">    proper response object, call :func:`make_response`.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-6\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">match_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">view_functions</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HTTPException</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">handler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_handlers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">code</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handler </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">e</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">handler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error_handlers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handler </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce011475777244-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">raise</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce011475777244-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0067 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>从上面的源码中可以看到，<strong>dispatch_request()</strong>方法做了如下的工作：</p>\n<ol>\n<li>对请求的URL进行匹配；</li>\n<li>如果URL可以匹配，则返回相对应视图函数的结果；</li>\n<li>如果不可以匹配，则进行错误处理。</li>\n</ol>\n<p>对于错误的处理，本文暂不做介绍。本文主要对Flask应用的URL模式以及请求处理过程中的URL匹配进行剖析。</p>\n<h1 id=\"Flask应用的url-map\">Flask应用的<strong>url_map</strong></h1>\n<p>Flask应用实例化的时候，会为应用增添一个<strong>url_map</strong>属性。这个属性是一个<strong>Map</strong>类，这个类在<strong>werkzeug.routing</strong>模块中定义，其主要的功能是为了给应用增加一些URL规则，这些URL规则形成一个<strong>Map</strong>实例的过程中会生成对应的正则表达式，可以进行URL匹配。相关的概念和内容可以参考：<a title=\"Werkzeug库——routing模块\" href=\"/Flask/Werkzeug%E5%BA%93%E2%80%94%E2%80%94routing%E6%A8%A1%E5%9D%97/\">Werkzeug库——routing模块</a>。</p>\n<p>在Flask源码中，它通过两个方法可以很方便地定制应用的URL。这两个方法是：<strong>route</strong>装饰器和<strong>add_url_rule</strong>方法。</p>\n<h4 id=\"1-add-url-rule\">1. <strong>add_url_rule</strong></h4>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce01c658314382\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef add_url_rule(self, rule, endpoint, **options):\r\n    options['endpoint'] = endpoint\r\n    options.setdefault('methods', ('GET',))\r\n    self.url_map.add(Rule(rule, **options))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce01c658314382-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce01c658314382-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce01c658314382-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce01c658314382-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce01c658314382-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_url_rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce01c658314382-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'endpoint'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">endpoint</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce01c658314382-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'methods'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce01c658314382-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url_map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p><strong>add_url_rule</strong>方法很简单，只要向其传递一条URL规则<strong>rule</strong>和一个<strong>endpoint</strong>即可。<strong>endpoint</strong>一般为和这条URL相关的视图函数的名字，这样处理就可以将URL和视图函数关联起来。除此之外，还可以传递一些关键字参数。调用该方法后，会调用<strong>Map</strong>实例的<strong>add</strong>方法，它会将URL规则添加进<strong>Map</strong>实例中。</p>\n<h4 id=\"2-route装饰器\">2. <strong>route装饰器</strong></h4>\n<p>为了更加方便、优雅地写应用的URL，Flask实现了一个<strong>route</strong>装饰器。</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce022773369960\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef route(self, rule, **options):\r\n    def decorator(f):\r\n        self.add_url_rule(rule, f.__name__, **options)\r\n        self.view_functions[f.__name__] = f\r\n        return f\r\n    return decorator</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce022773369960-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce022773369960-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce022773369960-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce022773369960-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce022773369960-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce022773369960-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce022773369960-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce022773369960-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce022773369960-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_url_rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce022773369960-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">view_functions</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce022773369960-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce022773369960-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorator</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p><strong>route</strong>装饰器会装饰一个视图函数。经<strong>route</strong>装饰的视图函数首先会调用<strong>add_url_rule</strong>方法，将装饰器中的URL规则添加进<strong>Map</strong>实例中，视图函数的名字会作为<strong>endpoint</strong>进行传递。然后在该应用的<strong>view_functions</strong>中增加<strong>endpoint</strong>和视图函数的对应关系。这种对应关系可以在请求成功时方便地调用对应的视图函数。</p>\n<h4 id=\"3-一个简单的例子\">3. 一个简单的例子</h4>\n<p>我们用一个简单的例子来说明以上过程的实现：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce028735950126\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; from flask import Flask\r\n&gt;&gt;&gt; app = Flask(__name__)\r\n&gt;&gt;&gt; @app.route('/')\r\n    def index():\r\n        return \"Hello, World!\"\r\n&gt;&gt;&gt; @app.route('/&lt;username&gt;')\r\n    def user(username):\r\n        return \"Hello, %s\" % username\r\n&gt;&gt;&gt; @app.route('/page/&lt;int:id&gt;')\r\n    def page(id):\r\n        return \"This is page %d\" % id</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce028735950126-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce028735950126-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce028735950126-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce028735950126-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce028735950126-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce028735950126-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce028735950126-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce028735950126-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, World!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce028735950126-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/&lt;username&gt;'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">username</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce028735950126-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello, %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">username</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/page/&lt;int:id&gt;'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce028735950126-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce028735950126-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is page %d\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>以上代码，我们创建了一个Flask应用<strong>app</strong>，并且通过<strong>route</strong>装饰器的形式为<strong>app</strong>增加了3条URL规则。</p>\n<p><strong>首先：</strong> 我们看一下Flask应用的<strong>url_map</strong>长啥样：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce02b419426245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; url_map = app.url_map\r\n&gt;&gt;&gt; url_map\r\nMap([&lt;Rule '/' (HEAD, GET) -&gt; index&gt;,\r\n     &lt;Rule '/static/&lt;filename&gt;' -&gt; static&gt;,\r\n     &lt;Rule '/page/&lt;id&gt;' (HEAD, GET) -&gt; page&gt;,\r\n     &lt;Rule '/&lt;username&gt;' (HEAD, GET) -&gt; user&gt;\r\n    ])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02b419426245-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02b419426245-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02b419426245-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02b419426245-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02b419426245-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02b419426245-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02b419426245-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce02b419426245-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_map</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url_map</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02b419426245-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url_map</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02b419426245-3\"><span class=\"crayon-k \">Map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02b419426245-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02b419426245-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/page/&lt;id&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02b419426245-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/&lt;username&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02b419426245-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>可以看到，<strong>url_map</strong>是一个<strong>Map</strong>实例，这个实例中包含4个<strong>Rule</strong>实例，分别对应4条URL规则，其中<strong>/static/&lt;filename&gt;</strong>在Flask应用实例化时会自动添加，其余3条是用户创建的。整个<strong>Map</strong>类便构成了Flask应用<strong>app</strong>的URL“地图”，可以用作URL匹配的依据。</p>\n<p><strong>接下来：</strong> 我们看一下<strong>url_map</strong>中的一个属性：<strong>_rules_by_endpoint</strong>：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce02f448952631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; rules_by_endpoint = url_map._rules_by_endpoint\r\n&gt;&gt;&gt; rules_by_endpoint\r\n{'index': [&lt;Rule '/' (HEAD, GET) -&gt; index&gt;],\r\n 'page': [&lt;Rule '/page/&lt;id&gt;' (HEAD, GET) -&gt; page&gt;],\r\n 'static': [&lt;Rule '/static/&lt;filename&gt;' -&gt; static&gt;],\r\n 'user': [&lt;Rule '/&lt;username&gt;' (HEAD, GET) -&gt; user&gt;]\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02f448952631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02f448952631-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02f448952631-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02f448952631-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02f448952631-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce02f448952631-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce02f448952631-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce02f448952631-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rules_by_endpoint</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_rules_by_endpoint</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02f448952631-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rules_by_endpoint</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02f448952631-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02f448952631-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'page'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/page/&lt;id&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02f448952631-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'static'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce02f448952631-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'user'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/&lt;username&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce02f448952631-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>可以看出，<strong>_rules_by_endpoint</strong>属性是一个字典，反映了<strong>endpoint</strong>和URL规则的对应关系。由于用<strong>route</strong>装饰器创建URL规则时，会将视图函数的名字作为<strong>endpoint</strong>进行传递，所以以上字典的内容也反映了视图函数和URL规则的对应关系。</p>\n<p><strong>再接下来：</strong> 我们看一下Flask应用的<strong>view_functions</strong>：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce033115415821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; view_functions = app.view_functions\r\n&gt;&gt;&gt; view_functions\r\n{'index': &lt;function __main__.index&gt;,\r\n 'page': &lt;function __main__.page&gt;,\r\n 'user': &lt;function __main__.user&gt;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce033115415821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce033115415821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce033115415821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce033115415821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce033115415821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce033115415821-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce033115415821-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view_functions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">view_functions</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce033115415821-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">view_functions</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce033115415821-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce033115415821-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'page'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce033115415821-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'user'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">user</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce033115415821-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>在用<strong>route</strong>装饰器创建URL规则时，它还会做一件事情：<strong>self.view_functions[f.__name__] = f</strong>。这样做是将函数名和视图函数的对应关系放在Flask应用的<strong>view_functions</strong>。由于<strong>Map</strong>实例中存储了函数名和URL规则的对应关系，这样只要在匹配URL规则时，如果匹配成功，只要返回一个函数名，那么便可以在<strong>view_functions</strong>中运行对应的视图函数。</p>\n<p><strong>最后：</strong> 我们看一下URL如何和<strong>Map</strong>实例中的URL规则进行匹配。我们以<strong>/page/&lt;int:id&gt;</strong>这条规则为例：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce037398541290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; rule = url_map._rules[2]\r\n&gt;&gt;&gt; rule\r\n&lt;Rule '/page/&lt;id&gt;' (HEAD, GET) -&gt; page&gt;\r\n&gt;&gt;&gt; rule._regex\r\nre.compile(ur'^\\|\\/page\\/(?P&lt;id&gt;\\d+)$', re.UNICODE)\r\n&gt;&gt;&gt; rule._regex.pattern\r\nu'^\\\\|\\\\/page\\\\/(?P&lt;id&gt;\\\\d+)$'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce037398541290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce037398541290-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce037398541290-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce037398541290-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce037398541290-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce037398541290-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce037398541290-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce037398541290-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_rules</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce037398541290-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce037398541290-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/page/&lt;id&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce037398541290-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_regex</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce037398541290-5\"><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">compile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">ur</span><span class=\"crayon-s\">'^\\|\\/page\\/(?P&lt;id&gt;\\d+)$'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">UNICODE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce037398541290-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rule</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_regex</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pattern</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce037398541290-7\"><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'^\\\\|\\\\/page\\\\/(?P&lt;id&gt;\\\\d+)$'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>可以看到，在将一条URL规则的实例<strong>Rule</strong>添加进<strong>Map</strong>实例的时候，会为这个<strong>Rule</strong>生成一个正则表达式的属性<strong>_regex</strong>。这样当这个Flask应用处理请求时，实际上会将请求中的url和Flask应用中每一条URL规则的正则表达式进行匹配。如果匹配成功，则会返回<strong>endpoint</strong>和一些参数，返回的<strong>endpoint</strong>可以用来在<strong>view_functions</strong>找到对应的视图函数，返回的参数可以传递给视图函数。具体的过程就是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ce03a609659740\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry:\r\n    # match_request()可以进行URL匹配\r\n    endpoint, values = self.match_request()\r\n    return self.view_functions[endpoint](**values)\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce03a609659740-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce03a609659740-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce03a609659740-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ce03a609659740-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ce03a609659740-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ce03a609659740-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce03a609659740-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># match_request()可以进行URL匹配</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce03a609659740-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">match_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ce03a609659740-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">view_functions</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ce03a609659740-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88618\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88618votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88618\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e6345801.png"], "tags": "工具与框架,Flask", "url_object_id": "9a0736825ab3f1913fb4e2a5dbbe1a70", "praise_nums": "1", "url": "http://python.jobbole.com/88618/", "title": "Flask 应用中的 URL 处理", "create_date": "2017/09/20", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/SocketServer%E2%80%94%E2%80%94%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%9C%8D%E5%8A%A1%E5%99%A8/\">Learn Python</a>   </div><p>SocketServer是Python标准库中的一个模块，其作用是创建网络服务器。SocketServer模块定义了一些类来处理诸如TCP、UDP、UNIX流和UNIX数据报之上的同步网络请求。</p>\n<p>SocketServer模块处理网络请求的功能，可以通过两个主要的类来实现：一个是服务器类，一个是请求处理类。</p>\n<ul>\n<li><strong>服务器类</strong> 处理通信问题，如监听一个套接字并接收连接等；</li>\n<li><strong>请求处理类</strong> 处理“协议”问题，如解释到来的数据、处理数据并把数据发回给客户端等。</li>\n</ul>\n<p>这种实现将服务器的实现过程和请求处理的实现过程解耦，这意味着我们可以将不同的服务器实现和请求处理实现结合起来来处理一些定制的协议，例如一个TCP服务器类和一个流请求处理类结合，处理基于TCP的网络请求。同时，也可以基于SocketServer模块中的服务器类和请求处理类，实现网络层之上应用层的服务器和请求处理实现，例如基于TCP服务器类实现HTTP服务器，基于流处理请求类实现HTTP请求处理类等。</p>\n<h1 id=\"服务器类\">服务器类</h1>\n<p>SocketServer模块中定义了五种服务器类。</p>\n<ul>\n<li>BaseServer(服务器的基类，定义了API)</li>\n<li>TCPServer(使用TCP/IP套接字)</li>\n<li>UDPServer(使用数据报套接字)</li>\n<li>UnixStreamServer(使用UNIX域套接字，只适用UNIX平台)</li>\n<li>UnixDatagramServer(使用UNIX域套接字，只适用UNIX平台)</li>\n</ul>\n<h2 id=\"1-构造服务器对象\">1. 构造服务器对象</h2>\n<p>要构建一个服务器对象，需要向它传递一个地址<strong>server_address</strong>（服务器将在这个地址上监听请求），以及一个请求处理类<strong>RequestHandlerClass</strong>（不是请求处理实例）。服务器类基类的构造函数如下：</p>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4c9d41286920771\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass BaseServer:\r\n    def __init__(self, server_address, RequestHandlerClass):\r\n        \"\"\"Constructor.  May be extended, do not override.\"\"\"\r\n        self.server_address = server_address\r\n        self.RequestHandlerClass = RequestHandlerClass\r\n        self.__is_shut_down = threading.Event()\r\n        self.__shutdown_request = False</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d41286920771-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d41286920771-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d41286920771-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d41286920771-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d41286920771-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d41286920771-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d41286920771-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4c9d41286920771-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BaseServer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d41286920771-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_address</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RequestHandlerClass</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d41286920771-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"Constructor.  May be extended, do not override.\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d41286920771-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">server_address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">server_address</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d41286920771-5\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RequestHandlerClass</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RequestHandlerClass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d41286920771-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__is_shut_down</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Event</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d41286920771-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__shutdown_request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>之后，可以构造TCPServer、UDPServer、UnixStreamServer、UnixDatagramServer。其中，TCPServer继承自BaseServer，UDPServer和UnixStreamServer继承自TCPServer，UnixDatagramServer继承自UDPServer。各个服务器类型可以根据自己的特点对基类进行扩展，例如创建监听套接字、绑定监听地址和端口、进行监听等。一旦实例化服务器对象，便可以使用服务器的方法来监听和处理请求。</p>\n<h2 id=\"2-实现服务器\">2. 实现服务器</h2>\n<p>由于SocketServer模块中定义的五种服务器类中，除了基类BaseServer和TCPServer外，其余的三个类都是直接或间接地继承自TCPServer。因此，以下以TCPServer的实现过程为例进行说明。</p>\n<ol>\n<li><strong>构造TCPServer</strong>。 构造TCPServer时，构造函数创建了一个套接字（这个套接字可以通过更改地址簇和类型用于其他服务器）用于监听请求。并且调用<strong>server_bind()</strong>绑定监听的地址和端口，调用<strong>server_activate()</strong>开始监听。</li>\n<li><strong>启动服务器</strong>。 服务器实例化后，可以使用<strong>serve_forever()</strong>或者<strong>handle_request()</strong>来监听和处理请求，实现服务器功能。这两个方法的具体实现依赖于<strong>_handle_request_noblock()</strong>方法。这个方法是BaseServer类中定义的。具体实现如下：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4c9d53350690790\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _handle_request_noblock(self):\r\n    \"\"\"Handle one request, without blocking.\r\n    I assume that select.select has returned that the socket is\r\n    readable before this function was called, so there should be\r\n    no risk of blocking in get_request().\r\n    \"\"\"\r\n    try:\r\n        request, client_address = self.get_request()\r\n    except socket.error:\r\n        return\r\n    if self.verify_request(request, client_address):\r\n        try:\r\n            self.process_request(request, client_address)\r\n        except:\r\n            self.handle_error(request, client_address)\r\n            self.shutdown_request(request)\r\n    else:\r\n        self.shutdown_request(request)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4c9d53350690790-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4c9d53350690790-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_handle_request_noblock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Handle one request, without blocking.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-3\"><span class=\"crayon-s\">    I assume that select.select has returned that the socket is</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-4\"><span class=\"crayon-s\">    readable before this function was called, so there should be</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-5\"><span class=\"crayon-s\">    no risk of blocking in get_request().</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-6\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">verify_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_address</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">handle_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shutdown_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4c9d53350690790-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4c9d53350690790-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shutdown_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</li>\n<li><strong>处理请求</strong>。 根据上一步骤启动服务器后，服务器便开始监听请求。如果接收到请求信息，便开始处理请求。由<strong>_handle_request_noblock()</strong>可以看出有几个函数比较重要。</li>\n</ol>\n<ul>\n<li><strong>get_request()</strong> ——这个函数可以在子类中重写。在TCPServer中，该函数调用监听套接字的<strong>accept()</strong>方法，返回请求<strong>request</strong>和客户端地址<strong>client_address</strong>。</li>\n<li><strong>verify_request(request, client_address)</strong> ——这个函数可以在子类中重写。该函数返回True表示处理请求，返回False表示忽略请求。</li>\n<li><strong>process_request(request, client_address)</strong> ——这个函数可以在子类中重写。该函数将调用<strong>finish_request()</strong>具体完成请求的处理过程，并且在处理完请求后关闭请求。</li>\n<li><strong>finish_request(request, client_address)</strong> ——该函数将构造一个请求处理类的实例。请求处理类被实例化后将调用其<strong>handle()</strong>方法处理请求。</li>\n</ul>\n<h2 id=\"3-进程-线程支持\">3. 进程/线程支持</h2>\n<p>SocketServer模块中还提供了一些”mix-in”类：<strong>ForkingMixIn</strong>和<strong>ThreadingMixIn</strong>。这些类可以和服务器类混合使用，很容易改变服务器，为每个请求使用一个单独的进程或线程。具体的服务器类有：</p>\n<ul>\n<li><strong>class ForkingUDPServer(ForkingMixIn, UDPServer)</strong></li>\n<li><strong>class ForkingTCPServer(ForkingMixIn, TCPServer)</strong></li>\n<li><strong>class ThreadingUDPServer(ThreadingMixIn, UDPServer)</strong></li>\n<li><strong>class ThreadingTCPServer(ThreadingMixIn, TCPServer)</strong></li>\n<li><strong>class ThreadingUnixStreamServer(ThreadingMixIn, UnixStreamServer)</strong></li>\n<li><strong>class ThreadingUnixDatagramServer(ThreadingMixIn, UnixDatagramServer)</strong></li>\n</ul>\n<h1 id=\"请求处理类\">请求处理类</h1>\n<p>要接收到来的请求以及确定采取什么行动，其中大部分的工作都是由请求处理类完成的。请求处理类负责在套接字层之上实现协议。具体过程为：读取请求、处理请求、写回响应。请求处理类基类中定义了3个方法，子类中需要重写。</p>\n<ul>\n<li><strong>setup()</strong> ——为请求准备请求处理器</li>\n<li><strong>handle()</strong> ——对请求完成具体的工作。诸如解析到来的请求，处理数据，并发回响应等。</li>\n<li><strong>finish()</strong> ——清理<strong>setup()</strong>期间创建的所有数据</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88626\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88626votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88626\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"], "tags": "基础知识,socketserver", "url_object_id": "fc1d45e47a1ea8ef77d8613f6b5178b3", "praise_nums": "1", "url": "http://python.jobbole.com/88626/", "title": "SocketServer ——网络通信服务器", "create_date": "2017/09/20", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><h2 id=\"前言\">前言</h2>\n<p>本文对遗传算法中的几种选择策略进行了总结, 其中包括:</p>\n<ol>\n<li>Proportionate Roulette Wheel Selection</li>\n<li>Linear Ranking Selection</li>\n<li>Exponential Ranking Selection</li>\n<li>Tournament Selection</li>\n</ol>\n<p>对于每种选择策略我都使用Python进行了相应的实现并以内置插件的形式整合进了本人所写的遗传算法框架GAFT中。对需要使用遗传算法优化问题以及学习遗传算法的童鞋可以作为参考.</p>\n<p>项目链接:</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/PytLab/gaft\" target=\"_blank\" rel=\"external\">https://github.com/PytLab/gaft</a></li>\n<li>PyPI: <a href=\"https://pypi.python.org/pypi/gaft\" target=\"_blank\" rel=\"external\">https://pypi.python.org/pypi/gaft</a></li>\n</ul>\n<h2 id=\"遗传算法中的选择算子\">遗传算法中的选择算子</h2>\n<p>遗传算法(genetic algorithms, GAs)是一种自适应的启发式搜索算法, 它模仿达尔文进化论中的“适者生存”的原则, 最终获取优化目标的最优解。下图描述了一个简单的遗传算法流程:</p>\n<p><img class=\"alignnone\" src=\"http://pytlab.org/assets/images/blog_img/2017-09-19-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E4%B8%AD%E5%87%A0%E7%A7%8D%E4%B8%8D%E5%90%8C%E9%80%89%E6%8B%A9%E7%AE%97%E5%AD%90%E7%9A%84%E6%AF%94%E8%BE%83/flowchart.png\" width=\"564\" height=\"402\"></p>\n<p>对于种群中需要进行杂交的物种选择方法有很多，而且选择一种合适的选择策略对于遗传算法整体性能的影响将是很大的。如果一个选择算法选择多样性降低，便会导致种群过早的收敛到局部最优点而不是我们想要的全局最优点，也就是所谓的”早熟”。而选择策略过于发散则会导致算法难以收敛到最优点。因此在这两点中我们需要进行平衡才能使遗传算法以一种高效的方式收敛到全局最优点。</p>\n<h2 id=\"GAFT框架中的算子插件\">GAFT框架中的算子插件</h2>\n<p>GAFT是我根据自己需求开发的一个遗传算法框架，相关介绍的博客可以参见《<a href=\"http://python.jobbole.com/88069/\" target=\"_blank\" rel=\"external\">GAFT-一个使用Python实现的遗传算法框架</a>》,《<a href=\"http://python.jobbole.com/88242/\" target=\"_blank\" rel=\"external\">使用MPI并行化遗传算法框架GAFT</a>》。该框架提供了插件接口，用户可以通过自定义算子以及on-the-fly分析插件来放到gaft框架中运行遗传算法流程对目标问题进行优化。</p>\n<p>本部分我稍微介绍下gaft关于遗传算子相关接口规范，以及编写能用于gaft的算子的编写方法。</p>\n<p>在gaft中遗传算子的编写都是需要继承框架内置的基类，然后根据基类提供的接口，实现自己的算子。其中基类的定义都在<a href=\"https://github.com/PytLab/gaft/tree/master/gaft/plugin_interfaces/operators\" target=\"_blank\" rel=\"external\"><code>/gaft/plugin_interfaces/operators/</code></a>目录下，下面我以选择算子为例，介绍下接口。</p>\n<p>gaft中选择算子的基类为<code>GASelection</code>，其中在遗传算法流程中会调用该类实例的<code>select</code>方法，进而根据算子中的相关选择策略完成从种群中选取一对物种作为父亲和母亲产生子代。基类的定义为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dfcf2562080018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass GASelection(metaclass=SelectionMeta):\r\n    '''\r\n    Class for providing an interface to easily extend the behavior of selection\r\n    operation.\r\n    '''\r\n    def select(self, population, fitness):\r\n        '''\r\n        Called when we need to select parents from a population to later breeding.\r\n        :param population: The current population.\r\n        :type population: GAPopulation\r\n        :return parents: Two selected individuals for crossover.\r\n        :type parents: Tuple of tow GAIndividual objects.\r\n        '''\r\n        raise NotImplementedError</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfcf2562080018-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfcf2562080018-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GASelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">metaclass</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">SelectionMeta</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-3\"><span class=\"crayon-s\">    Class for providing an interface to easily extend the behavior of selection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-4\"><span class=\"crayon-s\">    operation.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-5\"><span class=\"crayon-s\">    '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-8\"><span class=\"crayon-s\">        Called when we need to select parents from a population to later breeding.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-9\"><span class=\"crayon-s\">        :param population: The current population.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-10\"><span class=\"crayon-s\">        :type population: GAPopulation</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-11\"><span class=\"crayon-s\">        :return parents: Two selected individuals for crossover.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-12\"><span class=\"crayon-s\">        :type parents: Tuple of tow GAIndividual objects.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfcf2562080018-13\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfcf2562080018-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">NotImplementedError</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><code>select</code>的方法的参数为当前种群<code>population</code>以及相应的适应度函数<code>fitness</code>，其中<code>population</code>需要是<code>GAPopulation</code>对象，<code>fitness</code>也必须是callable的对象。</p>\n<p>当然，这些在Python这种动态类型语言中貌似看起来有些鸡肋，但是为了能够更加规范使用者，我<strong>利用Python的元类在实例化类对象的时候对接口的实现以及接口的参数类型加以限制</strong>。具体的实现都在<a href=\"https://github.com/PytLab/gaft/blob/master/gaft/plugin_interfaces/metaclasses.py\" target=\"_blank\" rel=\"external\"><code>/gaft/plugin_interfaces/metaclasses.py</code></a>中，有兴趣的童鞋可以看看实现方法。</p>\n<p>具体自定义算子的编写方法我将在下一部分同选择策略一起贴出来。</p>\n<h2 id=\"不同的选择策略\">不同的选择策略</h2>\n<p>本部分我主要对四种不同的选择策略进行总结并加以gaft插件形式的Python实现。</p>\n<p>选择算子决定了哪些个体将会从种群中被选择出来用于繁衍下一代种群中的新个体。其主要的原则就是:</p>\n<blockquote><p>the better is an individual; the higher is its chance of being a parent</p></blockquote>\n<p>选择算子在遗传算法迭代中将适应度函数引入进来，因为适应度函数式标定一个个体是否足够“好”的重要标准。但是选择过程又不能仅仅完全依赖于适应度函数，因为一个种群中的最优物种并不一定是在全局最优点附近。因此我们也应该给相对来说并那么“好”的个体一点机会让他们繁衍后代, 避免“早熟”。</p>\n<h3 id=\"Proportionate-Roulette-Wheel-Selection\">Proportionate Roulette Wheel Selection</h3>\n<p>此轮盘赌选择策略，是最基本的选择策略之一，种群中的个体被选中的概率与个体相应的适应度函数的值成正比。我们需要将种群中所有个体的适应度值进行累加然后归一化，最终通过随机数对随机数落在的区域对应的个体进行选取，类似赌场里面的旋转的轮盘。</p>\n<p><img class=\"alignnone\" src=\"http://pytlab.org/assets/images/blog_img/2017-09-19-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E4%B8%AD%E5%87%A0%E7%A7%8D%E4%B8%8D%E5%90%8C%E9%80%89%E6%8B%A9%E7%AE%97%E5%AD%90%E7%9A%84%E6%AF%94%E8%BE%83/roulette_wheel_selection.png\" width=\"592\" height=\"278\"></p>\n<p>每个个体<span id=\"MathJax-Element-1-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px;color: #333333;font-family: 'Open Sans', 'Helvetica Neue', Helvetica, 'Microsoft YaHei', 'WenQuanYi Micro Hei', Arial, sans-serif;background-color: #ffffff\"><span id=\"MathJax-Span-1\" class=\"math\"><span id=\"MathJax-Span-2\" class=\"mrow\"><span id=\"MathJax-Span-3\" class=\"msubsup\"><span id=\"MathJax-Span-4\" class=\"mi\">a</span><span id=\"MathJax-Span-5\" class=\"texatom\"><span id=\"MathJax-Span-6\" class=\"mrow\"><span id=\"MathJax-Span-7\" class=\"mi\">i</span></span></span></span></span></span></span>被选中的概率为:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/57a5e71c63e1e11c2771f6f7306e7651.png\"><img class=\"alignnone size-full wp-image-88612\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/57a5e71c63e1e11c2771f6f7306e7651.png\" alt=\"WX20170919-182624\"></a></p>\n<p>好了，下面可以将此算法写成一个可以gaft中执行的算子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dfd04809863339\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom random import random\r\nfrom bisect import bisect_right\r\nfrom itertools import accumulate\r\n\r\nfrom ...plugin_interfaces.operators.selection import GASelection\r\n\r\nclass RouletteWheelSelection(GASelection):\r\n    def __init__(self):\r\n        '''\r\n        Selection operator with fitness proportionate selection(FPS) or\r\n        so-called roulette-wheel selection implementation.\r\n        '''\r\n        pass\r\n\r\n    def select(self, population, fitness):\r\n        '''\r\n        Select a pair of parent using FPS algorithm.\r\n        '''\r\n        # Normalize fitness values for all individuals.\r\n        fit = [fitness(indv) for indv in population.individuals]\r\n        min_fit = min(fit)\r\n        fit = [(i - min_fit) for i in fit]\r\n\r\n        # Create roulette wheel.\r\n        sum_fit = sum(fit)\r\n        wheel = list(accumulate([i/sum_fit for i in fit]))\r\n\r\n        # Select a father and a mother.\r\n        father_idx = bisect_right(wheel, random())\r\n        father = population[father_idx]\r\n        mother_idx = (father_idx + 1) % len(wheel)\r\n        mother = population[mother_idx]\r\n\r\n        return father, mother</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd04809863339-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd04809863339-34\">34</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">bisect</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">itertools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accumulate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">plugin_interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">operators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selection </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GASelection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RouletteWheelSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GASelection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-10\"><span class=\"crayon-s\">        Selection operator with fitness proportionate selection(FPS) or</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-11\"><span class=\"crayon-s\">        so-called roulette-wheel selection implementation.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-12\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-17\"><span class=\"crayon-s\">        Select a pair of parent using FPS algorithm.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-18\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Normalize fitness values for all individuals.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">fitness</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">indv </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">individuals</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">min_fit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fit</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">min_fit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fit</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Create roulette wheel.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sum_fit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fit</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wheel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">accumulate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sum_fit </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fit</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Select a father and a mother.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd04809863339-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd04809863339-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">father</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mother</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>过程主要分为下面几个:</p>\n<ol>\n<li>继承<code>GASelection</code>类</li>\n<li>实现<code>select</code>方法</li>\n<li><code>select</code>的参数为<code>GAPopulation</code>实例和适应度函数</li>\n<li>根据算法选择出两个需要繁衍的物种并返回即可</li>\n</ol>\n<h3 id=\"Tournament-Selection\">Tournament Selection</h3>\n<p class=\" has-jax has-jax\">由于算法执行的效率以及易实现的的特点，锦标赛选择算法是遗传算法中最流行的选择策略。在本人的实际应用中的确此策略比基本的轮盘赌效果要好些。他的策略也很直观，就是我们再整个种群中抽取<span id=\"MathJax-Element-3-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-51\" class=\"math\"><span id=\"MathJax-Span-52\" class=\"mrow\"><span id=\"MathJax-Span-53\" class=\"mi\">n</span></span></span></span>个个体，让他们进行竞争(锦标赛)，抽取其中的最优的个体。参加锦标赛的个体个数成为tournament size。通常当<span id=\"MathJax-Element-4-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-54\" class=\"math\"><span id=\"MathJax-Span-55\" class=\"mrow\"><span id=\"MathJax-Span-56\" class=\"mi\">n</span><span id=\"MathJax-Span-57\" class=\"mo\">=</span><span id=\"MathJax-Span-58\" class=\"mn\">2</span></span></span></span>便是最常使用的大小，也称作Binary Tournament Selection.</p>\n<p>Tournament Selection的优势:</p>\n<ol>\n<li class=\" has-jax\">更小的复杂度<span id=\"MathJax-Element-5-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-59\" class=\"math\"><span id=\"MathJax-Span-60\" class=\"mrow\"><span id=\"MathJax-Span-61\" class=\"mi\">O</span><span id=\"MathJax-Span-62\" class=\"mo\">(</span><span id=\"MathJax-Span-63\" class=\"mi\">n</span><span id=\"MathJax-Span-64\" class=\"mo\">)</span></span></span></span></li>\n<li>易并行化处理</li>\n<li>不易陷入局部最优点</li>\n<li>不需要对所有的适应度值进行排序处理</li>\n</ol>\n<p class=\" has-jax\">下图显示了<span id=\"MathJax-Element-6-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-65\" class=\"math\"><span id=\"MathJax-Span-66\" class=\"mrow\"><span id=\"MathJax-Span-67\" class=\"mi\">n</span><span id=\"MathJax-Span-68\" class=\"mo\">=</span><span id=\"MathJax-Span-69\" class=\"mn\">3</span></span></span></span>的Tournament Selection的过程:</p>\n<p class=\" has-jax\"><img class=\"alignnone\" src=\"http://pytlab.org/assets/images/blog_img/2017-09-19-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E4%B8%AD%E5%87%A0%E7%A7%8D%E4%B8%8D%E5%90%8C%E9%80%89%E6%8B%A9%E7%AE%97%E5%AD%90%E7%9A%84%E6%AF%94%E8%BE%83/tournament_selection.png\" width=\"602\" height=\"321\"></p>\n<p class=\" has-jax\">可以开始写成自定义算子在gaft运行了:</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dfd0c801879040\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom random import sample\r\n\r\nfrom ...plugin_interfaces.operators.selection import GASelection\r\n\r\nclass TournamentSelection(GASelection):\r\n    def __init__(self, tournament_size=2):\r\n        '''\r\n        Selection operator using Tournament Strategy with tournament size equals\r\n        to two by default.\r\n        '''\r\n        self.tournament_size = tournament_size\r\n\r\n    def select(self, population, fitness):\r\n        '''\r\n        Select a pair of parent using Tournament strategy.\r\n        '''\r\n        # Competition function.\r\n        complete = lambda competitors: max(competitors, key=fitness)\r\n\r\n        # Check validity of tournament size.\r\n        if self.tournament_size &gt;= len(population):\r\n            msg = 'Tournament size({}) is larger than population size({})'\r\n            raise ValueError(msg.format(self.tournament_size, len(population)))\r\n\r\n        # Pick winners of two groups as parent.\r\n        competitors_1 = sample(population.individuals, self.tournament_size)\r\n        competitors_2 = sample(population.individuals, self.tournament_size)\r\n        father, mother = complete(competitors_1), complete(competitors_2)\r\n\r\n        return father, mother</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd0c801879040-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd0c801879040-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sample</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">plugin_interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">operators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selection </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GASelection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TournamentSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GASelection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-8\"><span class=\"crayon-s\">        Selection operator using Tournament Strategy with tournament size equals</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-9\"><span class=\"crayon-s\">        to two by default.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-10\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tournament_size</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-15\"><span class=\"crayon-s\">        Select a pair of parent using Tournament strategy.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-16\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Competition function.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">complete</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">competitors</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">competitors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Check validity of tournament size.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Tournament size({}) is larger than population size({})'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-24\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Pick winners of two groups as parent.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">competitors_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sample</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">individuals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">competitors_2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sample</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">individuals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tournament_size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mother</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">competitors_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">complete</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">competitors_2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd0c801879040-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd0c801879040-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">father</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mother</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0054 seconds] -->\r\n<p></p>\n<h3 id=\"Linear-Ranking-Selection\">Linear Ranking Selection</h3>\n<p>下面两个介绍的选择策略都是基于排序的选择策略，上面提到的第一种基本轮盘赌选择算法，有一个缺点，就是如果一个个体的适应度值为0的话，则被选中的概率将会是0, 这个个体将不能产生后代。于是我们需要一种基于排序的算法，来给每个个体安排相应的选中概率。</p>\n<p class=\" has-jax has-jax has-jax has-jax has-jax\">在Linear Ranking Selection中，种群中的个体首先根据适应度的值进行排序，然后给所有个体赋予一个序号，最好的个体为<span id=\"MathJax-Element-7-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span class=\"MJX_Assistive_MathML\">N</span></span>, 被选中的概率为<span id=\"MathJax-Element-8-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-73\" class=\"math\"><span id=\"MathJax-Span-74\" class=\"mrow\"><span id=\"MathJax-Span-75\" class=\"msubsup\"><span id=\"MathJax-Span-76\" class=\"mi\">P</span><span id=\"MathJax-Span-77\" class=\"texatom\"><span id=\"MathJax-Span-78\" class=\"mrow\"><span id=\"MathJax-Span-79\" class=\"mi\">m</span><span id=\"MathJax-Span-80\" class=\"mi\">a</span><span id=\"MathJax-Span-81\" class=\"mi\">x</span></span></span></span></span></span></span>, 最差的个体序号为<span id=\"MathJax-Element-9-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-82\" class=\"math\"><span id=\"MathJax-Span-83\" class=\"mrow\"><span id=\"MathJax-Span-84\" class=\"mn\">1</span></span></span></span>, 被选中的概率为<span id=\"MathJax-Element-10-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span class=\"MJX_Assistive_MathML\">Pmin</span></span>，于是其他的在他们中间的个体的概率便可以根据如下公式得到:</p>\n<p class=\" has-jax has-jax has-jax has-jax has-jax\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ccce76363c554c9a6937eb1d12db1b56.png\"><img class=\"alignnone size-full wp-image-88613\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ccce76363c554c9a6937eb1d12db1b56.png\" alt=\"WX20170919-222303@2x\"></a></p>\n<p class=\" has-jax has-jax has-jax has-jax has-jax\">实现代码:</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dfd12371352633\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom random import random\r\nfrom itertools import accumulate\r\nfrom bisect import bisect_right\r\n\r\nfrom ...plugin_interfaces.operators.selection import GASelection\r\n\r\nclass LinearRankingSelection(GASelection):\r\n    def __init__(self, pmin=0.1, pmax=0.9):\r\n        '''\r\n        Selection operator using Linear Ranking selection method.\r\n        Reference: Baker J E. Adaptive selection methods for genetic\r\n        algorithms[C]//Proceedings of an International Conference on Genetic\r\n        Algorithms and their applications. 1985: 101-111.\r\n        '''\r\n        # Selection probabilities for the worst and best individuals.\r\n        self.pmin, self.pmax = pmin, pmax\r\n\r\n    def select(self, population, fitness):\r\n        '''\r\n        Select a pair of parent individuals using linear ranking method.\r\n        '''\r\n        # Individual number.\r\n        NP = len(population)\r\n        # Add rank to all individuals in population.\r\n        sorted_indvs = sorted(population.individuals, key=fitness, reverse=True)\r\n\r\n        # Assign selection probabilities linearly.\r\n        # NOTE: Here the rank i belongs to {1, ..., N}\r\n        p = lambda i: (self.pmin + (self.pmax - self.pmin)*(i-1)/(NP-1))\r\n        probabilities = [self.pmin] + [p(i) for i in range(2, NP)] + [self.pmax]\r\n\r\n        # Normalize probabilities.\r\n        psum = sum(probabilities)\r\n        wheel = list(accumulate([p/psum for p in probabilities]))\r\n\r\n        # Select parents.\r\n        father_idx = bisect_right(wheel, random())\r\n        father = population[father_idx]\r\n        mother_idx = (father_idx + 1) % len(wheel)\r\n        mother = population[mother_idx]\r\n\r\n        return father, mother</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd12371352633-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd12371352633-42\">42</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">itertools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accumulate</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">bisect</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">plugin_interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">operators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selection </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GASelection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearRankingSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GASelection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pmin</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pmax</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.9</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-10\"><span class=\"crayon-s\">        Selection operator using Linear Ranking selection method.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-11\"><span class=\"crayon-s\">        Reference: Baker J E. Adaptive selection methods for genetic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-12\"><span class=\"crayon-s\">        algorithms[C]//Proceedings of an International Conference on Genetic</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-13\"><span class=\"crayon-s\">        Algorithms and their applications. 1985: 101-111.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-14\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Selection probabilities for the worst and best individuals.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmax</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pmin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pmax</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-18\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-20\"><span class=\"crayon-s\">        Select a pair of parent individuals using linear ranking method.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-21\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Individual number.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Add rank to all individuals in population.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sorted_indvs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">individuals</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-26\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Assign selection probabilities linearly.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># NOTE: Here the rank i belongs to {1, ..., N}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmax</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NP</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmin</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pmax</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Normalize probabilities.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">psum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wheel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">accumulate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">psum </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Select parents.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd12371352633-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd12371352633-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">father</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mother</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p></p>\n<h3 id=\"Exponential-Ranking-Selection\">Exponential Ranking Selection</h3>\n<p class=\" has-jax has-jax has-jax\">类似上面的Linear Ranking选择策略，这种指数排序便是在确定每个个体的选择概率的时候使用了指数形式的表达式, 其中<span id=\"MathJax-Element-12-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-134\" class=\"math\"><span id=\"MathJax-Span-135\" class=\"mrow\"><span id=\"MathJax-Span-136\" class=\"mi\">c</span></span></span></span>为底数，满足<span id=\"MathJax-Element-13-Frame\" class=\"MathJax\" style=\"font-style: normal;font-weight: normal;line-height: normal;font-size: 16.8px;text-indent: 0px;text-align: left;letter-spacing: normal;float: none;direction: ltr;max-width: none;max-height: none;min-width: 0px;min-height: 0px;border: 0px;padding: 0px;margin: 0px\"><span id=\"MathJax-Span-137\" class=\"math\"><span id=\"MathJax-Span-138\" class=\"mrow\"><span id=\"MathJax-Span-139\" class=\"mn\">0</span><span id=\"MathJax-Span-140\" class=\"mo\">&lt;</span><span id=\"MathJax-Span-141\" class=\"mi\">c</span><span id=\"MathJax-Span-142\" class=\"mo\">&lt;</span><span id=\"MathJax-Span-143\" class=\"mn\">1</span></span></span></span>:</p>\n<p class=\" has-jax has-jax has-jax\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/eff96de9a902d02b9f89266bd3adbdba.png\"><img class=\"alignnone size-full wp-image-88614\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/eff96de9a902d02b9f89266bd3adbdba.png\" alt=\"WX20170919-222353@2x\"></a></p>\n<p class=\" has-jax has-jax has-jax\">实现代码:</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dfd19701809824\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom random import random\r\nfrom itertools import accumulate\r\nfrom bisect import bisect_right\r\n\r\nfrom ...plugin_interfaces.operators.selection import GASelection\r\n\r\nclass ExponentialRankingSelection(GASelection): \r\n    def __init__(self, base=0.5):\r\n        '''\r\n        Selection operator using Exponential Ranking selection method.\r\n        :param base: The base of exponent\r\n        :type base: float in range (0.0, 1.0)\r\n        '''\r\n        if not (0.0 &lt; base &lt; 1.0):\r\n            raise ValueError('The base of exponent c must in range (0.0, 1.0)')\r\n        self.base = base\r\n\r\n    def select(self, population, fitness):\r\n        '''\r\n        Select a pair of parent individuals using exponential ranking method.\r\n        '''\r\n        # Individual number.\r\n        NP = len(population)\r\n        # NOTE: Here the rank i belongs to {1, ..., N}\r\n        p = lambda i: self.base**(NP - i)\r\n        probabilities = [p(i) for i in range(1, NP + 1)]\r\n        # Normalize probabilities.\r\n        psum = sum(probabilities)\r\n        wheel = list(accumulate([p/psum for p in probabilities]))\r\n        # Select parents.\r\n        father_idx = bisect_right(wheel, random())\r\n        father = population[father_idx]\r\n        mother_idx = (father_idx + 1) % len(wheel)\r\n        mother = population[mother_idx]\r\n        return father, mother</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dfd19701809824-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dfd19701809824-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">itertools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accumulate</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">bisect</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">plugin_interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">operators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selection </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GASelection</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExponentialRankingSelection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GASelection</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-10\"><span class=\"crayon-s\">        Selection operator using Exponential Ranking selection method.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-11\"><span class=\"crayon-s\">        :param base: The base of exponent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-12\"><span class=\"crayon-s\">        :type base: float in range (0.0, 1.0)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-13\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'The base of exponent c must in range (0.0, 1.0)'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">base</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-18\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fitness</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-20\"><span class=\"crayon-s\">        Select a pair of parent individuals using exponential ranking method.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-21\"><span class=\"crayon-s\">        '''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Individual number.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">NP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># NOTE: Here the rank i belongs to {1, ..., N}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">base</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">p</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Normalize probabilities.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">psum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wheel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">accumulate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">psum </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">probabilities</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Select parents.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bisect_right</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">father</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">father_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wheel</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dfd19701809824-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">mother</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">population</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mother_idx</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dfd19701809824-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">father</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mother</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0093 seconds] -->\r\n<p></p>\n<h2 id=\"总结\">总结</h2>\n<p>本文对于遗传算法中四种不同的选择策略进行了介绍和总结，同时对于本文所写的遗传算法框架的自定义算子接口进行了简要的介绍，针对本文中的选择策略分别根据接口的要求实现了相应的算子，这些算子也作为GAFT框架的内置算子放入到GAFT中，对于使用GAFT的童鞋可以直接拿来使用。</p>\n<h2 id=\"参考\">参考</h2>\n<ul>\n<li>Shukla, Anupriya, Hari Mohan Pandey, and Deepti Mehrotra. “Comparative review of selection techniques in genetic algorithm.” Futuristic Trends on Computational Analysis and Knowledge Management (ABLAZE), 2015 International Conference on. IEEE, 2015.</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88608\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88608votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88608\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://pytlab.org/assets/images/blog_img/2017-09-19-%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95%E4%B8%AD%E5%87%A0%E7%A7%8D%E4%B8%8D%E5%90%8C%E9%80%89%E6%8B%A9%E7%AE%97%E5%AD%90%E7%9A%84%E6%AF%94%E8%BE%83/flowchart.png"], "tags": "实践项目,最优化,机器学习,遗传算法", "url_object_id": "2387a562d0ed95fa4ad232884f5dd7e3", "praise_nums": "1", "url": "http://python.jobbole.com/88608/", "title": "遗传算法中几种不同选择算子及Python实现", "create_date": "2017/09/19", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/wsgiref%E5%8C%85%E2%80%94%E2%80%94%E7%AC%A6%E5%90%88WSGI%E6%A0%87%E5%87%86%E7%9A%84Web%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%EF%BC%88%E4%B8%80%EF%BC%89/\">Learn Python</a>   </div><h1 id=\"引子\">引子</h1>\n<p>在前几篇文章：<a title=\"SocketServer——网络通信服务器\" href=\"http://python.jobbole.com/88626/\">SocketServer——网络通信服务器</a>、<a title=\"BaseHTTPServer——实现Web服务器\" href=\"http://python.jobbole.com/88629/\">BaseHTTPServer——实现Web服务器</a>、<a title=\"SimpleHTTPServer——一个简单的HTTP服务器\" href=\"http://python.jobbole.com/88632/\">SimpleHTTPServer——一个简单的HTTP服务器</a>，我们介绍了Python标准库对于网络通信的支持，并且还介绍了标准库中的一些模块，例如<strong>TCPServer</strong>、<strong>UDPServer</strong>、<strong>BaseHTTPServer</strong>等。这些模块能够实现基础的网路通信服务，例如TCP/UDP层的通信、HTTP应用层的通信。</p>\n<p>上述模块对于网络通信的实现，基本的流程是：</p>\n<ul>\n<li>创建一个服务器。例如TCP服务器、UDP服务器、HTTP服务器。服务器可以监听和接收请求；</li>\n<li>创建请求处理程序。请求处理程序可以解析到达的请求，并发回一个响应。</li>\n</ul>\n<p>以上流程基本上反映了Python标准库中关于网络通信的基本过程。服务器类和请求处理类的解耦，意味着很多应用可以使用某个现有的服务器类，而不需要其他任何的修改，只需要提供一个可以处理这些应用的请求处理类即可。但随着近些年网络编程越来越复杂，对于服务器网络通信提出了较大的挑战。以Web编程为例，挑战主要在于：</p>\n<ol>\n<li>服务器不再仅仅提供简单的、静态的HTML页面，更多的是要与丰富的Web应用进行相互通信。如果将请求处理程序的构建放在服务器端实现，那对于每个Web应用构建一个请求处理程序显然不现实；</li>\n<li>如果将请求处理程序的构建放在开发Web应用的过程中，那无疑增加了Web应用程序开发的难度和复杂度，也是不太理想的。</li>\n</ol>\n<p>为了解决这些问题，常用的做法是提供一个中间层，通常称为<strong>网关接口</strong>。<strong>网关接口</strong>在服务器和应用中间承担一个<strong>“翻译官”</strong>的角色。只要应用程序符合网关接口的标准，那么服务器就只要做好服务器的角色，应用程序只要做好应用程序的作用，服务器和应用程序之间的通信全靠<strong>网关接口</strong>来协调。常用的网关接口有<strong>CGI</strong>、<strong>WSGI</strong>，本文就以<strong>WSGI网关接口</strong>来对此进行说明。</p>\n<h1 id=\"WSGI网关接口\">WSGI网关接口</h1>\n<p><strong>WSGI</strong> (Python Web Server Gateway Interface, Python Web服务器网关接口)是一个Web服务器和Web应用程序之间的标准化接口，用于增进应用程序在不同的Web服务器和框架之间的可移植性。关于该标准的官方说明可以参考<a href=\"http://www.python.org/dev/peps/pep-0333\" target=\"_blank\" rel=\"external\">PEP333</a>。</p>\n<p><strong>WSGI</strong>的主要作用是在Web服务器和Web应用程序承担<strong>“翻译官”</strong>的角色。对于这一角色可以这样理解：</p>\n<ol>\n<li>Web服务器的责任在于监听和接收请求。在处理请求的时候调用<strong>WSGI</strong>提供的标准化接口，将请求的信息转给<strong>WSGI</strong>；</li>\n<li><strong>WSGI</strong>的责任在于“中转”请求和响应信息。<strong>WSGI</strong>接收到Web服务器提供的请求信息后可以做一些处理，之后通过标准化接口调用Web应用，并将请求信息传递给Web应用。同时，<strong>WSGI</strong>还将会处理Web应用返回的响应信息，并通过服务器返回给客户端；</li>\n<li>Web应用的责任在于接收请求信息，并且生成响应。</li>\n</ol>\n<p>根据以上分析，要实现符合<strong>WSGI</strong>标准的Web服务，服务器和应用程序的设计就要符合<strong>WSGI</strong>规范。</p>\n<h1 id=\"WSGI规范\">WSGI规范</h1>\n<p><strong>WSGI</strong>规范如下：</p>\n<ul>\n<li>服务器的请求处理程序中要调用符合<strong>WSGI</strong>规范的网关接口；</li>\n<li>网关接口调用应用程序，并且要定义<strong>start_response(status, headers)</strong>函数，用于返回响应；</li>\n<li>应用程序中实现一个函数或者一个可调用对象<strong>webapp(environ, start_response)</strong>。其中<strong>environ</strong>是环境设置的字典，由服务器和<strong>WSGI网关接口</strong>设置，<strong>start_response</strong>是由网关接口定义的函数。</li>\n</ul>\n<p>在Python标准库中，<strong>wsgiref</strong>包就是符合<strong>WSGI</strong>标准的Web服务实现。后面简单对<strong>wsgiref</strong>包进行介绍，以此来对符合<strong>WSGI</strong>标准的Web服务的实现过程进行梳理。</p>\n<h1 id=\"wsgiref包\">wsgiref包</h1>\n<p><strong>wsgiref</strong>包为实现<strong>WSGI</strong>标准提供了一个参考，它可以作为独立的服务器测试和调试应用程序。在实际的生产环境中尽量不要使用。<strong>wsgiref</strong>包含有以下模块：</p>\n<ul>\n<li><strong><strong>simple_server</strong>模块</strong> ——<strong>simple_server</strong>模块实现了可以运行单个<strong>WSGI</strong>应用的简单的HTTP服务器。</li>\n<li><strong><strong>headers</strong>模块</strong> ——管理响应首部的模块。</li>\n<li><strong><strong>handlers</strong>模块</strong> ——符合<strong>WSGI</strong>标准的Web服务网关接口实现。该模块包含了一些处理程序对象，用来设置<strong>WSGI</strong>执行环境，以便应用程序能够在其他的Web服务器中运行。</li>\n<li><strong><strong>validate</strong>模块</strong> ——“验证包装”模块，确保应用程序和服务器都能够按照<strong>WSGI</strong>标准进行操作。</li>\n<li><strong><strong>util</strong>模块</strong> ——一些有用的工具集。</li>\n</ul>\n<p>以上模块暂时不做详细的介绍。本文剩余内容将<strong>simple_server</strong>模块单独拿出来，以其中的测试例子简单说明符合<strong>WSGI</strong>标准的Web服务器的实现过程。</p>\n<h1 id=\"simple-server——一个简单的符合WSGI规范的服务器\">simple_server——一个简单的符合<strong>WSGI</strong>规范的服务器</h1>\n<p><strong>wsgiref</strong>包的<strong>simple_server</strong>模块实现了一个符合<strong>WSGI</strong>规范的服务器。测试代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4efe12785696892\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif __name__ == '__main__':\r\n    httpd = make_server('', 8000, demo_app)\r\n    sa = httpd.socket.getsockname()\r\n    print \"Serving HTTP on\", sa[0], \"port\", sa[1], \"...\"\r\n    import webbrowser\r\n    webbrowser.open('http://localhost:8000/xyz?abc')\r\n    httpd.handle_request()  # serve one request, then exit\r\n    httpd.server_close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe12785696892-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe12785696892-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe12785696892-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe12785696892-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe12785696892-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe12785696892-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe12785696892-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe12785696892-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4efe12785696892-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe12785696892-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_server</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">demo_app</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe12785696892-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sa</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getsockname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe12785696892-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Serving HTTP on\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sa</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"port\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sa</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"...\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe12785696892-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">webbrowser</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe12785696892-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">webbrowser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://localhost:8000/xyz?abc'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe12785696892-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">handle_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># serve one request, then exit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe12785696892-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">httpd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">server_close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<figure></figure>\n<h2 id=\"1-创建HTTP服务器\">1. 创建HTTP服务器</h2>\n<p>上述测试代码中<strong>httpd = make_server(”, 8000, demo_app)</strong>创建了一个HTTP服务器。</p>\n<p>其中<strong>make_server</strong>函数用来创建服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4efe23802313822\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef make_server(\r\n    host, port, app, server_class=WSGIServer, handler_class=WSGIRequestHandler\r\n):\r\n    \"\"\"Create a new WSGI server listening on `host` and `port` for `app`\"\"\"\r\n    server = server_class((host, port), handler_class)\r\n    server.set_app(app)\r\n    return server</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe23802313822-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe23802313822-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe23802313822-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe23802313822-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe23802313822-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe23802313822-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe23802313822-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4efe23802313822-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_server</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe23802313822-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_class</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">WSGIServer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler_class</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">WSGIRequestHandler</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe23802313822-3\"><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe23802313822-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Create a new WSGI server listening on `host` and `port` for `app`\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe23802313822-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">server_class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler_class</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe23802313822-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_app</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe23802313822-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><strong>make_server</strong>函数使用<strong>WSGIServer</strong>类构建符合<strong>WSGI</strong>规范的HTTP服务器，使用<strong>WSGIRequestHandler</strong>类作为处理请求的类，使用<strong>demo_app</strong>作为一个Web应用。该函数返回一个服务器实例，并开始监听请求。可以通过<strong>httpd.socket.getsockname()</strong>获取服务器地址和端口号。</p>\n<h2 id=\"2-使用webbrowser模块创建请求\">2. 使用<strong>webbrowser</strong>模块创建请求</h2>\n<p>紧接着，测试例子导入<strong>webbrowser</strong>模块，使用函数创建了一个请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4efe2a752423256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwebbrowser.open('http://localhost:8000/xyz?abc')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe2a752423256-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4efe2a752423256-1\"><span class=\"crayon-k \">webbrowser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://localhost:8000/xyz?abc'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<figure></figure>\n<h2 id=\"3-服务器处理请求\">3. 服务器处理请求</h2>\n<p>服务器通过<strong>handle_request()</strong>方法处理请求。关于处理请求的过程简单介绍如下：</p>\n<ul>\n<li><strong>handle_request()</strong>方法通过调用<strong>get_request</strong>、<strong>verify_request</strong>、<strong>process_request</strong>、<strong>finish_request</strong>等方法创建一个请求处理实例（该过程可以参考TCPServer、HTTPServer的实现过程）；</li>\n<li>请求处理实例调用<strong>handle()</strong>方法处理请求。<strong>handle()</strong>在<strong>WSGIRequestHandler</strong>类中进行了重写。代码如下：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4efe30573748585\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef handle(self):\r\n    \"\"\"Handle a single HTTP request\"\"\"\r\n    self.raw_requestline = self.rfile.readline(65537)\r\n    if len(self.raw_requestline) &gt; 65536:\r\n        self.requestline = ''\r\n        self.request_version = ''\r\n        self.command = ''\r\n        self.send_error(414)\r\n        return\r\n    if not self.parse_request(): # An error code has been sent, just exit\r\n        return\r\n    handler = ServerHandler(\r\n        self.rfile, self.wfile, self.get_stderr(), self.get_environ()\r\n    )\r\n    handler.request_handler = self      # backpointer for logging\r\n    handler.run(self.server.get_app())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe30573748585-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe30573748585-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Handle a single HTTP request\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">raw_requestline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rfile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">65537</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">raw_requestline</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65536</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">requestline</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request_version</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">414</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># An error code has been sent, just exit</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">handler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ServerHandler</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">wfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_stderr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_environ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe30573748585-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request_handler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\"># backpointer for logging</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe30573748585-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_app</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n\n</li>\n</ul>\n<p>上面<strong>handle()</strong>函数先解析了请求，之后创建了一个<strong>WSGI</strong>网关类实例<strong>handler</strong>，这个实例可以作为服务器和应用程序之间的接口存在。</p>\n<h2 id=\"4-WSGI网关的请求处理过程\">4. <strong>WSGI</strong>网关的请求处理过程</h2>\n<p><strong>WSGI</strong>网关的定义在<strong>handlers</strong>模块。上一步骤中通过调用<strong>WSGI</strong>网关类实例<strong>handler</strong>的<strong>run</strong>方法，<strong>WSGI</strong>网关开始处理请求。</p>\n<p><strong>run</strong>方法的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4efe36512096465\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef run(self, application):\r\n    \"\"\"Invoke the application\"\"\"\r\n    # Note to self: don't move the close()!  Asynchronous servers shouldn't\r\n    # call close() from finish_response(), so if you close() anywhere but\r\n    # the double-error branch here, you'll break asynchronous servers by\r\n    # prematurely closing.  Async servers must return from 'run()' without\r\n    # closing if there might still be output to iterate over.\r\n    try:\r\n        self.setup_environ()\r\n        self.result = application(self.environ, self.start_response)\r\n        self.finish_response()\r\n    except:\r\n        try:\r\n            self.handle_error()\r\n        except:\r\n            # If we get an error handling an error, just give up already!\r\n            self.close()\r\n            raise   # ...and let the actual server figure it out.</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4efe36512096465-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4efe36512096465-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">application</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Invoke the application\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Note to self: don't move the close()!  Asynchronous servers shouldn't</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># call close() from finish_response(), so if you close() anywhere but</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># the double-error branch here, you'll break asynchronous servers by</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># prematurely closing.  Async servers must return from 'run()' without</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># closing if there might still be output to iterate over.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setup_environ</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">application</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">start_response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">finish_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">handle_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># If we get an error handling an error, just give up already!</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4efe36512096465-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4efe36512096465-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\"># ...and let the actual server figure it out.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p></p>\n<figure></figure>\n<p><strong>run</strong>方法的主要功能有：</p>\n<ul>\n<li>通过<strong>setup_environ()</strong>方法创建<strong>WSGI</strong>相关的环境；</li>\n<li>调用<strong>WSGI</strong>应用的函数或者<strong>WSGI</strong>应用的可调用对象。本测试例子中的<strong>WSGI</strong>应用是一个简单的函数，其作用是将请求的<strong>environ</strong>信息打印出来。</li>\n<li>调用<strong>finish_response()</strong>方法将<strong>WSGI</strong>应用返回的数据作为响应发回。</li>\n</ul>\n<h2 id=\"5-关闭服务器\">5. 关闭服务器</h2>\n<p>请求结束后，服务器会调用一系列函数关闭请求连接。之后测试代码调用<strong>server_close()</strong>方法关闭服务器。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88637\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88637votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88637\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "tags": "基础知识,WSGI,wsgiref", "url_object_id": "03174bc84f1a13027b32d936962dca60", "praise_nums": "1", "url": "http://python.jobbole.com/88637/", "title": "Wsgiref 包——符合 WSGI 标准的 Web 服务实现（一）", "create_date": "2017/09/23", "comment_nums": 0}
{"fav_nums": 4, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/pinard/p/6016029.html\">刘建平Pinard</a>   </div><p>对于想深入了解线性回归的童鞋，这里给出一个完整的例子，详细学完这个例子，对用scikit-learn来运行线性回归，评估模型不会有什么问题了。</p>\n<div id=\"cnblogs_post_body\">\n<h1>1. 获取数据，定义问题</h1>\n<p>没有数据，当然没法研究机器学习啦。:) 这里我们用UCI大学公开的机器学习数据来跑线性回归。</p>\n<p>数据的介绍在这： http://archive.ics.uci.edu/ml/datasets/Combined+Cycle+Power+Plant</p>\n<p>数据的下载地址在这： http://archive.ics.uci.edu/ml/machine-learning-databases/00294/</p>\n<p>里面是一个循环发电场的数据，共有9568个样本数据，每个数据有5列，分别是:AT（温度）, V（压力）, AP（湿度）, RH（压强）, PE（输出电力)。我们不用纠结于每项具体的意思。</p>\n<p>我们的问题是得到一个线性的关系，对应PE是样本输出，而AT/V/AP/RH这4个是样本特征， 机器学习的目的就是得到一个线性回归模型，即:</p>\n<p><strong>PE=θ_0+θ_1*AT+θ_2*V+θ_3*AP+θ_4*RH</strong></p>\n<p>而需要学习的，就是<strong>θ_0、θ_1、θ_2、θ_3、θ_4</strong>这5个参数。</p>\n<h1>2. 整理数据</h1>\n<p>下载后的数据可以发现是一个压缩文件，解压后可以看到里面有一个xlsx文件，我们先用excel把它打开，接着“另存为“”csv格式，保存下来，后面我们就用这个csv来运行线性回归。</p>\n<p>打开这个csv可以发现数据已经整理好，没有非法数据，因此不需要做预处理。但是这些数据并没有归一化，也就是转化为均值0，方差1的格式。也不用我们搞，后面scikit-learn在线性回归时会先帮我们把归一化搞定。</p>\n<p>好了，有了这个csv格式的数据，我们就可以大干一场了。</p>\n<h1>3. 用pandas来读取数据</h1>\n<p>我们先打开ipython notebook,新建一个notebook。当然也可以直接在python的交互式命令行里面输入，不过还是推荐用notebook。下面的例子和输出我都是在notebook里面跑的。</p>\n<p>先把要导入的库声明了：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d392e701286457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport matplotlib.pyplot as plt\r\n%matplotlib inline\r\nimport numpy as np\r\nimport pandas as pd\r\nfrom sklearn import datasets, linear_model</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d392e701286457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d392e701286457-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d392e701286457-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d392e701286457-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d392e701286457-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d392e701286457-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d392e701286457-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d392e701286457-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-i\">matplotlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inline</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d392e701286457-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d392e701286457-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d392e701286457-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d392e701286457-6\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">sklearn </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">datasets</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linear_model</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n\n</div>\n<p>接着我们就可以用pandas读取数据了：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3938454693311\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# read_csv里面的参数是csv在你电脑上的路径，此处csv文件放在notebook运行目录下面的CCPP目录里\r\ndata = pd.read_csv('.\\CCPP\\ccpp.csv')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3938454693311-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3938454693311-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3938454693311-1\"><span class=\"crayon-p\"># read_csv里面的参数是csv在你电脑上的路径，此处csv文件放在notebook运行目录下面的CCPP目录里</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3938454693311-2\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.\\CCPP\\ccpp.csv'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>测试下读取数据是否成功：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d393d855846847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#读取前五行数据，如果是最后五行，用data.tail()\r\ndata.head()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d393d855846847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d393d855846847-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d393d855846847-1\"><span class=\"crayon-p\">#读取前五行数据，如果是最后五行，用data.tail()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d393d855846847-2\"><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>运行结果应该如下，看到下面的数据，说明pandas读取数据成功：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>AT</th>\n<th>V</th>\n<th>AP</th>\n<th>RH</th>\n<th>PE</th>\n</tr>\n<tr>\n<th>0</th>\n<td>8.34</td>\n<td>40.77</td>\n<td>1010.84</td>\n<td>90.01</td>\n<td>480.48</td>\n</tr>\n<tr>\n<th>1</th>\n<td>23.64</td>\n<td>58.49</td>\n<td>1011.40</td>\n<td>74.20</td>\n<td>445.75</td>\n</tr>\n<tr>\n<th>2</th>\n<td>29.74</td>\n<td>56.90</td>\n<td>1007.15</td>\n<td>41.91</td>\n<td>438.76</td>\n</tr>\n<tr>\n<th>3</th>\n<td>19.07</td>\n<td>49.69</td>\n<td>1007.22</td>\n<td>76.79</td>\n<td>453.09</td>\n</tr>\n<tr>\n<th>4</th>\n<td>11.80</td>\n<td>40.66</td>\n<td>1017.13</td>\n<td>97.20</td>\n<td>464.43</td>\n</tr>\n</thead>\n</table>\n<h1>4. 准备运行算法的数据</h1>\n<p>我们看看数据的维度：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3941873278399\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndata.shape</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3941873278399-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3941873278399-1\"><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>结果是(9568, 5)。说明我们有9568个样本，每个样本有5列。</p>\n<p>现在我们开始准备样本特征X，我们用AT， V，AP和RH这4个列作为样本特征。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3944556120924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = data[['AT', 'V', 'AP', 'RH']]\r\nX.head()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3944556120924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3944556120924-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3944556120924-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'AT'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'V'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'AP'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'RH'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3944556120924-2\"><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>可以看到X的前五条输出如下：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>AT</th>\n<th>V</th>\n<th>AP</th>\n<th>RH</th>\n</tr>\n<tr>\n<th>0</th>\n<td>8.34</td>\n<td>40.77</td>\n<td>1010.84</td>\n<td>90.01</td>\n</tr>\n<tr>\n<th>1</th>\n<td>23.64</td>\n<td>58.49</td>\n<td>1011.40</td>\n<td>74.20</td>\n</tr>\n<tr>\n<th>2</th>\n<td>29.74</td>\n<td>56.90</td>\n<td>1007.15</td>\n<td>41.91</td>\n</tr>\n<tr>\n<th>3</th>\n<td>19.07</td>\n<td>49.69</td>\n<td>1007.22</td>\n<td>76.79</td>\n</tr>\n<tr>\n<th>4</th>\n<td>11.80</td>\n<td>40.66</td>\n<td>1017.13</td>\n<td>97.20</td>\n</tr>\n</thead>\n</table>\n<p>接着我们准备样本输出y， 我们用PE作为样本输出。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3948160803493\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ny = data[['PE']]\r\ny.head()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3948160803493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3948160803493-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3948160803493-1\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'PE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3948160803493-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>可以看到y的前五条输出如下：</p>\n<table style=\"height: 183px\" width=\"654\">\n<thead>\n<tr>\n<th></th>\n<td>PE</td>\n</tr>\n</thead>\n<tbody>\n<tr>\n<th>0</th>\n<td>480.48</td>\n</tr>\n<tr>\n<th>1</th>\n<td>445.75</td>\n</tr>\n<tr>\n<th>2</th>\n<td>438.76</td>\n</tr>\n<tr>\n<th>3</th>\n<td>453.09</td>\n</tr>\n<tr>\n<th>4</th>\n<td>464.43</td>\n</tr>\n</tbody>\n</table>\n<h1>5.划分训练集和测试集</h1>\n<p>我们把X和y的样本组合划分成两部分，一部分是训练集，一部分是测试集，代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d394c055343294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.cross_validation import train_test_split\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d394c055343294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d394c055343294-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d394c055343294-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cross_validation </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">train_test_split</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d394c055343294-2\"><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>查看下训练集和测试集的维度：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d394f867092306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint X_train.shape\r\nprint y_train.shape\r\nprint X_test.shape\r\nprint y_test.shape</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d394f867092306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d394f867092306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d394f867092306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d394f867092306-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d394f867092306-1\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shape</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d394f867092306-2\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shape</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d394f867092306-3\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shape</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d394f867092306-4\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>结果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3952391514614\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(7176, 4)\r\n(7176, 1)\r\n(2392, 4)\r\n(2392, 1)　　　　</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3952391514614-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3952391514614-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3952391514614-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3952391514614-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3952391514614-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">7176</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3952391514614-2\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">7176</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3952391514614-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2392</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3952391514614-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2392</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span>　　　　</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>可以看到75%的样本数据被作为训练集，25%的样本被作为测试集。</p>\n<h1>6. 运行scikit-learn的线性模型</h1>\n<p>终于到了临门一脚了，我们可以用scikit-learn的线性模型来拟合我们的问题了。scikit-learn的线性回归算法使用的是最小二乘法来实现的。代码如下：</p>\n<div id=\"cnblogs_post_body\">\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3956530726468\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.linear_model import LinearRegression\r\nlinreg = LinearRegression()\r\nlinreg.fit(X_train, y_train)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3956530726468-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3956530726468-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3956530726468-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3956530726468-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linear_model </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">LinearRegression</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3956530726468-2\"><span class=\"crayon-v\">linreg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearRegression</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3956530726468-3\"><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>拟合完毕后，我们看看我们的需要的模型系数结果：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3959727099343\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint linreg.intercept_\r\nprint linreg.coef_</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3959727099343-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3959727099343-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3959727099343-1\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">intercept_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3959727099343-2\"><span class=\"crayon-e\">print </span><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">coef_</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d395c236365828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ 447.06297099]\r\n[[-1.97376045 -0.23229086  0.0693515  -0.15806957]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d395c236365828-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d395c236365828-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d395c236365828-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">447.06297099</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d395c236365828-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1.97376045</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.23229086</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.0693515</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0.15806957</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>这样我们就得到了在步骤1里面需要求得的5个值。也就是说PE和其他4个变量的关系如下：<br>\n<strong>PE=447.06297099-1.97376045*AT-0.23229086*V+0.0693515*AP-0.15806957*RH</strong></p>\n<h1>7. 模型评价</h1>\n<p>我们需要评估我们的模型的好坏程度，对于线性回归来说，我们一般用均方差（Mean Squared Error, MSE）或者均方根差(Root Mean Squared Error, RMSE)在测试集上的表现来评价模型的好坏。</p>\n<p>我们看看我们的模型的MSE和RMSE，代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3960064538751\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#模型拟合测试集\r\ny_pred = linreg.predict(X_test)\r\nfrom sklearn import metrics\r\n# 用scikit-learn计算MSE\r\nprint \"MSE:\",metrics.mean_squared_error(y_test, y_pred)\r\n# 用scikit-learn计算RMSE\r\nprint \"RMSE:\",np.sqrt(metrics.mean_squared_error(y_test, y_pred))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3960064538751-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3960064538751-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3960064538751-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3960064538751-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3960064538751-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3960064538751-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3960064538751-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3960064538751-1\"><span class=\"crayon-p\">#模型拟合测试集</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3960064538751-2\"><span class=\"crayon-v\">y_pred</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3960064538751-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">sklearn </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">metrics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3960064538751-4\"><span class=\"crayon-p\"># 用scikit-learn计算MSE</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3960064538751-5\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_pred</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3960064538751-6\"><span class=\"crayon-p\"># 用scikit-learn计算RMSE</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3960064538751-7\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RMSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_pred</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3963031192190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMSE: 20.0804012021\r\nRMSE: 4.48111606657</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3963031192190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3963031192190-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3963031192190-1\"><span class=\"crayon-v\">MSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20.0804012021</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3963031192190-2\"><span class=\"crayon-v\">RMSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.48111606657</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>得到了MSE或者RMSE，如果我们用其他方法得到了不同的系数，需要选择模型时，就用MSE小的时候对应的参数。</p>\n<p>比如这次我们用AT， V，AP这3个列作为样本特征。不要RH， 输出仍然是PE。代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3967413920022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = data[['AT', 'V', 'AP']]\r\ny = data[['PE']]\r\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=1)\r\nfrom sklearn.linear_model import LinearRegression\r\nlinreg = LinearRegression()\r\nlinreg.fit(X_train, y_train)\r\n#模型拟合测试集\r\ny_pred = linreg.predict(X_test)\r\nfrom sklearn import metrics\r\n# 用scikit-learn计算MSE\r\nprint \"MSE:\",metrics.mean_squared_error(y_test, y_pred)\r\n# 用scikit-learn计算RMSE\r\nprint \"RMSE:\",np.sqrt(metrics.mean_squared_error(y_test, y_pred))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3967413920022-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3967413920022-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'AT'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'V'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'AP'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'PE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-3\"><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-4\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linear_model </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">LinearRegression</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-5\"><span class=\"crayon-v\">linreg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearRegression</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-6\"><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-7\"><span class=\"crayon-p\">#模型拟合测试集</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-8\"><span class=\"crayon-v\">y_pred</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-9\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">sklearn </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">metrics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-10\"><span class=\"crayon-p\"># 用scikit-learn计算MSE</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-11\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_pred</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3967413920022-12\"><span class=\"crayon-p\"># 用scikit-learn计算RMSE</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3967413920022-13\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RMSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_pred</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</div>\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d396a118993790\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMSE: 23.2089074701\r\nRMSE: 4.81756239919</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d396a118993790-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d396a118993790-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d396a118993790-1\"><span class=\"crayon-v\">MSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23.2089074701</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d396a118993790-2\"><span class=\"crayon-v\">RMSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.81756239919</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<p class=\"lang:default decode:true brush: default; gutter: true \">可以看出，去掉RH后，模型拟合的没有加上RH的好，MSE变大了。</p>\n<h1>8. 交叉验证</h1>\n<p class=\"lang:default decode:true brush: default; gutter: true \">我们可以通过交叉验证来持续优化模型，代码如下，我们采用10折交叉验证，即cross_val_predict中的cv参数为10：</p>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d396e858782410\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = data[['AT', 'V', 'AP', 'RH']]\r\ny = data[['PE']]\r\nfrom sklearn.model_selection import cross_val_predict\r\npredicted = cross_val_predict(linreg, X, y, cv=10)\r\n# 用scikit-learn计算MSE\r\nprint \"MSE:\",metrics.mean_squared_error(y, predicted)\r\n# 用scikit-learn计算RMSE\r\nprint \"RMSE:\",np.sqrt(metrics.mean_squared_error(y, predicted))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d396e858782410-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d396e858782410-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d396e858782410-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d396e858782410-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d396e858782410-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d396e858782410-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d396e858782410-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d396e858782410-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d396e858782410-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'AT'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'V'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'AP'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'RH'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d396e858782410-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'PE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d396e858782410-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">model_selection </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cross_val_predict</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d396e858782410-4\"><span class=\"crayon-v\">predicted</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cross_val_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">linreg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d396e858782410-5\"><span class=\"crayon-p\"># 用scikit-learn计算MSE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d396e858782410-6\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predicted</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d396e858782410-7\"><span class=\"crayon-p\"># 用scikit-learn计算RMSE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d396e858782410-8\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"RMSE:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sqrt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">metrics</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mean_squared_error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predicted</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3972560045877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nMSE: 20.7955974619\r\nRMSE: 4.56021901469</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3972560045877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3972560045877-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3972560045877-1\"><span class=\"crayon-v\">MSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20.7955974619</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3972560045877-2\"><span class=\"crayon-v\">RMSE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.56021901469</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>可以看出，采用交叉验证模型的MSE比第6节的大，主要原因是我们这里是对所有折的样本做测试集对应的预测值的MSE，而第6节仅仅对25%的测试集做了MSE。两者的先决条件并不同。</p>\n<h1>9. 画图观察结果</h1>\n<p>这里画图真实值和预测值的变化关系，离中间的直线y=x直接越近的点代表预测损失越低。代码如下：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4d3975430599855\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfig, ax = plt.subplots()\r\nax.scatter(y, predicted)\r\nax.plot([y.min(), y.max()], [y.min(), y.max()], 'k--', lw=4)\r\nax.set_xlabel('Measured')\r\nax.set_ylabel('Predicted')\r\nplt.show()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3975430599855-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3975430599855-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3975430599855-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3975430599855-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4d3975430599855-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4d3975430599855-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4d3975430599855-1\"><span class=\"crayon-v\">fig</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ax</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">subplots</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3975430599855-2\"><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predicted</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3975430599855-3\"><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'k--'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lw</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3975430599855-4\"><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_xlabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Measured'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4d3975430599855-5\"><span class=\"crayon-v\">ax</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_ylabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Predicted'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4d3975430599855-6\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n\n</div>\n<p>输出的图像如下:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/533a271bc27ca7198850b80934d96e97.png\"><img class=\"aligncenter size-full wp-image-88601\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/533a271bc27ca7198850b80934d96e97.png\" alt=\"0054\"></a></p>\n<p class=\"lang:default decode:true brush: default; gutter: true \">以上就是用scikit-learn和pandas学习线性回归的过程，希望可以对初学者有所帮助。 <em id=\"__mceDel\">　　</em></p>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88597\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88597votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88597\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/533a271bc27ca7198850b80934d96e97.png"], "tags": "实践项目,Pandas,Scikit-Learn,机器学习,线性回归", "url_object_id": "c8de3805329a61c14e85528f70ea838f", "praise_nums": "1", "url": "http://python.jobbole.com/88597/", "title": "用 Scikit-Learn 和 Pandas 学习线性回归", "create_date": "2017/09/14", "comment_nums": 0}
{"fav_nums": 4, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/daofazi\">逆旅</a> 翻译，<a href=\"http://www.jobbole.com/members/huanglimin\">黄利民</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://iluxonchik.github.io/why-you-should-learn-python/\">iluxonchik</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><h2>引言</h2>\n<p>第一次接触 Python 是在一节编程入门课上。其实，在此之前了解过它，所以在上课之前我对它的语法已经很熟悉了，但在上课之前我没有用它做过真正的项目。尽管对它没有太大兴趣，但我认为把它介绍给人们去学习编程还是很好的。我对它不是不喜欢，而是一种“无所谓”的态度。原因很简单：它里面有太多“魔法”。 C 和 Java 这些语言，对底层的行为描述的很清晰，Python 则完全相反。</p>\n<p>另外，Python 结构松散：写大型复杂程序时，遇到规则严谨的程序结构体（比如每个文件一个公共类），比其他语言（比如 Java ）要费些力气。但是，在这些方面 Python 给了你很大的自由。</p>\n<p>另一件事是严格的编码风格和调试：因为Python 是解释型语言，查找问题不太容易：如果C 语言有语法错误，编译器会直接停止编译，但在解释型语言中，直到执行到问题行，问题才会被发现。试着在需要整数的时候传一个字符串？cc 会马上提醒你，Python 解释器却对此一点都不介意（虽然有工具可以发现这个问题，比如 <a href=\"http://mypy-lang.org/\">mypy</a>，但我讨论的是通用的Python）。我提到的这些问题是解释型语言的通病，并非 Python 独有，但这些是我不喜欢它的主要原因。</p>\n<p>还有一个烦人的问题是强制缩进。我们老师（很优秀）认为这是好事情，因为“它强制我们形成简洁的代码风格”。确实如此，但还是有点烦，当代码没有按预期执行时，你分析代码想要找出 bug，它却无影无踪，过了很长时间之后你发现 if 语句那一行有一个多余的空格。</p>\n<p>我曾经和同事聊过 Python，告诉他为什么我之前对这个语言不感冒，他笑着问我“问什么不喜欢Python呢？因为它读起来很像英语？”。是的。因为这个语言做了很多底层的工作，有时候会不清楚发生了什么。举个读文件的例子，假设你想一行一行读取文件内容并打印出来。C 会这么做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded67749357617\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdio&gt;\r\n\r\nint main(void) {\r\n    FILE *fp;\r\n    char buff[256]; // assuming a line won't contain more than 256 chars\r\n    fp = fopen(\"hello.txt\", \"r\");\r\n\r\n    while(fgets(buff, 256, fp)) {\r\n        printf(\"%s\", buff);\r\n    }\r\n\r\n    fclose(fp);\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded67749357617-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded67749357617-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-1\"><span class=\"crayon-p\">#include &lt;stdio&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">void</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">FILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buff</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// assuming a line won't contain more than 256 chars</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"hello.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"r\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">fgets</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buff</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">buff</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded67749357617-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded67749357617-14\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>python 这么做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded75750579561\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open('hello.txt') as f:\r\n    for line in f:\r\n        print(line)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded75750579561-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded75750579561-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded75750579561-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded75750579561-1\"><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'hello.txt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded75750579561-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded75750579561-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>现在，很多人会认为这是 python 的优势，然而，第一个例子中，干了什么一目了然：</p>\n<ul>\n<li>获取一个文件指针</li>\n<li>从文件读取每一行数据到缓存中，打印缓存中的内容</li>\n<li>关闭文件流</li>\n</ul>\n<p>python 的例子中看不到这些，它是一种 “魔法般的”过程。现在，有人认为这是好事，因为将程序员与底层实现细节隔离（我同意这个说法），但我想知道到底发生了什么。</p>\n<p>有趣的是，我以上提到的缺点，我现在认为都是优点。为了公平起见，我强调，Python 里边没有魔法，如果你多了解一点，你会发现真的没有，有的只是语言解释代码的方式，从这点来看，我发现它挺有意思的。如果你也这么觉得，我建议你深入了解它的工作机制，如果有东西像魔法，就找出来到底发生了什么，事情就会变得清晰，魔法就变成了便利。</p>\n<p>我的认识发生很大的变化，尤其是我决定使用 Python 后，事实上我现在是 Python 的死忠！现在你也许会想我将会在哪里说服你学 Python 是个好主意，不要担心，马上就到。作为引言的结尾，我想说明，这只是我对这个语言的个人感受，只是个人偏好。我没有试图以“如果你用 Python，你就不是真正的程序员（实际上，我不这么认为）”的理由劝说人们学 C。当有人问我他们的入门语言应该选哪个，我通常建议他们选 Python，基于我上边提到的“缺点”的原因。我的感觉来源于我的兴趣，我曾经在做一些很底层的东西，你能想到，Python 并不适用。</p>\n<h2>Python 语言精粹</h2>\n<p>在借用了JavaScript 畅销书 《JavaScript 语言精粹》作为本节标题后，我们开始讨论本文的主题：为什么你(没错，就是你！)应该学 Python。</p>\n<h3>1、通用脚本语言</h3>\n<p>这是我使用 Python 的主要原因。我曾经和很多人做过很多项目，不同的人用不同的系统。就我而言，我经常在windows系统和linux系统之间切换。举一个实际的例子，有一个项目，我写了项目的自动测试脚本，结果发现只有我能用，因为是用 PowerShell 写的，而我是项目中唯一使用 Windows 的。当时同事们自然认为 bash 是最好的，我还向他们解释 PowerShell 遵循一种不同的模式并且有它的强项（例如，它提供了 .NET 框架接口），它是面向对象的脚本语言，和 bash 完全不一样。现在我不想讨论哪个更好，因为这不是本文的重点。</p>\n<p>那么这个问题怎么解决呢？嗯…现在，是否有一种脚本语言可以在所有主流平台上运行呢？你猜对了，它就是 Python。除了可以在主流平台上运行，它还是开箱即用的脚本语言。标准库包含不少实用程序，提供了独立于系统的常用接口。举一个简洁明了的例子，假设你想获取文件夹下所有文件的文件名，然后对其进行处理，在 UNIX下，你要这么做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded80690058537\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor f in *; do echo \"Processing $f file...\"; done</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded80690058537-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded80690058537-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processing $f file...\"</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>用 PowerShell 做类似的事情：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded87170740831\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGet-ChildItem \".\" | \r\nForeach-Object {\r\n    $name = $_.Name\r\n    Write-Output \"Processing $($name) file...\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded87170740831-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded87170740831-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded87170740831-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded87170740831-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded87170740831-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded87170740831-1\"><span class=\"crayon-v\">Get</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">ChildItem</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded87170740831-2\"><span class=\"crayon-st\">Foreach</span><span class=\"crayon-o\">-</span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded87170740831-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded87170740831-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">Write</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Output</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processing $($name) file...\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded87170740831-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>An equivalent functionality in Python can be achieved with:</p>\n<p>python 这么做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded8d307993672\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom os import listdir\r\n\r\nfor f in listdir('.'):\r\n    print('Processing {} file...'.format(f))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded8d307993672-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded8d307993672-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded8d307993672-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded8d307993672-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded8d307993672-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">os </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">listdir</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded8d307993672-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4ded8d307993672-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded8d307993672-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Processing {} file...'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>现在我认为，Python 除了可以跑在 Linux，MacOSX 和 Windows 上，它也很易读。上边例子中的脚本很简单，在复杂的例子中不同语言的易读性差异会更明显。</p>\n<p>就像我之前提到的，Python 自带了许多强大的库用来取代 shell 脚本，你会发现，最有用的是：</p>\n<ul>\n<ul>\n<ul>\n<li><a href=\"https://docs.python.org/3/library/os.html\">os</a> – 提供系统无关功能，比如文件目录和文件读写。</li>\n</ul>\n</ul>\n</ul>\n<ul>\n<ul>\n<ul>\n<li><a href=\"https://docs.python.org/3/library/subprocess.html\">subprocess</a> – 产生新进程、与输入输出流和返回代码交互。可以用它来启动系统已安装的程序，但请记住如果你担心脚本的可移植性，这不是最好的选择。</li>\n</ul>\n</ul>\n</ul>\n<ul>\n<ul>\n<ul>\n<li><a href=\"https://docs.python.org/3/library/shutil.html\">shutil</a> – 提供对文件和文件集合的高级操作。</li>\n</ul>\n</ul>\n</ul>\n<ul>\n<ul>\n<ul>\n<li><a href=\"https://docs.python.org/3/library/argparse.html\">argparse</a> – 解析命令行参数，构建命令行接口。</li>\n</ul>\n</ul>\n</ul>\n<p>好了，假设你 get 到了重点，跨平台和易读性听起来挺不错的，但是你真的喜欢类 UNIX shell 类似的语法怎么办？告诉你个好消息，鱼和熊掌可以兼得！看看 Plumbum，它是一个 Python 模块，它的座右铭是“ 再也不写 shell 脚本”。它模仿了 shell 语法，同时保持了跨平台。</p>\n<h4>不要完全抛弃 shell 脚本</h4>\n<p>即使 Python 可以完全取代 shell 脚本，但也不是必须这么做，因为 Python 脚本天生适合 Unix 命令行理念，你要做的就是让它们从 sys.stdin (标准输入)读数据，向 sys.stdout(标准输出)写数据。举个例子，假设你有一个文件，每行有一个单词，你想知道每个单词在文中出现的次数。这种情况就没必要全部是用Python，我们可以使用 cat 命令和我们的脚本，称它为 namecount.py 一起来完成这个任务。</p>\n<p>假设有一个文件，名为 names.txt ，内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4ded9d609765837\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat\r\ndog\r\nmouse\r\nbird\r\ncat\r\ncat\r\ndog</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded9d609765837-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded9d609765837-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded9d609765837-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded9d609765837-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded9d609765837-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4ded9d609765837-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4ded9d609765837-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4ded9d609765837-1\"><span class=\"crayon-e\">cat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded9d609765837-2\"><span class=\"crayon-e\">dog</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded9d609765837-3\"><span class=\"crayon-e\">mouse</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded9d609765837-4\"><span class=\"crayon-e\">bird</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded9d609765837-5\"><span class=\"crayon-e\">cat</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4ded9d609765837-6\"><span class=\"crayon-e\">cat</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4ded9d609765837-7\"><span class=\"crayon-v\">dog</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在使用我们的脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4deda4746289244\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$&gt; cat names.txt | namecount.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4deda4746289244-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4deda4746289244-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">namecount</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>Powershell:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedaa972392729\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$&gt; Get-Content names.txt | python namecount.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedaa972392729-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedaa972392729-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Get</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Content </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">namecount</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>期望的输出如下（顺序可能会变化）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedb0666623226\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbird 1\r\nmouse 1\r\ncat 3\r\ndog 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb0666623226-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb0666623226-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb0666623226-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb0666623226-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedb0666623226-1\"><span class=\"crayon-i\">bird</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb0666623226-2\"><span class=\"crayon-i\">mouse</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb0666623226-3\"><span class=\"crayon-i\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb0666623226-4\"><span class=\"crayon-i\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>namecount.py 源码:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedb5968525060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python3\r\nimport sys\r\n\r\ndef count_names():\r\n    names = {}\r\n    for name in sys.stdin.readlines():\r\n        name = name.strip()\r\n\r\n        if name in names:\r\n            names[name] += 1\r\n        else:\r\n            names[name] = 1\r\n            \r\n    for name, count in names.items():\r\n        sys.stdout.write(\"{0}\\t{1}\\n\".format(name, count))\r\n\r\nif __name__ == \"__main__\":\r\n    count_names()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedb5968525060-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedb5968525060-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-1\"><span class=\"crayon-p\">#!/usr/bin/env python3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">sys</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-4\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">count_names</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">readlines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-13\"><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"{0}\\t{1}\\n\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dedb5968525060-17\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedb5968525060-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">count_names</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>无序的信息可读性差，你可能想按单词出现的次数对其排序，让我们试试。我们要用管道输出文件内容供内建命令处理。按数字降序排序，我们要做的就是 $&gt; cat names.txt | namecount.py | sort -rn 。如果使用PowerShell 应该这样：$&gt; Get-Content names.txt | python namecount.py | Sort-Object { [int]$_.split()[-1] } -Descending （你可能听到了 Unixer 的吐槽声了，PowerShell 怎么这么繁琐）。</p>\n<p>这回我们的输出是确定的，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedbd332719784\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat 3\r\ndog 2\r\nbird 1\r\nmouse 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedbd332719784-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedbd332719784-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedbd332719784-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedbd332719784-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedbd332719784-1\"><span class=\"crayon-i\">cat</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedbd332719784-2\"><span class=\"crayon-i\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedbd332719784-3\"><span class=\"crayon-i\">bird</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedbd332719784-4\"><span class=\"crayon-i\">mouse</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>（旁注：如果你用 PowerShell，cat 是 Get-Content 的别名，sort 是 Sort_object 的别名，所以以上命令可以写成：$&gt; cat names.txt | python namecount.py 和 $&gt; cat names.txt | python namecount.py | sort { [int]$_.split()[-1] } -Descending ）</p>\n<p>但愿我成功说服你 python 是你某些脚本的替代品，你不必完全抛弃 shell 脚本，因为你可以将 Python 融合到你现有的工作流和工具箱中，还可以从它跨平台，更好的可读性，还有丰富的库中获益（后面会讲）。</p>\n<h3>2、大量优秀的库</h3>\n<p>Python 有非常丰富的库。我的意思是，几乎任何事都有库（有趣的是：如果你在你的Python 解释器中输入 import antigravity，在浏览器中打开 xkdc 漫画的页面，是不是很酷？）。我不是很推崇堆叠模块式的编程，但你不必这样。因为有太多的库，不表示你都要使用。我也不喜欢堆叠模块（它有点像 <a href=\"https://en.wikipedia.org/wiki/Component-based_software_engineering\">CBSE</a>），我在了解它们之后才使用。</p>\n<p>例如，我决定研究马尔科夫链，我想了一个项目：抓取一个艺术家的所有歌词，建立一个马尔科夫链，然后从其中生成歌曲。这个项目的目的是生成的歌曲应该能反映出艺术家的风格。所以我到处找相关的东西，搞出了 <a href=\"https://github.com/iluxonchik/lyricist\">lyricst</a> 项目（这只是个样品，还不成熟，只是一个测试项目，如我所言，我只是随便搞了一下，没想深入。如果你想玩的话，它包含有命令行界面和示例的说明文档）。我认为，最好的找歌词的地方是 <a href=\"http://rap.genius.com/\">RAPGenius</a>，因为它很活跃，经常更新。</p>\n<p>为了获取艺术家所有的歌词，我必须从网站上爬，然后处理 HTML。幸运的是，Python 很适合做网络爬虫，它有强大的库像 <a href=\"https://www.crummy.com/software/BeautifulSoup/bs4/doc/\">BeautifulSoup</a> 可以处理 HTML。所以我是这么做的，先使用 BeautifulSoup 从网页中抽取我需要的信息（就是歌词）然后用这些信息构建马尔科夫链。当然我曾经想用正则表达式构建自己的 HTML 解析器，但是这个库的存在让我更关注项目的最终目的：把玩马尔科夫链，让它更有趣，比方说，从文件中读取些内容出来。</p>\n<h3>3、用来做渗透测试很强大</h3>\n<p>如果你在作渗透测试或仅仅是喜欢玩玩，Python 是你的好帮手！由于Python 在所有 LInux 和 MAC OS 机器上都有安装，还有丰富的库，完善的语法，还是一门脚本语言，让它很适合干这个。</p>\n<p>另一个我为什么决定使用 Python 的原因（除了我之前提到的）是我对安全很感兴趣，Python 是用来做渗透测试的完美选择。我在第一次进入领域是通过 <a href=\"http://www.secdev.org/projects/scapy/\">Scapy</a>（或 <a href=\"https://github.com/phaethon/scapy\">Scapy3k</a> ，python3），我印象很深。Scapy 能够创建、监听、解析数据包。它的 API 很简单，文档也很完善。你可以很容易的创建不同层的数据（我指的是 OSI 模型）或者捕获它们对其进行分析或修改。你甚至可以导出 pcap 文件用 Wireshark 打开。虽然除了抓包还能做很多事情，还有很多其他的库也可以，但我在这里不会涉及，因为这不是本文的重点而且要展开讲的话需要一篇文章。</p>\n<p>有人可能会说，“哦，太棒了，但我感兴趣的是 Windows 设备，里边不会自带 Python”。别当心，你可以用 <a href=\"http://www.py2exe.org/\">py2exe</a> 把你的脚本编译成 .exe 文件。文件可能会有点大（取决于你是用的库的数量），但这不是重点。</p>\n<p>如果你很好奇，请参考 <a href=\"https://github.com/dloss/python-pentest-tools\">list of Python pentesting tools</a>。 文末我还推荐了几本书。</p>\n<h3>4、黑客的语言</h3>\n<p>Python 是可塑性很强的语言。你可以用各种方法改造它。可参见《 <a href=\"http://xion.org.pl/2012/05/06/hacking-python-imports/\">altering the way imports work</a>》和《messing with classes before they are created》这两篇文章。这只是一些例子。也让它成为强大的脚本语言（在第一节有说）适合做渗透测试（第三节），因为它给了你很大的自由。</p>\n<p>我不想讲太多，但我会讲述它让我惊讶的地方。当时，我在做一个网络爬虫( Python 很适合干这个！)，我用的其中一个工具是 <a href=\"https://www.crummy.com/software/BeautifulSoup/bs4/doc/\">BeautifulSoup</a>。 这是我用来学习 Python 的项目之一。Beautifulsoup 处理 HTML 的语法清晰直观，原因是在自定义行为方面，Python 给了你很大的自由。了解一番 API 后，发现有 “魔法”。和这种情况类似：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedc8144536743\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom bs4 import BeautifulSoup\r\n\r\nsoup = BeautifulSoup('&lt;p class=\"someclass\"&gt;Hello&lt;/p&gt;', 'html.parser')\r\nsoup.p</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedc8144536743-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedc8144536743-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedc8144536743-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedc8144536743-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedc8144536743-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedc8144536743-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dedc8144536743-3\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&lt;p class=\"someclass\"&gt;Hello&lt;/p&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedc8144536743-4\"><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">p</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>上面的代码利用第一个字符串参数创建了一个 BeautifulsSoup 实例，第二个参数表示我想使用 Python 自带的 HTML 解析器（BeautifulSoup 可以搭配多种解析器）。soup.p 返回一个 <code>Tag</code>(<code>bs4.element.Tag</code>) 对象，表示将作为第一个参数。</p>\n<p>以上代码的输出是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedcf150793860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">XHTML</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;p class=\"someclass\"&gt;Hello&lt;/p&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedcf150793860-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedcf150793860-1\"><span class=\"crayon-r \">&lt;p </span><span class=\"crayon-e \">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s \">\"someclass\"</span><span class=\"crayon-r \">&gt;</span><span class=\"crayon-i \">Hello</span><span class=\"crayon-r \">&lt;/p&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在你可能会想，你说的魔法在哪？马上就来。魔法在于上面的代码可以被修改为任何标签，甚至可以是自定义的。它意味着下面的代码也可以正常运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedd6197364704\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom bs4 import BeautifulSoup\r\n \r\nsoup = BeautifulSoup('&lt;foobarfoo class=\"someclass\"&gt;Hello&lt;/foobarfoo&gt;', 'html.parser')\r\nsoup.foobarfoo</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedd6197364704-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedd6197364704-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedd6197364704-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedd6197364704-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedd6197364704-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedd6197364704-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedd6197364704-3\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&lt;foobarfoo class=\"someclass\"&gt;Hello&lt;/foobarfoo&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedd6197364704-4\"><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">foobarfoo</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>The output is the following:</p>\n<p>输出如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4deddb442134350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;foobarfoo class=\"someclass\"&gt;Hello&lt;/foobarfoo&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4deddb442134350-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4deddb442134350-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">foobarfoo </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"someclass\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Hello</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">foobarfoo</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>当我发现这样也能运行，我的反应是“怎么回事？”。因为，第一个例子很容易实现，我的意思是最直接的方法是为每一个 HTML 标签定义一个属性（实例变量），在解析过程中如果找到了，就赋值给它们。但是这对第二种情况不适用，不可能对所有的字符串定义属性。我想知道它是怎么实现的，所以我打开 BeautifulSoups 源代码开始寻找。 我没有发现任何命名为 p 的属性，这一点也不奇怪，解析函数没有对其赋值。谷歌一番后，我找到了答案：魔法方法。什么是魔法方法，为什么要叫这个名字？事实上，魔法方法是给你的类赋予魔法的方法。这种方法通常前后有两条下划线（例如 __init__()）,在Python文档的 <a href=\"https://docs.python.org/3/reference/datamodel.html\">DataModel model section</a> 有对它的说明。</p>\n<p>真正让 BeautifulSoup 拥有这个功能的魔法方法是__getattr__(self, name)（self 在python 中指向实例，和 Java 中的this 类似）。如果去查看文档，你会发现第一段如下：</p>\n<blockquote><p>如果在属性常见地方找不到属性时，比如既不是实例属性，又没有在 self 类树中找到，则调用该方法（object.__getattr__(self, name)）。参数 name 就是属性名这个方法应当返回（计算过的）属性值或抛出 AttributeError 异常。</p></blockquote>\n<p>当你尝试访问一个不存在的属性，对象的 __getattr__(self,name) 方法会被调用，将返回一个以name 作为名字的属性的字符串。</p>\n<p>举个例子。假设你有一个 Person 类，拥有 first_name 属性。我们给使用者访问和 name 相同属性的内容的能力。下面是代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dede3659633059\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Person(object):\r\n    def __init__(self, first_name):\r\n        self.first_name = first_name\r\n\r\n    def __getattr__(self, name):\r\n        if (name == 'name'):\r\n            return self.first_name\r\n        raise AttributeError('Person object has no attribute \\'{}\\''.format(name))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede3659633059-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede3659633059-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede3659633059-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede3659633059-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede3659633059-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede3659633059-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede3659633059-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede3659633059-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dede3659633059-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede3659633059-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dede3659633059-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">first_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">first_name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede3659633059-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dede3659633059-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede3659633059-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dede3659633059-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">first_name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede3659633059-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">AttributeError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Person object has no attribute \\'{}\\''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>我们在终端运行代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dede9568574545\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nperson = Person('Jason')\r\n&gt;&gt;&gt; person.first_name\r\n'Jason'\r\n\r\n&gt;&gt;&gt; person.name\r\n'Jason'\r\n\r\n&gt;&gt;&gt; person.abc\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\n  File \"&lt;stdin&gt;\", line 7, in __getattr__\r\nAttributeError: Person object has no attribute 'abc'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dede9568574545-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dede9568574545-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-1\"><span class=\"crayon-v\">person</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Jason'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">first</span><span class=\"crayon-sy\">_</span>name</div><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-3\"><span class=\"crayon-s\">'Jason'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-6\"><span class=\"crayon-s\">'Jason'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">person</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">abc</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-9\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dede9568574545-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__getattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dede9568574545-12\"><span class=\"crayon-v\">AttributeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">no </span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'abc'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>这意味着我们能凭空构造实例属性，是不是很棒？所以你可以偷偷的让你的 Dog 除了汪汪叫之外，还会喵喵叫：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedef370950909\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Dog(object):\r\n    def bark(self):\r\n        print('Ruff, ruff!')\r\n    \r\n    def __getattr__(self, name):\r\n        if(name == 'meow'):\r\n           return lambda:  print('Meeeeeeow')\r\n        raise AttributeError('I don\\'t know what you\\'re talking about...')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedef370950909-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedef370950909-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedef370950909-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedef370950909-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedef370950909-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedef370950909-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedef370950909-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedef370950909-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedef370950909-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedef370950909-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">bark</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedef370950909-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Ruff, ruff!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedef370950909-4\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedef370950909-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedef370950909-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'meow'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedef370950909-7\"><span class=\"crayon-h\">           </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lambda</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Meeeeeeow'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedef370950909-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">AttributeError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'I don\\'t know what you\\'re talking about...'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedf5088295829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; snoop = Dog()\r\n\r\n&gt;&gt;&gt; snoop.bark()\r\nRuff, ruff!\r\n\r\n&gt;&gt;&gt; snoop.meow()\r\nMeeeeeeow</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedf5088295829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedf5088295829-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedf5088295829-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedf5088295829-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedf5088295829-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedf5088295829-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedf5088295829-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedf5088295829-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snoop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedf5088295829-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dedf5088295829-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snoop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bark</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedf5088295829-4\"><span class=\"crayon-v\">Ruff</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ruff</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedf5088295829-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedf5088295829-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snoop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">meow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedf5088295829-7\"><span class=\"crayon-v\">Meeeeeeow</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>你可以在没有 <a href=\"https://docs.oracle.com/javase/tutorial/reflect/\">reflection</a> 的情况下，随意添加新属性。object.__dict__ 是（字典）[https://docs.python.org/3.5/library/stdtypes.html#typesmapping] 包含 object 的属性和它们的值（注意我说的是 object.dict, object 是一个实例，还有一个 class.dict,是类的属性的字典)。</p>\n<p>意思是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dedfc885766779\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Dog(object):\r\n    \r\n    def __init__(self):\r\n        self.name = 'Doggy Dogg'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedfc885766779-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedfc885766779-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dedfc885766779-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dedfc885766779-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dedfc885766779-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedfc885766779-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dedfc885766779-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dedfc885766779-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Doggy Dogg'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>等价于：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dee02064288575\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Dog(object):\r\n    \r\n    def __init__(self):\r\n        self.__dict__['name'] = 'Doggy Dogg'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee02064288575-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee02064288575-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee02064288575-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee02064288575-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dee02064288575-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee02064288575-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee02064288575-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee02064288575-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict__</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Doggy Dogg'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>两者输出是一样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dee07069894326\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsnoop = Dog()\r\n\r\n&gt;&gt;&gt; snoop.name\r\n'Doggy Dogg'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee07069894326-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee07069894326-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee07069894326-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee07069894326-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dee07069894326-1\"><span class=\"crayon-v\">snoop</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee07069894326-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be4dee07069894326-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">snoop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee07069894326-4\"><span class=\"crayon-s\">'Doggy Dogg'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>到这里你会想，是挺好的，但是有什么用呢？答案很简单：magical APIs。你有没有用过一些 Python 库让你感觉像魔法？这是让它们变的有”魔法”的一种情况。虽然一旦你懂了底层发生的事情,就会发现没有魔法。</p>\n<p>如果你还想了解更多，可以查看文档中的 <a href=\"https://docs.python.org/3.5/howto/descriptor.html\">Description Protocol</a>。</p>\n<h2>Python 的面向对象</h2>\n<p>Python 的面向对象有点奇怪。例如，类中没有私有变量和方法。所以你想在类中创建一个实例变量或私有方法，你必须遵守规则：</p>\n<ul>\n<ul>\n<ul>\n<li>一个下划线 (<code class=\"highlighter-rouge\">_</code>)表示私有变量和方法。</li>\n</ul>\n</ul>\n</ul>\n<ul>\n<ul>\n<ul>\n<li>两个下划线(<code class=\"highlighter-rouge\">__</code>) 表示的变量和方法，它们的名字会被修改。</li>\n</ul>\n</ul>\n</ul>\n<p>举个例子，假设你有如下类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dee0e291643145\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Foo(object):\r\n    def __init__(self):\r\n        self.public = 'public'\r\n        self._private = 'public'\r\n        self.__secret = 'secret'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee0e291643145-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee0e291643145-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee0e291643145-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee0e291643145-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee0e291643145-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dee0e291643145-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee0e291643145-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee0e291643145-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'public'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee0e291643145-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_private</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'public'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee0e291643145-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__secret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'secret'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>转到解释器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dee14870692193\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; foo = Foo()\r\n&gt;&gt;&gt; foo.public\r\n'public'\r\n&gt;&gt;&gt; foo._private\r\n'public'\r\n&gt;&gt;&gt; foo.__secret\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\nAttributeError: 'Foo' object has no attribute '__secret'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee14870692193-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee14870692193-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee14870692193-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee14870692193-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee14870692193-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee14870692193-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee14870692193-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee14870692193-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee14870692193-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dee14870692193-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee14870692193-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-m\">public</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee14870692193-3\"><span class=\"crayon-s\">'public'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee14870692193-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">_private</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee14870692193-5\"><span class=\"crayon-s\">'public'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee14870692193-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__secret</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee14870692193-7\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee14870692193-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be4dee14870692193-9\"><span class=\"crayon-v\">AttributeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Foo'</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">no </span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__secret'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>如你所见，你可以访问 _private 变量，但是最后一个例子发生了什么，它是否意味着有两个下划线的变量是真正的私有变量？答案是 NO，它们的名字被改变了，实际上，它被 Python替换成了 _Foo_secret 。如果你想访问的话，你仍然可以访问：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be4dee1a238701190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; foo._Foo__secret\r\n'secret'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be4dee1a238701190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be4dee1a238701190-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be4dee1a238701190-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_Foo_</span><span class=\"crayon-sy\">_</span>secret</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be4dee1a238701190-2\"><span class=\"crayon-s\">'secret'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然而，<a href=\"https://www.python.org/dev/peps/pep-0008/#method-names-and-instance-variables\">PEP8</a> 建议只在父类中使用双下划线来避免属性名冲突。“PEP”，表示 “Python Enhancement Proposal”，它用来描述 Python 特性或作用。如果你想要添加一个新特性，你可以创建一个 PEP，这样可以让整个社区可以看到并讨论。你可以在<a href=\"https://www.python.org/dev/peps/pep-0001/\">这里了解更多的 PEPs</a>。</p>\n<p>可见，Python 很信任程序员。</p>\n<p>我不会再深入讲 OO 了，因为它需要单独一篇文章（甚至是一系列）来讲解。</p>\n<p>我确实想给你提个醒，Python 的 OO 可不像 Java 语言那么自然，你需要慢慢适应，但你知道吗，它只是做事的方法不同而已。举个例子，它没有<a href=\"https://msdn.microsoft.com/en-us/library/k535acbf.aspx\">抽象类</a>，你必须使用装饰器来实现这个行为。</p>\n<h2>结语</h2>\n<p>希望这篇文章，能够给你一个学习 Python 的理由。这篇文章来自一个为过去说了Python 的坏话而愧疚，如今在到处宣传 Python 的人。我先申明一点，这只是个人喜好问题，当有人问我先学哪门语言时，我通常推荐 Python。</p>\n<p>如果你还没决定，那就给它一次机会！用上一两个小时，多读些关于它的东西。如果你喜欢从书上学习，我也会帮你，看看<a href=\"http://shop.oreilly.com/product/0636920032519.do\">《Fluent Python》</a>， 下节还有更多。</p>\n<h2>书籍推荐</h2>\n<p>我兑现了诺言，这一节推荐书籍。我会尽量保持简短一些，只包含一些我读过的书籍。</p>\n<ul>\n<li><a href=\"http://shop.oreilly.com/product/0636920032519.do\">《Fluent Python》</a> —— 一本讲 Python3 的好书。无论你是新手、熟手还是高手都值得一读。包含了 Python 的来龙去脉。</li>\n<li><a href=\"http://shop.oreilly.com/product/0636920034391.do\">《Web Scraping With Python》</a> —— 标题已经说明了一切，讲如何用Python 来做网络爬虫。你会探索如何爬网上的内容，解析 HTML 等。我觉得这本书对爬虫领域的新手和熟手很有帮助。即使你之前从没用过Python，你也可以看懂。它没有涉及任何高级主题。</li>\n<li>《<a href=\"https://www.nostarch.com/blackhatpython\">Black Hat Python</a>》 —— 这个有趣！你可以创建反弹 SSH shell，木马等等！如果你想知道 Python 如何做渗透测试，请一定要读它。注意它使用的是 Python 2，我有一个仓库，用的是 Python 3。</li>\n<li>《<a href=\"https://www.amazon.com/Violent-Python-Cookbook-Penetration-Engineers/dp/1597499579\">Violent Python: A Cookbook for Hackers, Forensic Analysts, Penetration Testers and Security Engineers</a>》 ——比上面的主题要多，你会学到如何写一个常见的用于实战的渗透测试，取证分析和安全脚本。</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/11/4ec823de9f4637cdb4ee2f4b27a0aba9.png\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88622\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88622votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88622\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/daofazi\">逆旅</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/daofazi\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/a84a2baaaa98a48bb36349cd6431bcb3.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            a programmer,Do one's level best and leave the rest to God's will.I love this saying.        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/daofazi\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/daofazi/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/daofazi/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 17</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/86a1298ce44ca9807871520b81767e6f.gif"], "tags": "观点与动态,Python", "url_object_id": "8b715f3f4602eaf4135c649358771ed8", "praise_nums": "2", "url": "http://python.jobbole.com/88622/", "title": "为什么你应该学 Python ？", "create_date": "2017/09/20", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Flask/Flask%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B/\">Learn Python</a>   </div><p>Flask是当下流行的Web框架，它是用Python实现的。Flask显著的特点是：它是一个“微”框架。”微”意味着Flask旨在保持核心的简单，但同时又易于扩展。默认情况下，Flask 不包含数据库抽象层、表单验证，或是其它任何已有多种库可以胜任的功能。然而，Flask 支持用扩展来给应用添加这些功能。众多的扩展提供了数据库集成、表单验证、上传处理、各种各样的开放认证技术等功能。Flask的这些特性，使得它在Web开发方面变得非常流行。</p>\n<h1 id=\"文章目录\">文章目录</h1>\n<p>本板块将对Flask的运行机制进行分析和探讨，同时还将包括使用Flask过程中的心得体会、疑问等等。</p>\n<ul>\n<li><a title=\"一个Flask应用运行过程剖析\" href=\"http://python.jobbole.com/87683/\">一个Flask应用运行过程剖析</a></li>\n<li><a title=\"Flask应用中的URL处理\" href=\"http://python.jobbole.com/88618/\">Flask应用中的URL处理</a></li>\n<li><a title=\"Flask中模块化应用的实现\" href=\"http://python.jobbole.com/88591/\">Flask中模块化应用的实现</a></li>\n<li><a title=\"Flask中的蓝图管理\" href=\"http://python.jobbole.com/88587/\">Flask中的蓝图管理</a></li>\n<li><a title=\"Flask中的请求上下文和应用上下文\" href=\"http://python.jobbole.com/87680/\">Flask中的请求上下文和应用上下文</a></li>\n<li>后续将继续更新······</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88621\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88621votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88621\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "工具与框架,Flask", "url_object_id": "b98d2822da224138f8ea33f287132f36", "praise_nums": "1", "url": "http://python.jobbole.com/88621/", "title": "Flask 框架简介", "create_date": "2017/09/23", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010863236\">Stardustsky</a>   </div><h1>K-means算法简介</h1>\n<p>K-means是机器学习中一个比较常用的算法，属于无监督学习算法，其常被用于数据的聚类，只需为它指定簇的数量即可自动将数据聚合到多类中，相同簇中的数据相似度较高，不同簇中数据相似度较低。</p>\n<h2>K-menas的优缺点：</h2>\n<p>优点：</p>\n<ul>\n<li>原理简单</li>\n<li>速度快</li>\n<li>对大数据集有比较好的伸缩性</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>需要指定聚类 数量K</li>\n<li>对异常值敏感</li>\n<li>对初始值敏感</li>\n</ul>\n<h2>K-means的聚类过程</h2>\n<p>其聚类过程类似于梯度下降算法，建立代价函数并通过迭代使得代价函数值越来越小</p>\n<ol>\n<li>适当选择c个类的初始中心；</li>\n<li>在第k次迭代中，对任意一个样本，求其到c个中心的距离，将该样本归到距离最短的中心所在的类；</li>\n<li>利用均值等方法更新该类的中心值；</li>\n<li>对于所有的c个聚类中心，如果利用（2）（3）的迭代法更新后，值保持不变，则迭代结束，否则继续迭代。</li>\n</ol>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ce2342470268c3f3bc082d87fc35e14e.png\"><img class=\"aligncenter size-full wp-image-88536\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ce2342470268c3f3bc082d87fc35e14e.png\" alt=\"201104061601534923\"></a>该算法的最大优势在于简洁和快速。算法的关键在于初始中心的选择和距离公式。</p>\n<h2>K-means 实例展示</h2>\n<p>python中km的一些参数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5db754322047109\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsklearn.cluster.KMeans(\r\n    n_clusters=8,\r\n    init='k-means++', \r\n    n_init=10, \r\n    max_iter=300, \r\n    tol=0.0001, \r\n    precompute_distances='auto', \r\n    verbose=0, \r\n    random_state=None, \r\n    copy_x=True, \r\n    n_jobs=1, \r\n    algorithm='auto'\r\n    )\r\nn_clusters: 簇的个数，即你想聚成几类\r\ninit: 初始簇中心的获取方法\r\nn_init: 获取初始簇中心的更迭次数，为了弥补初始质心的影响，算法默认会初始10个质心，实现算法，然后返回最好的结果。\r\nmax_iter: 最大迭代次数（因为kmeans算法的实现需要迭代）\r\ntol: 容忍度，即kmeans运行准则收敛的条件\r\nprecompute_distances:是否需要提前计算距离，这个参数会在空间和时间之间做权衡，如果是True 会把整个距离矩阵都放到内存中，auto 会默认在数据样本大于featurs*samples 的数量大于12e6 的时候False,False 时核心实现的方法是利用Cpython 来实现的\r\nverbose: 冗长模式（不太懂是啥意思，反正一般不去改默认值）\r\nrandom_state: 随机生成簇中心的状态条件。\r\ncopy_x: 对是否修改数据的一个标记，如果True，即复制了就不会修改数据。bool 在scikit-learn 很多接口中都会有这个参数的，就是是否对输入数据继续copy 操作，以便不修改用户的输入数据。这个要理解Python 的内存机制才会比较清楚。\r\nn_jobs: 并行设置\r\nalgorithm: kmeans的实现算法，有：’auto’, ‘full’, ‘elkan’, 其中 ‘full’表示用EM方式实现\r\n虽然有很多参数，但是都已经给出了默认值。所以我们一般不需要去传入这些参数,参数的。可以根据实际需要来调用。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db754322047109-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db754322047109-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-1\"><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">KMeans</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">init</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'k-means++'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n_init</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tol</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.0001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">precompute_distances</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'auto'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">verbose</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">copy_x</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">n_jobs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">algorithm</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'auto'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-14\"><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>簇的个数，即你想聚成几类</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-15\"><span class=\"crayon-v\">init</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>初始簇中心的获取方法</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-16\"><span class=\"crayon-v\">n_init</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>获取初始簇中心的更迭次数，为了弥补初始质心的影响，算法默认会初始<span class=\"crayon-cn\">10</span>个质心，实现算法，然后返回最好的结果。</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-17\"><span class=\"crayon-v\">max_iter</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>最大迭代次数（因为<span class=\"crayon-i\">kmeans</span>算法的实现需要迭代）</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-18\"><span class=\"crayon-v\">tol</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>容忍度，即<span class=\"crayon-i\">kmeans</span>运行准则收敛的条件</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-19\"><span class=\"crayon-v\">precompute_distances</span><span class=\"crayon-o\">:</span>是否需要提前计算距离，这个参数会在空间和时间之间做权衡，如果是<span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span>会把整个距离矩阵都放到内存中，<span class=\"crayon-i\">auto</span><span class=\"crayon-h\"> </span>会默认在数据样本大于<span class=\"crayon-v\">featurs</span><span class=\"crayon-o\">*</span><span class=\"crayon-i\">samples</span><span class=\"crayon-h\"> </span>的数量大于<span class=\"crayon-cn\">12e6</span><span class=\"crayon-h\"> </span>的时候<span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span>时核心实现的方法是利用<span class=\"crayon-i\">Cpython</span><span class=\"crayon-h\"> </span>来实现的</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-20\"><span class=\"crayon-v\">verbose</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>冗长模式（不太懂是啥意思，反正一般不去改默认值）</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-21\"><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>随机生成簇中心的状态条件。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-22\"><span class=\"crayon-v\">copy_x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>对是否修改数据的一个标记，如果<span class=\"crayon-t\">True</span>，即复制了就不会修改数据。<span class=\"crayon-k \">bool</span><span class=\"crayon-h\"> </span>在<span class=\"crayon-v\">scikit</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">learn</span><span class=\"crayon-h\"> </span>很多接口中都会有这个参数的，就是是否对输入数据继续<span class=\"crayon-k \">copy</span><span class=\"crayon-h\"> </span>操作，以便不修改用户的输入数据。这个要理解<span class=\"crayon-i\">Python</span><span class=\"crayon-h\"> </span>的内存机制才会比较清楚。</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-23\"><span class=\"crayon-v\">n_jobs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>并行设置</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db754322047109-24\"><span class=\"crayon-v\">algorithm</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">kmeans</span>的实现算法，有：’<span class=\"crayon-i\">auto</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">full</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">elkan</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>其中<span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">full</span>’表示用<span class=\"crayon-i\">EM</span>方式实现</div><div class=\"crayon-line\" id=\"crayon-59d04be5db754322047109-25\">虽然有很多参数，但是都已经给出了默认值。所以我们一般不需要去传入这些参数<span class=\"crayon-sy\">,</span>参数的。可以根据实际需要来调用。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0142 seconds] -->\r\n<p>下面展示一个代码例子</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5db75e615545602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.cluster import KMeans\r\nfrom sklearn.externals import joblib\r\nfrom sklearn import cluster\r\nimport numpy as np\r\n\r\n# 生成10*3的矩阵\r\ndata = np.random.rand(10,3)\r\nprint data\r\n# 聚类为4类\r\nestimator=KMeans(n_clusters=4)\r\n# fit_predict表示拟合+预测，也可以分开写\r\nres=estimator.fit_predict(data)\r\n# 预测类别标签结果\r\nlable_pred=estimator.labels_\r\n# 各个类别的聚类中心值\r\ncentroids=estimator.cluster_centers_\r\n# 聚类中心均值向量的总和\r\ninertia=estimator.inertia_\r\n\r\nprint lable_pred\r\nprint centroids\r\nprint inertia\r\n\r\n代码执行结果\r\n[0 2 1 0 2 2 0 3 2 0]\r\n\r\n[[ 0.3028348   0.25183096  0.62493622]\r\n [ 0.88481287  0.70891813  0.79463764]\r\n [ 0.66821961  0.54817207  0.30197415]\r\n [ 0.11629904  0.85684903  0.7088385 ]]\r\n \r\n0.570794546829</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db75e615545602-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db75e615545602-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cluster </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KMeans</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">externals </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">joblib</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sklearn </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cluster</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-6\"><span class=\"crayon-c\"># 生成10*3的矩阵</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-7\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-8\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-9\"><span class=\"crayon-c\"># 聚类为4类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-10\"><span class=\"crayon-v\">estimator</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">KMeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-11\"><span class=\"crayon-c\"># fit_predict表示拟合+预测，也可以分开写</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-12\"><span class=\"crayon-v\">res</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-13\"><span class=\"crayon-c\"># 预测类别标签结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-14\"><span class=\"crayon-v\">lable_pred</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">labels_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-15\"><span class=\"crayon-c\"># 各个类别的聚类中心值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-16\"><span class=\"crayon-v\">centroids</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cluster_centers_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-17\"><span class=\"crayon-c\"># 聚类中心均值向量的总和</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-18\"><span class=\"crayon-v\">inertia</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">inertia_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-20\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lable_pred</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-21\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">centroids</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-22\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inertia</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-24\">代码执行结果</div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-25\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-26\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-27\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.3028348</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.25183096</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.62493622</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-28\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.88481287</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.70891813</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.79463764</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-29\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.66821961</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.54817207</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.30197415</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-30\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.11629904</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.85684903</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">0.7088385</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db75e615545602-31\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db75e615545602-32\"><span class=\"crayon-cn\">0.570794546829</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>为了更直观的描述，这次在图上做一个展示，由于图像上绘制二维比较直观，所以数据调整到了二维，选取100个点绘制，聚类类别为3类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5db763292504197\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.cluster import KMeans\r\nfrom sklearn.externals import joblib\r\nfrom sklearn import cluster\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\n\r\ndata = np.random.rand(100,2)\r\nestimator=KMeans(n_clusters=3)\r\nres=estimator.fit_predict(data)\r\nlable_pred=estimator.labels_\r\ncentroids=estimator.cluster_centers_\r\ninertia=estimator.inertia_\r\n#print res\r\nprint lable_pred\r\nprint centroids\r\nprint inertia\r\n\r\nfor i in range(len(data)):\r\n    if int(lable_pred[i])==0:\r\n        plt.scatter(data[i][0],data[i][1],color='red')\r\n    if int(lable_pred[i])==1:\r\n        plt.scatter(data[i][0],data[i][1],color='black')\r\n    if int(lable_pred[i])==2:\r\n        plt.scatter(data[i][0],data[i][1],color='blue')\r\nplt.show()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db763292504197-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5db763292504197-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cluster </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">KMeans</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">externals </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">joblib</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sklearn </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cluster</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-7\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-8\"><span class=\"crayon-v\">estimator</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">KMeans</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_clusters</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-9\"><span class=\"crayon-v\">res</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-10\"><span class=\"crayon-v\">lable_pred</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">labels_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-11\"><span class=\"crayon-v\">centroids</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cluster_centers_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-12\"><span class=\"crayon-v\">inertia</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">estimator</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">inertia_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-13\"><span class=\"crayon-c\">#print res</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-14\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lable_pred</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-15\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">centroids</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-16\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inertia</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-18\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lable_pred</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lable_pred</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'black'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lable_pred</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db763292504197-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">scatter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5db763292504197-25\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/72991f2951960519d817d9862f303173.jpg\"><img class=\"aligncenter size-full wp-image-88537\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/72991f2951960519d817d9862f303173.jpg\" alt=\"201708253474_6662\"></a></p>\n<p>可以看到聚类效果还是不错的，对k-means的聚类效率进行了一个测试，将维度扩宽到50维</p>\n<table>\n<thead>\n<tr>\n<th>数据规模</th>\n<th>消耗时间</th>\n<th>数据维度</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>10000条</td>\n<td>4s</td>\n<td>50维</td>\n</tr>\n<tr>\n<td>100000条</td>\n<td>30s</td>\n<td>50维</td>\n</tr>\n<tr>\n<td>1000000条</td>\n<td>4’13s</td>\n<td>50维</td>\n</tr>\n</tbody>\n</table>\n<p>对于百万级的数据，拟合时间还是能够接受的，可见效率还是不错，对模型的保存与其它的机器学习算法模型保存类似</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5db769421047253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom sklearn.externals import joblib\r\njoblib.dump(km,\"model/km_model.m\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5db769421047253-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5db769421047253-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5db769421047253-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">externals </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">joblib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5db769421047253-2\"><span class=\"crayon-v\">joblib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dump</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">km</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"model/km_model.m\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88535\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88535votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88535\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/ce2342470268c3f3bc082d87fc35e14e.png"], "tags": "基础知识,K-means,机器学习,聚类", "url_object_id": "51233bea750b8b47f4d63177351de369", "praise_nums": "1", "url": "http://python.jobbole.com/88535/", "title": "K-means 在 Python 中的实现", "create_date": "2017/09/09", "comment_nums": 0}
{"fav_nums": 6, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010783635\">药少敏</a>   </div><hr>\n<p>知识就像碎布，记得“缝一缝”，你才能华丽丽地亮相。</p>\n<hr>\n<h1>1.Beautiful Soup</h1>\n<h2>1.Beautifulsoup 简介</h2>\n<p>此次实战从网上爬取小说，需要使用到Beautiful Soup。<br>\nBeautiful Soup为python的第三方库，可以帮助我们从网页抓取数据。<br>\n它主要有如下特点：</p>\n<ul>\n<li>1.Beautiful Soup可以从一个HTML或者XML提取数据，它包含了简单的处理、遍历、搜索文档树、修改网页元素等功能。可以通过很简短地代码完成我们地爬虫程序。</li>\n<li>2.Beautiful Soup几乎不用考虑编码问题。一般情况下，它可以将输入文档转换为unicode编码，并且以utf-8编码方式输出，</li>\n</ul>\n<h2>2.Beautiful Soup安装</h2>\n<p>win命令行下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d739c233981602\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install beautifusoup4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d739c233981602-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d739c233981602-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">beautifusoup4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h2>3.Beautiful Soup基础</h2>\n<p>大家可以参考文档来学习（中文版的哦）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d73a6419770059\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[http://beautifulsoup.readthedocs.io/zh_CN/latest/#id8]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73a6419770059-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d73a6419770059-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">beautifulsoup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">readthedocs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">io</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zh_CN</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">latest</span><span class=\"crayon-o\">/</span><span class=\"crayon-c\">#id8]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>对于本次爬虫任务，只要了解以下几点基础内容就可以完成：<br>\n1.Beautiful Soup的对象种类：</p>\n<ul>\n<li>Tag</li>\n<li>Navigablestring</li>\n<li>BeautifulSoup</li>\n<li>Comment</li>\n</ul>\n<p>2.遍历文档树：find、find_all、find_next和children<br>\n3.一点点HTML和CSS知识（没有也将就，现学就可以）</p>\n<h1>2.爬取小说花千骨</h1>\n<h2>1.爬虫思路分析</h2>\n<p>本次爬取小说的网站为136书屋。</p>\n<p>先打开花千骨小说的目录页，是这样的。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/be3f9375411c9350650a985e8d841bb9.png\"><br>\n</a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/be3f9375411c9350650a985e8d841bb9.png\"><img class=\"aligncenter size-full wp-image-88561\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/be3f9375411c9350650a985e8d841bb9.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>我们的目的是找到每个目录对应的url，并且爬取其中地正文内容，然后放在本地文件中。</p>\n<h2>2.网页结构分析</h2>\n<p>首先，目录页左上角有几个可以提高你此次爬虫成功后成就感的字眼：暂不提供花千骨txt全集下载。</p>\n<p>继续往下看，发现是最新章节板块，然后便是全书的所有目录。我们分析的对象便是全书所有目录。点开其中一个目录，我们便可以都看到正文内容。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b52e17721f9e5eedd65dbdba2f9a5c6b.png\"><img class=\"aligncenter size-full wp-image-88562\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b52e17721f9e5eedd65dbdba2f9a5c6b.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>按F12打开审查元素菜单。可以看到网页前端的内容都包含在这里。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/666e311fd115a620584a4b4d53a4b489.png\"><img class=\"aligncenter size-full wp-image-88563\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/666e311fd115a620584a4b4d53a4b489.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>我们的目的是要找到所有目录的对应链接地址，爬取每个地址中的文本内容。</p>\n<p>有耐心的朋友可以在里面找到对应的章节目录内容。有一个简便方法是点击审查元素中左上角箭头标志的按钮，然后选中相应元素，对应的位置就会加深显示。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a477ba5a9b05dd5c1ae95adf7b88530f.png\"><img class=\"aligncenter size-full wp-image-88564\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a477ba5a9b05dd5c1ae95adf7b88530f.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>这样我们可以看到，每一章的链接地址都是有规则地存放在&lt;li&gt;中。而这些&lt;li&gt;又放在&lt;div id=”book_detail” class=”box1″&gt;中。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1c89337bb5c3916b7e74a369b11e739f.png\"><img class=\"aligncenter size-full wp-image-88565\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1c89337bb5c3916b7e74a369b11e739f.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>我不停地强调“我们的目的”是要告诉大家，思路很重要。爬虫不是约pao，蒙头就上不可取。</p>\n<div id=\"book_detail\" class=\"box1\">\n<h2>3.单章节爬虫</h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/191c78754348558ca04b7dd58e785b11.png\"><img class=\"aligncenter size-full wp-image-88566\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/191c78754348558ca04b7dd58e785b11.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>刚才已经分析过网页结构。我们可以直接在浏览器中打开对应章节的链接地址，然后将文本内容提取出来。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/25bde53156252ed7788773b10a2928d8.png\"><img class=\"aligncenter size-full wp-image-88567\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/25bde53156252ed7788773b10a2928d8.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>我们要爬取的内容全都包含在这个&lt;div&gt;里面。</p>\n<p>代码整理如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d73ad789935013\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom urllib import request\r\nfrom bs4 import BeautifulSoup\r\n\r\nif __name__ == '__main__':\r\n    # 第8章的网址\r\n    url = 'http://www.136book.com/huaqiangu/ebxeew/'\r\n    head = {}\r\n    # 使用代理\r\n    head['User-Agent'] = 'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'\r\n    req = request.Request(url, headers = head)\r\n    response = request.urlopen(req)\r\n    html = response.read()\r\n    # 创建request对象\r\n    soup = BeautifulSoup(html, 'lxml')\r\n    # 找出div中的内容\r\n    soup_text = soup.find('div', id = 'content')\r\n    # 输出其中的文本\r\n    print(soup_text.text)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73ad789935013-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73ad789935013-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 第8章的网址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.136book.com/huaqiangu/ebxeew/'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 使用代理</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 创建request对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 找出div中的内容</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'content'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73ad789935013-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 输出其中的文本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73ad789935013-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">soup_text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>运行结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a2826523f0e82825192368f4ad79c2d7.png\"><img class=\"aligncenter size-full wp-image-88568\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a2826523f0e82825192368f4ad79c2d7.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>这样，单章节内容爬取就大功告成了。</p>\n<h2>4.小说全集爬虫</h2>\n<p>单章节爬虫我们可以直接打开对应的章节地址解析其中的文本，全集爬虫我们不可能让爬虫程序在每章节网页内中跑一遍，如此还不如复制、粘贴来的快。</p>\n<p>我们的思路是先在目录页中爬取所有章节的链接地址，然后再爬取每个链接对应的网页中的文本内容。说来，就是比单章节爬虫多一次解析过程，需要用到Beautiful Soup遍历文档树的内容。</p>\n<h3>1.解析目录页</h3>\n<p>在思路分析中，我们已经了解了目录页的结构。所有的内容都放在一个所有的内容都放在一个&lt;div id=”book_detail” class=”box1″&gt;中。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/829b7f92a0960c613989352e6ab14b7b.png\"><img class=\"aligncenter size-full wp-image-88569\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/829b7f92a0960c613989352e6ab14b7b.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<div id=\"book_detail\" class=\"box1\">\n<p>这儿有两个一模一样的&lt;div id=”book_detail” class=”box1″&gt;。</p>\n<p>第一个&lt;div&gt;包含着最近更新的章节，第二个&lt;div&gt;包含着全集内容。</p>\n<p>请注意，我们要爬取的是第二个&lt;div&gt;中的内容。</p>\n<div id=\"book_detail\" class=\"box1\">\n<p>代码整理如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d73b2264195398\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom urllib import request\r\nfrom bs4 import BeautifulSoup\r\n\r\nif __name__ == '__main__':\r\n    # 目录页\r\n    url = 'http://www.136book.com/huaqiangu/'\r\n    head = {}\r\n    head['User-Agent'] = 'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'\r\n    req = request.Request(url, headers = head)\r\n    response = request.urlopen(req)\r\n    html = response.read()\r\n    # 解析目录页\r\n    soup = BeautifulSoup(html, 'lxml')\r\n    # find_next找到第二个&lt;div&gt;\r\n    soup_texts = soup.find('div', id = 'book_detail', class_= 'box1').find_next('div')\r\n    # 遍历ol的子节点，打印出章节标题和对应的链接地址\r\n    for link in soup_texts.ol.children:\r\n        if link != '\\n':\r\n            print(link.text + ':  ', link.a.get('href'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b2264195398-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b2264195398-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 目录页</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.136book.com/huaqiangu/'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 解析目录页</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># find_next找到第二个&lt;div&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup_texts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'book_detail'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'box1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 遍历ol的子节点，打印出章节标题和对应的链接地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">link </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup_texts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ol</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b2264195398-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b2264195398-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">':  '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p></p>\n<div>\n<p>执行结果如图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/00842590f76079c03a5d9e330c44b1df.png\"><img class=\"aligncenter size-full wp-image-88570\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/00842590f76079c03a5d9e330c44b1df.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<h3>2.爬取全集内容</h3>\n<p>将每个解析出来的链接循环代入到url中解析出来，并将其中的文本爬取出来，并且写到本地F：/huaqiangu.txt中。<br>\n代码整理如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d73b6920691695\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom urllib import request\r\nfrom bs4 import BeautifulSoup\r\n\r\nif __name__ == '__main__':\r\n    url = 'http://www.136book.com/huaqiangu/'\r\n    head = {}\r\n    head['User-Agent'] = 'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'\r\n    req = request.Request(url, headers = head)\r\n    response = request.urlopen(req)\r\n    html = response.read()\r\n    soup = BeautifulSoup(html, 'lxml')\r\n    soup_texts = soup.find('div', id = 'book_detail', class_= 'box1').find_next('div')\r\n    # 打开文件\r\n    f = open('F:/huaqiangu.txt','w')\r\n    # 循环解析链接地址\r\n    for link in soup_texts.ol.children:\r\n        if link != '\\n':\r\n            download_url = link.a.get('href')\r\n            download_req = request.Request(download_url, headers = head)\r\n            download_response = request.urlopen(download_req)\r\n            download_html = download_response.read()\r\n            download_soup = BeautifulSoup(download_html, 'lxml')\r\n            download_soup_texts = download_soup.find('div', id = 'content')\r\n            # 抓取其中文本\r\n            download_soup_texts = download_soup_texts.text\r\n            # 写入章节标题\r\n            f.write(link.text + '\\n\\n')\r\n            # 写入章节内容\r\n            f.write(download_soup_texts)\r\n            f.write('\\n\\n')\r\n    f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d73b6920691695-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d73b6920691695-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-4\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.136book.com/huaqiangu/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup_texts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'book_detail'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'box1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 打开文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'F:/huaqiangu.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 循环解析链接地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">link </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup_texts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ol</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">children</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">download_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">download_req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">download_response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">download_html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_soup_texts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">download_soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'content'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># 抓取其中文本</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">download_soup_texts</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">download_soup_texts</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># 写入章节标题</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n\\n'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># 写入章节内容</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">download_soup_texts</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d73b6920691695-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n\\n'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d73b6920691695-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0083 seconds] -->\r\n<p>执行结果显示 [Finished in 32.3s] 。</p>\n<p>打开F盘查看花千骨文件。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5333941e1c92bf0b49675b0b897d2444.png\"><img class=\"aligncenter size-full wp-image-88571\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5333941e1c92bf0b49675b0b897d2444.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>爬虫成功。备好纸巾，快快去感受尊上和小骨的虐恋吧。</p>\n<h2>5.总结</h2>\n<p>代码还有很多改进的地方。例如文本中包含广告的js代码可以去除，还可以加上爬虫进度显示等等。实现这些功能需要包含正则表达式和os模块知识，就不多说了，大家可以继续完善。</p>\n<hr>\n<p>码字辛苦，码代码费神，文字和代码同码更是艰辛无比。如果您觉得文章有那么一丢丢价值，请不要吝啬您的赞赏。</p>\n</div>\n</div>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88560\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88560votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88560\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/be3f9375411c9350650a985e8d841bb9.png"], "tags": "实践项目,网络爬虫", "url_object_id": "cde06d2cf5dac73e8c7cc63e85d2dcf2", "praise_nums": "1", "url": "http://python.jobbole.com/88560/", "title": "Python 爬虫——爬取小说 | 探索白子画和花千骨的爱恨情仇", "create_date": "2017/09/09", "comment_nums": 1}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010800119\">JackieFang</a>   </div><p>在Keras环境下构建多层感知器模型，对数字图像进行精确识别。</p>\n<p>模型不消耗大量计算资源，使用了cpu版本的keras，以Tensorflow 作为backended，在ipython交互环境jupyter notebook中进行编写。</p>\n<h1>1.数据来源</h1>\n<p>在Yann LeCun的博客页面上下载开源的mnist数据库：<br>\n<a href=\"http://yann.lecun.com/exdb/mnist/\">http://yann.lecun.com/exdb/mn…</a></p>\n<p>此数据库包含四部分：训练数据集、训练数据集标签、测试数据集、测试数据集标签。由于训练模型为有监督类型的判别模型，因此标签必不可少。若使用该数据集做k-means聚类，则不需要使用标签。将数据整合之后放入user\\.keras\\datasets文件夹以供调用。</p>\n<p>也可以直接从keras建议的url直接下载：<br>\n<a href=\"https://s3.amazonaws.com/img-datasets/mnist.npz\">https://s3.amazonaws.com/img-…</a></p>\n<p>其中训练数据集包含了60000张手写数字的图片和这些图片分别对应的标签；测试数据集包含了10000张手写数字的图片和这些图片分别对应的标签.</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/f89632a0f244d7a65073b60d427b7c02.png\"><img class=\"aligncenter size-full wp-image-88541\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f89632a0f244d7a65073b60d427b7c02.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/cced4a4151d891aa30603447de9866a6.png\"><img class=\"aligncenter size-full wp-image-88542\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/cced4a4151d891aa30603447de9866a6.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4ffcc27ccc962dce7c728a5cd4426163.png\"><img class=\"aligncenter size-full wp-image-88544\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4ffcc27ccc962dce7c728a5cd4426163.png\" alt=\"2309602036-599c8ecba50ff_articlex\"></a></p>\n<h1>2.数据格式和前期处理（在此不涉及）</h1>\n<p>训练数据集包含60000张图片，测试数据集包含10000张，所有图片都被当量化为28pixel*28pixel的大小。为减少向量长度，将图片灰度处理，每个像素用一个RGB值表示（0~255），这是因为灰度处理后的RGB值加了归一约束，向量长度相是灰度处理前的1/3。至此，每个图片都可以用28*28的向量表示。</p>\n<h1>3.导入依赖库</h1>\n<p>打开jupyter notebook后导入依赖库numpy,此处的seed为随机量的标签，可随意设置:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d37f1609425093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom __future__ import print_function\r\nimport numpy as np\r\nnp.random.seed(9999)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d37f1609425093-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d37f1609425093-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d37f1609425093-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d37f1609425093-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">__future__</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_function</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d37f1609425093-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d37f1609425093-3\"><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9999</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>继续从keras中导入使用到的模块：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d37fb771186290\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom keras.datasets import mnist\r\nfrom keras.models import Sequential\r\nfrom keras.layers.core import Dense, Dropout, Activation\r\nfrom keras.optimizers import SGD, Adam, RMSprop\r\nfrom keras.utils import np_utils</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d37fb771186290-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d37fb771186290-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d37fb771186290-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d37fb771186290-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d37fb771186290-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d37fb771186290-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">datasets </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mnist</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d37fb771186290-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">models </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sequential</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d37fb771186290-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">layers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">core </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dense</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dropout</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Activation</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d37fb771186290-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">optimizers </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SGD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Adam</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RMSprop</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d37fb771186290-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">utils </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np_utils</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>mnist为之前准备的数据集，Dense为全连接神经元层，Dropout为神经元输入的断接率，Activation为神经元层的激励函数设置。</p>\n<p>导入绘图工具，以便之后绘制模型简化图：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d3800992337612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom keras.utils.vis_utils import plot_model as plot</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3800992337612-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d3800992337612-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keras</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vis_utils </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plot_model </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plot</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h1>4.处理导入的数据集</h1>\n<p><em>处理数据集</em></p>\n<ol>\n<li>为了符合神经网络对输入数据的要求，原本为60000*28*28shape的三维ndarray,改变成了尺寸为60000*784的2维数组，每行为一个example，每一列为一个feature。</li>\n<li>神经网络用到大量线性与求导运算，将输入的feature的数值类型改变为32位float。</li>\n<li>将feature值归一化，原本0~255的feature归一为0~1。</li>\n<li>测试数据集同理。</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d3803443277460\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(X_train, y_train), (X_test, y_test) = mnist.load_data()\r\nX_train = X_train.reshape(60000, 28*28)\r\nX_test = X_test.reshape(10000, 28*28)\r\nX_train = X_train.astype('float32')\r\nX_test = X_test.astype('float32')\r\nX_train /= 255\r\nX_test /= 255</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3803443277460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d3803443277460-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3803443277460-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d3803443277460-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3803443277460-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d3803443277460-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3803443277460-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d3803443277460-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mnist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d3803443277460-2\"><span class=\"crayon-v\">X_train</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">60000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">28</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d3803443277460-3\"><span class=\"crayon-v\">X_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reshape</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">28</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d3803443277460-4\"><span class=\"crayon-v\">X_train</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">astype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'float32'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d3803443277460-5\"><span class=\"crayon-v\">X_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">astype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'float32'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d3803443277460-6\"><span class=\"crayon-v\">X_train</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d3803443277460-7\"><span class=\"crayon-v\">X_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">255</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p><em>处理标签</em></p>\n<p>文本识别问题本质是一个多元分类问题。将类向量转换为二进制数表示的类矩阵，其中每一行都是每一个example对应一个label。label为10维向量，每一位代表了此label对应的example属于特定类（0~10）的概率。此时Y_train为60000*10的向量，Y_test为10000*10的向量</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d3807114617648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nY_train = np_utils.to_categorical(y_train, nb_classes)\r\nY_test = np_utils.to_categorical(y_test, nb_classes)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3807114617648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d3807114617648-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d3807114617648-1\"><span class=\"crayon-v\">Y_train</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np_utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_categorical</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nb_classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d3807114617648-2\"><span class=\"crayon-v\">Y_test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np_utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">to_categorical</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nb_classes</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h1>5.用keras建立神经网络模型</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d380a642601583\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nbatch_size = 128\r\nnb_classes = 10\r\nnb_epoch = 20\r\nmodel = Sequential()\r\nmodel.add(Dense(500, input_shape=(28*28,)))\r\nmodel.add(Activation('relu'))\r\nmodel.add(Dropout(0.2))\r\nmodel.add(Dense(500))\r\nmodel.add(Activation('relu'))\r\nmodel.add(Dropout(0.2))\r\nmodel.add(Dense(500))\r\nmodel.add(Activation('relu'))\r\nmodel.add(Dropout(0.2))\r\nmodel.add(Dense(10))\r\nmodel.add(Activation('softmax'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d380a642601583-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380a642601583-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-1\"><span class=\"crayon-v\">batch_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-2\"><span class=\"crayon-v\">nb_classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-3\"><span class=\"crayon-v\">nb_epoch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-4\"><span class=\"crayon-v\">model</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Sequential</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-5\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">input_shape</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">28</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-6\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Activation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'relu'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-7\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dropout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-8\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-9\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Activation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'relu'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-10\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dropout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-11\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-12\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Activation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'relu'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-13\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dropout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d380a642601583-14\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Dense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d380a642601583-15\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Activation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'softmax'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>每次iter时，每一批次梯度下降运算所包含的example数量为128；<br>\nsoftmax输出值为10维向量；<br>\n一共迭代20次iteration。</p>\n<p>三层的神经网络，其中输入层为28*28=784维的全连接层。<br>\nHidden Layer有3层，每一层有500个神经元，input layer-&gt;hidden layer-&gt;output layer都是全连接方式（DENSE）。</p>\n<p>hidden layer的激活函数采用ReLu函数，表达式：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/de53a2a1524e7df33288fd052aeb140e.png\"><img class=\"aligncenter size-full wp-image-88545\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/de53a2a1524e7df33288fd052aeb140e.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a>如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4f4e774dad18d75e9648976e40b9606.png\"><img class=\"aligncenter size-full wp-image-88546\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4f4e774dad18d75e9648976e40b9606.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a><br>\n相比与传统的sigmoid函数，ReLU更容易学习优化。因为其分段线性性质，导致其前传、后传、求导都是分段线性。而传统的sigmoid函数，由于两端饱和，在传播过程中容易丢弃信息。且Relu在x</p>\n<p>文本识别本质是多元分类（此处为10元分类），因此输出层采用softmax函数进行feature处理，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d616365618331d21fb86d44b1f0e260a.png\"><img class=\"aligncenter size-full wp-image-88547\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d616365618331d21fb86d44b1f0e260a.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a><br>\n其中第j个输出层神经元输出值与当层输入feature的关系为：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/7f1f6812f3cfcb64d8fdaa3251908291.png\"><img class=\"aligncenter size-full wp-image-88548\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/7f1f6812f3cfcb64d8fdaa3251908291.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a>该神经网络示意图如图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/f6eb1d4132339d5a29e2142ddf9418eb.png\"><img class=\"aligncenter size-full wp-image-88549\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f6eb1d4132339d5a29e2142ddf9418eb.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>调用summary方法做一个总览：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d380f490331022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmodel.summary()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d380f490331022-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d380f490331022-1\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">summary</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/fd34f7741cb07c0cd4a8462542a7e8f3.png\"><img class=\"aligncenter size-full wp-image-88550\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fd34f7741cb07c0cd4a8462542a7e8f3.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>该神经网络一共有898510个参数，即在后向反馈过程中，每一次用梯度下降都要求898510次导数。</p>\n<p>用plot函数打印model：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d3812548306566\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nplot(model, to_file='mlp_model.png'，show_shapes=True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3812548306566-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d3812548306566-1\"><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">to_file</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'mlp_model.png'</span>，<span class=\"crayon-v\">show_shapes</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/0e9932fc69e8ddbb37276d9d71093097.png\"><img class=\"aligncenter size-full wp-image-88551\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0e9932fc69e8ddbb37276d9d71093097.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>编译模型，使用cross_entropy交叉熵函数作为loss function，公式如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9f8d4f4ef99690bfdb0d9f5b4371f85f.png\"><img class=\"aligncenter size-full wp-image-88552\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9f8d4f4ef99690bfdb0d9f5b4371f85f.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>用交叉熵可量化输出向量与标签向量的差异，p与q分别为输出向量与标签向量。对于每一个example，其交叉熵值就是要通过迭代尽量往小优化的值。优过程使用梯度算法，计算过程中使用反向传播算法求导。</p>\n<p>交叉熵的作用如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a5c4ca8b7c9aac7ebc969f0d24a70431.png\"><img class=\"aligncenter size-full wp-image-88553\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a5c4ca8b7c9aac7ebc969f0d24a70431.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>在此分类神经网络中，使用判别结果的accuracy作为参数值好坏的度量标准。</p>\n<h1>6.用数据训练和测试网络</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d3816909751762\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhistory = model.fit(X_train, Y_train,\r\n                    batch_size=batch_size, nb_epoch=nb_epoch,\r\n                    verbose=1, validation_data=(X_test, Y_test))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3816909751762-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d3816909751762-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d3816909751762-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d3816909751762-1\"><span class=\"crayon-v\">history</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y_train</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d3816909751762-2\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">batch_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">batch_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nb_epoch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">nb_epoch</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d3816909751762-3\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">verbose</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validation_data</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y_test</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>在这个地方运行碰到warning，原因是最新版的keras使用的iteration参数名改成了epoch，而非之前沿用的nb_epoch。将上面的代码作修改即可。</p>\n<p>训练结果如下所示。第一次迭代，通过对60000/128个的batch训练，已经达到了比较好的结果，accuracy已经高达0.957。之后Loss值继续下降，精确度继续上升。从第9个itearation开始，loss函数值（交叉熵cross_entropy）开始震荡在0.05附近，accuracy保持在0.98以上。说明前9次迭代就已经训练了足够好的θ值和bias，不需要后11次训练。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d726390d1a299fa98e20e254ce08cde9.png\"><img class=\"aligncenter size-full wp-image-88554\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d726390d1a299fa98e20e254ce08cde9.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<h1>7.评估模型</h1>\n<p>用score函数打印模型评估结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be5d381a908029190\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscore = model.evaluate(X_test, Y_test, verbose=0)\r\nprint('Test score:', score[0])\r\nprint('Test accuracy:', score[1])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be5d381a908029190-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be5d381a908029190-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be5d381a908029190-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be5d381a908029190-1\"><span class=\"crayon-v\">score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">evaluate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y_test</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">verbose</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be5d381a908029190-2\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Test score:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be5d381a908029190-3\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Test accuracy:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>输出结果如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/122fee62a7c75ce822aebbdca1b84842.png\"><img class=\"aligncenter size-full wp-image-88555\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/122fee62a7c75ce822aebbdca1b84842.png\" alt=\"1068837024-599c8e667e5f4_articlex\"></a></p>\n<p>训练的multi-layer_perceptron神经网络在对数字文本识别时具有98.12%的准确率。</p>\n<p>手写数字图片数据库和Iris_Flower_dataset一样，算是dl界的基本素材，可以拿来做很多事情，比如k-means聚类，LSTM(长短记忆网络)。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88540\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88540votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88540\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/f89632a0f244d7a65073b60d427b7c02.png"], "tags": "实践项目,图像识别,机器学习,神经网络", "url_object_id": "5b5996437669c6d2d749e0be32662a68", "praise_nums": "1", "url": "http://python.jobbole.com/88540/", "title": "构建多层感知器神经网络对数字图片进行文本识别", "create_date": "2017/09/09", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010756033\">js信仰者</a>   </div><p>最近在考虑学习一门后端语言，在ruby和python直接犹豫，然后自己做了一些对比，希望能帮到有同样问题的你。</p>\n<h1>一、异同对比选择</h1>\n<h2>1、<a href=\"http://lib.csdn.net/base/python\">Python</a>和ruby的相同点：</h2>\n<ul>\n<li>都强调语法简单，都具有更一般的表达方式。<a href=\"http://lib.csdn.net/base/python\">python</a>是缩进，ruby是类basic的表达。都大量减少了符号。</li>\n<li>都是动态数据类型。都是有丰富的<a href=\"http://lib.csdn.net/base/datastructure\">数据结构</a>。</li>\n<li>都具有<a href=\"http://lib.csdn.net/base/c\">C语言</a>扩展能力，都具有可移植性，比perl的可移植性更好。也都可以作为嵌入语言。</li>\n<li>都是面向对象的语言，都可以作为大项目的开发工具。</li>\n<li>都有丰富的库支持。</li>\n<li>也有最宽松的版权许可，除了一些工具属于GNU世界。</li>\n<li>都有lisp特色的eval函数，也都能把函数作为参数。</li>\n<li>也有图形界面的ruby的专门编辑器。</li>\n<li>都获得了广泛的c库的支持。如qt、gtk、tk、SDL、FOX等，ruby计划实现SWIG接口。</li>\n<li>都有完善的文档。</li>\n</ul>\n<h2>2、和python相比ruby的优点：</h2>\n<ul>\n<li>具有正则表达式和嵌入html的功能。python也有正则表达式，但没有ruby的应用方便和广泛。python的嵌入html项目才刚起步。ruby还有apache的mod模块。ruby本身也实现和很多unix工具，如racc，doctools。比python更亲近<a href=\"http://lib.csdn.net/base/linux\">Linux</a>。</li>\n<li>比python功能更完整的面向对象的语法。</li>\n<li>ruby的整个库都是具有类继承的结构。</li>\n<li>他的基本的数据类型和运算符都是可以重载的。</li>\n<li>ruby主要的功能都是通过对象的方法调用来实现的，而不是函数。python也在向这方面发展，但没有ruby做的彻底。</li>\n<li>ruby的类是更规范的单继承，还有接口等概念的实现。</li>\n<li>python可以实现在列表内的条件语句、循环语句，而ruby用“块”的方式来实现这个功能，比python的更灵活，更具有通用性。</li>\n<li>ruby具有类似lisp的彻底的函数方式的条件语句、循环语句等。语句的表达能力更强。</li>\n<li>附带一些unix工具，如racc等。</li>\n</ul>\n<h2>3、和python相比ruby的不足：</h2>\n<ul>\n<li>最大的不足正是因为ruby的强大所引起的。它没有python的简单性好。比较复杂的面向对象语法、“块”语法的引入、正则表达式的引入、一些简写标记都增加了语言的复杂性。</li>\n<li>python的缩进表达方式比ruby的basic的表达方式更让人悦目，ruby程序的满眼的end让人不舒服。当然，ruby认为end的方式比python更先进。</li>\n<li>ruby还没有python的“自省”的能力，没有从程序文件中生成文档的能力。</li>\n<li>ruby没有国际化的支持。国际化支持在ruby的计划中。这是因为ruby的历史比python要短造成的。</li>\n<li>ruby没有类似jython的东西。</li>\n</ul>\n<h2>4、python和ruby的语言的选择：</h2>\n<p>从简单的就是好的来说，选python是没错的。python适合寻找简单语言的人，这很可能造成python更流行，因此也有更多的支持。但如果要追求更强大的语法功能，则ruby是好的选择。因为ruby和python的哲学有很多相似的地方，先从python入手，尽量用python，如果python的能力不足了，可以在找ruby。</p>\n<p>ruby和python的比较，就像五笔和拼音输入法的比较。拼音作为入门的输入法和长久使用的输入法都没有问题。五笔适合更高要求的情况。如果追求性能的不妨学学ruby。对编程语言感兴趣，想了解各种编程概念的学ruby也会很兴奋。</p>\n<h1>二、两者各有特点：</h1>\n<h2>1、Python从语法上来说更质朴一些，而Ruby更性感一些</h2>\n<p>Python的语法相对其他脚本语言来说，没有太多花巧的地方，显得比较死板一点，其实从Python强制代码缩进也可以看出来Guido设计语言的取向。语法死板的一面就是不容易玩出来更性感的东西，比方说Rails这样的框架，另外Python也无法做DSL这样的事情，但是语法死板的另一面就是比较规范，相对来说，更加适应软件开发的工程性要求，更容易组织大规模的团队进行开发。</p>\n<p>Ruby的语法非常灵活，Matz设计ruby的出发点也是为了coding for fun，因此可以用ruby玩出来很多花样，运用足够的技巧，可以用Ruby写出来逼近<a href=\"http://lib.csdn.net/base/nlp\">自然语言</a>的DSL，对于程序员来说，玩ruby确实充满了乐趣。Rails能在ruby社区诞生，而不是Python社区诞生绝对和编程语言有直接的关系。不过ruby语法灵活的另一面就是编程实现风格的多样性，这对于大规模团队的协作和管理是一个挑战。</p>\n<h2>2、Python的解析器实现更成熟，第三方库质量高</h2>\n<p>Ruby1.9解析器尽管已经有了很大的性能提升和很多新的功能，但是从源代码实现的角度来说，基本上是通过在Ruby1.8源代码上打patch来增加功能的。从源代码的结构来说，Ruby的实现太古老了，Ruby扩展起来比较困难，只能不断打patch。这也是为什么现在Ruby社区涌现出来那么多新的Ruby解析器实现的原因。从很大程度上来说，这制约了Ruby的发展速度。相对而言，Python解析器更成熟，也比较稳定。</p>\n<p>在第三方类库的数量上来说，Ruby并不比Python少，但是高性能高质量久经考验的第三方类库Python要明显比Ruby多，事实上很多Ruby的第三方类库都不太成熟，因此这也很大程度上制约了Ruby的发展。</p>\n<h2>3、Python的应用领域非常广泛，而Ruby目前主要局限在在Web领域</h2>\n<p>Python应用的领域非常广泛，除了web开发以外，还被广泛用在服务器后端的高性能服务器实现，服务器后端的各种密集运算，全文检索，各种文本处理，系统管理等等，另外桌面应用领域wxPython也是一个很成熟的跨平台GUI框架。对于某些特殊的应用，比方说调用<a href=\"http://lib.csdn.net/base/operatingsystem\">操作系统</a>内核API，Python也可以完成的很好，比方说大量小文件的实时同步方案，就是用Python直接调用<a href=\"http://lib.csdn.net/base/linux\">linux</a>Kernel的inotify特性来实现的。所以可以说Python是软件开发领域的瑞士军刀，什么事情都可以做。</p>\n<p>正是由于Ruby解析器和Ruby类库的制约，Ruby的应用主要局限在Web开发领域，目前Ruby的应用还无法延伸到web开发领域以外的很多地方。据说豆瓣早期就考虑过Ruby on Rails，但是因为Ruby不能做其他事情，而Python可以大包大揽，最后放弃Ruby选择了Python。</p>\n<h2>4、在Web领域Ruby是王者</h2>\n<p>随着互联网应用更进一步渗透到软件开发的各个领域，其实web开发占整个软件行业开发的比重也是越来越大。尽管Ruby在其他领域很受制约，但是在Web开发领域就是绝对的王者了。Rails框架的领先程度已经远远甩开了任何一个潜在的竞争对手十万八千里。因此尽管Ruby可能有这样那样的问题，但是说到Web开发，Rails几乎就是无可争议的唯一选择。</p>\n<p>而Python尽管十分全面，却偏偏在web开发领域不彰，web框架虽然众多，却没有一个真正可以挑大梁，Django虽然在Python社区比较流行，但很多方面也有缺陷。现在的互联网应用往往都是多种语言混合编程，Ruby在Web以外的缺陷也可以用其他语言来弥补。</p>\n<h2>5、Python的包管理不如Ruby</h2>\n<p>尽管Python的第三方类库更高质量更成熟，但是Python社区缺乏Ruby Gem这样一个良好的包管理软件和包发布的网站。因此应用的构建显得不如Ruby那么方便，那么人性化。特别是在类库的版本升级上，就会遇到很多麻烦，不如Ruby Gem那么简单。</p>\n<p>不过总的来说，Python和Ruby还是相似度极高的两种编程语言，即使两种编程语言都学习一下也不会浪费太多时间。如果我个人选择的话，会首选用Rails来构建web应用，再根据情况选择Python或者<a href=\"http://lib.csdn.net/base/java\">Java</a>处理一些服务器后端的运算。总之，未来还是一个混合编程的时代，我们需要多了解一些编程工具，然后根据需要看菜吃饭才行。</p>\n<h1>三、《ruby和python的比较》之更正</h1>\n<p>1、文档、开源项目、库支持，这些东西Ruby不要跟Python比，不是几个数量级的问题，何必貌似并列的排在一起。</p>\n<p>2、Python确实没有把正则表达式模块内置到核心里面，但是却有re这个标准库的支持，当时的目的也是为了尽可能的把核心做到最小。我不太明白，使用标准库和内置有什么区别，甚至可以作为优点？且使用Python中的正则表达式也不过是多个import</p>\n<p>re和调用时的几个字母而已，省下的无数个end足以抵销这个问题了。</p>\n<p>3、至于嵌入HTML功能，Python里有C/Python双实现的Cheetah模板可用，据说托Zope的福，美国海军和法国政府在用，不知Ruby这个功能的成熟度如何？</p>\n<p>4、mod_ruby模块的出现时间很短，如果作者没有听过mod_python那就实在孤陋寡闻了。我在一年前翻译mod_python3.2.8文档的时候，mod_python已经很成熟了，以至于几乎所有的Python</p>\n<p>WEB框架都支持构建在其上来提高效率。但是，似乎mod_ruby的更新，每年也只有几次。mod_python更有gnu.org这样的重量级应用，不知mod_ruby有没有？</p>\n<p>5、另外，提到unix工具。Red hat</p>\n<p>Linux的安装程序一直是用Python写的，如果你恰巧用ubuntu，那么，那个提示你更新系统的程序，也是用Python写的。</p>\n<p>6、racc和doctools，请原谅我的孤陋寡闻，我google了一下居然除了你的这篇文章还没找到几篇关于racc的中文内容，辗转之后才查到是一种类似yacc的工具。从google的角度讲，racc的可用性我就不多说了。我不太明白一个yacc工具在日常编程当中有多大的实用性，但是既然作者提到了我就顺便找了个我只听说过名字，根本没用过的<a href=\"http://lib.csdn.net/base/spark\">Spark</a>。google的结果是”racc</p>\n<p>ruby”:”python</p>\n<p>spark”=159,000:659,000。至于doctools，我更是无话可说，在google上只有15,800条记录，我到现在都看不出这个东西是干什么用的。所以找了个估计是类似的东西对比了一下，docutils，google的记录是25,400条。</p>\n<p>7、“比Python库更完整的面向对象语法”。试问面向对象的目的是什么？再者，ruby能否像Python一样，绝大多数标准库根本不需要查文档，只要猜测一下大体上的名字，然后dir()一下，再help()一下就可以直接上手，用到第二次的时候，因为模块内东西实在太少，记忆太方便，就可以直接写出来的地步？另外，面向对象既不是什么银弹，也不是最先进的软件工程思想。</p>\n<p>8、”ruby的整个库都是类继承结构的”，个人认为是Java的糟粕，反倒是当成宝学过来了。或许这也是ruby来拯救Java程序员的一项优势吧。</p>\n<p>9、”基本数据类型和运算符都是可以重载的”，这个不是太清楚，不知Python中重载__add__之类的算不算。</p>\n<p>10、”ruby主要的功能都是通过对象的方法调用来实现的，而不是函数”，Python中所有的东西都是对象，但并不都是类，不知这句还有什么意义。另外，推荐你不要太追求什么彻底，还是实用这个词比较有吸引力。</p>\n<p>11、Python没有严格要求单继承是给程序员以灵活性。另外，关于接口，Python中只要定义了同名的函数就算是具有了相同的接口，玄学上升到了这个高度，我也有些迷糊了。至于接口，不要那么自信，ruby的所谓接口也不过是个mix-in。这个东西Python的几个大项目中也有过实现，只是因为对Python意义不明显，所以才没有更多的使用。</p>\n<p>12、关于lisp的函数式编程，Python中有很多内置支持，如map、zip、filter等等，当然还有lambda。不要说支持，我们谈实用。Pythoner中尚且有些人认为函数式编程影响了代码可读性而尽量避免呢。所以，你认为支持什么东西之前，先想好这样东西算不算是个好东西。</p>\n<p>13、”最大的不足正是因为ruby的强大所引起的”。这句真恶心，不予评论。</p>\n<p>14、呵呵，ruby居然没有国际化支持，真是个笑话，不知道当初那个小日本怎么想的？难道他英语过了四级？</p>\n<p>15、至于jython，现在也有了jruby，可能是作者的原文比较早的缘故吧。Python也有很多种实现，像是jython,ironpython, pypy,pyrex等等。Python的优秀其实并不一定要通过用其他语言来实现才能体现出来。当然更不要说寄希望于要Java来解救水深火热中的ruby了。</p>\n<p>另外么，有些ruby的缺点不要回避：</p>\n<p>16、ruby没有本地化线程，而是用的伪线程，根本无法利用多核CPU的优势。CPython使用了本地化线程，但是因为使用了GIL所以也是无法利用多核CPU优势的。但是Stackless的出现完全可以解决这个问题，并且stackless更是将Python提高到了并行计算的高度，这个高度的竞争对手可以是Erlang，ruby自然不必窥探。其中的超轻量线程技术可以确保一台很烂的机器上跑几十万的线程还很轻松。基于Twisted的异步编程方式也提供了一种选择。</p>\n<p>17、刚刚开始学Python的时候，就听说过一句“Python是主流动态语言中最慢的”，后来才知道，说那句话的人根本没把ruby放在眼里。如果把ruby也算进主流动态语言里，那么就会出现一个比Python还慢了一个多数量级的语言了。</p>\n<p>18、ruby流行么？是不是要走向<a href=\"http://lib.csdn.net/base/php\">PHP</a>？<a href=\"http://lib.csdn.net/base/php\">php</a>是个好东西，但是问题在于他只能作WEB编程，限制了PHP的应用范围，稍微需要系统一点的东西就要借助于C。而现在的ruby似乎也就是走着这条路。直到有一天，有人爆料”ruby是可以做客户端编程的”，赢得大家一片好奇。况且现在的ROR能否取代什么还是个未知数。从Java</p>\n<p>WEB开发中解救出来的人们也并不都是走向了ruby。</p>\n<h1>四、评《选Ruby还是选Python？》</h1>\n<p>Python和Ruby的设计哲学确实有很大的差异，这个问题，我就不评论哪个更好了，各有所爱吧。至于效率，Ruby永远不要考虑跟Python相比。Ruby是伪线程，而且根本没有利用多核CPU的可能，直接pass。而Python使用native</p>\n<p>thread，仅仅由于部分模块不是threadsafe的而加入了GIL来限制应用多核CPU，而在我最近的<a href=\"http://lib.csdn.net/base/softwaretest\">测试</a>中，在使用Twisted的异步线程之后，已经可以很好的利用多核CPU的计算能力了。执行效率上也不是一个数量级，自己试试就知道。</p>\n<p>拿Java对比Python，可见作者创造力之强悍，哈哈。开源项目是很符合达尔文的自然选择的，难道Ruby的开源项目少倒成了优点了？另外，在Python中我也没见除了WEB</p>\n<p>framework之外有什么项目有太多的重复。举个例子，pypcap就已经基本淘汰了pcapy了。</p>\n<p>谈到资源，Ruby还有很长的路要走，所以提到双方都很强的时候，麻烦不要太并列化了。至于Java社区的人倾向于学Ruby，我个人认为只是被Java折磨惯了的开发人员目光太狭隘所致。语言是工具，面向对象也是工具，纯粹的面向对象并不见得高明到哪里去，Python也有函数式编程的支持，作者怎么没有提到。另外，Python的很多做法是以开发效率为第一目标的而不拘泥于各类形式，甚至为很多智力有限的人所广泛诟病的C++中的多继承，Python也可以支持。问题不在于支持了什么让你不喜欢的东西，而是让尽可能多的人用上他们喜欢的东西。另外，一直被Ruby开发者所认为的Python不够OO的一个例子就是取一个序列的长度，Python使用len(x)的方法。这个问题，如果Ruby开发者认为x.length就可以算是OO的话，那么Python也大可以直接使用x.__len__()来获取长度。从用方法来封装属性的Java角度讲，谁更OO一些呢，哈哈。</p>\n<p>Ruby是一个日本人的作品，呵呵，这个就不多说了，不喜欢日本的国人有很多，在此我仅在技术层面就可以把Ruby贬低下去，无须用非技术的东西了。</p>\n<p>关于Ruby on</p>\n<p>rails，Ruby社区确实把几乎所有的精力都集中于此。但是这只能表现出Ruby的幼稚，事实已经证明了，ROR的很多模仿者已经推出无数的高级功能，远远超过了ROR，没有取代ROR只是出于先入为主的观念。如果现在的Ruby，突然失去了ROR又会是什么样子。至于作者提到的zend，居然用来跟ROR相比，有如以卵击石，我学过Python的2种WEB框架，平时也比较关注Python和Ruby的各种东西，但是zend这个东西，我是没有听说过的，不知是不是作者的作品，哈哈。如果一定要在WEB框架上有个较量的话，你可以用django,Quixote,mod_python之类的来比较一下。django，一个典型的ROR模仿品，还在成长，但是已经有很多优于ROR的功能了，而性能上远优于ROR自不必说。应用Quixote的douban.com是所有使用Python和Ruby网站中流量最大的，而且在相同硬件配置的情况下比ROR实现速度快了一倍还多，要知道去除WEB服务器等等的各种平等损耗之后，这可是要快上一个数量级的东西。至于mod_python，据说<a href=\"http://www.gnu.org/\">www.gnu.org</a>用的就是这个。如果Ruby还想开源的话，那么就永远活在Python的阴影里面吧。</p>\n<p>至于上手的速度，各个人有不同的情况，不作评论。至于灵活性所带来的东西，仁者见仁，就不要评论了。作者谈到Python的入门不容易，真不知Ruby有个何等容易。我初学Python时，第11天就用Python写了一个词法解析器，至今仍然在我博客上可查。所以，入门难度这个东西，每个人还是自己去试试为好，不必听别人怎么说。</p>\n<p>提到ROR生成的目录有很多东西，要很久才可以都了解，这确实是IDE的综合症。在Python下，比较典型的例子是TurboGears，如果你希望了解整个应用程序的运行方式，你可以从核心cherrypy开始学习，然后开始使用TurboGears就没有什么可不了解的东西了。在这个角度上，ROR没有选择。再者，现在ROR可用的一种连接WEB服务器的方式scgi，当年也是Python的作品，又是一个在Python的阴影下活着的小东西。</p>\n<p>未来的发展么，孤注一掷的Ruby还很难说，但既然是孤注一掷，风险还是蛮大的。而Python么，我也以为真的会平稳的发展，但是后来Micro$oft的加入，让我们都难以预料Python的未来到底有多大了。我们再回头谈谈作者一直讨厌的Python的多样性，在我看来Ruby可以超越Python的东西屈指可数，而Python超过Ruby的东西，自然是Ruby难以逾越的鸿沟。所以从编程语言的多样性考虑，也就不建议大家学Ruby了吧，少了一种选择，聚集一些人气总是好的。</p>\n<h1>五、python和ruby,我选谁？</h1>\n<p>其实python和ruby非常接近，比大多数别的语言要接近的多，所以喜欢用啥就用啥（大实话，虽然也是废话）。语法上的差别虽然有那么一点，大部分是syntax sugar，我斗胆稍微列几个（python我也忘得差不多了，不对的大家尽管来鞭尸吧），但是主要差异还是设计思想上的：灵活vs明确. 我不认为两者在生产力上会有什么差别，如果你熟悉的话。*注意，仅限语言本身的比较。</p>\n<p>1. ruby的case可以匹配很多东西：范围/数组，对象，正则表达，python没有case/switch而使用if/else比较死板点</p>\n<p>2. python的缩进很漂亮，虽然有时会造成些许麻烦。ruby的end蛮难看的，所以大家都被逼当one liner（玩笑）</p>\n<p>3. 感觉上ruby比python更OO,当然这也可能是因为python不提倡用那些改变对象内部构造的‘伎俩’造成的错觉</p>\n<p>4. python有list comprehension, ruby没有:(</p>\n<p>5. python有真正的keyword argument, ruby用hash模拟，当然实际用起来没什么差别</p>\n<p>6. python的self很讨厌，ruby没有那种繁琐的东西</p>\n<p>7. reflection，ruby内置了很多方法，比如object.methods，而python把这些信息存在特殊的字典里。差不多</p>\n<p>8. ruby的block功能很强，python的lambda只能返回单一值</p>\n<p>9. ruby的open class已经声明远播，可以玩出2.days.ago这样的花样，python好像没法直接修改内置类也反对这么做。</p>\n<p>10. python需要用@classmethod修饰声明类方法，ruby是内建</p>\n<p>11. ruby有单子方法，也就对对象单独定制，python不知道有没有类似概念</p>\n<p>12. ruby有method_missing机制，python可以使用__getattr__截获未定义方法(from qiezi)</p>\n<p>13. ruby使用单继承+mixin，python使用多重继承，不过python也有mixin</p>\n<p>14. ruby有attr_*系列语法helper，省却自己写一堆setter/getter, python的property方法还是得自己写setter/getter</p>\n<p>15. ruby和python都使用duck typing，不过python也有一套显式的interface机制(从zope3并入内核了么？)</p>\n<p>16. ruby的函数调用括号是可省的，稍微少敲几下键盘。python默认没括号也不带参数的话返回函数本身的一个引用。</p>\n<p>17. 我不清楚python的meta programming能到什么程度，只好等大牛来说说了。只是觉得pythoner不常用那个，也许觉得会把程序逻辑搞得晦涩不明。</p>\n<p>18. ruby从perl继承了一部分难看的东西，比如很多预定义的$x常量</p>\n<p>19. ruby内建正则表达，方便一点</p>\n<p>20. ruby的yield是用来call block的。而python的yield是用来给generator输入输出值的。</p>\n<p>21. python的库给我感觉命名规范有点不统一，有些方法用snake_case有些则用CamelCase,也许是库太多了遗留下的历史问题</p>\n<p>22. python的三引号很漂亮，ruby的&lt;&lt;-XX…XX太难看了，也可以用%q{…}包裹多行文字(from qiezi)</p>\n<p>23. ruby的类库设计中喜欢给方法添加别名，方便记忆。</p>\n<p>另： ruby官方网站也提供了一些基本的比较。</p>\n<h1>六、两种语言的资源和学习曲线比较：</h1>\n<p>总体的印象，用一个不大恰当的比喻：如果Python是Java，那么Ruby就是.net。我们知道，Java世界非常复杂，非常多样性，任何一个需求，都会有很多开源项目，他们用不同的思想来实现，性能特点迥异，到底选那个，总是令人犯难。现在Python也是如此，而由于Python开发难度远远低于Java，导致Python的相关项目比Java还要多得多。</p>\n<p>资源上，两者社区都很强，有趣的是，现在Java社区存在被Ruby同化的危险，至少我订阅的几个<a href=\"http://lib.csdn.net/base/java\">Java</a>blog聚合中谈Ruby比Java还多。Ruby的社区较为集中，Python则比较分散。我总怀疑Ruby的日本用户较多，但因为不懂日文，很难确认这个想法。对于一个母语非英语的创始人，我总是有点恐惧，怕很难理解他，怕很难得到最新消息等等，虽然这个担心目前看来并无必要，不过，谁知道会怎么样呢！</p>\n<p>Ruby之所以现在突然变得热门，和rails这套<a href=\"http://lib.csdn.net/base/architecture\">架构</a>是分不开的。考虑Ruby,就要考虑到Ruby on rails。rails提供了一套非常好的web开发框架，开发效率非常高。Python虽然有很多类似的架构实现，但并没有出现一个能够一统江湖的架构。Python的zend虽然完整，但更偏向于web服务器，不能用来和rails比较。</p>\n<p>Ruby比pyton更容易上手。从语言特征看，Ruby有很多有意思的创造，比如说block，但大规模的应用这些好玩的东西让程序变得混乱。Python语法强调简单，但是由于太灵活，简单得太过分，于是传统程序员经常会看到一些令人大吃一惊的表达方式。我不知道这应该算优点还是缺点，至少我认为语法过于灵活，容易导致不同程序员的代码风格差异过大，增加了学习成本。</p>\n<p>初期入门，Ruby更容易，但一旦达到一定复杂度，那么Ruby的难度骤然加大。Python入门不容易，复杂的时候也不会太痛苦。rails有入门简单，深入难的问题。rails生成的目录是做什么用途？o/r mapping如何实现的？如何把数据从web中传递到<a href=\"http://lib.csdn.net/base/mysql\">数据库</a>的。这些都是Ruby程序员早晚要面对的问题。Python则不会这样，如果搞不清楚这些，大概根本没办法开始。集成度太高的快速开发工具都有这个特点，无论是VB、Delphi，还是.net，有多少使用了半年以内的开发人员可以说清楚工程目录下面所有的文件的用途、每个文件中的语法？我相信很多很有经验的用户也未必说的清楚。</p>\n<p>从架构上看，二者虽然实际上相差甚远，但最后表现出来的结果反而很相似。Ruby是纯粹的OO语言，而Python是函数和OO混合型。虽然Ruby也能用函数风格的编码方式，但实际上是模拟出来的。他们的这个差距对于普通的程序员影响并不大，毕竟看起来差不多。</p>\n<p>总体来说，如果是非专业人员初尝开发，Ruby是合适的。对于专业的程序员，我还是建议选择Python。</p>\n<p>对于未来发展，我认为Python的发展可预见，会较为平稳。Python已经属于一个社区，而非一个人，但Ruby由于种种原因，Ruby的作者maze的意志仍然会对Ruby的发展造成较大影响。Sun控制着Java，但由于sun的资源强大，且组织了jcp进行统筹，所以Java发展很不错，但Ruby能不能作到这一点，还需要时间来证明。</p>\n<h1>七、从Python到Ruby</h1>\n<p>Python是一门非常优秀的语言，从Python迁移到Ruby，你将发现一些语法上的不同。</p>\n<p><strong>相似点</strong></p>\n<p>和Python一样，在Ruby中,…有一个交互提示 (叫做 irb).你可以在命令行中读取文档 (通过ri 命令来替代 pydoc).没有特殊的结束一行的符号(新行除外).文字可以用多行，就像Python中的三个引号.List用[]，Dict用{} (Dict在Ruby中叫“hashes”).Arrays的工作方式相同(2个Array相加成为一个更加长的Array,但是想这样a3 = [ a1, a2 ] 合并，将产生一个包含数组的数组).Objects是有固定类型和动态转换的.一切都是object,变量名只是一个指向Object的指针.虽然关键字不同, 但是exceptions的工作方式不变.你拥有嵌入文档的工具 (在Ruby中叫做rdoc).</p>\n<p><strong>不同点</strong></p>\n<p>与Python不同, 在Ruby中,…Strings是可以改变的。你可以使用常量(常量的值是不同改变的)。这里有些强制规定的书写要求 (例如：class的名字以大写字母开头, 变量名已小写字母开头)。这里只有一种容器(Array), 并且是可以改变的。引号中的String限制不同。这里没有新风格的Class，Class只有一种风格。你无法直接访问属性，在Ruby中，都是通过方法调用实现的。在方法调用中使用（），是一种可选的策略。这里用private等等限制访问的关键字，来替代Python中的名字隐藏。“mixin’s”用来替代多继承。你可以在任何时候修改已有的Class，并添加新的方法。用true和false来替代True和False (用nil来替代None)。在判断真值的时候,只有false和nil会被认为是假.其他所有的都认为是真(包括0, 0.0, “”,和[])。用elsif替代elif.用require替代import. 但是用法是相同的。用usual-style来注释文档(替代docstrings) 同时用来生成文档。</p>\n<h1>八、从三个方面来进行Python和Ruby的比较:</h1>\n<p>1.各自所适用于什么应用</p>\n<p>2.开发环境、运行环境</p>\n<p>3.可移植性如何，因为项目最后计划移植到手机平台，如windows CE Symbina</p>\n<h2>【1.各自所适用于的应用场合】</h2>\n<p>查阅的结果似乎对于这两种语言的评价都很好，在网络开发上的性能都很好。都很适用于快速的应用程序开发，开发的效率很高。</p>\n<p><strong>Python：</strong></p>\n<p>摘取了跟项目有关的一些应用方面的叙述</p>\n<p><strong>跨平台开发：</strong></p>\n<p>Python 以中立方式支持不同的一系列平台，如果用户使用的系统包含不同的平台，使用 Python 开发应用程序则再好不过;它这种适应性也可以为系统预留使用其它工具的可能。对于频繁更换平台用户，Python 是个理想的选择。</p>\n<p>为最终用户提供软件服务时，Python 也是个备选方案，可以避免同时用不同应用软件编程的时间和费用。</p>\n<p><strong>互联网程序设计：</strong></p>\n<p>Python 带有的标准模块可以对网络插槽进行初级和协议级别的通讯，比如，如果要从 POP 服务器上读取电子邮件，Python 随带的库模块可以做到。另外， Python 还支持 XML、HTML和 CGI 库文件，所以利用它可以解析用户输入的需求，并通过网络服务器产生最佳质量的成果。</p>\n<p>程序员还可为拥有 Python 内置解释器的 Apache、Unix 和 Windows 网络服务器编译模块。基于 CGI 程序的功效，可以很方便地执行 Python 语句而不用单独装载。</p>\n<p>针对于python的网络编程，有一本很好的书：《python网络编程基础》</p>\n<p>这本书全面介绍了使用Python语言进行网络编程的基础知识，主要内容包括网络基础知识、高级网络操作、Web Services、解析HTML和XHTML、XML、E-mail服务、FTP、使用Python操作数据库、SSL、几种服务器端框架（包括Socket服务器、SimpleXMLRPCServer、CGI和mod_python），以及多任务处理（包括Forking、线程和异步通信）等。本书实用性强，共提供了大约175个实例，6600行以上的代码，是帮助读者全面而快速地学习Python语言、编写网络程序的最佳实践。</p>\n<p><strong>Ruby：</strong></p>\n<p>功能强大，面向对象的脚本语言，可以使您方便快捷地进行面向对象编程，有时使用像Smalltalk、Eiffel或C++这样正式的面向对象语言来开发一些小项目显得有点”小题大做”,而Ruby刚好可以满足这些面向对象编程的需求.当然了,您也可以使用Ruby进行普通的面向过程编程。</p>\n<p>Ruby支持很多网络协议，不管是高层的还是底层的。ruby提供了一些基本类，让你可以使用TCP,UDP,SOCKS等很多协议交互，而不必拘泥在网络层。这些类也提供了辅助类，让你可以轻松的对服务器进行读写。进行网络编程也是很不错。</p>\n<h2>【2.开发环境、运行环境】</h2>\n<p>Python：相比之下，就是没有一个很强的集成开发环境。有人说开源软件相对于收费的那种软件好用一些。</p>\n<p>用得较多的几个：</p>\n<p>Python自带的idle:不是python的IDE中最好的……</p>\n<p>PythonWin ：使用起来非常得心应手（就像使用 Windows 那样舒服）。它有个好用的编辑器，包括代码合并、语法标签高亮显示以及代码自动完成特性。PythonWin 和有些 IDE 一样，不包含任何类型的表单设计器；但它提供一个优秀的调试器，具有监视、代码检查、交互调试窗口、断点、和其他调试器该有的功能。最重要的是，PythonWin 很稳定，尽管有时候在 Win95r2 系统上使用时会奇怪地“停止响应”。界面上来说，PythonWin 比较简单，但非常吸引人，很好的运用了可嵌入和可对接的元素（我有点偏爱 Idle 风格的 “many windows everywhere”，它也为其他许多 IDE 所采用的）。PythonWin 还集成了 ActiveState 的 HtmlHelp 版本的 Python 说明文档和 PythonCOM。</p>\n<p>eclipse的pydev插件，eclipse+pydev</p>\n<p>Pydev 基于Eclipse的,非常棒的Python环境,改进速度非常快。提供的一些功能</p>\n<p>UliPad ：</p>\n<p>一个编辑器，你可以用它来进行你的文档写作，编程开发。它使用 Python 编程语言开发，用户界面基于 wxPython 。它除了想要完成一般编辑器的常用功能之外，最主要是想实现一种方便、灵活的框架，开发者可以方便地开发新的功能。而且有编程经验的用户还可以针对日常工作中的特别问题编制处理的插件，从而使之与自已的日常工作紧密结合起来。由于使用的是 Python 这种功能强大的编程语言，你可以方便地对本软件进行修改，从而满足自已的需要。</p>\n<p>UliPad 支持代码着色、<a href=\"http://lib.csdn.net/base/aiplanning\">智能</a>补全、代码调试、Python类浏览、代码片段、Ftp功能、目录浏览等等强大功能，其 Doc 目录下的文档更是非常丰富，是你编写 Python 的绝世好帮手！</p>\n<p>系统要求：</p>\n<p>python 2.4+</p>\n<p>wxPython 2.6+</p>\n<p>我们最后选择的是UliPad，还是挺棒的。</p>\n<p>Ruby：</p>\n<p>Ruby有极好的高级调试器。</p>\n<p>可以用netbeans的ruby插件或eclipse的ruby插件</p>\n<p>Eclipse下安装开发环境的大致过程：</p>\n<p>1. 安装 Ruby 1.8.6 One-Click Installer。</p>\n<p>2. 将 Eclipse Platform Runtime Binary 压缩包解压到某个目录。</p>\n<p>3. 将 Ruby Development Tools 压缩包的内容解压缩到 Eclipse 相应目录下。</p>\n<p>运行环境在其官方网站上下载相应的版本再安装即可，windows下面的安装较为简单，双击运行即可安装。</p>\n<h2>【3.可移植性】</h2>\n<p><strong>Python:</strong></p>\n<p>由于它的开源本质，Python已经被移植在许多平台上（经过改动使它能够工作在不同平台上）。如果你小心地避免使用依赖于系统的特性，那么你的所有Python程序无需修改就可以在下述任何平台上面运行。这些平台包括Linux、Windows、FreeBSD、Macintosh、Solaris、OS/2、Amiga、AROS、AS/400、BeOS、OS/390、z/OS、Palm OS、QNX、VMS、Psion、Acom RISC OS、VxWorks、PlayStation、Sharp Zaurus、Windows CE甚至还有PocketPC！</p>\n<p>Python在执行时，首先会将.py文件中的源代码编译成Python的byte code（字节码），然后再由Python Virtual Machine来执行这些编译好的byte code。这种机制的基本思想跟Java，.NET是一致的。然而，Python Virtual Machine与Java或.NET的Virtual Machine不同的是，Python的Virtual Machine是一种更高级的Virtual Machine。这里的高级并不是通常意义上的高级，不是说Python的Virtual Machine比Java或.NET的功能更强大，而是说和Java 或.NET相比，Python的Virtual Machine距离真实机器的距离更远。或者可以这么说，Python的Virtual Machine是一种抽象层次更高的Virtual Machine。</p>\n<p>可以安装一种面向对象的解释性的计算机程序设计语言，也是一种功能强大而完善的通用型语言，已经具有十多年的发展历史，成熟且稳定。Python 具有脚本语言中最丰富和强大的类库，足以支持绝大多数日常应用.在Symbina智能手机上支持C++和JAVA开发的两类程序，装上Python后，也就可以支持众多以Python开发的各种程序了。对于普通的手机用户，我们不用了解太多，只是安上Python这个平台就可以了，可以让我们的手机支持更多以Python开发的程序。目前在Symbian手机上已经有相当多的Python开发的程序，也都是比较实用的。</p>\n<p><strong>Ruby:</strong></p>\n<p>它大部分是在Linux上开发的，但是可以在很多类型的Unix, Dos, Windows95/98/Me/NT/2000/XP, MacOS, BeOS, OS/2等系统上运行。</p>\n<p>关于ruby跟手机开发的资料很少，有在windows CE上运行的版本，但是好像现在相关的资料还特别少，而且安装失败、编译不通过的例子偏多。日文页面上有少量的日文介绍。</p>\n<h2>【总结】</h2>\n<p>然后针对于Python跟Ruby在朋友的建议下还给出了如下一些参考意见，在此感谢他：</p>\n<p>1.  Python也被称为是一门清晰的语言。因为它的作者在设计它的时候，总的指导思想是，对于一个特定的问题，只要有一种最好的方法来解决就好了。Python语言是一种清晰的语言的另一个意思是，它的作者有意的设计限制性很强的语法，使得不好的编程习惯（例如if语句的下一行不向右缩进）都不能通过编译。这样有意的强制程序员养成良好的编程习惯。Python在其他部分的设计上也坚持了清晰划一的风格，这使得Python称为一门易读性、易维护性好，并且被大量用户所欢迎的、用途广泛的语言。</p>\n<p>同一个问题用Python几个人分别写写出来的代码会很相近。但Ruby则设计思想不一样，用它写出来的程序太过于灵活，不同的人写出来可能相差会很大。</p>\n<p>２.  Ruby英文文档极度缺乏，中文文档就更不用说。Python社区相对成熟，也有一大堆的资料。</p>\n<p>最后给出Python的几个网站</p>\n<ul>\n<li><a href=\"http://www.python.org/\">http://www.python.org/</a>– Python 的官方网站</li>\n<li><a href=\"http://python.cn/\">http://python.cn/</a>– Python 中文社区</li>\n<li><a href=\"http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython\">http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython</a>Python For Dot Net 的网站</li>\n</ul>\n<p>Ruby的几个网站</p>\n<ul>\n<li><a href=\"http://www.ruby-lang.org/zh_CN\">www.ruby-lang.org/zh_CN</a>Ruby中文官方网站</li>\n<li><a href=\"http://www.rubystudy.com/bbs/tag.php?name=Ruby\">http://www.rubystudy.com/bbs/tag.php?name=Ruby</a>Ruby中文学习交流社区</li>\n<li><a href=\"http://ruby-lang.guo.cc/\">http://ruby-lang.guo.cc/</a>Ruby在线参考手册</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88577\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88577votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88577\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "观点与动态,异同", "url_object_id": "66d1fcfa6dbdedd50398def4632bcdf4", "praise_nums": "1", "url": "http://python.jobbole.com/88577/", "title": "Python 和 Ruby 的对比", "create_date": "2017/09/10", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jeffknupp.com/blog/2012/03/31/pythons-hardest-problem/\">Jeff Knupp</a>   译文出处：<a target=\"_blank\" href=\"http://www.oschina.net/translate/pythons-hardest-problem\">开源中国</a>   </div><p><em>超过十年以上，没有比解释器全局锁（GIL）让Python新手和专家更有挫折感或者更有好奇心。</em></p>\n<h1>未解决的问题</h1>\n<p>随处都是问题。难度大、耗时多肯定是其中一个问题。仅仅是尝试解决这个问题就会让人惊讶。之前是整个社区的尝试，但现在只是外围的开发人员在努力。对于新手，去尝试解决这样的问题，主要是因为问题难度足够大，解决之后可以获得相当的荣誉。计算机科学中未解决的 P = NP 就是这样的问题。对此如果能给出多项式时间复杂度的答案，那简直就可以改变世界了。Python最困难的问题比证明P = NP要容易一些，不过迄今仍然没有一个满意的解决，要知道，这个问题的实用的解决方案同样能起着变革性的作用。正因为如此，很容易看到Python社区会有如此多的人关注于这样的问题: “对于解释器全局锁能做什么?”</p>\n<h1>Python的底层</h1>\n<p>要理解GIL的含义，我们需要从Python的基础讲起。像C++这样的语言是编译型语言，所谓编译型语言，是指程序输入到编译器，编译器再根据语言的语法进行解析，然后翻译成语言独立的中间表示，最终链接成具有高度优化的机器码的可执行程序。编译器之所以可以深层次的对代码进行优化，是因为它可以看到整个程序（或者一大块独立的部分）。这使得它可以对不同的语言指令之间的交互进行推理，从而给出更有效的优化手段。</p>\n<p>与此相反，Python是解释型语言。程序被输入到解释器来运行。解释器在程序执行之前对其并不了解；它所知道的只是Python的规则，以及在执行过程中怎样去动态的应用这些规则。它也有一些优化，但是这基本上只是另一个级别的优化。由于解释器没法很好的对程序进行推导，Python的大部分优化其实是解释器自身的优化。更快的解释器自然意味着程序的运行也能“免费”的更快。也就是说，解释器优化后，Python程序不用做修改就可以享受优化后的好处。</p>\n<p>这一点很重要，让我们再强调一下。如果其他条件不变，Python程序的执行速度直接与解释器的“速度”相关。不管你怎样优化自己的程序，你的程序的执行速度还是依赖于解释器执行你的程序的效率。这就很明显的解释了为什么我们需要对优化Python解释器做这么多的工作了。对于Python程序员来说，这恐怕是与免费午餐最接近的了。</p>\n<h1>免费午餐结束了</h1>\n<p>还是没有结束？摩尔定律给出了硬件速度会按照确定的时间周期增长，与此同时，整整一代程序员学会了如何编码。如果一个人写了比较慢的代码，最简单的结果通常是更快的处理器去等待代码的执行。显然，摩尔定律仍然是正确的，并且还会在很长一段时间生效，不过它提及的方式有了根本的变化。并非是时钟频率增长到一个高不可攀的速度，而是通过多核来利用晶体管密度提高带来的好处。在新处理器上运行的程序要想充分利用其性能，必须按照并发方式进行重写。</p>\n<p>大部分开发者听到“并发”通常会立刻想到多线程的程序。目前来说，多线程执行还是利用多核系统最常用的方式。尽管多线程编程大大好于“顺序”编程，不过即便是仔细的程序员也没法在代码中将并发性做到最好。编程语言在这方面应该做的更好，大部分应用广泛的现代编程语言都会支持多线程编程。</p>\n<h1>意外的事实</h1>\n<p>现在我们来看一下问题的症结所在。要想利用多核系统，Python必须支持多线程运行。作为解释型语言，Python的解释器必须做到既安全又高效。我们都知道多线程编程会遇到的问题。解释器要留意的是避免在不同的线程操作内部共享的数据。同时它还要保证在管理用户线程时保证总是有最大化的计算资源。</p>\n<p>那么，不同线程同时访问时，数据的保护机制是怎样的呢？答案是解释器全局锁。从名字上看能告诉我们很多东西，很显然，这是一个加在解释器上的全局（从解释器的角度看）锁（从互斥或者类似角度看）。这种方式当然很安全，但是它有一层隐含的意思（Python初学者需要了解这个）：对于任何Python程序，不管有多少的处理器，任何时候都总是只有一个线程在执行。</p>\n<p>许多人都是偶然发现这个事实的。网上的很多讨论组和留言板都充斥着来自Python初学者和专家的类似这样的问题——”为什么我全新的多线程Python程序运行得比其只有一个线程的时候还要慢？“许多人在问这个问题时还是非常犯晕的，因为显然一个具有两个线程的程序要比其只有一个线程时要快（假设该程序确实是可并行的）。事实上，这个问题被问得如此频繁以至于Python的专家们精心制作了一个标准答案：”不要使用多线程，请使用多进程。“但这个答案比那个问题更加让人困惑。难道我不能在Python中使用多线程？在Python这样流行的一个语言中使用多线程究竟是有多糟糕，连专家都建议不要使用。难道我真的漏掉了一些东西？</p>\n<p>很遗憾，没有任何东西被漏掉。由于Python解释器的设计，使用多线程以提高性能应该算是一个困难的任务。在最坏的情况下，它将会降低（有时很明显）你的程序的运行速度。一个计算机科学与技术专业的大学生新手可能会告诉你当多个线程都在竞争一个共享资源时将会发生什么。结果通常不会非常理想。很多情况下多线程都能很好地工作，可能对于解释器的实现和内核开发人员来说，没有关于Python多线程性能的过多抱怨。</p>\n<h1>现在该怎么办？惊慌？</h1>\n<p>那么，这又能怎样？问题解决了吗？难道我们作为Python开发人员就意味着要放弃使用多线程来探索并行的想法了？为什么无论怎样，GIL需要保证只有一个线程在某一时刻处于运行中？难道不可以添加细粒度的锁来阻止多个独立对象的同时访问？并且为什么之前没有人去尝试过类似的事情？</p>\n<p>这些实用的问题有着十分有趣的回答。GIL对诸如当前线程状态和为垃圾回收而用的堆分配对象这样的东西的访问提供着保护。然而，这对Python语言来说没什么特殊的，它<em>需要</em>使用一个GIL。这是该实现的一种典型产物。现在也有其它的Python解释器（和编译器）并不使用GIL。虽然，对于CPython来说，自其出现以来已经有很多不使用GIL的解释器。</p>\n<p>那么为什么不抛弃GIL呢？许多人也许不知道，在1999年，针对Python 1.5，一个经常被提到但却不怎么理解的“free threading”补丁已经尝试实现了这个想法，该补丁来自Greg Stein。在这个补丁中，GIL被完全的移除，且用细粒度的锁来代替。然而，GIL的移除给单线程程序的执行速度带来了一定的代价。当用单线程执行时，速度大约降低了40%。使用两个线程展示出了在速度上的提高，但除了这个提高，这个收益并没有随着核数的增加而线性增长。由于执行速度的降低，这一补丁被拒绝了，并且几乎被人遗忘。</p>\n<h1>移除GIL非常困难，让我们去购物吧！</h1>\n<p><em>（译者注：XXX is hard. Let’s go shopping!在英语中类似于中文的咆哮体。其隐含意思为想成功完成某件事情非常困难，我们去直接寻找第三方的产品替代吧。）</em></p>\n<p>不过，“free threading”这个补丁是有启发性意义的，其证明了一个关于Python解释器的基本要点：移除GIL是非常困难的。由于该补丁发布时所处的年代，解释器变得依赖更多的全局状态，这使得想要移除当今的GIL变得更加困难。值得一提的是，也正是因为这个原因，许多人对于尝试移除GIL变得更加有兴趣。困难的问题往往很有趣。</p>\n<p>但是这可能有点被误导了。让我们考虑一下：如果我们有了一个神奇的补丁，其移除了GIL，并且没有对单线程的Python代码产生性能上的下降，那么什么事情将会发生？我们将会获得我们一直想要的：一个线程API可能会同时利用所有的处理器。那么现在，我们已经获得了我们希望的，但这确实是一个好事吗？</p>\n<p>基于线程的编程毫无疑问是困难的。每当某个人觉得他了解关于线程是如何工作的一切的时候，总是会悄无声息的出现一些新的问题。因为在这方面想要得到正确合理的一致性真的是太难了，因此有一些非常知名的语言设计者和研究者已经总结得出了一些线程模型。就像某个写过多线程应用的人可以告诉你的一样，不管是多线程应用的开发还是调试都会比单线程的应用难上数倍。程序员通常所具有的顺序执行的思维模恰恰就是与并行执行模式不相匹配。GIL的出现无意中帮助了开发者免于陷入困境。在使用多线程时仍然需要同步原语的情况下，GIL事实上帮助我们保持不同线程之间的数据一致性问题。</p>\n<p>那么现在看起来讨论Python最难得问题是有点问错了问题。我们有非常好的理由来说明为什么Python专家推荐我们使用多进程代替多线程，而不是去试图隐藏Python线程实现的不足。更进一步，我们鼓励开发者使用更安全更直接的方式实现并发模型，同时保留使用多线程进行开发除非你觉的真的非常必要的话。对于大多数人来说什么是最好的并行编程模型可能并不是十分清楚。但是目前我们清楚的是多线程的方式可能并不是最好的。</p>\n<p>至于GIL，不要认为它在那的存在就是静态的和未经分析过的。Antoine Pitrou 在Python 3.2中实现了一个新的GIL，并且带着一些积极的结果。这是自1992年以来，GIL的一次最主要改变。这个改变非常巨大，很难在这里解释清楚，但是从一个更高层次的角度来说，旧的GIL通过对Python指令进行计数来确定何时放弃GIL。这样做的结果就是，单条Python指令将会包含大量的工作，即它们并没有被1:1的翻译成机器指令。在新的GIL实现中，用一个固定的超时时间来指示当前的线程以放弃这个锁。在当前线程保持这个锁，且当第二个线程请求这个锁的时候，当前线程就会在5ms后被强制释放掉这个锁（这就是说，当前线程每5ms就要检查其是否需要释放这个锁）。当任务是可行的时候，这会使得线程间的切换更加可预测。</p>\n<p>然而，这并不是一个完美的改变。对于在各种类型的任务上有效利用GIL这个领域里，最活跃的研究者可能就是David Beazley了。除了对Python 3.2之前的GIL研究最深入，他还研究了这个最新的GIL实现，并且发现了很多有趣的程序方案。对于这些程序，即使是新的GIL实现，其表现也相当糟糕。他目前仍然通过一些实际的研究和发布一些实验结果来引领并推进着有关GIL的讨论。</p>\n<p>不管某一个人对Python的GIL感觉如何，它仍然是Python语言里最困难的技术挑战。想要理解它的实现需要对操作系统设计、多线程编程、C语言、解释器设计和CPython解释器的实现有着非常彻底的理解。单是这些所需准备的就妨碍了很多开发者去更彻底的研究GIL。虽然如此，并没有迹象表明GIL在不久以后的任何一段时间内会远离我们。目前，它将继续给那些新接触Python，并且与此同时又对解决非常困难的技术问题感兴趣的人带来困惑和惊喜。</p>\n<p><em>以上内容是基于我目前对Python解释器所做出的研究而写。虽然我还希望写一些有关解释器的其它方面内容，但是没有任何一个比全局解释器锁（GIL）更为人所知。虽然我认为这里有些内容是不准确的，但是这些技术上的细节与CPython的很多资源条目是不同的。如果你发现了不准确的内容，请及时告知我，这样我就会尽快对其进行改正。</em></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88594\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88594votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88594\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "观点与动态,GIL", "url_object_id": "3a3e12fb284c50eca283c272707ff526", "praise_nums": "2", "url": "http://python.jobbole.com/88594/", "title": "Python 最难的问题", "create_date": "2017/09/13", "comment_nums": 0}
{"fav_nums": 4, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/Python%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE%E4%B8%8E%E6%8F%8F%E8%BF%B0%E7%AC%A6/\">Learn Python</a>   </div><p>在Python中，对于一个对象的属性访问，我们一般采用的是点(.)属性运算符进行操作。例如，有一个类实例对象<strong>foo</strong>，它有一个<strong>name</strong>属性，那便可以使用<strong>foo.name</strong>对此属性进行访问。一般而言，点(.)属性运算符比较直观，也是我们经常碰到的一种属性访问方式。然而，在点(.)属性运算符的背后却是别有洞天，值得我们对对象的属性访问进行探讨。</p>\n<p>在进行对象属性访问的分析之前，我们需要先了解一下对象怎么表示其属性。为了便于说明，本文以新式类为例。有关新式类和旧式类的区别，大家可以查看Python官方文档。</p>\n<h1 id=\"对象的属性\">对象的属性</h1>\n<p>Python中，“一切皆对象”。我们可以给对象设置各种属性。先来看一个简单的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bd9242929537\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Animal(object):\r\n    run = True\r\nclass Dog(Animal):\r\n    fly = False\r\n    def __init__(self, age):\r\n        self.age = age\r\n    def sound(self):\r\n        return \"wang wang~\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bd9242929537-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bd9242929537-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bd9242929537-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bd9242929537-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bd9242929537-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bd9242929537-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bd9242929537-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bd9242929537-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bd9242929537-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bd9242929537-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bd9242929537-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Animal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bd9242929537-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fly</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bd9242929537-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bd9242929537-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bd9242929537-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sound</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bd9242929537-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wang wang~\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面的例子中，我们定义了两个类。类<strong>Animal</strong>定义了一个属性<strong>run</strong>；类<strong>Dog</strong>继承自<strong>Animal</strong>，定义了一个属性<strong>fly</strong>和两个函数。接下来，我们实例化一个对象。对象的属性可以从特殊属性<strong>__dict__</strong>中查看。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631be5192100453\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 实例化一个对象dog\r\n&gt;&gt;&gt; dog = Dog(1)\r\n# 查看dog对象的属性\r\n&gt;&gt;&gt; dog.__dict__\r\n{'age': 1}\r\n# 查看类Dog的属性\r\n&gt;&gt;&gt; Dog.__dict__\r\ndict_proxy({'__doc__': None,\r\n            '__init__': &lt;function __main__.__init__&gt;,\r\n            '__module__': '__main__',\r\n            'fly': False,\r\n            'sound': &lt;function __main__.sound&gt;})\r\n# 查看类Animal的属性\r\n&gt;&gt;&gt; Animal.__dict__\r\ndict_proxy({'__dict__': &lt;attribute '__dict__' of 'Animal' objects&gt;,\r\n            '__doc__': None,\r\n            '__module__': '__main__',\r\n            '__weakref__': &lt;attribute '__weakref__' of 'Animal' objects&gt;,\r\n            'run': True})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631be5192100453-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631be5192100453-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-1\"><span class=\"crayon-c\"># 实例化一个对象dog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-3\"><span class=\"crayon-c\"># 查看dog对象的属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-5\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-6\"><span class=\"crayon-c\"># 查看类Dog的属性</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-8\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__init__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'fly'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'sound'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sound</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-13\"><span class=\"crayon-c\"># 查看类Animal的属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-14\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Animal</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-15\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Animal'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631be5192100453-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Animal'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631be5192100453-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'run'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>由上面的例子可以看出：属性在哪个对象上定义，便会出现在哪个对象的<strong>__dict__</strong>中。例如：</p>\n<ul>\n<li>类<strong>Animal</strong>定义了一个属性<strong>run</strong>，那这个<strong>run</strong>属性便只会出现在类<strong>Animal</strong>的<strong>__dict__</strong>中，而不会出现在其子类中。</li>\n<li>类<strong>Dog</strong>定义了一个属性<strong>fly</strong>和两个函数，那这些属性和方法便会出现在类<strong>Dog</strong>的<strong>__dict__</strong>中，同时它们也不会出现在实例的<strong>__dict__</strong>中。</li>\n<li>实例对象<strong>dog</strong>的<strong>__dict__</strong>中只出现了一个属性<strong>age</strong>，这是在初始化实例对象的时候添加的，它没有父类的属性和方法。</li>\n<li>由此可知：Python中对象的属性具有 <strong>“层次性”</strong>，属性在哪个对象上定义，便会出现在哪个对象的<strong>__dict__</strong>中。</li>\n</ul>\n<p>在这里我们首先了解的是属性值会存储在对象的<strong>__dict__</strong>中，查找也会在对象的<strong>__dict__</strong>中进行查找的。至于Python对象进行属性访问时，会按照怎样的规则来查找属性值呢？这个问题在后文中进行讨论。</p>\n<h1 id=\"对象属性访问与特殊方法-getattribute\">对象属性访问与特殊方法<strong>__getattribute__</strong></h1>\n<p>正如前面所述，Python的属性访问方式很直观，使用点属性运算符。在新式类中，对对象属性的访问，都会调用特殊方法<strong>__getattribute__</strong>。<strong>__getattribute__</strong>允许我们在访问对象属性时自定义访问行为，但是使用它特别要小心无限递归的问题。</p>\n<p>还是以上面的情景为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bea842182045\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Animal(object):\r\n    run = True\r\nclass Dog(Animal):\r\n    fly = False\r\n    def __init__(self, age):\r\n        self.age = age\r\n    # 重写__getattribute__。需要注意的是重写的方法中不能\r\n    # 使用对象的点运算符访问属性，否则使用点运算符访问属性时，\r\n    # 会再次调用__getattribute__。这样就会陷入无限递归。\r\n    # 可以使用super()方法避免这个问题。\r\n    def __getattribute__(self, key):\r\n        print  \"calling __getattribute__\\n\"\r\n        return super(Dog, self).__getattribute__(key)\r\n    def sound(self):\r\n        return \"wang wang~\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bea842182045-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bea842182045-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Animal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fly</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 重写__getattribute__。需要注意的是重写的方法中不能</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 使用对象的点运算符访问属性，否则使用点运算符访问属性时，</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 会再次调用__getattribute__。这样就会陷入无限递归。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 可以使用super()方法避免这个问题。</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__getattribute__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"calling __getattribute__\\n\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__getattribute__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bea842182045-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sound</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bea842182045-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wang wang~\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>上面的例子中我们重写了<strong>__getattribute__</strong>方法。注意我们使用了<strong>super()</strong>方法来避免无限循环问题。下面我们实例化一个对象来说明访问对象属性时<strong>__getattribute__</strong>的特性。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bee781128263\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 实例化对象dog\r\n&gt;&gt;&gt; dog = Dog(1)\r\n# 访问dog对象的age属性\r\n&gt;&gt;&gt; dog.age\r\ncalling __getattribute__\r\n1\r\n# 访问dog对象的fly属性\r\n&gt;&gt;&gt; dog.fly\r\ncalling __getattribute__\r\nFalse\r\n# 访问dog对象的run属性\r\n&gt;&gt;&gt; dog.run\r\ncalling __getattribute__\r\nTrue\r\n# 访问dog对象的sound方法\r\n&gt;&gt;&gt; dog.sound\r\ncalling __getattribute__\r\n&lt;bound method Dog.sound of &lt;__main__.Dog object at 0x0000000005A90668&gt;&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bee781128263-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bee781128263-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-1\"><span class=\"crayon-c\"># 实例化对象dog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-3\"><span class=\"crayon-c\"># 访问dog对象的age属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-5\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__getattribute_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-6\"><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-7\"><span class=\"crayon-c\"># 访问dog对象的fly属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fly</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-9\"><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">__getattribute__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-10\"><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-11\"><span class=\"crayon-c\"># 访问dog对象的run属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-13\"><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">__getattribute__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-14\"><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-15\"><span class=\"crayon-c\"># 访问dog对象的sound方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sound</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bee781128263-17\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__getattribute__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bee781128263-18\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">bound </span><span class=\"crayon-e\">method </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sound </span><span class=\"crayon-v\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Dog </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000005A90668</span><span class=\"crayon-o\">&gt;&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>由上面的验证可知，<strong><strong>__getattribute__</strong>是实例对象查找属性或方法的入口</strong>。实例对象访问属性或方法时都需要调用到<strong>__getattribute__</strong>，之后才会根据一定的规则在各个<strong>__dict__</strong>中查找相应的属性值或方法对象，若没有找到则会调用<strong>__getattr__</strong>（后面会介绍到）。<strong>__getattribute__</strong>是Python中的一个内置方法，关于其底层实现可以查看相关官方文档，后面将要介绍的属性访问规则就是依赖于<strong>__getattribute__</strong>的。</p>\n<h1 id=\"对象属性控制\">对象属性控制</h1>\n<p>在继续介绍后面相关内容之前，让我们先来了解一下Python中和对象属性控制相关的相关方法。</p>\n<ul>\n<li><strong>__getattr__(self, name)</strong><strong>__getattr__</strong>可以用来在当用户试图访问一个根本不存在（或者暂时不存在）的属性时，来定义类的行为。前面讲到过，当<strong>__getattribute__</strong>方法找不到属性时，最终会调用<strong>__getattr__</strong>方法。它可以用于捕捉错误的以及灵活地处理AttributeError。只有当试图访问不存在的属性时它才会被调用。</li>\n<li><strong>__setattr__(self, name, value)</strong><strong>__setattr__</strong>方法允许你自定义某个属性的赋值行为，不管这个属性存在与否，都可以对任意属性的任何变化都定义自己的规则。关于<strong>__setattr__</strong>有两点需要说明：第一，使用它时必须小心，不能写成类似<strong>self.name = “Tom”</strong>这样的形式，因为这样的赋值语句会调用<strong>__setattr__</strong>方法，这样会让其陷入无限递归；第二，你必须区分 <strong>对象属性</strong> 和 <strong>类属性</strong> 这两个概念。后面的例子中会对此进行解释。</li>\n<li><strong>__delattr__(self, name)</strong><strong>__delattr__</strong>用于处理删除属性时的行为。和<strong>__setattr__</strong>方法要注意无限递归的问题，重写该方法时不要有类似<strong>del self.name</strong>的写法。</li>\n</ul>\n<p>还是以上面的例子进行说明，不过在这里我们要重写三个属性控制方法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bf3545681400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Animal(object):\r\n    run = True\r\nclass Dog(Animal):\r\n    fly = False\r\n    def __init__(self, age):\r\n        self.age = age\r\n    def __getattr__(self, name):\r\n        print \"calling __getattr__\\n\"\r\n        if name == 'adult':\r\n            return True if self.age &gt;= 2 else False\r\n        else:\r\n            raise AttributeError\r\n    def __setattr__(self, name, value):\r\n        print \"calling __setattr__\"\r\n        super(Dog, self).__setattr__(name, value)\r\n    def __delattr__(self, name):\r\n        print \"calling __delattr__\"\r\n        super(Dog, self).__delattr__(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf3545681400-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf3545681400-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Animal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">run</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Animal</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">fly</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"calling __getattr__\\n\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'adult'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">AttributeError</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__setattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"calling __setattr__\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__setattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__delattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf3545681400-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"calling __delattr__\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf3545681400-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__delattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>以下进行验证。首先是<strong>__getattr__</strong>:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bf6616719867\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 创建实例对象dog\r\n&gt;&gt;&gt; dog = Dog(1)\r\ncalling __setattr__\r\n# 检查一下dog和Dog的__dict__\r\n&gt;&gt;&gt; dog.__dict__\r\n{'age': 1}\r\n&gt;&gt;&gt; Dog.__dict__\r\ndict_proxy({'__delattr__': &lt;function __main__.__delattr__&gt;,\r\n            '__doc__': None,\r\n            '__getattr__': &lt;function __main__.__getattr__&gt;,\r\n            '__init__': &lt;function __main__.__init__&gt;,\r\n            '__module__': '__main__',\r\n            '__setattr__': &lt;function __main__.__setattr__&gt;,\r\n            'fly': False})\r\n# 获取dog的age属性\r\n&gt;&gt;&gt; dog.age\r\n1\r\n# 获取dog的adult属性。\r\n# 由于__getattribute__没有找到相应的属性，所以调用__getattr__。\r\n&gt;&gt;&gt; dog.adult\r\ncalling __getattr__\r\nFalse\r\n# 调用一个不存在的属性name，__getattr__捕获AttributeError错误\r\n&gt;&gt;&gt; dog.name\r\ncalling __getattr__\r\nTraceback (most recent call last):\r\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\r\n  File \"&lt;stdin&gt;\", line 10, in __getattr__\r\nAttributeError</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bf6616719867-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bf6616719867-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-1\"><span class=\"crayon-c\"># 创建实例对象dog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-3\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__setattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-4\"><span class=\"crayon-c\"># 检查一下dog和Dog的__dict__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-8\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__delattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__delattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__getattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__getattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__init__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__setattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__setattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'fly'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-15\"><span class=\"crayon-c\"># 获取dog的age属性</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-17\"><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-18\"><span class=\"crayon-c\"># 获取dog的adult属性。</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-19\"><span class=\"crayon-c\"># 由于__getattribute__没有找到相应的属性，所以调用__getattr__。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-20\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">adult</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-21\"><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">__getattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-22\"><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-23\"><span class=\"crayon-c\"># 调用一个不存在的属性name，__getattr__捕获AttributeError错误</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-24\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-25\"><span class=\"crayon-e\">calling </span><span class=\"crayon-e\">__getattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-26\"><span class=\"crayon-k \">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-27\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bf6616719867-28\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__getattr__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bf6616719867-29\"><span class=\"crayon-k \">AttributeError</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>可以看到，属性访问时，当访问一个不存在的属性时触发<strong>__getattr__</strong>，它会对访问行为进行控制。接下来是<strong>__setattr__</strong>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bfa541396891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 给dog.age赋值，会调用__setattr__方法\r\n&gt;&gt;&gt; dog.age = 2\r\ncalling __setattr__\r\n&gt;&gt;&gt; dog.age\r\n2\r\n# 先调用dog.fly时会返回False，这时因为Dog类属性中有fly属性；\r\n# 之后再给dog.fly赋值，触发__setattr__方法。\r\n&gt;&gt;&gt; dog.fly\r\nFalse\r\n&gt;&gt;&gt; dog.fly = True\r\ncalling __setattr__\r\n# 再次查看dog.fly的值以及dog和Dog的__dict__;\r\n# 可以看出对dog对象进行赋值，会在dog对象的__dict__中添加了一条对象属性；\r\n# 然而，Dog类属性没有发生变化\r\n# 注意：dog对象和Dog类中都有fly属性，访问时会选择哪个呢？\r\n&gt;&gt;&gt; dog.fly\r\nTrue\r\n&gt;&gt;&gt; dog.__dict__\r\n{'age': 2, 'fly': True}\r\n&gt;&gt;&gt; Dog.__dict__\r\ndict_proxy({'__delattr__': &lt;function __main__.__delattr__&gt;,\r\n            '__doc__': None,\r\n            '__getattr__': &lt;function __main__.__getattr__&gt;,\r\n            '__init__': &lt;function __main__.__init__&gt;,\r\n            '__module__': '__main__',\r\n            '__setattr__': &lt;function __main__.__setattr__&gt;,\r\n            'fly': False})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfa541396891-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfa541396891-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-1\"><span class=\"crayon-c\"># 给dog.age赋值，会调用__setattr__方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-3\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__setattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">age</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-5\"><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-6\"><span class=\"crayon-c\"># 先调用dog.fly时会返回False，这时因为Dog类属性中有fly属性；</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-7\"><span class=\"crayon-c\"># 之后再给dog.fly赋值，触发__setattr__方法。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fly</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-9\"><span class=\"crayon-t\">False</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fly</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-11\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__setattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-12\"><span class=\"crayon-c\"># 再次查看dog.fly的值以及dog和Dog的__dict__;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-13\"><span class=\"crayon-c\"># 可以看出对dog对象进行赋值，会在dog对象的__dict__中添加了一条对象属性；</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-14\"><span class=\"crayon-c\"># 然而，Dog类属性没有发生变化</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-15\"><span class=\"crayon-c\"># 注意：dog对象和Dog类中都有fly属性，访问时会选择哪个呢？</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fly</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-17\"><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-18\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-19\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'fly'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-20\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-21\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__delattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__delattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__getattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__getattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__init__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfa541396891-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__setattr__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__setattr__</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfa541396891-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'fly'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>实例对象的<strong>__setattr__</strong>方法可以定义属性的赋值行为，不管属性是否存在。当属性存在时，它会改变其值；当属性不存在时，它会添加一个对象属性信息到对象的<strong>__dict__</strong>中，然而这并不改变类的属性。从上面的例子可以看出来。</p>\n<p>最后，看一下<strong>__delattr__</strong>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631bfe600291380\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 由于上面的例子中我们为dog设置了fly属性，现在删除它触发__delattr__方法\r\n&gt;&gt;&gt; del dog.fly\r\ncalling __delattr__\r\n# 再次查看dog对象的__dict__，发现和fly属性相关的信息被删除\r\n&gt;&gt;&gt; dog.__dict__\r\n{'age': 2}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfe600291380-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfe600291380-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfe600291380-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfe600291380-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631bfe600291380-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631bfe600291380-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631bfe600291380-1\"><span class=\"crayon-c\"># 由于上面的例子中我们为dog设置了fly属性，现在删除它触发__delattr__方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfe600291380-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">del</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fly</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfe600291380-3\"><span class=\"crayon-e\">calling </span><span class=\"crayon-v\">__delattr__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfe600291380-4\"><span class=\"crayon-c\"># 再次查看dog对象的__dict__，发现和fly属性相关的信息被删除</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631bfe600291380-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631bfe600291380-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<figure></figure>\n<h1 id=\"描述符\">描述符</h1>\n<p>描述符是Python 2.2 版本中引进来的新概念。描述符一般用于实现对象系统的底层功能， 包括绑定和非绑定方法、类方法、静态方法特特性等。关于描述符的概念，官方并没有明确的定义，可以在网上查阅相关资料。这里我从自己的认识谈一些想法，如有不当之处还请包涵。</p>\n<p>在前面我们了解了对象属性访问和行为控制的一些特殊方法，例如<strong>__getattribute__</strong>、<strong>__getattr__</strong>、<strong>__setattr__</strong>、<strong>__delattr__</strong>。以我的理解来看，这些方法应当具有属性的”普适性”，可以用于属性查找、设置、删除的一般方法，也就是说所有的属性都可以使用这些方法实现属性的查找、设置、删除等操作。但是，这并不能很好地实现对某个具体属性的访问控制行为。例如，上例中假如要实现<strong>dog.age</strong>属性的类型设置（只能是整数），如果单单去修改<strong>__setattr__</strong>方法满足它，那这个方法便有可能不能支持其他的属性设置。</p>\n<p>在类中设置属性的控制行为不能很好地解决问题，Python给出的方案是：<strong>__getattribute__</strong>、<strong>__getattr__</strong>、<strong>__setattr__</strong>、<strong>__delattr__</strong>等方法用来实现属性查找、设置、删除的一般逻辑，而对属性的控制行为就由属性对象来控制。这里单独抽离出来一个属性对象，在属性对象中定义这个属性的查找、设置、删除行为。这个属性对象就是描述符。</p>\n<p>描述符对象一般是作为其他类对象的属性而存在。在其内部定义了三个方法用来实现属性对象的查找、设置、删除行为。这三个方法分别是：</p>\n<ul>\n<li><strong>get</strong>(self, instance, owner)：定义当试图取出描述符的值时的行为。</li>\n<li><strong>set</strong>(self, instance, value)：定义当描述符的值改变时的行为。</li>\n<li><strong>delete</strong>(self, instance)：定义当描述符的值被删除时的行为。</li>\n</ul>\n<p>其中：instance为把描述符对象作为属性的对象实例；<br>\nowner为instance的类对象。</p>\n<p>以下以官方的一个例子进行说明：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631c02469177179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass RevealAccess(object):\r\n    def __init__(self, initval=None, name='var'):\r\n        self.val = initval\r\n        self.name = name\r\n    def __get__(self, obj, objtype):\r\n        print 'Retrieving', self.name\r\n        return self.val\r\n    def __set__(self, obj, val):\r\n        print 'Updating', self.name\r\n        self.val = val\r\nclass MyClass(object):\r\n    x = RevealAccess(10, 'var \"x\"')\r\n    y = 5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c02469177179-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c02469177179-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RevealAccess</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">initval</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'var'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">initval</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-4\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__get__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objtype</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Retrieving'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__set__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">obj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Updating'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyClass</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c02469177179-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RevealAccess</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'var \"x\"'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c02469177179-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>以上定义了两个类。其中<strong>RevealAccess</strong>类的实例是作为<strong>MyClass</strong>类属性<strong>x</strong>的值存在的。而且<strong>RevealAccess</strong>类定义了<strong>__get__</strong>、<strong>__set__</strong>方法，它是一个描述符对象。注意，描述符对象的<strong>__get__</strong>、<strong>__set__</strong>方法中使用了诸如<strong>self.val</strong>和<strong>self.val = val</strong>等语句，这些语句会调用<strong>__getattribute__</strong>、<strong>__setattr__</strong>等方法，这也说明了<strong>__getattribute__</strong>、<strong>__setattr__</strong>等方法在控制访问对象属性上的一般性（一般性是指对于所有属性它们的控制行为一致），以及<strong>__get__</strong>、<strong>__set__</strong>等方法在控制访问对象属性上的特殊性（特殊性是指它针对某个特定属性可以定义不同的行为）。</p>\n<p>以下进行验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be631c06917372022\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 创建Myclass类的实例m\r\n&gt;&gt;&gt; m = MyClass()\r\n# 查看m和MyClass的__dict__\r\n&gt;&gt;&gt; m.__dict__\r\n{}\r\n&gt;&gt;&gt; MyClass.__dict__\r\ndict_proxy({'__dict__': &lt;attribute '__dict__' of 'MyClass' objects&gt;,\r\n            '__doc__': None,\r\n            '__module__': '__main__',\r\n            '__weakref__': &lt;attribute '__weakref__' of 'MyClass' objects&gt;,\r\n            'x': &lt;__main__.RevealAccess at 0x5130080&gt;,\r\n            'y': 5})\r\n# 访问m.x。会先触发__getattribute__方法\r\n# 由于x属性的值是一个描述符，会触发它的__get__方法\r\n&gt;&gt;&gt; m.x\r\nRetrieving var \"x\"\r\n10\r\n# 设置m.x的值。对描述符进行赋值，会触发它的__set__方法\r\n# 在__set__方法中还会触发__setattr__方法（self.val = val）\r\n&gt;&gt;&gt; m.x = 20\r\nUpdating var \"x\"\r\n# 再次访问m.x\r\n&gt;&gt;&gt; m.x\r\nRetrieving var \"x\"\r\n20\r\n# 查看m和MyClass的__dict__，发现这与对描述符赋值之前一样。\r\n# 这一点与一般属性的赋值不同，可参考上述的__setattr__方法。\r\n# 之所以前后没有发生变化，是因为变化体现在描述符对象上，\r\n# 而不是实例对象m和类MyClass上。\r\n&gt;&gt;&gt; m.__dict__\r\n{}\r\n&gt;&gt;&gt; MyClass.__dict__\r\ndict_proxy({'__dict__': &lt;attribute '__dict__' of 'MyClass' objects&gt;,\r\n            '__doc__': None,\r\n            '__module__': '__main__',\r\n            '__weakref__': &lt;attribute '__weakref__' of 'MyClass' objects&gt;,\r\n            'x': &lt;__main__.RevealAccess at 0x5130080&gt;,\r\n            'y': 5})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04be631c06917372022-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be631c06917372022-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-1\"><span class=\"crayon-c\"># 创建Myclass类的实例m</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyClass</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-3\"><span class=\"crayon-c\"># 查看m和MyClass的__dict__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-5\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MyClass</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-7\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'MyClass'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'MyClass'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'x'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RevealAccess </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x5130080</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'y'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-13\"><span class=\"crayon-c\"># 访问m.x。会先触发__getattribute__方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-14\"><span class=\"crayon-c\"># 由于x属性的值是一个描述符，会触发它的__get__方法</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-15\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-16\"><span class=\"crayon-e\">Retrieving </span><span class=\"crayon-i\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"x\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-17\"><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-18\"><span class=\"crayon-c\"># 设置m.x的值。对描述符进行赋值，会触发它的__set__方法</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-19\"><span class=\"crayon-c\"># 在__set__方法中还会触发__setattr__方法（self.val = val）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-20\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-21\"><span class=\"crayon-e\">Updating </span><span class=\"crayon-i\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"x\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-22\"><span class=\"crayon-c\"># 再次访问m.x</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-23\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-24\"><span class=\"crayon-e\">Retrieving </span><span class=\"crayon-i\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"x\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-25\"><span class=\"crayon-cn\">20</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-26\"><span class=\"crayon-c\"># 查看m和MyClass的__dict__，发现这与对描述符赋值之前一样。</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-27\"><span class=\"crayon-c\"># 这一点与一般属性的赋值不同，可参考上述的__setattr__方法。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-28\"><span class=\"crayon-c\"># 之所以前后没有发生变化，是因为变化体现在描述符对象上，</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-29\"><span class=\"crayon-c\"># 而不是实例对象m和类MyClass上。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-30\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__dict_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-31\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-32\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MyClass</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__dict__</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-33\"><span class=\"crayon-e\">dict_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__dict__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'MyClass'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__module__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">attribute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__weakref__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'MyClass'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be631c06917372022-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'x'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RevealAccess </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x5130080</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be631c06917372022-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'y'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>上面的例子对描述符进行了一定的解释，不过对描述符还需要更进一步的探讨和分析，这个工作先留待以后继续进行。</p>\n<p>最后，还需要注意一点：描述符有数据描述符和非数据描述符之分。</p>\n<ul>\n<li>只要至少实现<strong>__get__</strong>、<strong>__set__</strong>、<strong>__delete__</strong>方法中的一个就可以认为是描述符；</li>\n<li>只实现<strong>__get__</strong>方法的对象是非数据描述符，意味着在初始化之后它们只能被读取；</li>\n<li>同时实现<strong>__get__</strong>和<strong>__set__</strong>的对象是数据描述符，意味着这种属性是可读写的。</li>\n</ul>\n<h1 id=\"属性访问的优先规则\">属性访问的优先规则</h1>\n<p>在以上的讨论中，我们一直回避着一个问题，那就是属性访问时的优先规则。我们了解到，属性一般都在<strong>__dict__</strong>中存储，但是在访问属性时，在对象属性、类属型、基类属性中以怎样的规则来查询属性呢？以下对Python中属性访问的规则进行分析。</p>\n<p>由上述的分析可知，属性访问的入口点是<strong>__getattribute__</strong>方法。它的实现中定义了Python中属性访问的优先规则。Python官方文档中对<strong>__getattribute__</strong>的底层实现有相关的介绍，本文暂时只是讨论属性查找的规则，相关规则可见下图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/34d2ba968a4e32fc3b7db0400d4e6c63.png\"><img class=\"aligncenter size-full wp-image-88583\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/34d2ba968a4e32fc3b7db0400d4e6c63.png\" alt=\"Python属性查找\"></a></p>\n<p>上图是查找<strong>b.x</strong>这样一个属性的过程。在这里要对此图进行简单的介绍：</p>\n<ol>\n<li>查找属性的第一步是搜索基类列表，即<strong>type(b).__mro__</strong>，直到找到该属性的第一个定义，并将该属性的值赋值给<strong>descr</strong>；</li>\n<li>判断<strong>descr</strong>的类型。它的类型可分为数据描述符、非数据描述符、普通属性、未找到等类型。若<strong>descr</strong>为数据描述符，则调用<strong>desc.__get__(b, type(b))</strong>，并将结果返回，结束执行。否则进行下一步；</li>\n<li>如果<strong>descr</strong>为非数据描述符、普通属性、未找到等类型，则查找实例b的实例属性，即<strong>b.__dict__</strong>。如果找到，则将结果返回，结束执行。否则进行下一步；</li>\n<li>如果在<strong>b.__dict__</strong>未找到相关属性，则重新回到<strong>descr</strong>值的判断上。\n<ul>\n<li>若<strong>descr</strong>为非数据描述符，则调用<strong>desc.__get__(b, type(b))</strong>，并将结果返回，结束执行；</li>\n<li>若<strong>descr</strong>为普通属性，直接返回结果并结束执行；</li>\n<li>若<strong>descr</strong>为空（未找到），则最终抛出 AttributeError 异常，结束查找。</li>\n</ul>\n</li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88582\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88582votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88582\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/34d2ba968a4e32fc3b7db0400d4e6c63.png"], "tags": "基础知识,描述符", "url_object_id": "a8dd852d504bba8cefe451aa4195072b", "praise_nums": "1", "url": "http://python.jobbole.com/88582/", "title": "Python 中的属性访问与描述符", "create_date": "2017/09/10", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Python/Python%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E8%A7%84%E5%88%99%E5%92%8C%E9%97%AD%E5%8C%85%E7%AE%80%E6%9E%90/\">Learn Python</a>   </div><p>在对Python中的闭包进行简单分析之前，我们先了解一下Python中的作用域规则。关于Python中作用域的详细知识，有很多的博文都进行了介绍。这里我们先从一个简单的例子入手。</p>\n<h1 id=\"Python中的作用域\">Python中的作用域</h1>\n<p>假设在交互式命令行中定义如下的函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10b9363929926\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; a = 1\r\n&gt;&gt;&gt; def foo():\r\n        b = 2\r\n        c = 3\r\n        print \"locals: %s\" % locals()\r\n        return \"result: %d\" % (a + b +c)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10b9363929926-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10b9363929926-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10b9363929926-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10b9363929926-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10b9363929926-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10b9363929926-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10b9363929926-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10b9363929926-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10b9363929926-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10b9363929926-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10b9363929926-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"locals: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">locals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10b9363929926-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"result: %d\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>上述代码先给<strong>a</strong>赋值1，紧接着定义了一个函数：<strong>foo()</strong>。在函数<strong>foo()</strong>中我们定义了两个整数<strong>b</strong>和<strong>c</strong>，函数的返回值为<strong>a</strong>、<strong>b</strong>、<strong>c</strong>三个数的和。</p>\n<p>对上述函数进行验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10c4508285586\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# result\r\n&gt;&gt;&gt; foo()\r\nlocals: {'c': 3, 'b': 2}\r\nresult: 6</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10c4508285586-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10c4508285586-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10c4508285586-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10c4508285586-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10c4508285586-1\"><span class=\"crayon-c\"># result</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10c4508285586-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10c4508285586-3\"><span class=\"crayon-k \">locals</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'c'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10c4508285586-4\"><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>根据验证的结果，<strong>foo()</strong>函数的返回值为6。上述的函数定义中只有<strong>b</strong>和<strong>c</strong>两个变量的赋值，那调用函数是如何判断<strong>a</strong>的值呢？这涉及到函数的作用域规则。本文摘录《Python参考手册（第4版）》中的相关论述：</p>\n<blockquote><p>每次执行一个函数时， 就会创建心得局部命名空间。该命名空间代表一个局部环境，其中包含函数参数的名称和在函数体内赋值的变量名称。解析这些名称时：</p>\n<ul>\n<li>解释器将首先搜索局部命名空间；</li>\n<li>如果没有找到匹配的名称，它就会搜索全局命名空间（函数的全局命名空间始终是定义该函数的模块）；</li>\n<li>如果解释器在全局命名空间中也找不到匹配值，最终会检查内置命名空间；</li>\n<li>如果在内置命名空间中也找不到匹配值，就会引发NameError异常。</li>\n</ul>\n</blockquote>\n<p>对应于上面的例子，<strong>foo</strong>函数首先会在局部命名空间中找三个变量的匹配值。上述代码中的<strong>locals()</strong>方法给出了<strong>foo</strong>函数局部命名空间的内容。可以看出，局部命名空间是一个字典，包含<strong>b</strong>和<strong>c</strong>的值，这是因为我们在<strong>foo</strong>函数中定义了这两个变量。然而，局部命名空间中不包含<strong>a</strong>的值，所以就需要在全局命名空间中寻找。可以使用<strong>__globals__</strong>获取一个函数的局部命名空间。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10c8991957954\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# foo函数的全局命名空间\r\n&gt;&gt;&gt; foo.__globals__\r\n{'a': 1, '__builtins__': &lt;module '__builtin__' (built-in)&gt;, '__package__': None, '__name__': '__main__', 'foo': &lt;function foo at 0x0000000004613518&gt;, '__doc__': None}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10c8991957954-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10c8991957954-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10c8991957954-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10c8991957954-1\"><span class=\"crayon-c\"># foo函数的全局命名空间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10c8991957954-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__globals_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10c8991957954-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtins__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">module</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__builtin__'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-st\">in</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__package__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__name__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'foo'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">foo </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000004613518</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__doc__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<figure></figure>\n<p><strong>foo</strong>函数的全局命名空间中包含了内置函数模块、<strong>foo</strong>函数、变量<strong>a</strong>以及其他的一些参数。由于在<strong>foo</strong>函数的全局命名空间中找到了变量<strong>a</strong>，<strong>foo</strong>函数便返回三个变量的和。</p>\n<h1 id=\"闭包\">闭包</h1>\n<p>上述的Python作用域规则具有普遍性。然而，在Python中“一切皆对象”，函数也不例外。这也就是说可以把函数当作参数传递给其他的函数，也可以放在数据结构中，还可以作为函数的返回结果。在这种情况下，Python的作用域规则会发生什么变化呢？我们还是举一个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10cc979697016\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; def foo():\r\n        a = 1\r\n        def bar():\r\n            b = 2\r\n            c = 3\r\n            return a + b + c\r\n        return bar</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10cc979697016-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10cc979697016-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10cc979697016-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10cc979697016-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10cc979697016-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10cc979697016-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10cc979697016-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10cc979697016-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10cc979697016-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10cc979697016-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10cc979697016-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10cc979697016-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10cc979697016-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10cc979697016-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>在这个例子中，我们定义了一个函数<strong>foo</strong>，并对变量<strong>a</strong>赋值。不过与之前的例子不同的是，在函数<strong>foo</strong>中我们还嵌套了一个函数<strong>bar</strong>，并且还定义了两个变量，这个函数是作为函数<strong>foo</strong>的返回值。根据上面的作用域规则，函数<strong>foo</strong>的局部作用域既不是函数<strong>bar</strong>的局部作用域，也不是它的全局作用域，那函数<strong>bar</strong>能否正确匹配变量<strong>a</strong>的值呢？我们我们来验证一下这个函数是否能够正常运行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10d0391227420\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 调用函数foo()\r\n&gt;&gt;&gt; bar = foo()\r\n# 返回值bar是一个函数\r\n&gt;&gt;&gt; bar\r\n&lt;function bar at 0x00000000045F3588&gt;\r\n# 调用bar()\r\n&gt;&gt;&gt; bar()\r\n# 结果显示为三个变量之和\r\n6</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d0391227420-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d0391227420-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d0391227420-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d0391227420-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d0391227420-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d0391227420-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d0391227420-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d0391227420-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d0391227420-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10d0391227420-1\"><span class=\"crayon-c\"># 调用函数foo()</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d0391227420-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d0391227420-3\"><span class=\"crayon-c\"># 返回值bar是一个函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d0391227420-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d0391227420-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">bar </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000000045F3588</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d0391227420-6\"><span class=\"crayon-c\"># 调用bar()</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d0391227420-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d0391227420-8\"><span class=\"crayon-c\"># 结果显示为三个变量之和</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d0391227420-9\"><span class=\"crayon-cn\">6</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>以上的验证结果说明，在上述嵌套的函数中，内部函数可以正确地引用外部函数的变量，即使外部的函数已经返回。</p>\n<p>这种内部函数的局部作用域中可以访问外部函数局部作用域中变量的行为，我们称为： <strong>闭包</strong>。内部函数可以访问外部函数变量的特点很像将外部函数的变量直接“打包”到内部函数中一样，我们也可以这样理解闭包：将组成函数的语句以及执行这些语句的环境“打包”在一起时得到的对象称为闭包。</p>\n<h1 id=\"和闭包相关的几个对象\">和闭包相关的几个对象</h1>\n<p>为了了解闭包是怎么实现内部函数对外部函数变量的引用，还需要对闭包相关的几个对象进行介绍。关于这几个对象会涉及到Python的底层实现，本文中对此不加以详述，可以参考以下文章：</p>\n<ul>\n<li><a href=\"http://python.jobbole.com/83545/\" target=\"_blank\" rel=\"external\">Python源码阅读-闭包的实现</a></li>\n<li><a href=\"http://www.cnblogs.com/ChrisChen3121/p/3208119.html\" target=\"_blank\" rel=\"external\">Python闭包详解</a></li>\n</ul>\n<p>不过，为了直观地说明闭包的实现过程（不分析底层实现），这里先简单介绍以下<strong>code</strong>对象。<strong>code</strong>对象是指代码对象，表示编译成字节的的可执行Python代码，或者字节码。它有几个比较重要的属性：</p>\n<ul>\n<li>co_name：函数的名称</li>\n<li>co_nlocals: 函数使用的局部变量的个数</li>\n<li>co_varnames: 一个包含局部变量名字的元组</li>\n<li>co_cellvars: 是一个元组，包含嵌套的函数所引用的局部变量的名字</li>\n<li>co_freevars: 是一个元组，保存使用了的外层作用域中的变量名</li>\n<li>co_consts： 是一个包含字节码使用的字面量的元组</li>\n</ul>\n<p>其余属性可以参考<a href=\"http://python.usyiyi.cn/translate/python_278/reference/datamodel.html#index-37\" target=\"_blank\" rel=\"external\">Python文档</a>。</p>\n<p>其中比较关键的是<strong>co_varnames</strong>和<strong>co_freevars</strong>两个属性。我们对上面的例子稍加修改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10d6107618835\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; def foo():\r\n        a = 1\r\n        b = 2\r\n        def bar():\r\n            return a + 1\r\n        def bar2():\r\n            return b + 2\r\n        return bar\r\n&gt;&gt;&gt; bar = foo()\r\n# 外层函数\r\n&gt;&gt;&gt; foo.func_code.co_cellvars\r\n('a', 'b')\r\n&gt;&gt;&gt; foo.func_code.co_freevars\r\n()\r\n# 内层嵌套函数\r\n&gt;&gt;&gt; bar.func_code.co_cellvars\r\n()\r\n&gt;&gt;&gt; bar.func_code.co_freevars\r\n('a',)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10d6107618835-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10d6107618835-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-10\"><span class=\"crayon-c\"># 外层函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-11\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_code</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_cellvars</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-12\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-13\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_code</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_freevars</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-14\"><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-15\"><span class=\"crayon-c\"># 内层嵌套函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_code</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_cellvars</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-17\"><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10d6107618835-18\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_code</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_freevars</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10d6107618835-19\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>以上说明外层函数的<strong>code</strong>对象的<strong>co_cellvars</strong>保存了内部嵌套函数需要引用的变量的名字，而内层嵌套函数的<strong>code</strong>对象的<strong>co_freevars</strong>保存了需要引用外部函数作用域中的变量名字。具体来说，就是<strong>foo</strong>函数中嵌套了两个函数，它们都需要引用<strong>foo</strong>函数局部作用域中的变量，所以<strong>foo.func_code.co_cellvars</strong>便包含变量<strong>a</strong>和变量<strong>b</strong>的名称。而函数<strong>bar</strong>是<strong>foo</strong>的返回值，只引用了变量<strong>a</strong>，因此<strong>bar.func_code.co_freevars</strong>中便只包含变量<strong>a</strong>。</p>\n<p>内部函数和外部函数的<strong>co_freevars</strong>、<strong>co_cellvars</strong>的对应关系，使得在函数编译过程中内部函数具有了一个闭包的特殊属性<strong>__closure__</strong>（底层中对此有相关实现）。<strong>__closure__</strong>属性是一个由<strong>cell</strong>对象组成的元组，包含了由多个作用域引用的变量。可以做以下验证：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6a10dd992905859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; foo.__closure__     #None\r\n# 内部函数bar对变量a的引用\r\n&gt;&gt;&gt; bar.__closure__\r\n(&lt;cell at 0x00000000044F6798: int object at 0x0000000003FA4B38&gt;,)\r\n# 内部函数bar引用的变量a的值\r\n&gt;&gt;&gt; bar.__closure__[0].cell_contents\r\n1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10dd992905859-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10dd992905859-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10dd992905859-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10dd992905859-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10dd992905859-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6a10dd992905859-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6a10dd992905859-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6a10dd992905859-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__closure__</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">#None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10dd992905859-2\"><span class=\"crayon-c\"># 内部函数bar对变量a的引用</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10dd992905859-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__closure__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10dd992905859-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">cell </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x00000000044F6798</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x0000000003FA4B38</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6a10dd992905859-5\"><span class=\"crayon-c\"># 内部函数bar引用的变量a的值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6a10dd992905859-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__closure__</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cell</span><span class=\"crayon-sy\">_</span>contents</div><div class=\"crayon-line\" id=\"crayon-59d04be6a10dd992905859-7\"><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88585\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88585votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88585\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/24004ba5c7c6660ad259e346b2d86114.png"], "tags": "基础知识,作用域,闭包", "url_object_id": "5575233fb30a71ec7a1b6603b5b400f8", "praise_nums": "1", "url": "http://python.jobbole.com/88585/", "title": "Python 中的作用域规则和闭包简析", "create_date": "2017/09/10", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Flask/Flask%E4%B8%AD%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BA%94%E7%94%A8%E7%9A%84%E5%AE%9E%E7%8E%B0/\">Learn Python</a>   </div><p>Flask是一个轻量级的Web框架。虽然是轻量级的，但是对于组件一个大型的、模块化应用也是能够实现的，“蓝图”就是这样一种实现。对于模块化应用的实现，在Flask 0.2版本中进行了设计。本文暂时不对“蓝图”做详细的介绍，而是先从0.2版本中的<strong>Module</strong>类的实现讲起。其实，“蓝图”的实现和<strong>Module</strong>类的实现很相似。</p>\n<h1 id=\"为什么实现模块化应用\">为什么实现模块化应用</h1>\n<p>对于大型应用而言，随着功能的不断增加，整个应用的规模也会扩大。按照一定的规则将应用的不同部分进行模块化，不仅能够使整个应用逻辑清晰，也易于维护。例如，在Flask中，你也许想像如下构建一个简单的项目：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3c9f221353608\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/myapplication\r\n    /__init__.py\r\n    /views\r\n        /__init__.py\r\n        /admin.py\r\n        /frontend.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3c9f221353608-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3c9f221353608-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3c9f221353608-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3c9f221353608-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3c9f221353608-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3c9f221353608-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3c9f221353608-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myapplication</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3c9f221353608-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3c9f221353608-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">views</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3c9f221353608-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3c9f221353608-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3c9f221353608-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">frontend</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>以上目录结构中，我们将之前的Flask单文件修改成了一个应用包，所有的视图函数都在<strong>views</strong>下，并且按照功能分为了<strong>admin</strong>和<strong>frontend</strong>两个部分。为了实现这种模块化应用的构建，在0.2版本中Flask实现了<strong>Module</strong>类。这个类实例可以通过注册的方式，在Flask应用创建后添加进应用。</p>\n<p><strong>Module</strong>类实现了一系列的方法：</p>\n<ul>\n<li><strong>route(rule, **options)</strong></li>\n<li><strong>add_url_rule(rule, endpoint, view_func=None, **options)</strong></li>\n<li><strong>before_request(f)</strong></li>\n<li><strong>before_app_request(f)</strong></li>\n<li><strong>after_request(f)</strong></li>\n<li><strong>after_app_request(f)</strong></li>\n<li><strong>context_processor(f)</strong></li>\n<li><strong>app_context_processor(f)</strong></li>\n<li><strong>_record(func)</strong></li>\n</ul>\n<p>以上方法除了<strong>add_url_rule</strong>和<strong>_record</strong>外，都可以作为装饰器在自己的模块中使用，这些装饰器都返回一个函数。通过调用<strong>_record</strong>方法，可以将装饰器返回的函数放到<strong>_register_events</strong>中。当Flask应用创建之后，通过运行<strong>_register_events</strong>列表中的函数，可以将这个模块注册到应用中去。</p>\n<h1 id=\"Flask应用怎么注册一个Module\">Flask应用怎么注册一个Module</h1>\n<p>以下我们以一个例子来说明Flask应用怎么注册一个<strong>Module</strong>。</p>\n<h2 id=\"1-项目结构\">1. 项目结构</h2>\n<p>这个简单的例子项目结构如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3ca9211458935\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/myapplication\r\n    /__init__.py\r\n    /app.py\r\n    /views\r\n        /__init__.py\r\n        /admin.py\r\n        /blog.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3ca9211458935-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3ca9211458935-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3ca9211458935-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3ca9211458935-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3ca9211458935-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3ca9211458935-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3ca9211458935-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3ca9211458935-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">myapplication</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3ca9211458935-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3ca9211458935-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3ca9211458935-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">views</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3ca9211458935-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3ca9211458935-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3ca9211458935-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<figure></figure>\n<p><strong>admin.py</strong>和<strong>blog.py</strong>两个模块的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3cad623105176\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# admin.py\r\nfrom flask import Module\r\nadmin = Module(__name__)\r\n@admin.route('/')\r\ndef index():\r\n    return \"This is admin page!\"\r\n@admin.route('/profile')\r\ndef profile():\r\n    return \"This is profile page.\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cad623105176-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cad623105176-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cad623105176-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cad623105176-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cad623105176-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cad623105176-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cad623105176-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cad623105176-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cad623105176-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3cad623105176-1\"><span class=\"crayon-c\"># admin.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cad623105176-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Module</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cad623105176-3\"><span class=\"crayon-v\">admin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cad623105176-4\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cad623105176-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cad623105176-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is admin page!\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cad623105176-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/profile'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cad623105176-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">profile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cad623105176-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is profile page.\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<figure></figure>\n<figure></figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3cb0216792836\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# blog.py\r\nfrom flask import Module\r\nblog = Module(__name__)\r\n@blog.route('/')\r\ndef index():\r\n    return \"This is my blog!\"\r\n@blog.route('/article/&lt;int:id&gt;')\r\ndef article(id):\r\n    return \"The article id is %d.\" % id</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb0216792836-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb0216792836-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb0216792836-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb0216792836-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb0216792836-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb0216792836-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb0216792836-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb0216792836-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb0216792836-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb0216792836-1\"><span class=\"crayon-c\"># blog.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb0216792836-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Module</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb0216792836-3\"><span class=\"crayon-v\">blog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb0216792836-4\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb0216792836-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb0216792836-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is my blog!\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb0216792836-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/article/&lt;int:id&gt;'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb0216792836-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">article</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb0216792836-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"The article id is %d.\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>以上两个模块中，我们首先分别创建了一个<strong>Module</strong>类，然后像写一般的视图函数一样，为每个模块增加一些规则。之后，可以在创建Flask应用的时候将这些模块引入，就可以注册了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3cb4404169207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# app.py\r\nfrom flask import Flask\r\nfrom views.admin import admin\r\nfrom views.blog import blog\r\napp = Flask(__name__)\r\n@app.route('/')\r\ndef index():\r\n    return \"This is my app.\"\r\napp.register_module(blog, url_prefix='/blog')\r\napp.register_module(admin, url_prefix='/admin')\r\nif __name__ == '__main__':\r\n    from werkzeug.serving import run_simple\r\n    run_simple('localhost', 5000, app)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb4404169207-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb4404169207-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-1\"><span class=\"crayon-c\"># app.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">admin </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">admin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">blog </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">blog</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-5\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-6\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-7\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is my app.\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-9\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register_module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'/blog'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-10\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register_module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'/admin'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-11\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb4404169207-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">werkzeug</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">serving </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run_simple</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb4404169207-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">run_simple</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'localhost'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>在<strong>app.py</strong>中：</p>\n<ul>\n<li>我们首先引入了<strong>admin</strong>和<strong>blog</strong>两个<strong>Module</strong>对象；</li>\n<li>之后，我们创建了一个Flask应用<strong>app</strong>，并且为这个应用增加了一个视图函数；</li>\n<li>为了注册模块，我们调用了应用的<strong>register_module</strong>方法；</li>\n<li>最后，从<strong>werkzeug.serving</strong>中我们调用<strong>run_simple</strong>方法，用来创建一个本地的服务器用于测试这个Flask应用。</li>\n</ul>\n<p>根据以上的步骤，我们就可以测试这个应用。分别以<strong>/blog</strong>和<strong>/admin</strong>为URL前缀，就可以访问<strong>blog</strong>和<strong>admin</strong>两个模块了。</p>\n<h2 id=\"2-注册Module时发生了什么\">2. 注册<strong>Module</strong>时发生了什么</h2>\n<p>根据上面的例子，只要简单的调用Flask应用的<strong>register_module</strong>方法，就可以注册一个<strong>Module</strong>了。关于<strong>register_module</strong>方法的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3cb8280102306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef register_module(self, module, **options):\r\n    \"\"\"Registers a module with this application.  The keyword argument\r\n    of this function are the same as the ones for the constructor of the\r\n    :class:`Module` class and will override the values of the module if\r\n    provided.\r\n    \"\"\"\r\n    options.setdefault('url_prefix', module.url_prefix)\r\n    state = _ModuleSetupState(self, **options)\r\n    for func in module._register_events:\r\n        func(state)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb8280102306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb8280102306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb8280102306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb8280102306-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb8280102306-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb8280102306-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb8280102306-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb8280102306-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cb8280102306-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cb8280102306-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb8280102306-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register_module</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb8280102306-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Registers a module with this application.  The keyword argument</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb8280102306-3\"><span class=\"crayon-s\">    of this function are the same as the ones for the constructor of the</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb8280102306-4\"><span class=\"crayon-s\">    :class:`Module` class and will override the values of the module if</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb8280102306-5\"><span class=\"crayon-s\">    provided.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb8280102306-6\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb8280102306-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'url_prefix'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url_prefix</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb8280102306-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_ModuleSetupState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cb8280102306-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_register_events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cb8280102306-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>通过以上代码可以发现：</p>\n<ul>\n<li>可以通过增加<strong>url_prefix</strong>来区分不同的<strong>Module</strong>，这在<strong>app</strong>注册<strong>admin</strong>和<strong>blog</strong>时我们已经看到了；</li>\n<li>在注册时，我们创建了一个<strong>_ModuleSetupState</strong>的类，这个类接收Flask应用和一些参数生成一个<strong>state</strong>实例。这个实例反映了当前Flask应用的状态。</li>\n<li>前面在讲到<strong>Module</strong>类的时候，我们讲到<strong>Module</strong>未注册时会将自己模块的一些功能实现都放在<strong>_register_events</strong>列表中，这些功能实现都是函数形式。当需要将模块注册到某一应用上时，只需要传递关于这个应用信息的参数即可，即就是上面的<strong>state</strong>实例。这样，通过运行函数，可以讲一些属性绑定到当前应用上去。</li>\n</ul>\n<p>以上面例子中不同模块的URL绑定来讲，通过注册，应用<strong>app</strong>现形成了如下的URL“地图”：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6b3cbc941480636\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; app.url_map\r\nMap([&lt;Rule '/admin/profile' (HEAD, GET) -&gt; admin.profile&gt;,\r\n     &lt;Rule '/admin/' (HEAD, GET) -&gt; admin.index&gt;,\r\n     &lt;Rule '/blog/' (HEAD, GET) -&gt; blog.index&gt;,\r\n     &lt;Rule '/' (HEAD, GET) -&gt; index&gt;,\r\n     &lt;Rule '/blog/article/&lt;id&gt;' (HEAD, GET) -&gt; blog.article&gt;,\r\n     &lt;Rule '/static/&lt;filename&gt;' (HEAD, GET) -&gt; static&gt;]\r\n    )\r\n&gt;&gt;&gt; app.url_map._rules_by_endpoint\r\n{'admin.index': [&lt;Rule '/admin/' (HEAD, GET) -&gt; admin.index&gt;],\r\n 'admin.profile': [&lt;Rule '/admin/profile' (HEAD, GET) -&gt; admin.profile&gt;],\r\n 'blog.article': [&lt;Rule '/blog/article/&lt;id&gt;' (HEAD, GET) -&gt; blog.article&gt;],\r\n 'blog.index': [&lt;Rule '/blog/' (HEAD, GET) -&gt; blog.index&gt;],\r\n 'index': [&lt;Rule '/' (HEAD, GET) -&gt; index&gt;],\r\n 'static': [&lt;Rule '/static/&lt;filename&gt;' (HEAD, GET) -&gt; static&gt;]\r\n}\r\n&gt;&gt;&gt; app.view_functions\r\n{'admin.index': &lt;function views.admin.index&gt;,\r\n 'admin.profile': &lt;function views.admin.profile&gt;,\r\n 'blog.article': &lt;function views.blog.article&gt;,\r\n 'blog.index': &lt;function views.blog.index&gt;,\r\n 'index': &lt;function __main__.index&gt;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6b3cbc941480636-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6b3cbc941480636-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url_map</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-2\"><span class=\"crayon-k \">Map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/admin/profile'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">profile</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/admin/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/article/&lt;id&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">article</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-7\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url_map</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_rules_by</span><span class=\"crayon-sy\">_</span>endpoint</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-10\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'admin.index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/admin/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'admin.profile'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/admin/profile'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">profile</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blog.article'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/article/&lt;id&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">article</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blog.index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'static'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-16\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-17\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">_</span>functions</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-18\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'admin.index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'admin.profile'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">profile</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blog.article'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">article</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blog.index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6b3cbc941480636-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6b3cbc941480636-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0099 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>这样，就可以把不同模块的URL规则放在一起，并在<strong>endpoint</strong>和视图函数之间形成对应关系。关于Flask应用中URL处理，可以参考：<a title=\"Flask应用中的URL处理\" href=\"/Flask/Flask%E5%BA%94%E7%94%A8%E4%B8%AD%E7%9A%84URL%E5%A4%84%E7%90%86/\">Flask应用中的URL处理</a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88591\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88591votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88591\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e634580.png"], "tags": "工具与框架,Flask", "url_object_id": "58683c3100ad0bd51f0a6e25818c8582", "praise_nums": "1", "url": "http://python.jobbole.com/88591/", "title": "Flask 中模块化应用的实现", "create_date": "2017/09/10", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://fanchunke.me/Flask/Flask%E4%B8%AD%E7%9A%84%E8%93%9D%E5%9B%BE%E7%AE%A1%E7%90%86/\">Learn Python</a>   </div><p>在<a href=\"http://python.jobbole.com/88591/\">Flask中模块化应用的实现</a>一文中，我们曾分析过Flask 0.2版本中的<strong>Module</strong>类。这个类能够实现Flask应用的多模块化管理。在0.7版本中，Flask重新设计了模块化管理的内容，提出了“蓝图”的概念，用来取代<strong>Module</strong>的功能。</p>\n<h1 id=\"什么是“蓝图”\">什么是“蓝图”</h1>\n<p><a href=\"http://flask.pocoo.org/docs/0.12/blueprints/\" target=\"_blank\" rel=\"external\">官方文档</a>中对“蓝图”的概念是这样描述的：</p>\n<blockquote><p>Flask uses a concept of blueprints for making application components and supporting common patterns within an application or across applications. Blueprints can greatly simplify how large applications work and provide a central means for Flask extensions to register operations on applications. A Blueprint object works similarly to a Flask application object, but it is not actually an application. Rather it is a blueprint of how to construct or extend an application.</p></blockquote>\n<p>按照以上的描述，可以看出“蓝图”系统在Flask应用的组件化和扩展提供了很大的便利。“组件化”是指可以在Flask层上将一个Flask应用进行“分割”，实现模块化管理，这极大地简化了构建大型应用的流程，也使得应用的维护变得更加容易。另外，“蓝图”还提供了一种Flask扩展在应用上注册操作的核心方法。</p>\n<p>“蓝图”和一个Flask应用对象很相似，但是并不是一个Flask应用对象。它是可以注册到Flask应用上的一系列操作（对于此的理解，后文会详细讲到）。使用“蓝图”，可以实现以下的一些功能：</p>\n<ul>\n<li>将Flask应用“分割”为一系列“蓝图”的集合，简化了大型应用工作的方式；</li>\n<li>在Flask应用上，以 URL 前缀和或子域名注册一个蓝图。可以以不同的URL多次注册一个蓝图；</li>\n<li>通过蓝图提供模板过滤器、静态文件、模板和其它功能。</li>\n</ul>\n<h1 id=\"创建“蓝图”对象时发生了什么\">创建“蓝图”对象时发生了什么</h1>\n<p>“蓝图”和Flask应用的工作方式非常相似。Flask中的“蓝图”系统能够实现很多“蓝图”对象在应用层上的管理，这些“蓝图”对象可以共享应用配置。这意味着“蓝图”应该和Flask应用有一样的运行逻辑，这样一旦蓝图注册到应用上，就可以完全像Flask应用一样工作。</p>\n<p>在Flask应用中有一些属性，它们以字典的形式用来存放很多装饰器运行的结果。例如：<strong>view_functions</strong>这个字典通常存放<strong>route</strong>装饰器装饰的视图函数，可以用来进行URL匹配；<strong>before_request_functions</strong>字典会存放<strong>before_request</strong>装饰器装饰的视图函数，当正式处理请求前会先运行这个字典中的函数••••••为了实现和Flask应用相同的请求处理逻辑，“蓝图”对象也设计了同样的装饰器函数，这些函数都是一些“匿名函数”，只要传递一个参数，就可以将本蓝图上的一些操作映射到Flask应用上去。</p>\n<p>例如：<strong>before_request</strong>装饰器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efab4900435648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef before_request(self, f):\r\n    \"\"\"Like :meth:`Flask.before_request` but for a blueprint.  This function\r\n    is only executed before each request that is handled by a function of\r\n    that blueprint.\r\n    \"\"\"\r\n    self.record_once(lambda s: s.app.before_request_funcs\r\n        .setdefault(self.name, []).append(f))\r\n    return f</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efab4900435648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efab4900435648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efab4900435648-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efab4900435648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efab4900435648-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efab4900435648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efab4900435648-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efab4900435648-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efab4900435648-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">before_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efab4900435648-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Like :meth:`Flask.before_request` but for a blueprint.  This function</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efab4900435648-3\"><span class=\"crayon-s\">    is only executed before each request that is handled by a function of</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efab4900435648-4\"><span class=\"crayon-s\">    that blueprint.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efab4900435648-5\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efab4900435648-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">record_once</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">before_request</span><span class=\"crayon-sy\">_</span>funcs</div><div class=\"crayon-line\" id=\"crayon-59d04be6efab4900435648-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efab4900435648-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>上面的代码中，只要给这个装饰器传递参数<strong>s</strong>，那么这个装饰器就会将装饰的函数添加到Flask应用的<strong>before_request_functions</strong>字典当中，并且和该“蓝图”的名字对应起来。这样就可以实现该函数在Flask应用中可用。</p>\n<p>由于“蓝图”的创建过程和Flask应用的创建过程是分离的，所以在“蓝图”中使用装饰器不会立即对应用产生效果。“蓝图”中装饰器函数的返回值会经过<strong>record_once</strong>方法存储在“蓝图”对象的<strong>deferred_functions</strong>列表中，这为“蓝图”对象的注册提供了一个接口：只要在注册“蓝图”时执行<strong>deferred_functions</strong>列表中的函数即可。</p>\n<p>以下是一个简单的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efabf269671246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# blueprint\r\n&gt;&gt;&gt; from flask import Blueprint\r\n&gt;&gt;&gt; blog = Blueprint('blog', __name__,\r\n                    static_folder='static',\r\n                    template_folder='templates')\r\n&gt;&gt;&gt; @blog.route('/')\r\n    def index():\r\n        return \"This is blog home page.\"\r\n&gt;&gt;&gt; @blog.before_request\r\n    def before_request():\r\n        return \"This is before_request function.\"\r\n&gt;&gt;&gt; @blog.after_request\r\n    def after_request():\r\n        return \"This is after_request function.\"\r\n&gt;&gt;&gt; @blog.after_app_request\r\n    def after_app_request():\r\n        return \"This is after_app_request function.\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efabf269671246-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efabf269671246-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-1\"><span class=\"crayon-c\"># blueprint</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Blueprint</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blueprint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'blog'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-4\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">static_folder</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'static'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-5\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">template_folder</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'templates'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is blog home page.\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">before_request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-10\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">before_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is before_request function.\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">after_request</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-13\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">after_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is after_request function.\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-15\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">after_app_request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efabf269671246-16\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">after_app_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efabf269671246-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"This is after_app_request function.\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>上面的例子中：</p>\n<ul>\n<li>首先我们创建了一个“蓝图”对象<strong>blog</strong>。创建“蓝图”对象时，必须至少传递前两个参数：<strong>name</strong>和<strong>import_name</strong>。也可以传递<strong>static_folder</strong>、<strong>template_folder</strong>、<strong>url_prefix</strong>等参数，<strong>url_prefix</strong>参数也可以在注册蓝图时传入。</li>\n<li>之后，我们为<strong>blog</strong>增加了四条视图函数，每个函数由蓝图的装饰器装饰。此时，我们看一下“蓝图”对象的<strong>deferred_functions</strong>中有什么：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efac3610861030\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; blog.deferred_functions\r\n[&lt;function flask.blueprints.&lt;lambda&gt;&gt;,\r\n &lt;function flask.blueprints.&lt;lambda&gt;&gt;,\r\n &lt;function flask.blueprints.&lt;lambda&gt;&gt;,\r\n &lt;function flask.blueprints.&lt;lambda&gt;&gt;\r\n]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac3610861030-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac3610861030-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac3610861030-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac3610861030-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac3610861030-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac3610861030-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efac3610861030-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">deferred</span><span class=\"crayon-sy\">_</span>functions</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac3610861030-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac3610861030-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac3610861030-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac3610861030-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac3610861030-6\"><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</li>\n</ul>\n<p>可以看出，此时“蓝图”对象的<strong>deferred_functions</strong>中已经包含了四个匿名函数，分别对应上面例子中的四个视图函数。一旦“蓝图”被注册到应用上，会执行这四个函数。</p>\n<h1 id=\"注册“蓝图”\">注册“蓝图”</h1>\n<p>Flask应用和“蓝图”中都有注册“蓝图”的接口。</p>\n<p><strong>Flask应用</strong> 中的接口是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efac7244893394\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef register_blueprint(self, blueprint, **options):\r\n    \"\"\"Registers a blueprint on the application.\r\n    .. versionadded:: 0.7\r\n    \"\"\"\r\n    first_registration = False\r\n    if blueprint.name in self.blueprints:\r\n        assert self.blueprints[blueprint.name] is blueprint, \\\r\n            'A blueprint\\'s name collision ocurred between %r and ' \\\r\n            '%r.  Both share the same name \"%s\".  Blueprints that ' \\\r\n            'are created on the fly need unique names.' % \\\r\n            (blueprint, self.blueprints[blueprint.name], blueprint.name)\r\n    else:\r\n        self.blueprints[blueprint.name] = blueprint\r\n        first_registration = True\r\n    blueprint.register(self, options, first_registration)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efac7244893394-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efac7244893394-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register_blueprint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Registers a blueprint on the application.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-3\"><span class=\"crayon-s\">    .. versionadded:: 0.7</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-4\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">first_registration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">assert</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'A blueprint\\'s name collision ocurred between %r and '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'%r.  Both share the same name \"%s\".  Blueprints that '</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'are created on the fly need unique names.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">blueprint</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efac7244893394-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">first_registration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efac7244893394-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">blueprint</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_registration</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>这个方法首先会对“蓝图”进行检查，如果已经注册，则会出现一条<strong>assert</strong>语句。否则，就会调用“蓝图”对象的<strong>register</strong>方法进行注册。</p>\n<p><strong>蓝图对象</strong> 中的接口是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efacb335692528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef register(self, app, options, first_registration=False):\r\n    \"\"\"Called by :meth:`Flask.register_blueprint` to register a blueprint\r\n    on the application.  This can be overridden to customize the register\r\n    behavior.  Keyword arguments from\r\n    :func:`~flask.Flask.register_blueprint` are directly forwarded to this\r\n    method in the `options` dictionary.\r\n    \"\"\"\r\n    self._got_registered_once = True\r\n    state = self.make_setup_state(app, options, first_registration)\r\n    if self.has_static_folder:\r\n        state.add_url_rule(self.static_url_path + '/&lt;path:filename&gt;',\r\n                           view_func=self.send_static_file,\r\n                           endpoint='static')\r\n    for deferred in self.deferred_functions:\r\n        deferred(state)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacb335692528-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacb335692528-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_registration</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Called by :meth:`Flask.register_blueprint` to register a blueprint</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-3\"><span class=\"crayon-s\">    on the application.  This can be overridden to customize the register</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-4\"><span class=\"crayon-s\">    behavior.  Keyword arguments from</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-5\"><span class=\"crayon-s\">    :func:`~flask.Flask.register_blueprint` are directly forwarded to this</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-6\"><span class=\"crayon-s\">    method in the `options` dictionary.</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-7\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_got_registered_once</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_setup_state</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">options</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">first_registration</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">has_static_folder</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_url_rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">static_url_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/&lt;path:filename&gt;'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-12\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">view_func</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">send_static_file</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-13\"><span class=\"crayon-h\">                           </span><span class=\"crayon-v\">endpoint</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'static'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacb335692528-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deferred </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">deferred_functions</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacb335692528-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">deferred</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>蓝图对象中的<strong>register</strong>方法首先会生成一个<strong>BlueprintSetupState</strong>对象，这个对象将当前应用和当前蓝图的相关信息进行关联，还将作为参数传递到蓝图对象<strong>deferred_functions</strong>列表中的每一个函数。这样，蓝图中的相关操作就会映射到当前应用当中。</p>\n<p>还是以上面的例子为例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04be6efacf730467922\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; from flask import Flask\r\n&gt;&gt;&gt; app = Flask(__name__)\r\n&gt;&gt;&gt; app.url_map\r\nMap([&lt;Rule '/static/&lt;filename&gt;' (HEAD, OPTIONS, GET) -&gt; static&gt;])\r\n&gt;&gt;&gt; app.blueprints\r\n{}\r\n&gt;&gt;&gt; app.before_request_funcs\r\n{}\r\n&gt;&gt;&gt; app.after_request_funcs\r\n{}\r\n&gt;&gt;&gt; app.register_blueprint(blog, url_prefix='/blog')\r\n&gt;&gt;&gt; app.url_map\r\nMap([&lt;Rule '/blog/' (HEAD, OPTIONS, GET) -&gt; blog.index&gt;,\r\n     &lt;Rule '/blog/static/&lt;filename&gt;' (HEAD, OPTIONS, GET) -&gt; blog.static&gt;,\r\n     &lt;Rule '/static/&lt;filename&gt;' (HEAD, OPTIONS, GET) -&gt; static&gt;\r\n    ])\r\n&gt;&gt;&gt; app.blueprints\r\n{'blog': &lt;flask.blueprints.Blueprint at 0x896e7f0&gt;}\r\n&gt;&gt;&gt; app.before_request_funcs\r\n{'blog': [&lt;function __main__.before_request&gt;]}\r\n&gt;&gt;&gt; app.after_request_funcs\r\n{None: [&lt;function __main__.after_app_request&gt;],\r\n 'blog': [&lt;function __main__.after_request&gt;]\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04be6efacf730467922-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04be6efacf730467922-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url_map</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-4\"><span class=\"crayon-k \">Map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">blueprints</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">before_request</span><span class=\"crayon-sy\">_</span>funcs</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-8\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_request</span><span class=\"crayon-sy\">_</span>funcs</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-10\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-11\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register_blueprint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'/blog'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url_map</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-13\"><span class=\"crayon-k \">Map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-14\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/blog/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-15\"><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">Rule</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/static/&lt;filename&gt;'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HEAD</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OPTIONS</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">GET</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-17\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">blueprints</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-18\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'blog'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">blueprints</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Blueprint </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x896e7f0</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-19\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">before_request</span><span class=\"crayon-sy\">_</span>funcs</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-20\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'blog'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">before_request</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-21\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_request</span><span class=\"crayon-sy\">_</span>funcs</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-22\"><span class=\"crayon-sy\">{</span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_app_request</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04be6efacf730467922-23\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blog'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_request</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04be6efacf730467922-24\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0061 seconds] -->\r\n<p></p>\n<figure></figure>\n<p>经过上面的例子，可以发现“蓝图”对象注册到Flask应用时，会在Flask应用对应的地方增加“蓝图”对象的相关信息。例如，<strong>blog</strong>对象中有一个<strong>before_request</strong>装饰器，注册成功后，在<strong>app.before_request_funcs</strong>增加了该信息，并且以蓝图名作为键进行区分。<strong>blog</strong>对象中还有一个<strong>route</strong>装饰器，它为蓝图增加了一条URL规则，最终会在Flask应用的<strong>url_map</strong>中出现。由于在创建蓝图时我们增加了<strong>static_folder</strong>参数，所以在<strong>url_map</strong>中我们还可以看到<strong>‘/blog/static/&lt;filename&gt;’</strong>这样的URL规则。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88587\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88587votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88587\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "tags": "工具与框架,Flask", "url_object_id": "c1d02aa12a42c1a79cc27f9c3b938730", "praise_nums": "1", "url": "http://python.jobbole.com/88587/", "title": "Flask 中的蓝图管理", "create_date": "2017/09/10", "comment_nums": 0}
{"fav_nums": 11, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://gist.github.com/JeffPaine/6213790\">JeffPaine</a>   译文出处：<a target=\"_blank\" href=\"http://www.lightxue.com/transforming-code-into-beautiful-idiomatic-python\">0xFEE1C001</a>   </div><h2>译序</h2>\n<blockquote><p>如果说优雅也有缺点的话，那就是你需要艰巨的工作才能得到它，需要良好的教育才能欣赏它。</p>\n<p>—— Edsger Wybe Dijkstra</p></blockquote>\n<p>在Python社区文化的浇灌下，演化出了一种独特的代码风格，去指导如何正确地使用Python，这就是常说的pythonic。一般说地道(idiomatic)的python代码，就是指这份代码很pythonic。Python的语法和标准库设计，处处契合着pythonic的思想。而且Python社区十分注重编码风格一的一致性，他们极力推行和处处实践着pythonic。所以经常能看到基于某份代码P vs NP (pythonic vs non-pythonic)的讨论。pythonic的代码简练，明确，优雅，绝大部分时候执行效率高。阅读pythonic的代码能体会到“代码是写给人看的，只是顺便让机器能运行”畅快。</p>\n<p>然而什么是pythonic，就像什么是地道的汉语一样，切实存在但标准模糊。<strong>import this</strong>可以看到Tim Peters提出的Python之禅，它提供了指导思想。许多初学者都看过它，深深赞同它的理念，但是实践起来又无从下手。PEP 8给出的不过是编码规范，对于实践pythonic还远远不够。如果你正被如何写出pythonic的代码而困扰，或许这份笔记能给你帮助。</p>\n<p>Raymond Hettinger是Python核心开发者，本文提到的许多特性都是他开发的。同时他也是Python社区热忱的布道师，不遗余力地传授pythonic之道。这篇文章是网友Jeff Paine整理的他在2013年美国的PyCon的<a href=\"http://pyvideo.org/pycon-us-2013/transforming-code-into-beautiful-idiomatic-pytho.html\">演讲</a>的笔记。</p>\n<p>术语澄清：本文所说的集合全都指<strong>collection</strong>，而不是<strong>set</strong>。</p>\n<p>以下是正文。</p>\n<hr>\n<p>本文是Raymond Hettinger在2013年美国PyCon演讲的笔记(<a href=\"http://www.youtube.com/watch?feature=player_embedded&amp;v=OSGv2VnC0go\">视频</a>, <a href=\"https://speakerdeck.com/pyconslides/transforming-code-into-beautiful-idiomatic-python-by-raymond-hettinger-1\">幻灯片</a>)。</p>\n<p>示例代码和引用的语录都来自Raymond的演讲。这是我按我的理解整理出来的，希望你们理解起来跟我一样顺畅！</p>\n<h1>遍历一个范围内的数字</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb1a433667576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in [0, 1, 2, 3, 4, 5]:\r\n    print i ** 2\r\n\r\nfor i in range(6):\r\n    print i ** 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb1a433667576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb1a433667576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb1a433667576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb1a433667576-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb1a433667576-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb1a433667576-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb1a433667576-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb1a433667576-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb1a433667576-4\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb1a433667576-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb27462541421\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in xrange(6):\r\n    print i ** 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb27462541421-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb27462541421-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb27462541421-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb27462541421-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p><strong>xrange</strong>会返回一个迭代器，用来一次一个值地遍历一个范围。这种方式会比<strong>range</strong>更省内存。<strong>xrange</strong>在Python 3中已经改名为<strong>range</strong>。</p>\n<h1>遍历一个集合</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb2c716158761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\nfor i in range(len(colors)):\r\n    print colors[i]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb2c716158761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb2c716158761-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb2c716158761-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb2c716158761-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb2c716158761-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb2c716158761-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb2c716158761-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb2c716158761-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb2f406317648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor color in colors:\r\n    print color</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb2f406317648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb2f406317648-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb2f406317648-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb2f406317648-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">color</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<h1>反向遍历</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb32651287027\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\nfor i in range(len(colors)-1, -1, -1):\r\n    print colors[i]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb32651287027-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb32651287027-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb32651287027-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb32651287027-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb32651287027-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb32651287027-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb32651287027-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb32651287027-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb36267967691\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor color in reversed(colors):\r\n    print color</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb36267967691-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb36267967691-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb36267967691-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reversed</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb36267967691-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">color</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<h1>遍历一个集合及其下标</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb39200076550\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\nfor i in range(len(colors)):\r\n    print i, '---&gt;', colors[i]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb39200076550-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb39200076550-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb39200076550-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb39200076550-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb39200076550-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb39200076550-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb39200076550-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb39200076550-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb3c288174862\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i, color in enumerate(colors):\r\n    print i, '---&gt;', color</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3c288174862-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb3c288174862-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3c288174862-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb3c288174862-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<blockquote><p>这种写法效率高，优雅，而且帮你省去亲自创建和自增下标。</p>\n<p>当你发现你在操作集合的下标时，你很有可能在做错事。</p></blockquote>\n<h1>遍历两个集合</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb3f977934268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = ['raymond', 'rachel', 'matthew']\r\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\nn = min(len(names), len(colors))\r\nfor i in range(n):\r\n    print names[i], '---&gt;', colors[i]\r\n\r\nfor name, color in zip(names, colors):\r\n    print name, '---&gt;', color</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3f977934268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb3f977934268-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3f977934268-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb3f977934268-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3f977934268-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb3f977934268-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3f977934268-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb3f977934268-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb3f977934268-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3f977934268-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb3f977934268-2\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3f977934268-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb3f977934268-4\"><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">min</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3f977934268-5\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb3f977934268-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3f977934268-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb3f977934268-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb3f977934268-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb43438184033\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor name, color in izip(names, colors):\r\n    print name, '---&gt;', color</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb43438184033-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb43438184033-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb43438184033-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">izip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb43438184033-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">color</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p><strong>zip</strong>在内存中生成一个新的列表，需要更多的内存。<strong>izip</strong>比<strong>zip</strong>效率更高。</p>\n<p>注意：在Python 3中，<strong>izip</strong>改名为<strong>zip</strong>，并替换了原来的<strong>zip</strong>成为内置函数。</p>\n<h1>有序地遍历</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb46719097413\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\n# 正序\r\nfor color in sorted(colors):\r\n    print colors\r\n\r\n# 倒序\r\nfor color in sorted(colors, reverse=True):\r\n    print colors</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb46719097413-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb46719097413-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb46719097413-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb46719097413-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb46719097413-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb46719097413-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb46719097413-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb46719097413-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb46719097413-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb46719097413-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb46719097413-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb46719097413-3\"><span class=\"crayon-p\"># 正序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb46719097413-4\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb46719097413-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">colors</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb46719097413-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb46719097413-7\"><span class=\"crayon-p\"># 倒序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb46719097413-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb46719097413-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">colors</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<h1>自定义排序顺序</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb4b775261186\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'blue', 'yellow']\r\n\r\ndef compare_length(c1, c2):\r\n    if len(c1) &lt; len(c2): return -1\r\n    if len(c1) &gt; len(c2): return 1\r\n    return 0\r\n\r\nprint sorted(colors, cmp=compare_length)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb4b775261186-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb4b775261186-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb4b775261186-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb4b775261186-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb4b775261186-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb4b775261186-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb4b775261186-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb4b775261186-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb4b775261186-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yellow'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb4b775261186-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb4b775261186-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">compare_length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb4b775261186-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb4b775261186-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">c2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb4b775261186-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb4b775261186-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb4b775261186-8\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cmp</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">compare_length</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb4f754452669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint sorted(colors, key=len)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb4f754452669-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb4f754452669-1\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">sorted</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">len</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<p>第一种方法效率低而且写起来很不爽。另外，Python 3已经不支持比较函数了。</p>\n<h1>调用一个函数直到遇到标记值</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb52994689591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblocks = []\r\nwhile True:\r\n    block = f.read(32)\r\n    if block == '':\r\n        break\r\n    blocks.append(block)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb52994689591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb52994689591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb52994689591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb52994689591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb52994689591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb52994689591-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb52994689591-1\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb52994689591-2\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb52994689591-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb52994689591-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb52994689591-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb52994689591-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb55850227331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblocks = []\r\nfor block in iter(partial(f.read, 32), ''):\r\n    blocks.append(block)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb55850227331-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb55850227331-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb55850227331-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb55850227331-1\"><span class=\"crayon-v\">blocks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb55850227331-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">block </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">iter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">partial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">read</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb55850227331-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">blocks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p><strong>iter</strong>接受两个参数。第一个是你反复调用的函数，第二个是标记值。</p>\n<p>译注：这个例子里不太能看出来方法二的优势，甚至觉得<strong>partial</strong>让代码可读性更差了。方法二的优势在于<strong>iter</strong>的返回值是个迭代器，迭代器能用在各种地方，<strong>set</strong>，<strong>sorted</strong>，<strong>min</strong>，<strong>max</strong>，<strong>heapq</strong>，<strong>sum</strong>……</p>\n<h1>在循环内识别多个退出点</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb58839308248\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef find(seq, target):\r\n    found = False\r\n    for i, value in enumerate(seq):\r\n        if value == target:\r\n            found = True\r\n            break\r\n    if not found:\r\n        return -1\r\n    return i</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb58839308248-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb58839308248-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb58839308248-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb58839308248-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb58839308248-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb58839308248-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb58839308248-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb58839308248-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb58839308248-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb58839308248-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb58839308248-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb58839308248-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb58839308248-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb58839308248-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">found</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb58839308248-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb58839308248-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">found</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb58839308248-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb58839308248-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb5c896833631\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef find(seq, target):\r\n    for i, value in enumerate(seq):\r\n        if value == target:\r\n            break\r\n    else:\r\n        return -1\r\n    return i</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5c896833631-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5c896833631-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5c896833631-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5c896833631-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5c896833631-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5c896833631-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5c896833631-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5c896833631-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5c896833631-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seq</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5c896833631-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5c896833631-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5c896833631-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5c896833631-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5c896833631-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p><strong>for</strong>执行完所有的循环后就会执行<strong>else</strong>。</p>\n<p>译注：刚了解<strong>for-else</strong>语法时会困惑，什么情况下会执行到<strong>else</strong>里。有两种方法去理解<strong>else</strong>。传统的方法是把<strong>for</strong>看作<strong>if</strong>，当<strong>for</strong>后面的条件为<strong>False</strong>时执行<strong>else</strong>。其实条件为<strong>False</strong>时，就是<strong>for</strong>循环没被<strong>break</strong>出去，把所有循环都跑完的时候。所以另一种方法就是把<strong>else</strong>记成<strong>nobreak</strong>，当<strong>for</strong>没有被<strong>break</strong>，那么循环结束时会进入到<strong>else</strong>。</p>\n<h1>遍历字典的key</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb5f178934571\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nd = {'matthew': 'blue', 'rachel': 'green', 'raymond': 'red'}\r\n\r\nfor k in d:\r\n    print k\r\n\r\nfor k in d.keys():\r\n    if k.startswith('r'):\r\n        del d[k]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5f178934571-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5f178934571-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5f178934571-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5f178934571-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5f178934571-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5f178934571-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb5f178934571-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb5f178934571-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5f178934571-1\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5f178934571-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5f178934571-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5f178934571-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5f178934571-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5f178934571-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">keys</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb5f178934571-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">startswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'r'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb5f178934571-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">del</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>什么时候应该使用第二种而不是第一种方法？当你需要修改字典的时候。</p>\n<blockquote><p>如果你在迭代一个东西的时候修改它，那就是在冒天下之大不韪，接下来发生什么都活该。</p></blockquote>\n<p><strong>d.keys()</strong>把字典里所有的key都复制到一个列表里。然后你就可以修改字典了。</p>\n<p>注意：如果在Python 3里迭代一个字典你得显示地写：<strong>list(d.keys())</strong>，因为<strong>d.keys()</strong>返回的是一个“字典视图”(一个提供字典key的动态视图的迭代器)。详情请看<a href=\"https://docs.python.org/3/library/stdtypes.html#dict-views\">文档</a>。</p>\n<h1>遍历一个字典的key和value</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb63569326020\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 并不快，每次必须要重新哈希并做一次查找\r\nfor k in d:\r\n    print k, '---&gt;', d[k]\r\n\r\n# 产生一个很大的列表\r\nfor k, v in d.items():\r\n    print k, '---&gt;', v</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb63569326020-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb63569326020-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb63569326020-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb63569326020-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb63569326020-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb63569326020-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb63569326020-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb63569326020-1\"><span class=\"crayon-p\"># 并不快，每次必须要重新哈希并做一次查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb63569326020-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb63569326020-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb63569326020-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb63569326020-5\"><span class=\"crayon-p\"># 产生一个很大的列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb63569326020-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb63569326020-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb68602938897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor k, v in d.iteritems():\r\n    print k, '---&gt;', v</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb68602938897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb68602938897-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb68602938897-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">iteritems</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb68602938897-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'---&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p><strong>iteritems()</strong>更好是因为它返回了一个迭代器。</p>\n<p>注意：Python 3已经没有<strong>iteritems()</strong>了，<strong>items()</strong>的行为和<strong>iteritems()</strong>很接近。详情请看<a href=\"https://docs.python.org/3/library/stdtypes.html#dict-views\">文档</a>。</p>\n<h1>用key-value对构建字典</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb6c485270872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = ['raymond', 'rachel', 'matthew']\r\ncolors = ['red', 'green', 'blue']\r\n\r\nd = dict(izip(names, colors))\r\n# {'matthew': 'blue', 'rachel': 'green', 'raymond': 'red'}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6c485270872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6c485270872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6c485270872-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6c485270872-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6c485270872-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6c485270872-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6c485270872-2\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6c485270872-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6c485270872-4\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">izip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6c485270872-5\"><span class=\"crayon-p\"># {'matthew': 'blue', 'rachel': 'green', 'raymond': 'red'}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>Python 3: <strong>d = dict(zip(names, colors))</strong></p>\n<h2>用字典计数</h2>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb6f219447778\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncolors = ['red', 'green', 'red', 'blue', 'green', 'red']\r\n\r\n# 简单，基本的计数方法。适合初学者起步时学习。\r\nd = {}\r\nfor color in colors:\r\n    if color not in d:\r\n        d[color] = 0\r\n    d[color] += 1\r\n\r\n# {'blue': 1, 'green': 2, 'red': 3}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6f219447778-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6f219447778-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6f219447778-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6f219447778-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6f219447778-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6f219447778-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6f219447778-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6f219447778-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb6f219447778-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb6f219447778-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6f219447778-1\"><span class=\"crayon-v\">colors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6f219447778-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6f219447778-3\"><span class=\"crayon-p\"># 简单，基本的计数方法。适合初学者起步时学习。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6f219447778-4\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6f219447778-5\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6f219447778-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6f219447778-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6f219447778-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb6f219447778-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb6f219447778-10\"><span class=\"crayon-p\"># {'blue': 1, 'green': 2, 'red': 3}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb72808200455\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nd = {}\r\nfor color in colors:\r\n    d[color] = d.get(color, 0) + 1\r\n\r\n# 稍微潮点的方法，但有些坑需要注意，适合熟练的老手。\r\nd = defaultdict(int)\r\nfor color in colors:\r\n    d[color] += 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb72808200455-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb72808200455-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb72808200455-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb72808200455-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb72808200455-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb72808200455-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb72808200455-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb72808200455-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb72808200455-1\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb72808200455-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb72808200455-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb72808200455-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb72808200455-5\"><span class=\"crayon-p\"># 稍微潮点的方法，但有些坑需要注意，适合熟练的老手。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb72808200455-6\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">defaultdict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb72808200455-7\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">color </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">colors</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb72808200455-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">color</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<h1>用字典分组 — 第I部分和第II部分</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb76251709607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = ['raymond', 'rachel', 'matthew', 'roger',\r\n         'betty', 'melissa', 'judith', 'charlie']\r\n\r\n# 在这个例子，我们按name的长度分组\r\nd = {}\r\nfor name in names:\r\n    key = len(name)\r\n    if key not in d:\r\n        d[key] = []\r\n    d[key].append(name)\r\n\r\n# {5: ['roger', 'betty'], 6: ['rachel', 'judith'], 7: ['raymond', 'matthew', 'melissa', 'charlie']}\r\n\r\nd = {}\r\nfor name in names:\r\n    key = len(name)\r\n    d.setdefault(key, []).append(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb76251709607-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb76251709607-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'roger'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'betty'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'melissa'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'judith'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'charlie'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-4\"><span class=\"crayon-p\"># 在这个例子，我们按name的长度分组</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-5\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-12\"><span class=\"crayon-p\"># {5: ['roger', 'betty'], 6: ['rachel', 'judith'], 7: ['raymond', 'matthew', 'melissa', 'charlie']}</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-14\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-15\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb76251709607-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb76251709607-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb79989475841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nd = defaultdict(list)\r\nfor name in names:\r\n    key = len(name)\r\n    d[key].append(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb79989475841-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb79989475841-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb79989475841-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb79989475841-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb79989475841-1\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">defaultdict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb79989475841-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb79989475841-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb79989475841-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<h1>字典的<strong>popitem()</strong>是原子的吗？</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb83222035489\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nd = {'matthew': 'blue', 'rachel': 'green', 'raymond': 'red'}\r\n\r\nwhile d:\r\n    key, value = d.popitem()\r\n    print key, '--&gt;', value</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb83222035489-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb83222035489-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb83222035489-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb83222035489-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb83222035489-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb83222035489-1\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'blue'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'green'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb83222035489-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb83222035489-3\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb83222035489-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">popitem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb83222035489-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--&gt;'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p><strong>popitem</strong>是原子的，所以多线程的时候没必要用锁包着它。</p>\n<h1>连接字典</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb86098252810\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndefaults = {'color': 'red', 'user': 'guest'}\r\nparser = argparse.ArgumentParser()\r\nparser.add_argument('-u', '--user')\r\nparser.add_argument('-c', '--color')\r\nnamespace = parser.parse_args([])\r\ncommand_line_args = {k: v for k, v in vars(namespace).items() if v}\r\n\r\n# 下面是通常的作法，默认使用第一个字典，接着用环境变量覆盖它，最后用命令行参数覆盖它。\r\n# 然而不幸的是，这种方法拷贝数据太疯狂。\r\nd = defaults.copy()\r\nd.update(os.environ)\r\nd.update(command_line_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb86098252810-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb86098252810-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-1\"><span class=\"crayon-v\">defaults</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'color'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'red'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'user'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'guest'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-2\"><span class=\"crayon-v\">parser</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argparse</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ArgumentParser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-3\"><span class=\"crayon-v\">parser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_argument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'-u'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--user'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-4\"><span class=\"crayon-v\">parser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_argument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'-c'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--color'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-5\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parser</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse_args</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-6\"><span class=\"crayon-v\">command_line_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">k</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vars</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">namespace</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-8\"><span class=\"crayon-p\"># 下面是通常的作法，默认使用第一个字典，接着用环境变量覆盖它，最后用命令行参数覆盖它。</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-9\"><span class=\"crayon-p\"># 然而不幸的是，这种方法拷贝数据太疯狂。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-10\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb86098252810-11\"><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb86098252810-12\"><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command_line_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb8a183118268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nd = ChainMap(command_line_args, os.environ, defaults)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb8a183118268-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb8a183118268-1\"><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ChainMap</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command_line_args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">environ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">defaults</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p><strong>ChainMap</strong>在Python 3中加入。高效而优雅。</p>\n<h1>提高可读性</h1>\n<ul>\n<li>位置参数和下标很漂亮</li>\n<li>但关键字和名称更好</li>\n<li>第一种方法对计算机来说很便利</li>\n<li>第二种方法和人类思考方式一致</li>\n</ul>\n<h1>用关键字参数提高函数调用的可读性</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb8f184473279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntwitter_search('@obama', False, 20, True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb8f184473279-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb8f184473279-1\"><span class=\"crayon-e\">twitter_search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'@obama'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb93995818328\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntwitter_search('@obama', retweets=False, numtweets=20, popular=True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb93995818328-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb93995818328-1\"><span class=\"crayon-e\">twitter_search</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'@obama'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">retweets</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numtweets</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">popular</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>第二种方法稍微(微秒级)慢一点，但为了代码的可读性和开发时间，值得。</p>\n<h1>用<strong>namedtuple</strong>提高多个返回值的可读性</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb96097942915\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 老的testmod返回值\r\ndoctest.testmod()\r\n# (0, 4)\r\n# 测试结果是好是坏？你看不出来，因为返回值不清晰。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb96097942915-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb96097942915-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb96097942915-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb96097942915-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb96097942915-1\"><span class=\"crayon-p\"># 老的testmod返回值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb96097942915-2\"><span class=\"crayon-v\">doctest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">testmod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb96097942915-3\"><span class=\"crayon-p\"># (0, 4)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb96097942915-4\"><span class=\"crayon-p\"># 测试结果是好是坏？你看不出来，因为返回值不清晰。</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb99722701457\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 新的testmod返回值, 一个namedtuple\r\ndoctest.testmod()\r\n# TestResults(failed=0, attempted=4)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb99722701457-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb99722701457-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb99722701457-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb99722701457-1\"><span class=\"crayon-p\"># 新的testmod返回值, 一个namedtuple</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb99722701457-2\"><span class=\"crayon-v\">doctest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">testmod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb99722701457-3\"><span class=\"crayon-p\"># TestResults(failed=0, attempted=4)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<p><strong>namedtuple</strong>是<strong>tuple</strong>的子类，所以仍适用正常的元组操作，但它更友好。</p>\n<p>创建一个<strong>nametuple</strong></p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb9c652040748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nTestResults = namedTuple('TestResults', ['failed', 'attempted'])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb9c652040748-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb9c652040748-1\"><span class=\"crayon-v\">TestResults</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">namedTuple</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'TestResults'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'failed'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'attempted'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h1>unpack序列<del></del></h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eb9f607046146\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\np = 'Raymond', 'Hettinger', 0x30, 'python@example.com'\r\n\r\n# 其它语言的常用方法/习惯\r\nfname = p[0]\r\nlname = p[1]\r\nage = p[2]\r\nemail = p[3]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb9f607046146-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb9f607046146-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb9f607046146-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb9f607046146-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb9f607046146-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eb9f607046146-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eb9f607046146-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eb9f607046146-1\"><span class=\"crayon-v\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hettinger'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'python@example.com'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb9f607046146-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb9f607046146-3\"><span class=\"crayon-p\"># 其它语言的常用方法/习惯</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb9f607046146-4\"><span class=\"crayon-v\">fname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb9f607046146-5\"><span class=\"crayon-v\">lname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eb9f607046146-6\"><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eb9f607046146-7\"><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eba3887495850\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfname, lname, age, email = p</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba3887495850-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eba3887495850-1\"><span class=\"crayon-v\">fname</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lname</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">email</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">p</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>第二种方法用了unpack元组，更快，可读性更好。</p>\n<h1>更新多个变量的状态</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eba6818348781\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fibonacci(n):\r\n    x = 0\r\n    y = 1\r\n    for i in range(n):\r\n        print x\r\n        t = y\r\n        y = x + y\r\n        x = t</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba6818348781-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba6818348781-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba6818348781-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba6818348781-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba6818348781-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba6818348781-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba6818348781-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba6818348781-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eba6818348781-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba6818348781-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eba6818348781-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba6818348781-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eba6818348781-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba6818348781-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eba6818348781-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba6818348781-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8eba9765084663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fibonacci(n):\r\n    x, y = 0, 1\r\n    for i in range(n):\r\n        print x\r\n        x, y = y, x + y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba9765084663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba9765084663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba9765084663-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8eba9765084663-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8eba9765084663-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8eba9765084663-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fibonacci</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba9765084663-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eba9765084663-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8eba9765084663-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8eba9765084663-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>第一种方法的问题</p>\n<ul>\n<li>x和y是状态，状态应该在一次操作中更新，分几行的话状态会互相对不上，这经常是bug的源头。</li>\n<li>操作有顺序要求</li>\n<li>太底层太细节</li>\n</ul>\n<p>第二种方法抽象层级更高，没有操作顺序出错的风险而且更效率更高。</p>\n<h1>同时状态更新</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebac409985056\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntmp_x = x + dx * t\r\ntmp_y = y + dy * t\r\ntmp_dx = influence(m, x, y, dx, dy, partial='x')\r\ntmp_dy = influence(m, x, y, dx, dy, partial='y')\r\nx = tmp_x\r\ny = tmp_y\r\ndx = tmp_dx\r\ndy = tmp_dy</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebac409985056-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebac409985056-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebac409985056-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebac409985056-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebac409985056-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebac409985056-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebac409985056-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebac409985056-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebac409985056-1\"><span class=\"crayon-v\">tmp_x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dx *</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebac409985056-2\"><span class=\"crayon-v\">tmp_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dy *</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebac409985056-3\"><span class=\"crayon-v\">tmp_dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">influence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">partial</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'x'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebac409985056-4\"><span class=\"crayon-v\">tmp_dy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">influence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">partial</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'y'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebac409985056-5\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">_</span>x</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebac409985056-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tmp_y</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebac409985056-7\"><span class=\"crayon-v\">dx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tmp_dx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebac409985056-8\"><span class=\"crayon-v\">dy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tmp_dy</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebaf464573340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx, y, dx, dy = (x + dx * t,\r\n                y + dy * t,\r\n                influence(m, x, y, dx, dy, partial='x'),\r\n                influence(m, x, y, dx, dy, partial='y'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebaf464573340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebaf464573340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebaf464573340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebaf464573340-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebaf464573340-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dx *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebaf464573340-2\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">dy *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebaf464573340-3\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">influence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">partial</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'x'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebaf464573340-4\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">influence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dx</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dy</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">partial</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'y'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<h1>效率</h1>\n<ul>\n<li>优化的基本原则</li>\n<li>除非必要，别无故移动数据</li>\n<li>稍微注意一下用线性的操作取代O(n**2)的操作</li>\n</ul>\n<blockquote><p>总的来说，不要无故移动数据</p></blockquote>\n<h1>连接字符串</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebb2359641339\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = ['raymond', 'rachel', 'matthew', 'roger',\r\n         'betty', 'melissa', 'judith', 'charlie']\r\n\r\ns = names[0]\r\nfor name in names[1:]:\r\n    s += ', ' + name\r\nprint s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebb2359641339-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebb2359641339-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebb2359641339-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebb2359641339-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebb2359641339-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebb2359641339-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebb2359641339-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebb2359641339-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'roger'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebb2359641339-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'betty'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'melissa'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'judith'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'charlie'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebb2359641339-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebb2359641339-4\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebb2359641339-5\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebb2359641339-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">', '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebb2359641339-7\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebb8454462572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint ', '.join(names)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebb8454462572-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebb8454462572-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">', '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<h1>更新序列</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebbb974397861\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = ['raymond', 'rachel', 'matthew', 'roger',\r\n         'betty', 'melissa', 'judith', 'charlie']\r\n\r\ndel names[0]\r\n# 下面的代码标志着你用错了数据结构\r\nnames.pop(0)\r\nnames.insert(0, 'mark')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbb974397861-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbb974397861-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbb974397861-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbb974397861-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbb974397861-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbb974397861-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbb974397861-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbb974397861-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'roger'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbb974397861-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-s\">'betty'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'melissa'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'judith'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'charlie'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbb974397861-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbb974397861-4\"><span class=\"crayon-e\">del </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbb974397861-5\"><span class=\"crayon-p\"># 下面的代码标志着你用错了数据结构</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbb974397861-6\"><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbb974397861-7\"><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mark'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebbe123595736\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnames = deque(['raymond', 'rachel', 'matthew', 'roger',\r\n               'betty', 'melissa', 'judith', 'charlie'])\r\n\r\n# 用deque更有效率\r\ndel names[0]\r\nnames.popleft()\r\nnames.appendleft('mark')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbe123595736-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbe123595736-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbe123595736-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbe123595736-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbe123595736-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebbe123595736-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebbe123595736-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbe123595736-1\"><span class=\"crayon-v\">names</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">deque</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'raymond'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rachel'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'matthew'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'roger'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbe123595736-2\"><span class=\"crayon-h\">               </span><span class=\"crayon-s\">'betty'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'melissa'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'judith'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'charlie'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbe123595736-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbe123595736-4\"><span class=\"crayon-p\"># 用deque更有效率</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbe123595736-5\"><span class=\"crayon-e\">del </span><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebbe123595736-6\"><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">popleft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebbe123595736-7\"><span class=\"crayon-v\">names</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">appendleft</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'mark'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<h1>装饰器和上下文管理</h1>\n<ul>\n<li>用于把业务和管理的逻辑分开</li>\n<li>分解代码和提高代码重用性的干净优雅的好工具</li>\n<li>起个好名字很关键</li>\n<li>记住蜘蛛侠的格言：能力越大，责任越大</li>\n</ul>\n<h1>使用装饰器分离出管理逻辑</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebc2080757182\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 混着业务和管理逻辑，无法重用\r\ndef web_lookup(url, saved={}):\r\n    if url in saved:\r\n        return saved[url]\r\n    page = urllib.urlopen(url).read()\r\n    saved[url] = page\r\n    return page</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc2080757182-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc2080757182-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc2080757182-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc2080757182-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc2080757182-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc2080757182-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc2080757182-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc2080757182-1\"><span class=\"crayon-p\"># 混着业务和管理逻辑，无法重用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc2080757182-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">web_lookup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saved</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc2080757182-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saved</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc2080757182-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">saved</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc2080757182-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc2080757182-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">saved</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc2080757182-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">page</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebc5864223658\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;a href=\"http://www.jobbole.com/members/jjq153287083\"&gt;@cache&lt;/a&gt;\r\ndef web_lookup(url):\r\n    return urllib.urlopen(url).read()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc5864223658-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc5864223658-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc5864223658-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc5864223658-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/jjq153287083\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">cache</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc5864223658-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">web_lookup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc5864223658-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>注意：Python 3.2开始加入了<strong>functools.lru_cache</strong>解决这个问题。</p>\n<h1>分离临时上下文</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebc8822642534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 保存旧的，创建新的\r\nold_context = getcontext().copy()\r\ngetcontext().prec = 50\r\nprint Decimal(355) / Decimal(113)\r\nsetcontext(old_context)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc8822642534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc8822642534-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc8822642534-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebc8822642534-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebc8822642534-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc8822642534-1\"><span class=\"crayon-p\"># 保存旧的，创建新的</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc8822642534-2\"><span class=\"crayon-v\">old_context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getcontext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc8822642534-3\"><span class=\"crayon-e\">getcontext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">prec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebc8822642534-4\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">Decimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">355</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Decimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">113</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebc8822642534-5\"><span class=\"crayon-e\">setcontext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">old_context</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebcb214596999\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith localcontext(Context(prec=50)):\r\n    print Decimal(355) / Decimal(113)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebcb214596999-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebcb214596999-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebcb214596999-1\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">localcontext</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Context</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prec</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebcb214596999-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print </span><span class=\"crayon-e\">Decimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">355</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Decimal</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">113</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>译注：示例代码在使用标准库<strong>decimal</strong>，这个库已经实现好了<strong>localcontext</strong>。</p>\n<h1>如何打开关闭文件</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebce254345863\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('data.txt')\r\ntry:\r\n    data = f.read()\r\nfinally:\r\n    f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebce254345863-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebce254345863-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebce254345863-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebce254345863-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebce254345863-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebce254345863-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'data.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebce254345863-2\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebce254345863-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebce254345863-4\"><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebce254345863-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebd1043099612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open('data.txt') as f:\r\n    data = f.read()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd1043099612-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd1043099612-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd1043099612-1\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'data.txt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd1043099612-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<h1>如何使用锁</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebd5771884450\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 创建锁\r\nlock = threading.Lock()\r\n\r\n# 使用锁的老方法\r\nlock.acquire()\r\ntry:\r\n    print 'Critical section 1'\r\n    print 'Critical section 2'\r\nfinally:\r\n    lock.release()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd5771884450-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd5771884450-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd5771884450-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd5771884450-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd5771884450-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd5771884450-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd5771884450-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd5771884450-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd5771884450-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd5771884450-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd5771884450-1\"><span class=\"crayon-p\"># 创建锁</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd5771884450-2\"><span class=\"crayon-v\">lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd5771884450-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd5771884450-4\"><span class=\"crayon-p\"># 使用锁的老方法</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd5771884450-5\"><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd5771884450-6\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd5771884450-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Critical section 1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd5771884450-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Critical section 2'</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd5771884450-9\"><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd5771884450-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebd8228769223\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 使用锁的新方法\r\nwith lock:\r\n    print 'Critical section 1'\r\n    print 'Critical section 2'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd8228769223-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd8228769223-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebd8228769223-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebd8228769223-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd8228769223-1\"><span class=\"crayon-p\"># 使用锁的新方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd8228769223-2\"><span class=\"crayon-e\">with </span><span class=\"crayon-v\">lock</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebd8228769223-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Critical section 1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebd8228769223-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Critical section 2'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n\n</div>\n<h1>分离出临时的上下文</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebdb145697836\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry:\r\n    os.remove('somefile.tmp')\r\nexcept OSError:\r\n    pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebdb145697836-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebdb145697836-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebdb145697836-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebdb145697836-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebdb145697836-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebdb145697836-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'somefile.tmp'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebdb145697836-3\"><span class=\"crayon-e\">except </span><span class=\"crayon-v\">OSError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebdb145697836-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebe1166949556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith ignored(OSError):\r\n    os.remove('somefile.tmp')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe1166949556-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe1166949556-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe1166949556-1\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">ignored</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">OSError</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe1166949556-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">remove</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'somefile.tmp'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p><strong>ignored</strong>是Python 3.4加入的, <a href=\"http://docs.python.org/dev/library/contextlib.html#contextlib.ignored\">文档</a>。</p>\n<p>注意：<strong>ignored</strong> 实际上在标准库叫<strong>suppress</strong>(译注：<strong>contextlib.supress</strong>).</p>\n<p>试试创建你自己的<strong>ignored</strong>上下文管理器。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebe4278361019\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@contextmanager\r\ndef ignored(*exceptions):\r\n    try:\r\n        yield\r\n    except exceptions:\r\n        pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe4278361019-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe4278361019-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe4278361019-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe4278361019-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe4278361019-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe4278361019-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe4278361019-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">contextmanager</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe4278361019-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">ignored</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">exceptions</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe4278361019-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe4278361019-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">yield</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe4278361019-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">exceptions</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe4278361019-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<blockquote><p>把它放在你的工具目录，你也可以忽略异常</p></blockquote>\n<p>译注：<strong>contextmanager</strong>在标准库<strong>contextlib</strong>中，通过装饰生成器函数，省去用<strong>__enter__</strong>和<strong>__exit__</strong>写上下文管理器。详情请看<a href=\"https://docs.python.org/3/library/contextlib.html#contextlib.contextmanager\">文档</a>。</p>\n<h1>分离临时上下文</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebe8751939682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 临时把标准输出重定向到一个文件，然后再恢复正常\r\nwith open('help.txt', 'w') as f:\r\n    oldstdout = sys.stdout\r\n    sys.stdout = f\r\n    try:\r\n        help(pow)\r\n    finally:\r\n        sys.stdout = oldstdout</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe8751939682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe8751939682-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe8751939682-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe8751939682-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe8751939682-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe8751939682-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebe8751939682-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebe8751939682-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe8751939682-1\"><span class=\"crayon-p\"># 临时把标准输出重定向到一个文件，然后再恢复正常</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe8751939682-2\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'help.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe8751939682-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">oldstdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stdout</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe8751939682-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe8751939682-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe8751939682-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">help</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebe8751939682-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebe8751939682-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">oldstdout</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>更好的写法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebeb645792243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open('help.txt', 'w') as f:\r\n    with redirect_stdout(f):\r\n        help(pow)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebeb645792243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebeb645792243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebeb645792243-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebeb645792243-1\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'help.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebeb645792243-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-e\">redirect_stdout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebeb645792243-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">help</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pow</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p><strong>redirect_stdout</strong>在Python 3.4加入(译注：<strong>contextlib.redirect_stdout</strong>)， <a href=\"http://bugs.python.org/issue15805\">bug反馈</a>。</p>\n<p>实现你自己的<strong>redirect_stdout</strong>上下文管理器。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebee327422983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@contextmanager\r\ndef redirect_stdout(fileobj):\r\n    oldstdout = sys.stdout\r\n    sys.stdout = fileobj\r\n    try:\r\n        yield fieldobj\r\n    finally:\r\n        sys.stdout = oldstdout</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebee327422983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebee327422983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebee327422983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebee327422983-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebee327422983-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebee327422983-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebee327422983-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebee327422983-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebee327422983-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">contextmanager</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebee327422983-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">redirect_stdout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebee327422983-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">oldstdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stdout</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebee327422983-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fileobj</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebee327422983-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebee327422983-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">yield </span><span class=\"crayon-e\">fieldobj</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebee327422983-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebee327422983-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stdout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">oldstdout</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<h1>简洁的单句表达</h1>\n<p>两个冲突的原则：</p>\n<ul>\n<li>一行不要有太多逻辑</li>\n<li>不要把单一的想法拆分成多个部分</li>\n</ul>\n<p>Raymond的原则：</p>\n<ul>\n<li>一行代码的逻辑等价于一句自然语言</li>\n</ul>\n<h1>列表解析和生成器</h1>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebf1840440278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nresult = []\r\nfor i in range(10):\r\ns = i ** 2\r\n    result.append(s)\r\nprint sum(result)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebf1840440278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebf1840440278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebf1840440278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d0481d8ebf1840440278-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebf1840440278-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebf1840440278-1\"><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebf1840440278-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebf1840440278-3\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">i *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d0481d8ebf1840440278-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d0481d8ebf1840440278-5\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>更好的方法</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d0481d8ebf4258651461\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint sum(i**2 for i in xrange(10))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d0481d8ebf4258651461-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d0481d8ebf4258651461-1\"><span class=\"crayon-e\">print </span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">i*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>第一种方法说的是你在做什么，第二种方法说的是你想要什么。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88526\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88526votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88526\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e634580.png"], "tags": "基础知识,代码", "url_object_id": "9ff6a4390852c31bbca64d9307f0d4dc", "praise_nums": "1", "url": "http://python.jobbole.com/88526/", "title": "让你的 Python 代码优雅又地道", "create_date": "2017/09/07", "comment_nums": 1}
{"fav_nums": 12, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2515102440\">李趴趴要化身女超人</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.learn4master.com/data-science/popular-python-libraries-for-data-science-and-machine-learning\">learn4master</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Python 对于数据科学家来说几乎是一项必备技能。正如你看到的那样，很多数据科学家的岗位要求具备 Python 编程的能力。这篇文章将会针对数据科学介绍几种常用的 Python 包。在与数据挖掘、机器学习以及数据分析相关的项目中，这些 Python 包通常会得到广泛应用。</p>\n<p><strong>1. <a href=\"http://www.scipy.org/\">SciPy</a></strong></p>\n<p>SciPy (发音为“Sigh Pie”) 是一个基于 Python 的开源软件生态系统，主要用于数学、科学和工程学等领域，给数据科学家提供了大量的算法和数学工具。</p>\n<p><strong>2. <a href=\"http://numpy.scipy.org/\">NumPy</a></strong></p>\n<p>Numpy是用 Pyhton 进行科学计算时的基础包，为 Python 提供了出色的数学功能。</p>\n<p><strong>3. <a href=\"http://scikit-learn.org/stable/\">Scikit-learn</a></strong></p>\n<p>Scikit-learn 是 Python 中最著名的机器学习包，包含了大量不同的分类方法、交叉检验及其他模型选择方法、降维技术、回归和聚类分析的模块以及非常实用的数据预处理的模块。</p>\n<p><strong>4. <a href=\"http://pandas.pydata.org/\">Pandas</a></strong></p>\n<p>Pandas 是一个用于处理具有类表格结构数据的库，通常与强大的数据框对象一起使用。DataFrame 是高效处理数据的多维数组对象，类似 Numpy 的 narray ，同时也有些附加的功能。</p>\n<p><strong>5. <a href=\"http://ipython.scipy.org/moin/\">IPython</a></strong></p>\n<p>IPython 是一个命令行shell，相对于自带的 Python 解释器，具有很多有用的增强功能。</p>\n<p><strong>IPython Notebooks</strong>  对于科学计算来说是个不错的环境：不仅仅可以执行代码，同时也能通过 Markdown 、 HTML 、 LaTeX 、内置图片、内置数据图表（例如 matplotlib 等）增加信息化文件，还能为并行计算提供高性能的工具。</p>\n<p><strong>6. <a href=\"http://www.python-requests.org/\">Requests</a></strong></p>\n<p>Requests 是 Python 中为人们搭建的优雅而简单的 HTTP 库。作为一名数据科学家，你或许需要从网上采集数据，而Requests 则为你提供了强大的工具。</p>\n<p><strong>7. <a href=\"http://www.scrapy.org/\">Scrapy</a></strong></p>\n<p>Scrapy 是从互联网上采集数据的开源和协同框架，使用了快速、简单并且可扩展的方式。</p>\n<p><strong>8. <a href=\"http://statsmodels.sourceforge.net/\">Statsmodels</a></strong></p>\n<p>用户可以通过 Statsmodels 这个 Python 模块去挖掘数据、搭建预测统计模型和进行统计检验。它是个可扩展的列表，用来描述数据、统计检验、绘图以及为不同类型的数据和每一种预测提供统计结果。</p>\n<p><strong>9. <a href=\"http://deeplearning.net/software/theano/\">T</a><a href=\"http://deeplearning.net/software/theano/\">heano</a></strong></p>\n<p>如果从事深度学习项目，通常会需要 theano 。你可以用它这个 Python 库去定义、优化、高效评估包括多维数组在内的数学表达式。</p>\n<p><strong>10. <a href=\"https://radimrehurek.com/gensim/\">gensim</a></strong></p>\n<p>genism 是最稳健、高效和省事的软件之一，通过纯文本实现无监督的语义建模，可以很容易地训练主题模型。如果想要在文本数据中应用主题模型，那你应该去试试 genism。</p>\n<p><strong>11. <a href=\"http://www.sympygamma.com/\">SymPy</a></strong></p>\n<p>SymPy 是进行符号数学计算的 Python 库，拥有大量的特征，包括微积分、代数、几何学、离散数学，甚至还有量子物理学。同时在 LaTeX 的支持下具备基础绘图和输出功能。</p>\n<p><strong>12. <a href=\"http://pymc-devs.github.io/pymc/index.html\">PyMC</a></strong></p>\n<p>PyMC 的核心是贝叶斯统计和模型拟合的大量算法（包括Markov Chain Monte Carlo, MCMC）。</p>\n<p><strong>13. <a href=\"http://matplotlib.sourceforge.net/\">matplotlib</a></strong></p>\n<p>matplotlib 是 python 的平面绘图库，能以硬拷贝格式和跨平台交互环境的多种形式输出高质量的图形，对于任何数据科学家或数据分析师来说都是必备的。</p>\n<p><strong>14. <a href=\"http://www.crummy.com/software/BeautifulSoup/\">BeautifulSoup</a></strong></p>\n<p>如果想要提取些数据出来，那么 BeautifulSoup 正是你所需要的，可以用它在网页中提取内容。</p>\n<p><strong>15. <a href=\"http://www.nltk.org/\">nltk</a></strong></p>\n<p>Natural Language Toolkit (NLTK) 是使用人类语言数据搭建 Python 项目的领先平台。如果你在从事 NLP 相关的项目，那么 NLTK 是个必备工具。</p>\n<p><strong>16. <a href=\"https://docs.python.org/3.4/library/sqlite3.html\">sqlite3</a></strong></p>\n<p>这个工具能帮助你轻而易举地存储数据。它为 Python 连接 SQLite 数据库提供了接口。搭建开源的 SQL 数据库引擎对于小团队来说是个理想的选择，因为它是独立的本地存储数据库文件（最多140Tb），不像SQL那样，它不需要任何服务器基本结构。</p>\n<p>以上是我在数据挖掘项目中经常使用到的包。如果你有任何想法或建议，请在下面留言。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88521\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88521votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88521\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 12 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2515102440\">李趴趴要化身女超人</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2515102440\">\r\n\t\t\t<img src=\"http://tp4.sinaimg.cn/2515102440/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2515102440\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/2515102440/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2515102440/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2515102440\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/3cccc8c943fe706b4be2fc3d02ba4a1e.jpg"], "tags": "工具与框架", "url_object_id": "318a9e299c12b39f253ee752992b5ac1", "praise_nums": "3", "url": "http://python.jobbole.com/88521/", "title": "数据科学和 ML 领域常用的 Python 库", "create_date": "2017/09/07", "comment_nums": 2}
{"fav_nums": 3, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.paypal-engineering.com/2014/12/10/10-myths-of-enterprise-python/\">Mahmoud Hashemi</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/10-myths-of-enterprise-python\">开源中国</a>   </div><p>语言多元化是PayPal编程文化中一个重要的组成部分。在C++和Java长期流行的同时，更多的团队选择了JvaScript和Scala。同时，<a href=\"https://www.braintreepayments.com/\" rel=\"nofollow\">Braintree</a>的收购也引入了一个久经世故的Ruby社区。</p>\n<p><a href=\"https://www.python.org/\" rel=\"nofollow\">Python</a>作为一门特别的语言，在eBay和PayPal有很长的历史。而且其流行程度依然有增不减。</p>\n<p>eBay的开发者支持Python这个应用于基层领域多年的语言。甚至在eBay管理层官方支持Python以前，技术人员就开始使用Python。我在几年前加入PayPal并选择Python来写内部应用，然而，我却发现了PayPal中将近15年以前的Python代码。</p>\n<p>目前，Python 支撑着 <strong>超过50个项目</strong>, 包括:</p>\n<ul>\n<li><strong>功能和产品型</strong>, 例如 <a href=\"http://www.ebay.com/lcl/\" rel=\"nofollow\">eBay Now</a> 和 <a href=\"http://redlaser.com/\" rel=\"nofollow\">RedLaser</a></li>\n<li><strong>运营和基础设施<strong>型</strong></strong>, 从开放的 <a href=\"http://www.openstack.org/\" rel=\"nofollow\">OpenStack</a> 到专有设施</li>\n<li><strong>中间层服务和应用<strong>型</strong></strong>, 例如 PayPal 用来设定价格以及检测用户可用功能的那个（服务/应用）</li>\n<li><strong>监测代理和接口</strong><strong>型</strong>, 用于涉及到部署和安全的一些用例</li>\n<li><strong>批处理任务</strong><strong>型</strong>, 例如数据导入，价格调整，及其它项目</li>\n<li>以及不计其数的开发者工具</li>\n</ul>\n<p>在接下来的文章里我将详细介绍那些使得 eBay 和 PayPal 的 Python 生态系统从2011年的不超过25个工程师到2014年<strong>超过260个</strong>工程师所使用的技术和举措。对于本文，我则会专注于10个不得不予以揭露的关于 eBay 和 PayPal 的企业环境的谬误。</p>\n<div class=\"content\">\n<h1 id=\"content_h2_3_5\"><a href=\"https://www.paypal-engineering.com/2014/12/10/10-myths-of-enterprise-python/#python-is-new\" rel=\"nofollow\" name=\"python-is-new\">谬误 #1</a>: Python 是一门新语言</h1>\n<p>伴随着所有的初创公司正在使用它以及<a href=\"http://www.nostarch.com/pythonforkids\" rel=\"nofollow\">孩子们最近也在学习它</a>的事实，这个谬误为何仍然存在是可以理解的。实际上 Python 已经 <a href=\"https://en.wikipedia.org/wiki/Python_%28programming_language%29#History\" rel=\"nofollow\">超过23岁了</a>, 它最初发布于1991年, 早于 <a href=\"http://www.w3.org/Protocols/HTTP/1.0/spec.html\" rel=\"nofollow\">HTTP 1.0</a><a href=\"http://www.w3.org/Protocols/HTTP/1.0/spec.html\" rel=\"nofollow\">协议</a> 5年且早于 Java 4年. 目前比较有著名的很早就使用 Python 的例子是在1996年: <a href=\"https://news.ycombinator.com/item?id=8587697\" rel=\"nofollow\">Google 的第一个成功的网络爬虫</a>.</p>\n<p>如果你对于长长的 Python 历史比较好奇，Python 的作者 <a href=\"https://en.wikipedia.org/wiki/Guido_van_Rossum\" rel=\"nofollow\">Guido van Rossum</a> <a href=\"http://python-history.blogspot.com/2009/01/introduction-and-overview.html\" rel=\"nofollow\">已经为你准备好整个故事了</a>.</p>\n<div class=\"content\">\n<h1 id=\"content_h2_4_5\"><a href=\"https://www.paypal-engineering.com/2014/12/10/10-myths-of-enterprise-python/#python-is-not-compiled\" rel=\"nofollow\" name=\"python-is-not-compiled\">谬误 #2</a>: Python 没有被编译</h1>\n<p>不像 C++ 一样需要一个独立的编译器工具链，Python 实际上被编译成了字节码，和 Java 或者许多其他的编译型语言十分相似。更进一步的编译过程，如果有的话, 取决于运行时环境, 不管是 CPython，PyPy，Jython/JVM，IronPython/CLR，或是其它的进程式虚拟机（process virtual machine）。参考 <a href=\"https://www.paypal-engineering.com/2014/12/10/10-myths-of-enterprise-python/#myth-6\" rel=\"nofollow\">谬误 #6</a> 来了解更多。</p>\n<p>一条在 PayPal 以及其它地方的通用原则就是，（应用的）安全性不能依赖于代码的已编译状态。更为重要的是加强运行时环境的安全，因为实质上每种语言都有一个解码器，或者能被拦截并导出受保护的状态。参考下一条谬误来了解更多的 Python 安全性问题。</p>\n</div>\n<div class=\"translator-info\">\n<h1 id=\"content_h2_5_5\">谬误 #3: Python 不安全</h1>\n<p>轻量级 Python 的亲和力可能使他看起来不怎么可怕，但是这里直觉很大程度上是受到了误导的. 安全的一个核心原则就是尽可能让呈现的目标更小. 大系统是违背安全原则的，因为他们趋向于 <a href=\"http://www.jwz.org/xscreensaver/toolkits.html\" rel=\"nofollow\">使行为过渡集中化</a>, 并且也 <a href=\"https://www.schneier.com/essays/archives/1999/11/a_plea_for_simplicit.html\" rel=\"nofollow\">让开发者难于理解</a>. Python 通过倡导简洁化来边缘化这些恶心的问题. 更有甚者, <a href=\"https://en.wikipedia.org/wiki/CPython\" rel=\"nofollow\">CPython</a> 通过让自己成为一个简单、稳定并且易于审核的虚拟机来使这些问题得到解决. 事实上，近期 <a href=\"http://www.coverity.com/why-coverity/\" rel=\"nofollow\">Coverity</a> Software 的一个分析结果<a href=\"http://www.coverity.com/press-releases/coverity-finds-python-sets-new-level-of-quality-for-open-source-software/\" rel=\"nofollow\">显示 CPython 得到了他们的最高质量评级</a>.</p>\n<p>Python 还拥有一系列可扩展的开源、产业标准化的安全库序列. 在PayPal, 我们把安全和授信看做是重中之重, 我们发现 <a href=\"https://docs.python.org/2/library/hashlib.html\" rel=\"nofollow\">hashlib</a>, <a href=\"https://github.com/dlitz/pycrypto\" rel=\"nofollow\">PyCrypto</a>, 以及 <a href=\"https://www.openssl.org/\" rel=\"nofollow\">OpenSSL</a>, 通过 <a href=\"https://github.com/pyca/pyopenssl\" rel=\"nofollow\">PyOpenSSL</a> 和我们自己的定制构建的结合，涵盖了 PayPal 多样化的安全和性能需求.</p>\n<p>这些诸多的原因，使得 Python 成为PayPal（和eBay）的应用程序安全团队在某些业务中最快的选择. 这里有把Python用在PayPal的安全第一环境中的几个以安全为基础应用程序:</p>\n<ul>\n<li>创建安全代理，以促进密钥的轮换以并巩固加密实现</li>\n<li>同业界领先的 <a href=\"https://en.wikipedia.org/wiki/Hardware_security_module\" rel=\"nofollow\">HSM</a> 技术集成</li>\n<li>为缺乏兼容性的技术栈构建受TLS保护的封装代理</li>\n<li>为我们内部的互相认证计划生成键和证书</li>\n<li>开发主动的漏洞扫描器</li>\n</ul>\n<p>另外，还有无数存在安全隐患的用Python构建，面向操作的系统, 诸如防火墙和连接管理. 未来，我们一定回去深入的整合PayPal Python的安全事项.</p>\n<h1 id=\"content_h2_7_5\">谬误 #4: Python 是一门脚本语言</h1>\n<p>Python 确实可以用来编写脚本，并且因其简单的语法、跨平台并且无所不在于 Linux, Macs, 和其它Unix 机器而成为这个领域的领跑者之一.</p>\n<p>事实上, Python 可能是常规用途编程语言中最灵活的技术. 以下是一些实例:</p>\n<ol>\n<li>电信基础设施 (<a href=\"https://en.wikipedia.org/wiki/Twilio\" rel=\"nofollow\">Twilio</a>)</li>\n<li>支付系统 (<a href=\"https://en.wikipedia.org/wiki/PayPal\" rel=\"nofollow\">PayPal</a>, <a href=\"https://www.balancedpayments.com/\" rel=\"nofollow\">Balanced Payments</a>)</li>\n<li>神经科学和心理学 (<a href=\"http://journal.frontiersin.org/ResearchTopic/8\" rel=\"nofollow\">许多</a>, <a href=\"http://journal.frontiersin.org/ResearchTopic/1622\" rel=\"nofollow\">许多</a>, <a href=\"http://neuralensemble.org/\" rel=\"nofollow\">例子</a>)</li>\n<li>数值分析和工程 (<a href=\"https://en.wikipedia.org/wiki/NumPy\" rel=\"nofollow\">numpy</a>, <a href=\"http://numba.pydata.org/\" rel=\"nofollow\">numba</a>, 以及 <a href=\"https://wiki.python.org/moin/NumericAndScientific\" rel=\"nofollow\">更多其它</a>)</li>\n<li>动画(<a href=\"https://en.wikipedia.org/wiki/LucasArts\" rel=\"nofollow\">LucasArts</a>, <a href=\"http://www.disneyanimation.com/technology/opensource\" rel=\"nofollow\">Disney</a>, <a href=\"https://en.wikipedia.org/wiki/DreamWorks_Animation\" rel=\"nofollow\">Dreamworks</a>)</li>\n<li>游戏后台 (<a href=\"https://en.wikipedia.org/wiki/Eve_Online\" rel=\"nofollow\">Eve Online</a>, <a href=\"https://en.wikipedia.org/wiki/Second_Life\" rel=\"nofollow\">Second Life</a>, <a href=\"https://en.wikipedia.org/wiki/Battlefield_%28series%29\" rel=\"nofollow\">Battlefield</a>, 以及 <a href=\"https://wiki.python.org/moin/PythonGames\" rel=\"nofollow\">其它很多</a>)</li>\n<li>Email 基础设施 (<a href=\"https://en.wikipedia.org/wiki/GNU_Mailman\" rel=\"nofollow\">Mailman</a>, <a href=\"http://www.rackspace.com/mailgun\" rel=\"nofollow\">Mailgun</a>)</li>\n<li>媒体存储和处理 (<a href=\"https://en.wikipedia.org/wiki/YouTube\" rel=\"nofollow\">YouTube</a>, <a href=\"http://instagram-engineering.tumblr.com/post/13649370142/what-powers-instagram-hundreds-of-instances\" rel=\"nofollow\">Instagram</a>, <a href=\"https://tech.dropbox.com/\" rel=\"nofollow\">Dropbox</a>)</li>\n<li>操作和系统管理 (<a href=\"https://en.wikipedia.org/wiki/Rackspace\" rel=\"nofollow\">Rackspace</a>, <a href=\"http://www.openstack.org/\" rel=\"nofollow\">OpenStack</a>)</li>\n<li>自然语言处理(<a href=\"http://www.nltk.org/\" rel=\"nofollow\">NLTK</a>)</li>\n<li>机器学习和计算机版本 (<a href=\"http://scikit-learn.org/stable/\" rel=\"nofollow\">scikit-learn</a>, <a href=\"http://orange.biolab.si/\" rel=\"nofollow\">Orange</a>, <a href=\"http://simplecv.org/\" rel=\"nofollow\">SimpleCV</a>)</li>\n<li>安全性和渗透性测试 (<a href=\"https://github.com/dloss/python-pentest-tools\" rel=\"nofollow\">很多很多</a> 以及 <a href=\"https://www.paypal-engineering.com/2014/12/10/10-myths-of-enterprise-python/#ebay-paypal-python-security\" rel=\"nofollow\">eBay/PayPal</a></li>\n<li>大数据 (<a href=\"http://discoproject.org/\" rel=\"nofollow\">Disco</a>, <a href=\"http://blog.cloudera.com/blog/2013/01/a-guide-to-python-frameworks-for-hadoop/\" rel=\"nofollow\">Hadoop support</a>)</li>\n<li>如理 (<a href=\"http://calendarserver.org/\" rel=\"nofollow\">Calendar Server</a>, 它 <a href=\"https://en.wikipedia.org/wiki/Calendar_and_Contacts_Server\" rel=\"nofollow\">驱动了 Apple iCal</a>)</li>\n<li>搜索系统 (<a href=\"http://www.eweek.com/c/a/Application-Development/Python-Slithers-into-Systems/\" rel=\"nofollow\">ITA</a>, <a href=\"https://www.python.org/about/success/verity/\" rel=\"nofollow\">Ultraseek</a>, 还有 <a href=\"https://news.ycombinator.com/item?id=8587697\" rel=\"nofollow\">Google</a>)</li>\n<li>Internet 基础设施 (DNS) (<a href=\"http://www.isc.org/blogs/programming-languages-for-bind-10/\" rel=\"nofollow\">BIND 10</a>)</li>\n</ol>\n<p>更别提网站和web服务了，那些都不在少数. 事实上，PayPal工程师看起来像是有兴趣致力于基于Python的web特性,比如 <a href=\"https://en.wikipedia.org/wiki/YouTube\" rel=\"nofollow\">YouTube</a> 和 <a href=\"http://yelp.com/\" rel=\"nofollow\">Yelp</a>. 如果对Python成功案例的更大清单感兴趣，那就看看<a href=\"https://www.python.org/about/success/\" rel=\"nofollow\">官方的清单吧</a>.</p>\n<div class=\"content\">\n<h1 id=\"content_h2_8_5\">谬误 #5: Python 是弱类型的</h1>\n<p>Python 类型系统的特点是拥有强大、灵活的类型操作. <a href=\"https://en.wikipedia.org/wiki/Type_system\" rel=\"nofollow\">维基百科上对此作出的阐述</a>.</p>\n<p>而存在一个不争而有趣的事实是， Python 是比Java更加强类型的. Java 对于原生类型和对象区分了类型系统，它让null存在于一个灰色地带. 另一方面，现代的 Python 拥有一个统一的强类型系统, 其中什么都没有（None） 的类型是明确指定的. 更进一步的，JVM自身也是动态类型的，因为可以把它的 <a href=\"https://en.wikipedia.org/wiki/HotSpot#History\" rel=\"nofollow\">根源</a> 追溯到由Sun所收购的Smalltalk VM的一个实现.</p>\n<p><a href=\"https://docs.python.org/2/reference/datamodel.html\" rel=\"nofollow\">Python的类型系统</a> 很棒，但要提供给企业级使用，目前仍然还有许多更重大的事项需要关注.</p>\n<h1 id=\"content_h2_9_5\">谬误 #6: Python 速度慢</h1>\n<p>首先是有一个重要区别: Python 是一门编程语言，而不是运行时环境. Python 拥有几个实现:</p>\n<ol>\n<li><a href=\"https://en.wikipedia.org/wiki/CPython\" rel=\"nofollow\"><strong>CPython</strong></a> 是参考实现, 且也是广泛发布和使用的实现.</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Jython\" rel=\"nofollow\"><strong>Jython</strong></a> 是Python用于JVM的是一个成熟的实现.</li>\n<li><a href=\"https://en.wikipedia.org/wiki/IronPython\" rel=\"nofollow\"><strong>IronPython</strong></a> 是 Microsoft 针对其自家的通用语言运行时——又名 .NET，实现的Python .</li>\n<li><a href=\"http://pypy.org/\" rel=\"nofollow\"><strong>PyPy</strong></a> 是一个正在日趋成熟的Python实现，拥有JIT编译，增量垃圾收集诸多先进的特性.</li>\n</ol>\n<p>每一个运行时都有其自己的性能特点, 而且他们本身也不慢. 这里更重要的地方在于不能错误地把一个性能指标分派到一门编程语言智商. 应该总是把该评估用在一个应用程序运行时上面，最好是针对一个特定的使用场景.</p>\n<p>清楚了那些事项之后，下面就是一些有Python提供的小项，体现其重要的性能优势:</p>\n</div>\n<ol>\n<li class=\"translator-info\">把 <a href=\"https://en.wikipedia.org/wiki/NumPy\" rel=\"nofollow\">NumPy</a> 用作 <a href=\"https://software.intel.com/en-us/articles/numpyscipy-with-intel-mkl\" rel=\"nofollow\">Intel 的 MKL SIMD接口</a></li>\n<li class=\"translator-info\"><a href=\"http://pypy.org/\" rel=\"nofollow\">PyPy</a>的 JIT 编译能 <a href=\"http://morepypy.blogspot.com/2011/08/pypy-is-faster-than-c-again-string.html\" rel=\"nofollow\">达到比C还快的性能</a></li>\n<li class=\"translator-info\"><a href=\"https://disqus.com/\" rel=\"nofollow\">Disqus</a> 能在<a href=\"http://blog.disqus.com/post/62187806135/scaling-django-to-8-billion-page-views\" rel=\"nofollow\">同样的100个盒子上容纳两亿五千万到5亿用户</a></li>\n</ol>\n<p>诚然，这些都不是最新的列子，只是我个人的最爱罢了. 这将很容易扯到高性能Python以及独立提供的运行时这些广阔的领域. 我们不应只是专注于解决单个特殊的案例, 而是应该把注意力放在对开发人员在 <a href=\"http://www.perfdynamics.com/Manifesto/gcaprules.html\" rel=\"nofollow\">最终产品性能</a> 方面的生产力的普遍影响上面, 特别是在一种企业级环境之下.</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/599fa230402f564d56795dcb62a67a66.png\"><img class=\"aligncenter size-full wp-image-88444\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/599fa230402f564d56795dcb62a67a66.png\" alt=\"cpp_py_medium\"></a></p>\n<p>C++ vs Python,. 两种语言在同一个输出下的对比。</p>\n</div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88443\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88443votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88443\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e634580.png"], "tags": "观点与动态,谬误", "url_object_id": "6d08f200d055afcf5c362aff154c9b8b", "praise_nums": "1", "url": "http://python.jobbole.com/88443/", "title": "Python 语言在企业应用方面遭遇的十大谬误", "create_date": "2017/08/31", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/544d406e0875\">Andrew_liu</a>   </div><p>本文希望达到的目标:</p>\n<ol>\n<li>学习Queue模块</li>\n<li>将Queue模块与多线程编程相结合</li>\n<li>通过Queue和threading模块, 重构爬虫, 实现多线程爬虫,</li>\n<li>通过以上学习希望总结出一个通用的多线程爬虫小模版</li>\n</ol>\n<h1>1. Queue模块</h1>\n<p><strong>Queue</strong>模块实现了多生产者多消费者队列, 尤其适合多线程编程.<strong>Queue</strong>类中<strong>实现了所有需要的锁原语</strong>(这句话非常重要), Queue模块实现了三种类型队列:</p>\n<ul>\n<li>FIFO(先进先出)队列, 第一加入队列的任务, 被第一个取出</li>\n<li>LIFO(后进先出)队列,最后加入队列的任务, 被第一个取出(操作类似与栈, 总是从栈顶取出, 这个队列还不清楚内部的实现)</li>\n<li>PriorityQueue(优先级)队列, 保持队列数据有序, 最小值被先取出(在C++中我记得优先级队列是可以自己重写排序规则的, Python不知道可以吗)</li>\n</ul>\n<h2>1.1. 类和异常</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f2f924265657\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport Queue\r\n\r\n#类\r\nQueue.Queue(maxsize = 0)  #构造一个FIFO队列,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认)\r\n\r\nQueue.LifoQueue(maxsize = 0)  #构造一LIFO队列,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认)\r\n\r\nQueue.PriorityQueue(maxsize = 0)  #构造一个优先级队列,,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认). 优先级队列中, 最小值被最先取出\r\n\r\n#异常\r\nQueue.Empty  #当调用非阻塞的get()获取空队列的元素时, 引发异常\r\nQueue.Full  #当调用非阻塞的put()向满队列中添加元素时, 引发异常</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f2f924265657-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f2f924265657-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-3\"><span class=\"crayon-c\">#类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-4\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一个FIFO队列,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-6\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">LifoQueue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一LIFO队列,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-8\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PriorityQueue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maxsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一个优先级队列,,maxsize设置队列大小的上界, 如果插入数据时, 达到上界会发生阻塞, 直到队列可以放入数据. 当maxsize小于或者等于0, 表示不限制队列的大小(默认). 优先级队列中, 最小值被最先取出</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-10\"><span class=\"crayon-c\">#异常</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f2f924265657-11\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Empty</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#当调用非阻塞的get()获取空队列的元素时, 引发异常</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f2f924265657-12\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Full</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#当调用非阻塞的put()向满队列中添加元素时, 引发异常</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p>\n<h2>1.2. Queue对象</h2>\n<p>三种队列对象<strong>提供公共的方法</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f3a810203445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nQueue.empty()  #如果队列为空, 返回True(注意队列为空时, 并不能保证调用put()不会阻塞); 队列不空返回False(不空时, 不能保证调用get()不会阻塞)\r\nQueue.full()  #如果队列为满, 返回True(不能保证调用get()不会阻塞), 如果队列不满, 返回False(并不能保证调用put()不会阻塞)\r\n\r\nQueue.put(item[, block[, timeout]])  #向队列中放入元素, 如果可选参数block为True并且timeout参数为None(默认), 为阻塞型put(). 如果timeout是正数, 会阻塞timeout时间并引发Queue.Full异常. 如果block为False为非阻塞put\r\nQueue.put_nowait(item)  #等价于put(itme, False)\r\n\r\nQueue.get([block[, timeout]])  #移除列队元素并将元素返回, block = True为阻塞函数, block = False为非阻塞函数. 可能返回Queue.Empty异常\r\nQueue.get_nowait()  #等价于get(False)\r\n\r\nQueue.task_done()  #在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号\r\nQueue.join()  #实际上意味着等到队列为空，再执行别的操作</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3a810203445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3a810203445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3a810203445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3a810203445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3a810203445-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3a810203445-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-1\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#如果队列为空, 返回True(注意队列为空时, 并不能保证调用put()不会阻塞); 队列不空返回False(不空时, 不能保证调用get()不会阻塞)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3a810203445-2\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">full</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#如果队列为满, 返回True(不能保证调用get()不会阻塞), 如果队列不满, 返回False(并不能保证调用put()不会阻塞)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3a810203445-4\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#向队列中放入元素, 如果可选参数block为True并且timeout参数为None(默认), 为阻塞型put(). 如果timeout是正数, 会阻塞timeout时间并引发Queue.Full异常. 如果block为False为非阻塞put</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-5\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put_nowait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#等价于put(itme, False)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3a810203445-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-7\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#移除列队元素并将元素返回, block = True为阻塞函数, block = False为非阻塞函数. 可能返回Queue.Empty异常</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3a810203445-8\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_nowait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#等价于get(False)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3a810203445-10\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#在完成一项工作之后，Queue.task_done()函数向任务已经完成的队列发送一个信号</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3a810203445-11\"><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#实际上意味着等到队列为空，再执行别的操作</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>下面是官方文档给多出的多线程模型:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f3f578389337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef worker():\r\n    while True:\r\n        item = q.get()\r\n        do_work(item)\r\n        q.task_done()\r\n\r\nq = Queue()\r\nfor i in range(num_worker_threads):\r\n     t = Thread(target=worker)\r\n     t.daemon = True\r\n     t.start()\r\n\r\nfor item in source():\r\n    q.put(item)\r\n\r\nq.join()       # block until all tasks are done</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f3f578389337-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f3f578389337-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">do_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-7\"><span class=\"crayon-v\">q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_worker_threads</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-9\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-10\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-11\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-13\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">source</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f3f578389337-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f3f578389337-16\"><span class=\"crayon-v\">q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\"># block until all tasks are done</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p></p>\n<h1>2. Queue模块与线程相结合</h1>\n<p>简单写了一个Queue和线程结合的小程序</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f42810964445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport threading\r\nimport time\r\nimport Queue\r\n\r\nSHARE_Q = Queue.Queue()  #构造一个不限制大小的的队列\r\n_WORKER_THREAD_NUM = 3   #设置线程个数\r\n\r\nclass MyThread(threading.Thread) :\r\n\r\n    def __init__(self, func) :\r\n        super(MyThread, self).__init__()\r\n        self.func = func\r\n\r\n    def run(self) :\r\n        self.func()\r\n\r\ndef worker() :\r\n    global SHARE_Q\r\n    while not SHARE_Q.empty():\r\n        item = SHARE_Q.get() #获得任务\r\n        print \"Processing : \", item\r\n        time.sleep(1)\r\n\r\ndef main() :\r\n    global SHARE_Q\r\n    threads = []\r\n    for task in xrange(5) :  #向队列中放入任务\r\n        SHARE_Q.put(task)\r\n    for i in xrange(_WORKER_THREAD_NUM) :\r\n        thread = MyThread(worker)\r\n        thread.start()\r\n        threads.append(thread)\r\n    for thread in threads :\r\n        thread.join()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f42810964445-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f42810964445-40\">40</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-8\"><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一个不限制大小的的队列</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-9\"><span class=\"crayon-v\">_WORKER_THREAD_NUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#设置线程个数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-17\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-20\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-22\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获得任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processing : \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-25\"><span class=\"crayon-e\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-26\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-27\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-29\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#向队列中放入任务</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_WORKER_THREAD_NUM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-38\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f42810964445-39\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f42810964445-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0096 seconds] -->\r\n<p></p>\n<h1>3. 重构爬虫</h1>\n<p>主要针对之间写过的豆瓣爬虫进行重构:</p>\n<ul>\n<li><a href=\"http://andrewliu.tk/2014/12/05/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB-%E4%BA%8C-%E8%B1%86%E7%93%A3%E6%8A%93%E7%AB%99%E5%B0%8F%E8%AE%A1/\" target=\"_blank\">Python网络爬虫(二)–豆瓣抓站小计</a></li>\n</ul>\n<h2>3.1. 豆瓣电影爬虫重构</h2>\n<p>通过对Queue和线程模型进行改写, 可以写出下面的爬虫程序 :</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f46981998601\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n# 多线程爬取豆瓣Top250的电影名称\r\n\r\nimport urllib2, re, string\r\nimport threading, Queue, time\r\nimport sys\r\n\r\nreload(sys)\r\nsys.setdefaultencoding('utf8')\r\n_DATA = []\r\nFILE_LOCK = threading.Lock()\r\nSHARE_Q = Queue.Queue()  #构造一个不限制大小的的队列\r\n_WORKER_THREAD_NUM = 3  #设置线程的个数\r\n\r\nclass MyThread(threading.Thread) :\r\n\r\n    def __init__(self, func) :\r\n        super(MyThread, self).__init__()  #调用父类的构造函数\r\n        self.func = func  #传入线程函数逻辑\r\n\r\n    def run(self) :\r\n        self.func()\r\n\r\ndef worker() :\r\n    global SHARE_Q\r\n    while not SHARE_Q.empty():\r\n        url = SHARE_Q.get() #获得任务\r\n        my_page = get_page(url)  #爬取整个网页的HTML代码\r\n        find_title(my_page)  #获得当前页面的电影名\r\n        time.sleep(1)\r\n        SHARE_Q.task_done()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f46981998601-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f46981998601-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-3\"><span class=\"crayon-c\"># 多线程爬取豆瓣Top250的电影名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-9\"><span class=\"crayon-k \">reload</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-10\"><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setdefaultencoding</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf8'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-11\"><span class=\"crayon-v\">_DATA</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-12\"><span class=\"crayon-v\">FILE_LOCK</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-13\"><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一个不限制大小的的队列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-14\"><span class=\"crayon-v\">_WORKER_THREAD_NUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置线程的个数</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-16\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#调用父类的构造函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#传入线程函数逻辑</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-24\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-25\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-27\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获得任务</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">my_page</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_page</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#爬取整个网页的HTML代码</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">find_title</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">my_page</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#获得当前页面的电影名</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f46981998601-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f46981998601-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>完整代码请查看<a href=\"https://github.com/Andrew-liu/dou_ban_spider/blob/master/threading_douban.py\" target=\"_blank\">Github豆瓣多线程爬虫</a><br>\n完成这个程序后, 又出现了新的问题:</p>\n<blockquote><p>无法保证数据的顺序性, 因为线程是并发的, 思考的方法是: 设置一个主线程进行管理, 然后他们的线程工作</p></blockquote>\n<h1>4. 通用的多线程爬虫小模版</h1>\n<p>下面是根据上面的爬虫做了点小改动后形成的模板</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae0f57377196805\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport threading\r\nimport time\r\nimport Queue\r\n\r\nSHARE_Q = Queue.Queue()  #构造一个不限制大小的的队列\r\n_WORKER_THREAD_NUM = 3  #设置线程的个数\r\n\r\nclass MyThread(threading.Thread) :\r\n    \"\"\"\r\n\r\n    doc of class\r\n\r\n    Attributess:\r\n        func: 线程函数逻辑\r\n    \"\"\"\r\n    def __init__(self, func) :\r\n        super(MyThread, self).__init__()  #调用父类的构造函数\r\n        self.func = func  #传入线程函数逻辑\r\n\r\n    def run(self) :\r\n        \"\"\"\r\n        重写基类的run方法\r\n\r\n        \"\"\"\r\n        self.func()\r\n\r\ndef do_something(item) :\r\n    \"\"\"\r\n    运行逻辑, 比如抓站\r\n    \"\"\"\r\n    print item\r\n\r\ndef worker() :\r\n    \"\"\"\r\n    主要用来写工作逻辑, 只要队列不空持续处理\r\n    队列为空时, 检查队列, 由于Queue中已经包含了wait,\r\n    notify和锁, 所以不需要在取任务或者放任务的时候加锁解锁\r\n    \"\"\"\r\n    global SHARE_Q\r\n    while True : \r\n        if not SHARE_Q.empty():\r\n            item = SHARE_Q.get() #获得任务\r\n            do_something(item)\r\n            time.sleep(1)\r\n            SHARE_Q.task_done()\r\n\r\n\r\ndef main() :\r\n    global SHARE_Q\r\n    threads = []\r\n    #向队列中放入任务, 真正使用时, 应该设置为可持续的放入任务\r\n    for task in xrange(5) :   \r\n        SHARE_Q.put(task)\r\n    #开启_WORKER_THREAD_NUM个线程\r\n    for i in xrange(_WORKER_THREAD_NUM) :\r\n        thread = MyThread(worker)\r\n        thread.start()  #线程开始处理任务\r\n        threads.append(thread)\r\n    for thread in threads :\r\n        thread.join()\r\n    #等待所有任务完成\r\n    SHARE_Q.join()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae0f57377196805-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae0f57377196805-68\">68</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-8\"><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#构造一个不限制大小的的队列</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-9\"><span class=\"crayon-v\">_WORKER_THREAD_NUM</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置线程的个数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-14\"><span class=\"crayon-s\">    doc of class</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-16\"><span class=\"crayon-s\">    Attributess:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-17\"><span class=\"crayon-s\">        func: 线程函数逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-18\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#调用父类的构造函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#传入线程函数逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-22\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-25\"><span class=\"crayon-s\">        重写基类的run方法</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-26\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-27\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-30\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">do_something</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-32\"><span class=\"crayon-s\">    运行逻辑, 比如抓站</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-33\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-36\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-38\"><span class=\"crayon-s\">    主要用来写工作逻辑, 只要队列不空持续处理</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-39\"><span class=\"crayon-s\">    队列为空时, 检查队列, 由于Queue中已经包含了wait,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-40\"><span class=\"crayon-s\">    notify和锁, 所以不需要在取任务或者放任务的时候加锁解锁</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-41\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-43\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获得任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">do_something</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task_done</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-49\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-50\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-51\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-53\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#向队列中放入任务, 真正使用时, 应该设置为可持续的放入任务</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#开启_WORKER_THREAD_NUM个线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_WORKER_THREAD_NUM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#线程开始处理任务</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threads</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#等待所有任务完成</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-66\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae0f57377196805-67\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae0f57377196805-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p></p>\n<blockquote><p>我感觉其实这个多线程挺凌乱的, 希望以后自己能重构</p></blockquote>\n<h1>5. 思考更高效的爬虫方法</h1>\n<ul>\n<li>使用<a href=\"https://twistedmatrix.com/trac/wiki/Documentation\" target=\"_blank\">twisted</a>进行异步IO抓取</li>\n<li>使用<strong>Scrapy</strong>框架(Scrapy 使用了 Twisted 异步网络库来处理网络通讯)</li>\n</ul>\n<h1>6. 参考链接</h1>\n<ul>\n<li><a href=\"https://docs.python.org/2/library/queue.html\" target=\"_blank\">Queue官方文档</a></li>\n<li><a href=\"http://krondo.com/blog/?page_id=1327\" target=\"_blank\">Twisted英文入门指南</a></li>\n<li><a href=\"http://turtlerbender007.appspot.com/twisted/index.html\" target=\"_blank\">Twisted中文入门指南</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88413\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88413votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88413\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "系列教程,多线程,爬虫", "url_object_id": "31bc1e6431af20297c28c17e74d44ded", "praise_nums": "1", "url": "http://python.jobbole.com/88413/", "title": "Python 爬虫 (五) --多线程续 (Queue )", "create_date": "2017/08/27", "comment_nums": 3}
{"fav_nums": 6, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.keakon.net/2017/06/28/%E7%94%A8Python3%E7%9A%84async/await%E5%81%9A%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B\">keakon的涂鸦馆</a>   </div><p>前年我曾写过一篇<a href=\"/2015/09/07/%E5%88%9D%E6%8E%A2Python3%E7%9A%84%E5%BC%82%E6%AD%A5IO%E7%BC%96%E7%A8%8B\">《初探 Python 3 的异步 IO 编程》</a>，当时只是初步接触了一下 <strong>yield from</strong> 语法和 <strong>asyncio</strong> 标准库。前些日子我在 V2EX 看到一篇<a href=\"https://www.v2ex.com/t/369299\">《为什么只有基于生成器的协程可以真正的暂停执行并强制性返回给事件循环？》</a>，激起了我再探 Python 3 异步编程的兴趣。然而看了很多文章和，才发现极少提到 <strong>async</strong> 和 <strong>await</strong> 实际意义的，绝大部分仅止步于对 <strong>asyncio</strong> 库的使用，真正有所帮助的只有<a href=\"https://snarky.ca/how-the-heck-does-async-await-work-in-python-3-5/\">《How the heck does async/await work in Python 3.5?》</a>和<a href=\"https://github.com/AndreLouisCaron/a-tale-of-event-loops\">《A tale of event loops》</a>这两篇。</p>\n<p>在接着写下去之前，我先列举一些 PEPs 以供参考：</p>\n<ul>\n<li><a href=\"https://www.python.org/dev/peps/pep-0255/\">PEP 255 — Simple Generators</a></li>\n<li><a href=\"https://www.python.org/dev/peps/pep-0342/\">PEP 342 — Coroutines via Enhanced Generators</a></li>\n<li><a href=\"https://www.python.org/dev/peps/pep-0380/\">PEP 380 — Syntax for Delegating to a Subgenerator</a></li>\n<li><a href=\"https://www.python.org/dev/peps/pep-0492/\">PEP 492 — Coroutines with async and await syntax</a></li>\n<li><a href=\"https://www.python.org/dev/peps/pep-0525/\">PEP 525 — Asynchronous Generators</a></li>\n</ul>\n<p>从这些 PEPs 中可以看出 Python 生成器 / 协程的发展历程：先是 PEP 255 引入了简单的生成器；接着 PEP 342 赋予了生成器 <strong>send()</strong> 方法，使其可以传递数据，协程也就有了实际意义；接下来，PEP 380 增加了 <strong>yield from</strong> 语法，简化了调用子生成器的语法；然后，PEP 492 将协程和生成器区分开，使得其更不易被用错；最后，PEP 525 提供了异步生成器，使得编写异步的数据产生器得到简化。</p>\n<p>本文将简单介绍一下这些 PEPs，着重深入的则是 PEP 492。</p>\n<p>首先提一下生成器（generator）。</p>\n<p>Generator function 是函数体里包含 <strong>yield</strong> 表达式的函数，它在调用时生成一个 generator 对象（以下将其命名为 <strong>gen</strong>）。第一次调用 <strong>next(gen)</strong> 或 <strong>gen.send(None)</strong> 时，将进入它的函数体：在执行到 <strong>yield</strong> 表达式时，向调用者返回数据；当函数返回时，抛出 <strong>StopIteration</strong> 异常。在该函数未执行完之前，可再次调用 <strong>next(gen)</strong> 进入函数体，也可调用 <strong>gen.send(value)</strong> 向其传递参数，以供其使用（例如提供必要的数据，或者控制其行为等）。</p>\n<p>由于它主要的作用是产生一系列数据，所以一般使用 <strong>for … in gen</strong> 的语法来遍历它，以简化 <strong>next()</strong> 的调用和手动捕捉 <strong>StopIteration</strong> 异常。<br>\n即：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6262086803010\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile True:\r\n    try:\r\n        value = next(gen)\r\n        process(value)\r\n    except StopIteration:\r\n        break</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6262086803010-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6262086803010-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6262086803010-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6262086803010-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6262086803010-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6262086803010-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6262086803010-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6262086803010-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6262086803010-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">gen</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6262086803010-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6262086803010-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StopIteration</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6262086803010-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">break</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>可以简化为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae626d013125132\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor value in gen:\r\n    process(value)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae626d013125132-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae626d013125132-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae626d013125132-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gen</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae626d013125132-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">process</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>由于生成器提供了再次进入一个函数体的机制，其实它已经可以当成协程来使用了。<br>\n写个很简单的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6271272548076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport select\r\nimport socket\r\n\r\n\r\ndef coroutine():\r\n    sock = socket.socket()\r\n    sock.setblocking(0)\r\n    address = yield sock\r\n    try:\r\n        sock.connect(address)\r\n    except BlockingIOError:\r\n        pass\r\n    data = yield\r\n    size = yield sock.send(data)\r\n    yield sock.recv(size)\r\n\r\n\r\ndef main():\r\n    coro = coroutine()\r\n    sock = coro.send(None)\r\n    wait_list = (sock.fileno(),)\r\n    coro.send(('www.baidu.com', 80))\r\n    select.select((), wait_list, ())\r\n    coro.send(b'GET / HTTP/1.1\\r\\nHost: www.baidu.com\\r\\nConnection: Close\\r\\n\\r\\n')\r\n    select.select(wait_list, (), ())\r\n    print(coro.send(1024))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6271272548076-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6271272548076-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">select</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sock</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-9\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">yield</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-18\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">coro</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wait_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fileno</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'www.baidu.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wait_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'GET / HTTP/1.1\\r\\nHost: www.baidu.com\\r\\nConnection: Close\\r\\n\\r\\n'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6271272548076-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wait_list</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6271272548076-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">coro</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0100 seconds] -->\r\n<p>这里的 <strong>coroutine</strong> 函数用于处理连接和收发数据，而 <strong>main</strong> 函数则等待读写和传递参数。虽然看上去和同步的调用没啥区别，但其实在 <strong>main</strong> 函数中可以同时执行多个 <strong>coroutine</strong>，以实现并发执行。</p>\n<p>再说一下 <strong>yield from</strong>。</p>\n<p>如果一个生成器内部需要遍历另一个生成器，并将数据返回给调用者，你需要遍历它并处理所遇到的异常；而用了 <strong>yield from</strong> 后，则可以一行代码解决这些问题。具体例子就不列出了，PEP 380 里有详细的代码。</p>\n<p>这对于协程而言也是一个利好，这使得它的调用也得到了简化：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6275172996517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef coroutine():\r\n    ...\r\n\r\ndef caller():\r\n    yield from coroutine()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6275172996517-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6275172996517-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6275172996517-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6275172996517-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6275172996517-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6275172996517-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6275172996517-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6275172996517-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6275172996517-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">caller</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6275172996517-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>接下来就该轮到协程（coroutine）登场了。</p>\n<p>从上文也可看出，调用 <strong>yield from gen</strong> 时，我无法判定我是遍历了一个生成器，还是调用了一个协程，这种混淆使得接口的设计者和使用者需要花费额外的工夫来约定和检查。</p>\n<p>于是 Python 又先后添加了 <strong>asyncio.coroutine</strong> 和 <strong>types.coroutine</strong> 这两个装饰器来标注协程，这样就使得需要使用协程时，不至于误用了生成器。顺带一提，前者是 asyncio 库的实现，需要保持向下兼容，本文暂不讨论；后者则是 Python 3.5 的语言实现，实际上是给函数的 <strong>__code__.co_flags</strong> 设置 <strong>CO_ITERABLE_COROUTINE</strong> 标志。随后，<strong>async def</strong> 也被引入以用于定义协程，它则是设置 <strong>CO_COROUTINE</strong> 标志。</p>\n<p>至此，协程和生成器就得以区分，其中以 <strong>types.coroutine</strong> 定义的协程称为基于生成器的协程（generator-based coroutine），而以 <strong>async def</strong> 定义的协程则称为原生协程（native coroutine）。</p>\n<p>这两种协程之间的区别其实并不大，非要追究的话，主要有这些：</p>\n<ul>\n<li>原生协程里不能有 <strong>yield</strong> 或 <strong>yield from</strong> 表达式。</li>\n<li>原生协程被垃圾回收时，如果它从来没被使用过（即调用 <strong>await coro</strong> 或 <strong>coro.send(None)</strong>），会抛出 <strong>RuntimeWarning</strong>。</li>\n<li>原生协程没有实现 <strong>__iter__</strong> 和 <strong>__next__</strong> 方法。</li>\n<li>简单的生成器（非协程）不能 <strong>yield from</strong> 原生协程</li>\n<li>对原生协程及其函数分别调用 <strong>inspect.isgenerator()</strong> 和 <strong>inspect.isgeneratorfunction()</strong> 将返回 <strong>False</strong>。</li>\n</ul>\n<p>实际使用时，如果不考虑向下兼容，可以都用原生协程，除非这个协程里用到了 <strong>yield</strong> 或 <strong>yield from</strong> 表达式。</p>\n<p>定义了协程函数以后，就可以调用它们了。<br>\nPEP 492 也引入了一个 <strong>await</strong> 表达式来调用协程，它的用法和 <strong>yield from</strong> 差不多，但是它只能在协程函数内部使用，且只能接 awaitable 的对象。<br>\n所谓 awaitable 的对象，就是其 <strong>__await__</strong> 方法返回一个迭代器的对象。原生协程和基于生成器的协程都是 awaitable 的对象。<br>\n另一种调用协程的方法则和生成器一样，调用其 <strong>send</strong> 方法，并自行迭代。这种方式主要用于在非协程函数里调用协程。</p>\n<p>举例来说，调用的代码会类似这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae627b339894333\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@types.coroutine\r\ndef generator_coroutine():\r\n    yield 1\r\n\r\nasync def native_coroutine():\r\n    await generator_coroutine()\r\n\r\ndef main():\r\n    native_coroutine().send(None)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae627b339894333-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627b339894333-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627b339894333-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627b339894333-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627b339894333-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627b339894333-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627b339894333-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627b339894333-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627b339894333-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae627b339894333-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">types</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">coroutine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627b339894333-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">generator_coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627b339894333-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627b339894333-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627b339894333-5\"><span class=\"crayon-e\">async </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">native_coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627b339894333-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">generator_coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627b339894333-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627b339894333-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627b339894333-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">native_coroutine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>其中 <strong>generator_coroutine</strong> 函数里因为用到了 <strong>yield</strong> 表达式，所以只能定义成基于生成器的协程；<strong>native_coroutine</strong> 函数由于自身是协程,可以直接用 <strong>await</strong> 表达式调用其他协程；<strong>main</strong> 函数由于不是协程，因而需要用 <strong>native_coroutine().send(None)</strong> 这种方式来调用协程。</p>\n<p>这个例子其实也解释了 V2EX 里提到的那个问题，即为什么原生协程不能「真正的暂停执行并强制性返回给事件循环」。</p>\n<p>假设事件循环在 <strong>main</strong> 函数里，原生协程是 <strong>native_coroutine</strong> 函数，那要怎么才能让它暂停并返回 <strong>main</strong> 函数呢？</p>\n<p>很显然 <strong>await generator_coroutine()</strong> 是不行的，这会进入 <strong>generator_coroutine</strong> 的函数体，而不是回到 <strong>main</strong> 函数；如果 <strong>yield</strong> 一个值，又会遇到之前提到的一个限制，即原生协程里不能有 <strong>yield</strong> 表达式；最后仅剩 <strong>return</strong> 或 <strong>raise</strong> 这两种选择了，但它们虽然能回到 <strong>main</strong> 函数，却也不是「暂停」，因为再也没法「继续」了。</p>\n<p>所以一般而言，如果要用 Python 3.5 来做异步编程的话，最外层的事件循环需要调用协程的 <strong>send</strong> 方法，里面大部分的异步方法都可以用原生协程来实现，但最底层的异步方法则需要用基于生成器的协程。</p>\n<p>为了有个更直观的认识，再来举个例子，抓取 10 个百度搜索的页面：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae627f486226093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom selectors import DefaultSelector, EVENT_READ, EVENT_WRITE\r\nimport socket\r\nfrom types import coroutine\r\nfrom urllib.parse import urlparse\r\n\r\n\r\n@coroutine\r\ndef until_readable(fileobj):\r\n    yield fileobj, EVENT_READ\r\n\r\n\r\n@coroutine\r\ndef until_writable(fileobj):\r\n    yield fileobj, EVENT_WRITE\r\n\r\n\r\nasync def connect(sock, address):\r\n    try:\r\n        sock.connect(address)\r\n    except BlockingIOError:\r\n        await until_writable(sock)\r\n\r\n\r\nasync def recv(fileobj):\r\n    result = b''\r\n    while True:\r\n        try:\r\n            data = fileobj.recv(4096)\r\n            if not data:\r\n                return result\r\n            result += data\r\n        except BlockingIOError:\r\n            await until_readable(fileobj)\r\n\r\n\r\nasync def send(fileobj, data):\r\n    while data:\r\n        try:\r\n            sent_bytes = fileobj.send(data)\r\n            data = data[sent_bytes:]\r\n        except BlockingIOError:\r\n            await until_writable(fileobj)\r\n\r\n\r\nasync def fetch_url(url):\r\n    parsed_url = urlparse(url)\r\n    if parsed_url.port is None:\r\n        port = 443 if parsed_url.scheme == 'https' else 80\r\n    else:\r\n        port = parsed_url.port\r\n\r\n    with socket.socket() as sock:\r\n        sock.setblocking(0)\r\n        await connect(sock, (parsed_url.hostname, port))\r\n        path = parsed_url.path if parsed_url.path else '/'\r\n        path_with_query = '{}?{}'.format(path, parsed_url.query) if parsed_url.query else path\r\n        await send(sock, 'GET {} HTTP/1.1\\r\\nHost: {}\\r\\nConnection: Close\\r\\n\\r\\n'.format(path_with_query, parsed_url.netloc).encode())\r\n        content = await recv(sock)\r\n        print('{}: {}'.format(url, content))\r\n\r\n\r\ndef main():\r\n    urls = ['http://www.baidu.com/s?wd={}'.format(i) for i in range(10)]\r\n    tasks = [fetch_url(url) for url in urls]  # 将任务定义成协程对象\r\n\r\n    with DefaultSelector() as selector:\r\n        while tasks or selector.get_map():  # 有要做的任务，或者有等待的 IO 事件\r\n            events = selector.select(0 if tasks else 1)  # 如果有要做的任务，立刻获得当前已就绪的 IO 事件，否则最多等待 1 秒\r\n            for key, event in events:\r\n                task = key.data\r\n                tasks.append(task)  # IO 事件已就绪，可以执行新 task 了\r\n                selector.unregister(key.fileobj)  # 取消注册，避免重复执行\r\n\r\n            for task in tasks:\r\n                try:\r\n                    fileobj, event = task.send(None)  # 开始或继续执行 task\r\n                except StopIteration:\r\n                    pass\r\n                else:\r\n                    selector.register(fileobj, event, task)  # task 还未执行完，需要等待 IO，将 task 注册为 key.data\r\n\r\n            tasks.clear()\r\n\r\nmain()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae627f486226093-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae627f486226093-84\">84</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">selectors </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DefaultSelector</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EVENT_WRITE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">types</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">coroutine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urlparse</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">coroutine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">until_readable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EVENT</span><span class=\"crayon-sy\">_</span>READ</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-12\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">coroutine</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-13\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">until_writable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EVENT_WRITE</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-17\"><span class=\"crayon-e\">async </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">until_writable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-22\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-24\"><span class=\"crayon-e\">async </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4096</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">result</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-31\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-32\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">until_readable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-34\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-36\"><span class=\"crayon-e\">async </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sent_bytes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sent_bytes</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">until_writable</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-44\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-45\"><span class=\"crayon-e\">async </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fetch_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urlparse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">port </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">443</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">scheme</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">port</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-52\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hostname</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">path </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">path </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">path_with_query</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{}?{}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">query </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-57\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'GET {} HTTP/1.1\\r\\nHost: {}\\r\\nConnection: Close\\r\\n\\r\\n'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path_with_query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netloc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'{}: {}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-60\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-61\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-62\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'http://www.baidu.com/s?wd={}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">fetch_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 将任务定义成协程对象</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-65\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DefaultSelector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selector</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 有要做的任务，或者有等待的 IO 事件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-68\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 如果有要做的任务，立刻获得当前已就绪的 IO 事件，否则最多等待 1 秒</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-69\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">event </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-70\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-71\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># IO 事件已就绪，可以执行新 task 了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-72\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">selector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 取消注册，避免重复执行</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-74\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-75\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-76\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 开始或继续执行 task</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-77\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StopIteration</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-78\"><span class=\"crayon-h\">                    </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-79\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-80\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">selector</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">event</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># task 还未执行完，需要等待 IO，将 task 注册为 key.data</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-81\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-82\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae627f486226093-83\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae627f486226093-84\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0235 seconds] -->\r\n<p>其他的函数都没什么好说的，主要解释下 <strong>until_readable</strong>、<strong>until_writable</strong> 和 <strong>main</strong> 函数。<br>\n其实 <strong>until_readable</strong> 和 <strong>until_writable</strong> 函数都是 <strong>yield</strong> 一个 <strong>(fileobj, event)</strong> 元组，用于告知事件循环，这个 <strong>fileobj</strong> 的 <strong>event</strong> 事件需要被监听。</p>\n<p>而在 <strong>main</strong> 函数中，事件循环遍历并执行 <strong>tasks</strong> 里包含的协程。这些协程在等待 IO 时返回事件循环，由事件循环注册事件及其对应的协程。到下一个事件循环时，取出所有就绪的事件，继续执行其对应的协程，就完成了整个的异步执行过程。</p>\n<p>如果关注到 <strong>fetch_url</strong> 函数，就会发现业务逻辑用到的代码其实挺简单，只是 <strong>await</strong> 异步函数而已。这虽然简化了大部分的开发工作，但其实也限制了它的表达能力，因为在一个协程内，不能同时 <strong>await</strong> 多个异步函数——它实际上是顺序执行的，只是不同协程之间可以异步执行而已。</p>\n<p>考虑一个 HTTP/2 的客户端，它和服务器之间的连接是多路复用的，也就是可以在一个连接里同时发出和接收多份数据，而这些数据的传输是乱序的。如果一份 JavaScript 资源已经下载完毕，没必要再等其他的图片资源下载完毕才能执行。要做到这点，就需要协程有并发执行多个子协程，共同完成任务的能力。这在使用多线程或回调函数时是很容易做到的，但使用 <strong>await</strong> 就显得捉襟见肘了。倒也不是不能做，只是需要拿之前的代码改下，<strong>yield</strong> 一些子协程，并在事件循环中判断一下类型就行了。</p>\n<p>虽然仅用上述提到的东西，已经能做异步编程了，但我还是得补充 2 个漏掉的语法知识：</p>\n<p><strong>1.async with</strong><br>\n先考虑普通的 <strong>with</strong> 语句，它的主要作用是在进入和退出一个区域时，做一些初始化和清理工作。<br>\n例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6285781259123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('1.txt')\r\ntry:\r\n    content = f.read()\r\nfinally:\r\n    f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6285781259123-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6285781259123-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6285781259123-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6285781259123-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6285781259123-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6285781259123-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6285781259123-2\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6285781259123-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6285781259123-4\"><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6285781259123-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>就可以改写为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6289547412609\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open('1.txt') as f:\r\n    content = f.read()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6289547412609-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6289547412609-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6289547412609-1\"><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6289547412609-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>这里要求 <strong>open</strong> 函数返回的 <strong>f</strong> 对象带有 <strong>__enter__</strong> 和 <strong>__exit__</strong> 方法。其中，<strong>__enter__</strong> 方法只需要返回一个文件对象就行了，<strong>__exit__</strong> 则需要调用这个文件对象的 <strong>close</strong> 方法。类似的，假设这个 <strong>open</strong> 函数和 <strong>close</strong> 方法变成了异步的，你的代码可能是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae628c471706876\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = await async_open('1.txt')\r\ntry:\r\n    content = await f.read()\r\nfinally:\r\n    await f.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae628c471706876-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae628c471706876-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae628c471706876-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae628c471706876-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae628c471706876-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae628c471706876-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-e\">async_open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae628c471706876-2\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae628c471706876-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">await</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae628c471706876-4\"><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae628c471706876-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">await</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>你就可以用 <strong>async with</strong> 来改写它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae628f324799669\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nasync with async_open('1.txt') as f:\r\n    content = await f.read()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae628f324799669-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae628f324799669-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae628f324799669-1\"><span class=\"crayon-e\">async </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">async_open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae628f324799669-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">await</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>相应的，<strong>async_open</strong> 函数返回的 <strong>f</strong> 对象需要实现 <strong>__aenter__</strong> 和 <strong>__aexit__</strong> 这 2 个异步方法。</p>\n<p><strong>2.async for</strong><br>\n这里也先考虑普通的 <strong>for</strong> 语句，它的主要作用是遍历一个迭代器。<br>\n例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6292278723274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('1.txt')\r\nit = iter(f)\r\nwhile True:\r\n    try:\r\n        print(next(it))\r\n    except StopIteration:\r\n        break</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6292278723274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6292278723274-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6292278723274-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6292278723274-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6292278723274-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6292278723274-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6292278723274-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6292278723274-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6292278723274-2\"><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">iter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6292278723274-3\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6292278723274-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6292278723274-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">next</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6292278723274-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StopIteration</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6292278723274-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">break</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>可以改写为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6296373323080\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('1.txt')\r\nfor line in f:\r\n    print(line)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6296373323080-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6296373323080-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6296373323080-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6296373323080-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6296373323080-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6296373323080-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这里要求 <strong>open</strong> 函数返回的 <strong>f</strong> 对象返回一个迭代器对象，即实现了 <strong>__iter__</strong> 方法，这个方法要返回一个实现了 <strong>__next__</strong> 方法的对象。而 <strong>__next__</strong> 方法在每次调用时，都返回下一行的文件内容，直到文件结束时抛出 <strong>StopIteration</strong> 异常。类似的，假如 <strong>__next__</strong> 方法变成了异步的，你的代码可能是这样的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae6299360799648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('1.txt')\r\nit = iter(f)\r\nwhile True:\r\n    try:\r\n        line = await it.__anext__()\r\n        print(line)\r\n    except StopAsyncIteration:\r\n        break</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae6299360799648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6299360799648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6299360799648-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6299360799648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6299360799648-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6299360799648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae6299360799648-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae6299360799648-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae6299360799648-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6299360799648-2\"><span class=\"crayon-v\">it</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">iter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6299360799648-3\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6299360799648-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6299360799648-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">await </span><span class=\"crayon-v\">it</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__anext__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6299360799648-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae6299360799648-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StopAsyncIteration</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae6299360799648-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">break</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>你可以用 <strong>async with</strong> 来改写它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beae629c184686429\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nf = open('1.txt')\r\nasync for line in f:\r\n    print(line)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beae629c184686429-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beae629c184686429-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beae629c184686429-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beae629c184686429-1\"><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beae629c184686429-2\"><span class=\"crayon-e\">async </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beae629c184686429-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">line</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>相应的，所需实现的方法分别变成了 <strong>__aiter__</strong> 和 <strong>__anext__</strong>。其中，后者是异步方法。顺带一提，PEP 525 引入的异步生成器（asynchronous generator）就实现了这两个方法。在异步方法中使用 <strong>yield</strong> 表达式，会将它变成异步生成器函数（Python 3.6 以后可用，3.5 之前是语法错误）。值得注意的是，异步生成器没有实现 <strong>__await__</strong> 方法，因此它不是协程，也不能被 <strong>await</strong>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88427\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88427votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88427\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/12/6da94dec8f6f96417f14c8291e634580.png"], "tags": "基础知识,异步", "url_object_id": "28b55dc694a0f24e7207658848559e16", "praise_nums": "1", "url": "http://python.jobbole.com/88427/", "title": "用 Python 3 的 async / await 做异步编程", "create_date": "2017/08/27", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010895903\">一曲广陵散</a>   </div><h1>一, 引用</h1>\n<blockquote><p><a href=\"https://book.douban.com/subject/27028517/\">[书] 流畅的Python</a></p>\n<p><a href=\"https://book.douban.com/subject/26709315/\">[书] Effective Python</a></p></blockquote>\n<hr>\n<h1>二, 基本概念</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2b40543f2ca8191002fc449a3ef4a516.png\"><img class=\"aligncenter size-full wp-image-88513\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2b40543f2ca8191002fc449a3ef4a516.png\" alt=\"2372598012-59a77c7d2a7de_articlex\"></a></p>\n<p><strong>问题１：</strong>装饰器是什么？</p>\n<p><strong>解答：　</strong>严格来说，装饰器只是语法糖，　装饰器是可调用的对象，可以像常规的可调用对象那样调用，特殊的地方是装饰器的参数是一个函数</p>\n<p><strong>问题２：</strong>装饰器有什么特性？</p>\n<p><strong>解答：</strong>　装饰器有２个特性，一是可以把被装饰的函数替换成其他函数，　二是可以在加载模块时候立即执行</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beb08b42005769968\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef decorate(func):\r\n    print('running decorate', func)\r\n    def decorate_inner():\r\n        print('running decorate_inner function')\r\n        return func()\r\n    return decorate_inner\r\n\r\n&lt;a href=\"http://www.jobbole.com/members/decorate\"&gt;@decorate&lt;/a&gt;\r\ndef func_1():\r\n    print('running func_1')\r\n\r\nif __name__ == '__main__':\r\n\r\n    print(func_1)\r\n\r\n＃返回值\r\nrunning decorate &lt;function func_1 at 0x7f29f644d268&gt;\r\n&lt;function decorate.&lt;locals&gt;.decorate_inner at 0x7f29f641cb70&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b42005769968-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b42005769968-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running decorate'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate_inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running decorate_inner function'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorate_inner</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/decorate\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">decorate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-9\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running func_1'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-12\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func_1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-16\">＃返回值</div><div class=\"crayon-line\" id=\"crayon-59d04beb08b42005769968-17\"><span class=\"crayon-e\">running </span><span class=\"crayon-v\">decorate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">func_1 </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f29f644d268</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b42005769968-18\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">decorate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decorate_inner </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f29f641cb70</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p><strong>问题３：</strong>如何使用被装饰函数中的参数？</p>\n<p><strong>解答：</strong>　通过<em>args 和　</em>*kwargs 传递被修饰函数中的参数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beb08b56285736341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef decorate(func):\r\n    def decorate_inner(*args, **kwargs):\r\n        print(type(args), type(kwargs))\r\n        print('args', args, 'kwargs', kwargs)\r\n        return func(*args, **kwargs)\r\n    return decorate_inner\r\n\r\n&lt;a href=\"http://www.jobbole.com/members/decorate\"&gt;@decorate&lt;/a&gt;\r\ndef func_1(*args, **kwargs):\r\n    print(args, kwargs)\r\n\r\nif __name__ == '__main__':\r\n\r\n    func_1('1', '2', '3', para_1='1', para_2='2', para_3='3')\r\n\r\n#返回值\r\n&lt;class 'tuple'&gt; &lt;class 'dict'&gt;\r\nargs ('1', '2', '3') kwargs {'para_2': '2', 'para_1': '1', 'para_3': '3'}\r\n('1', '2', '3') {'para_2': '2', 'para_1': '1', 'para_3': '3'}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b56285736341-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b56285736341-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate_inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'args'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'kwargs'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorate_inner</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/decorate\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">decorate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-9\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-12\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">func_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">para_1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">para_2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">para_3</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-16\"><span class=\"crayon-c\">#返回值</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-17\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tuple'</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'dict'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b56285736341-18\"><span class=\"crayon-e\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">kwargs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'para_2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'para_1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'para_3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b56285736341-19\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'para_2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'para_1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'para_3'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3'</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p></p>\n<hr>\n<h1>三, 叠放装饰器</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/66b534974698f2d1421c0deeec810049.jpg\"><img class=\"aligncenter size-full wp-image-88514\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/66b534974698f2d1421c0deeec810049.jpg\" alt=\"3981774596-59a44a325eb8d_articlex\"></a></p>\n<p><strong>问题１：</strong>叠放装饰器执行顺序是什么？</p>\n<p><strong>解答：　</strong>如果一个函数被多个装饰器修饰，其实应该是该函数先被最里面的装饰器修饰后（下面例子中函数main()先被inner装饰，变成新的函数），变成另一个函数后，再次被装饰器修饰</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beb08b5f699316911\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef outer(func):\r\n    print('enter outer', func)\r\n    def wrapper():\r\n        print('running outer')\r\n        func()\r\n    return wrapper\r\n\r\ndef inner(func):\r\n    print('enter inner', func)\r\n    def wrapper():\r\n        print('running inner')\r\n        func()\r\n    return wrapper\r\n\r\n@outer\r\n@inner\r\ndef main():\r\n    print('running main')\r\n\r\nif __name__ == '__main__':\r\n\r\n    main()\r\n\r\n＃返回值\r\n\r\nenter inner &lt;function main at 0x7fa1c96e8b70&gt;\r\nenter outer &lt;function inner.&lt;locals&gt;.wrapper at 0x7fa1c96e8bf8&gt;\r\nrunning outer\r\nrunning inner\r\nrunning main</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b5f699316911-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b5f699316911-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'enter outer'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running outer'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrapper</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'enter inner'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running inner'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">wrapper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-15\"><span class=\"crayon-sy\">@</span><span class=\"crayon-i\">outer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-16\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">inner</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-17\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running main'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-20\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-24\">＃返回值</div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-26\"><span class=\"crayon-e\">enter </span><span class=\"crayon-v\">inner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">main </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7fa1c96e8b70</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-27\"><span class=\"crayon-e\">enter </span><span class=\"crayon-v\">outer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-v\">inner</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wrapper </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7fa1c96e8bf8</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-28\"><span class=\"crayon-e\">running </span><span class=\"crayon-e\">outer</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b5f699316911-29\"><span class=\"crayon-e\">running </span><span class=\"crayon-e\">inner</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b5f699316911-30\"><span class=\"crayon-e\">running </span><span class=\"crayon-v\">main</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<hr>\n<h1>四, 标准库中的装饰器</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/c576ed1b9137db673453bbbd8f0c28e2.jpg\"><img class=\"aligncenter size-full wp-image-88515\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c576ed1b9137db673453bbbd8f0c28e2.jpg\" alt=\"3981774596-59a44a325eb8d_articlex\"></a></p>\n<p><strong>问题１：</strong>　标准库中都有哪些装饰器？</p>\n<p><strong>解答：</strong>　标准库中有多种装饰器，　例如：装饰方法的函数有property, classmethod, staticmethod；　functools模块中的lru_cache, singledispatch,  wraps 等等</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beb08b8a865605728\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom functools import lru_cache\r\nfrom functools import singledispatch\r\nfrom functools import wraps</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b8a865605728-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08b8a865605728-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08b8a865605728-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beb08b8a865605728-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">functools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lru_cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08b8a865605728-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">functools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">singledispatch</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08b8a865605728-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">functools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wraps</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><strong>问题２：</strong>为什么要使用@wraps装饰器？它的作用是什么？</p>\n<p><strong>解答：</strong>　使用装饰器会产生我们可能不希望出现的副作用，　例如：改变被修饰函数名称，对于调试器或者对象序列化器等需要使用内省机制的那些工具，可能会无法正常运行；其实调用装饰器后，会将同一个作用域中原来函数同名的那个变量（例如下面的func_1）,重新赋值为装饰器返回的对象；使用＠wraps后，会把与内部函数（被修饰函数，例如下面的func_1）相关的重要元数据全部复制到外围函数（例如下面的decorate_inner）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beb08bb3997240931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom functools import wraps\r\n\r\ndef decorate(func):\r\n    print('running decorate', func)\r\n    @wraps(func)\r\n    def decorate_inner():\r\n        print('running decorate_inner function', decorate_inner)\r\n        return func()\r\n    return decorate_inner\r\n\r\n&lt;a href=\"http://www.jobbole.com/members/decorate\"&gt;@decorate&lt;/a&gt;\r\ndef func_1():\r\n    print('running func_1', func_1)\r\n\r\nif __name__ == '__main__':\r\n\r\n    func_1()\r\n\r\n＃返回值\r\nrunning decorate &lt;function func_1 at 0x7f145d2c2268&gt;\r\nrunning decorate_inner function &lt;function func_1 at 0x7f145b9731e0&gt;\r\nrunning func_1 &lt;function func_1 at 0x7f145b9731e0&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beb08bb3997240931-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beb08bb3997240931-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">functools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wraps</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running decorate'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">wraps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">decorate_inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running decorate_inner function'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorate_inner</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorate_inner</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/decorate\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">decorate</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-12\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'running func_1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func_1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-15\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">func_1</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-18\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-19\">＃返回值</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-20\"><span class=\"crayon-e\">running </span><span class=\"crayon-v\">decorate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">func_1 </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f145d2c2268</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beb08bb3997240931-21\"><span class=\"crayon-e\">running </span><span class=\"crayon-e\">decorate_inner </span><span class=\"crayon-v\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">func_1 </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f145b9731e0</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beb08bb3997240931-22\"><span class=\"crayon-e\">running </span><span class=\"crayon-v\">func_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">function </span><span class=\"crayon-e\">func_1 </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f145b9731e0</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<hr>\n<h1>五, 装饰器设计模式</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/8f636b58340f9ace9f1cfe8090bb118d.jpg\"><img class=\"aligncenter size-full wp-image-88516\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8f636b58340f9ace9f1cfe8090bb118d.jpg\" alt=\"3981774596-59a44a325eb8d_articlex\"></a></p>\n<p><strong>问题１：</strong>　什么是装饰器设计模式？</p>\n<p><strong>解答：</strong>　动态的给一个对象添加一些额外的职责，就扩展功能而言，装饰器模式比子类化更加灵活，在设计模式中，装饰器和组件都是抽象类，为了给具体的组件添加行为，具体的装饰器实例要包装具体组件的实例，即，装饰器和所装饰的组件接口一致，对使用该组建的客户透明，将客户的请求转发给该组件，并且可能在转发前后执行一些额外的操作，透明性使得可以递归嵌套多个装饰器，从而可以添加任意多个功能</p>\n<p><strong>问题２：</strong>　Python中的装饰器函数和设计模式中的装饰器模式有什么关系？</p>\n<p><strong>解答：  </strong>修饰器模式和Python修饰器之间并不是一对一的等价关系，　Python装饰器函数更为强大，不仅仅可以实现装饰器模式。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88512\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88512votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88512\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/2b40543f2ca8191002fc449a3ef4a516.png"], "tags": "基础知识,装饰器", "url_object_id": "aa39557e65459f5d68f48929da8f58bc", "praise_nums": "1", "url": "http://python.jobbole.com/88512/", "title": "Python 装饰器", "create_date": "2017/09/05", "comment_nums": 1}
{"fav_nums": 7, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.lightxue.com/understand-python-decorator-the-easy-way\">0xFEE1C001</a>   </div><p>Python有大量强大又贴心的特性，如果要列个最受欢迎排行榜，那么装饰器绝对会在其中。</p>\n<p>刚接触装饰器，会觉得代码不多却难以理解。其实装饰器的语法本身挺简单的，复杂是因为同时混杂了其它的概念。下面我们一起抛去无关概念，简单地理解下Python的装饰器。</p>\n<h1>装饰器的原理</h1>\n<p>在解释器下跑个装饰器的例子，直观地感受一下。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc4a899630393\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# make_bold就是装饰器，实现方式这里略去\r\n&gt;&gt;&gt; @make_bold\r\n... def get_content():\r\n...     return 'hello world'\r\n...\r\n&gt;&gt;&gt; get_content()\r\n'&lt;b&gt;hello world&lt;/b&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc4a899630393-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc4a899630393-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc4a899630393-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc4a899630393-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc4a899630393-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc4a899630393-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc4a899630393-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc4a899630393-1\"><span class=\"crayon-p\"># make_bold就是装饰器，实现方式这里略去</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc4a899630393-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">make</span><span class=\"crayon-sy\">_</span>bold</div><div class=\"crayon-line\" id=\"crayon-59d04beaddc4a899630393-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc4a899630393-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc4a899630393-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc4a899630393-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc4a899630393-7\"><span class=\"crayon-s\">'&lt;b&gt;hello world&lt;/b&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n\n</div>\n<p>被<strong>make_bold</strong>装饰的<strong>get_content</strong>，调用后返回结果会自动被<strong>b</strong>标签包住。怎么做到的呢，简单4步就能明白了。</p>\n<h2>1. 函数是对象</h2>\n<p>我们定义个<strong>get_content</strong>函数。这时<strong>get_content</strong>也是个对象，它能做所有对象的操作。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc57603422331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef get_content():\r\n    return 'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc57603422331-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc57603422331-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc57603422331-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc57603422331-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>它有<strong>id</strong>，有<strong>type</strong>，有值。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc5b143305279\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; id(get_content)\r\n140090200473112\r\n&gt;&gt;&gt; type(get_content)\r\n&lt;class 'function'&gt;\r\n&gt;&gt;&gt; get_content\r\n&lt;function get_content at 0x7f694aa2be18&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc5b143305279-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc5b143305279-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc5b143305279-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc5b143305279-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc5b143305279-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc5b143305279-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc5b143305279-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">id</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc5b143305279-2\"><span class=\"crayon-cn\">140090200473112</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc5b143305279-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc5b143305279-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'function'</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc5b143305279-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc5b143305279-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f694aa2be18</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n\n</div>\n<p>跟其他对象一样可以被赋值给其它变量。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc5f164079943\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; func_name = get_content\r\n&gt;&gt;&gt; func_name()\r\n'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc5f164079943-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc5f164079943-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc5f164079943-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc5f164079943-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc5f164079943-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_name</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc5f164079943-3\"><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>它可以当参数传递，也可以当返回值</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc62511334877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; def foo(bar):\r\n...     print(bar())\r\n...     return bar\r\n...\r\n&gt;&gt;&gt; func = foo(get_content)\r\nhello world\r\n&gt;&gt;&gt; func()\r\n'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc62511334877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc62511334877-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc62511334877-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc62511334877-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc62511334877-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc62511334877-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc62511334877-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc62511334877-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc62511334877-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bar</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc62511334877-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">bar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc62511334877-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bar</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc62511334877-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc62511334877-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc62511334877-6\"><span class=\"crayon-e\">hello </span><span class=\"crayon-v\">world</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc62511334877-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc62511334877-8\"><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n\n</div>\n<h2>2. 自定义函数对象</h2>\n<p>我们可以用<strong>class</strong>来构造函数对象。有成员函数<strong>__call__</strong>的就是函数对象了，函数对象被调用时正是调用的<strong>__call__</strong>。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc65070506534\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass FuncObj(object):\r\n    def __init__(self, name):\r\n        print('Initialize')\r\n        self.name= name\r\n\r\n    def __call__(self):\r\n        print('Hi', self.name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc65070506534-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc65070506534-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc65070506534-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc65070506534-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc65070506534-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc65070506534-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc65070506534-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc65070506534-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FuncObj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc65070506534-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc65070506534-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Initialize'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc65070506534-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc65070506534-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc65070506534-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc65070506534-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hi'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>我们来调用看看。可以看到，<strong>函数对象的使用分两步：构造和调用</strong>(同学们注意了，这是考点)。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc69422839895\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; fo = FuncObj('python')\r\nInitialize\r\n&gt;&gt;&gt; fo()\r\nHi python</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc69422839895-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc69422839895-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc69422839895-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc69422839895-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc69422839895-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FuncObj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'python'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc69422839895-2\"><span class=\"crayon-v\">Initialize</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc69422839895-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc69422839895-4\"><span class=\"crayon-e\">Hi </span><span class=\"crayon-v\">python</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<h2>3. <strong>@</strong>是个语法糖</h2>\n<p>装饰器的<strong>@</strong>没有做什么特别的事，不用它也可以实现一样的功能，只不过需要更多的代码。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc6c190888226\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@make_bold\r\ndef get_content():\r\n    return 'hello world'\r\n\r\n# 上面的代码等价于下面的\r\n\r\ndef get_content():\r\n    return 'hello world'\r\nget_content = make_bold(get_content)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc6c190888226-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc6c190888226-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc6c190888226-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc6c190888226-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc6c190888226-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc6c190888226-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc6c190888226-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc6c190888226-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc6c190888226-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc6c190888226-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_bold</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc6c190888226-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc6c190888226-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc6c190888226-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc6c190888226-5\"><span class=\"crayon-p\"># 上面的代码等价于下面的</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc6c190888226-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc6c190888226-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc6c190888226-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc6c190888226-9\"><span class=\"crayon-v\">get_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p><strong>make_bold</strong>是个函数，要求入参是函数对象，返回值是函数对象。<strong>@</strong>的语法糖其实是省去了上面最后一行代码，使可读性更好。用了装饰器后，每次调用<strong>get_content</strong>，真正调用的是<strong>make_bold</strong>返回的函数对象。</p>\n<h2>4. 用类实现装饰器</h2>\n<p>入参是函数对象，返回是函数对象，如果第2步里的类的构造函数改成入参是个函数对象，不就正好符合要求吗？我们来试试实现<strong>make_bold</strong>。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc70390061965\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass make_bold(object):\r\n    def __init__(self, func):\r\n        print('Initialize')\r\n        self.func = func\r\n\r\n    def __call__(self):\r\n        print('Call')\r\n        return '&lt;b&gt;{}&lt;/b&gt;'.format(self.func())</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc70390061965-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc70390061965-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc70390061965-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc70390061965-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc70390061965-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc70390061965-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc70390061965-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc70390061965-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc70390061965-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc70390061965-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc70390061965-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Initialize'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc70390061965-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc70390061965-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc70390061965-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc70390061965-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Call'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc70390061965-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;b&gt;{}&lt;/b&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n\n</div>\n<p>大功告成，看看能不能用。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc73211737245\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; @make_bold\r\n... def get_content():\r\n...     return 'hello world'\r\n...\r\nInitialize\r\n&gt;&gt;&gt; get_content()\r\nCall\r\n'&lt;b&gt;hello world&lt;/b&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc73211737245-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc73211737245-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc73211737245-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc73211737245-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc73211737245-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc73211737245-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc73211737245-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc73211737245-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc73211737245-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">make</span><span class=\"crayon-sy\">_</span>bold</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc73211737245-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc73211737245-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc73211737245-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc73211737245-5\"><span class=\"crayon-v\">Initialize</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc73211737245-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc73211737245-7\"><span class=\"crayon-i\">Call</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc73211737245-8\"><span class=\"crayon-s\">'&lt;b&gt;hello world&lt;/b&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>成功实现装饰器！是不是很简单？</p>\n<p>这里分析一下之前强调的<strong>构造</strong>和<strong>调用</strong>两个过程。我们去掉<strong>@</strong>语法糖好理解一些。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc76323686472\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 构造，使用装饰器时构造函数对象，调用了__init__\r\n&gt;&gt;&gt; get_content = make_bold(get_content)\r\nInitialize\r\n\r\n# 调用，实际上直接调用的是make_bold构造出来的函数对象\r\n&gt;&gt;&gt; get_content()\r\nCall\r\n'&lt;b&gt;hello world&lt;/b&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc76323686472-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc76323686472-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc76323686472-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc76323686472-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc76323686472-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc76323686472-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc76323686472-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc76323686472-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc76323686472-1\"><span class=\"crayon-p\"># 构造，使用装饰器时构造函数对象，调用了__init__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc76323686472-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc76323686472-3\"><span class=\"crayon-v\">Initialize</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc76323686472-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc76323686472-5\"><span class=\"crayon-p\"># 调用，实际上直接调用的是make_bold构造出来的函数对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc76323686472-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc76323686472-7\"><span class=\"crayon-i\">Call</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc76323686472-8\"><span class=\"crayon-s\">'&lt;b&gt;hello world&lt;/b&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>到这里就彻底清楚了，完结撒花，可以关掉网页了~~~(如果只是想知道装饰器原理的话)</p>\n<h1>函数版装饰器</h1>\n<p>阅读源码时，经常见到用嵌套函数实现的装饰器，怎么理解？同样仅需4步。</p>\n<h2>1. <strong>def</strong>的函数对象初始化</h2>\n<p>用<strong>class</strong>实现的函数对象很容易看到什么时候<strong>构造</strong>的，那<strong>def</strong>定义的函数对象什么时候<strong>构造</strong>的呢？</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc7a262656763\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 这里的全局变量删去了无关的内容\r\n&gt;&gt;&gt; globals()\r\n{}\r\n&gt;&gt;&gt; def func():\r\n...     pass\r\n...\r\n&gt;&gt;&gt; globals()\r\n{'func': &lt;function func at 0x10f5baf28&gt;}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7a262656763-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7a262656763-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7a262656763-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7a262656763-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7a262656763-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7a262656763-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7a262656763-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7a262656763-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc7a262656763-1\"><span class=\"crayon-p\"># 这里的全局变量删去了无关的内容</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7a262656763-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc7a262656763-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7a262656763-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc7a262656763-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-i\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7a262656763-6\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc7a262656763-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">globals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7a262656763-8\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'func'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x10f5baf28</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n\n</div>\n<p>不像一些编译型语言，程序在启动时函数已经构造那好了。上面的例子可以看到，执行到<strong>def</strong>会才构造出一个函数对象，并赋值给变量<strong>make_bold</strong>。</p>\n<p>这段代码和下面的代码效果是很像的。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc7d881988440\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass NoName(object):\r\n    def __call__(self):\r\n        pass\r\n\r\nfunc = NoName()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7d881988440-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7d881988440-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7d881988440-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc7d881988440-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc7d881988440-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc7d881988440-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NoName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7d881988440-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc7d881988440-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc7d881988440-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc7d881988440-5\"><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NoName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n\n</div>\n<h2>2. 嵌套函数</h2>\n<p>Python的函数可以嵌套定义。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc80180673363\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef outer():\r\n    print('Before def:', locals())\r\n    def inner():\r\n        pass\r\n    print('After def:', locals())\r\n    return inner</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc80180673363-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc80180673363-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc80180673363-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc80180673363-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc80180673363-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc80180673363-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc80180673363-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc80180673363-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Before def:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc80180673363-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc80180673363-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">pass</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc80180673363-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'After def:'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc80180673363-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inner</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p><strong>inner</strong>是在<strong>outer</strong>内定义的，所以算<strong>outer</strong>的局部变量。执行到<strong>def inner</strong>时函数对象才创建，因此每次调用<strong>outer</strong>都会创建一个新的<strong>inner</strong>。下面可以看出，每次返回的<strong>inner</strong>是不同的。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc83272595345\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; outer()\r\nBefore def: {}\r\nAfter def: {'inner': &lt;function outer.&lt;locals&gt;.inner at 0x7f0b18fa0048&gt;}\r\n&lt;function outer.&lt;locals&gt;.inner at 0x7f0b18fa0048&gt;\r\n&gt;&gt;&gt; outer()\r\nBefore def: {}\r\nAfter def: {'inner': &lt;function outer.&lt;locals&gt;.inner at 0x7f0b18fa00d0&gt;}\r\n&lt;function outer.&lt;locals&gt;.inner at 0x7f0b18fa00d0&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc83272595345-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc83272595345-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc83272595345-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc83272595345-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc83272595345-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc83272595345-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc83272595345-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc83272595345-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc83272595345-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc83272595345-2\"><span class=\"crayon-e\">Before </span><span class=\"crayon-v\">def</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc83272595345-3\"><span class=\"crayon-e\">After </span><span class=\"crayon-v\">def</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'inner'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">inner </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f0b18fa0048</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc83272595345-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">inner </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f0b18fa0048</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc83272595345-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc83272595345-6\"><span class=\"crayon-e\">Before </span><span class=\"crayon-v\">def</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc83272595345-7\"><span class=\"crayon-e\">After </span><span class=\"crayon-v\">def</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'inner'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">inner </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f0b18fa00d0</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc83272595345-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">locals</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">inner </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f0b18fa00d0</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<h2>3. 闭包</h2>\n<p>嵌套函数有什么特别之处？因为有闭包。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc87066237612\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef outer():\r\n    msg = 'hello world'\r\n    def inner():\r\n        print(msg)\r\n    return inner</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc87066237612-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc87066237612-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc87066237612-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc87066237612-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc87066237612-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc87066237612-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc87066237612-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc87066237612-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">inner</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc87066237612-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc87066237612-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inner</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p>下面的试验表明，<strong>inner</strong>可以访问到<strong>outer</strong>的局部变量<strong>msg</strong>。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc8a613372875\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; func = outer()\r\n&gt;&gt;&gt; func()\r\nhello world</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc8a613372875-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc8a613372875-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc8a613372875-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc8a613372875-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">outer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc8a613372875-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc8a613372875-3\"><span class=\"crayon-e\">hello </span><span class=\"crayon-v\">world</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>闭包有2个特点</p>\n<ol>\n<li><strong>inner</strong>能访问<strong>outer</strong>及其祖先函数的命名空间内的变量(局部变量，函数参数)。</li>\n<li>调用<strong>outer</strong>已经返回了，但是它的命名空间被返回的<strong>inner</strong>对象引用，所以还不会被回收。</li>\n</ol>\n<p>这部分想深入可以去了解Python的LEGB规则。</p>\n<h2>4. 用函数实现装饰器</h2>\n<p>装饰器要求入参是函数对象，返回值是函数对象，嵌套函数完全能胜任。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc8d202146429\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef make_bold(func):\r\n    print('Initialize')\r\n    def wrapper():\r\n        print('Call')\r\n        return '&lt;b&gt;{}&lt;/b&gt;'.format(func())\r\n    return wrapper</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc8d202146429-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc8d202146429-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc8d202146429-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc8d202146429-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc8d202146429-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc8d202146429-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc8d202146429-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc8d202146429-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Initialize'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc8d202146429-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc8d202146429-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Call'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc8d202146429-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;b&gt;{}&lt;/b&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc8d202146429-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wrapper</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>用法跟类实现的装饰器一样。可以去掉<strong>@</strong>语法糖分析下<strong>构造</strong>和<strong>调用</strong>的时机。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc90658122170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; @make_bold\r\n... def get_content():\r\n...     return 'hello world'\r\n...\r\nInitialize\r\n&gt;&gt;&gt; get_content()\r\nCall\r\n'&lt;b&gt;hello world&lt;/b&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc90658122170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc90658122170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc90658122170-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc90658122170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc90658122170-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc90658122170-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc90658122170-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc90658122170-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc90658122170-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">make</span><span class=\"crayon-sy\">_</span>bold</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc90658122170-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc90658122170-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc90658122170-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc90658122170-5\"><span class=\"crayon-v\">Initialize</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc90658122170-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc90658122170-7\"><span class=\"crayon-i\">Call</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc90658122170-8\"><span class=\"crayon-s\">'&lt;b&gt;hello world&lt;/b&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n\n</div>\n<p>因为返回的<strong>wrapper</strong>还在引用着，所以存在于<strong>make_bold</strong>命名空间的<strong>func</strong>不会消失。<strong>make_bold</strong>可以装饰多个函数，<strong>wrapper</strong>不会调用混淆，因为每次调用<strong>make_bold</strong>，都会有创建新的命名空间和新的<strong>wrapper</strong>。</p>\n<p>到此函数实现装饰器也理清楚了，完结撒花，可以关掉网页了~~~(后面是使用装饰的常见问题)</p>\n<h1>常见问题</h1>\n<h2>1. 怎么实现带参数的装饰器？</h2>\n<p>带参数的装饰器，有时会异常的好用。我们看个例子。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc94074805233\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; @make_header(2)\r\n... def get_content():\r\n...     return 'hello world'\r\n...\r\n&gt;&gt;&gt; get_content()\r\n'&lt;h2&gt;hello world&lt;/h2&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc94074805233-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc94074805233-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc94074805233-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc94074805233-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc94074805233-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc94074805233-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc94074805233-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc94074805233-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc94074805233-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc94074805233-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc94074805233-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc94074805233-6\"><span class=\"crayon-s\">'&lt;h2&gt;hello world&lt;/h2&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>怎么做到的呢？其实这跟装饰器语法没什么关系。去掉<strong>@</strong>语法糖会变得很容易理解。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc97137764916\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@make_header(2)\r\ndef get_content():\r\n    return 'hello world'\r\n\r\n# 等价于\r\n\r\ndef get_content():\r\n    return 'hello world'\r\nunnamed_decorator = make_header(2)\r\nget_content = unnamed_decorator(get_content)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc97137764916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc97137764916-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc97137764916-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc97137764916-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc97137764916-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc97137764916-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc97137764916-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc97137764916-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc97137764916-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc97137764916-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc97137764916-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc97137764916-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc97137764916-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc97137764916-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc97137764916-5\"><span class=\"crayon-p\"># 等价于</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc97137764916-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddc97137764916-7\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc97137764916-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc97137764916-9\"><span class=\"crayon-v\">unnamed_decorator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc97137764916-10\"><span class=\"crayon-v\">get_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unnamed_decorator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<p>上面代码中的<strong>unnamed_decorator</strong>才是真正的装饰器，<strong>make_header</strong>是个普通的函数，它的返回值是装饰器。</p>\n<p>来看一下实现的代码。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc9a582459493\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef make_header(level):\r\n    print('Create decorator')\r\n\r\n    # 这部分跟通常的装饰器一样，只是wrapper通过闭包访问了变量level\r\n    def decorator(func):\r\n        print('Initialize')\r\n        def wrapper():\r\n            print('Call')\r\n            return '&lt;h{0}&gt;{1}&lt;/h{0}&gt;'.format(level, func())\r\n        return wrapper\r\n\r\n    # make_header返回装饰器\r\n    return decorator</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9a582459493-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9a582459493-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">make_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Create decorator'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 这部分跟通常的装饰器一样，只是wrapper通过闭包访问了变量level</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">decorator</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Initialize'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Call'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;h{0}&gt;{1}&lt;/h{0}&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wrapper</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9a582459493-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># make_header返回装饰器</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9a582459493-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">decorator</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n\n</div>\n<p>看了实现代码，装饰器的<strong>构造</strong>和<strong>调用</strong>的时序已经很清楚了。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddc9e957230879\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; @make_header(2)\r\n... def get_content():\r\n...     return 'hello world'\r\n...\r\nCreate decorator\r\nInitialize\r\n&gt;&gt;&gt; get_content()\r\nCall\r\n'&lt;h2&gt;hello world&lt;/h2&gt;'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9e957230879-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9e957230879-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9e957230879-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9e957230879-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9e957230879-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9e957230879-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9e957230879-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddc9e957230879-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddc9e957230879-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddc9e957230879-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9e957230879-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9e957230879-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9e957230879-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9e957230879-5\"><span class=\"crayon-e\">Create </span><span class=\"crayon-e\">decorator</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9e957230879-6\"><span class=\"crayon-v\">Initialize</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9e957230879-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddc9e957230879-8\"><span class=\"crayon-i\">Call</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddc9e957230879-9\"><span class=\"crayon-s\">'&lt;h2&gt;hello world&lt;/h2&gt;'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<h2>2. 如何装饰有参数的函数？</h2>\n<p>为了有条理地理解装饰器，之前例子里的被装饰函数有意设计成无参的。我们来看个例子。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddca1660637600\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@make_bold\r\ndef get_login_tip(name):\r\n    return 'Welcome back, {}'.format(name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca1660637600-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca1660637600-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca1660637600-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddca1660637600-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_bold</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca1660637600-2\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_login_tip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddca1660637600-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Welcome back, {}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>最直接的想法是把<strong>get_login_tip</strong>的参数透传下去。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddca4579818910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass make_bold(object):\r\n    def __init__(self, func):\r\n        self.func = func\r\n\r\n    def __call__(self, name):\r\n        return '&lt;b&gt;{}&lt;/b&gt;'.format(self.func(name))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca4579818910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca4579818910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca4579818910-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca4579818910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca4579818910-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca4579818910-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddca4579818910-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca4579818910-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddca4579818910-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca4579818910-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddca4579818910-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca4579818910-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;b&gt;{}&lt;/b&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<p>如果被装饰的函数参数是明确固定的，这么写是没有问题的。但是<strong>make_bold</strong>明显不是这种场景。它既需要装饰没有参数的<strong>get_content</strong>，又需要装饰有参数的<strong>get_login_tip</strong>。这时候就需要可变参数了。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddca7064814045\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass make_bold(object):\r\n    def __init__(self, func):\r\n        self.func = func\r\n    def __call__(self, *args, **kwargs):\r\n        return '&lt;b&gt;{}&lt;/b&gt;'.format(self.func(*args, **kwargs))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca7064814045-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca7064814045-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca7064814045-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddca7064814045-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddca7064814045-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddca7064814045-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca7064814045-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddca7064814045-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">func</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddca7064814045-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__call__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddca7064814045-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;b&gt;{}&lt;/b&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>当装饰器不关心被装饰函数的参数，或是被装饰函数的参数多种多样的时候，可变参数非常合适。可变参数不属于装饰器的语法内容，这里就不深入探讨了。</p>\n<h2>3. 一个函数能否被多个装饰器装饰？</h2>\n<p>下面这么写合法吗？</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddcab627160692\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@make_italic\r\n@make_bold\r\ndef get_content():\r\n    return 'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcab627160692-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcab627160692-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcab627160692-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcab627160692-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddcab627160692-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">make</span><span class=\"crayon-sy\">_</span>italic</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcab627160692-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">make_bold</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcab627160692-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcab627160692-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n\n</div>\n<p>合法。上面的的代码和下面等价，留意一下装饰的顺序。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddcae546344240\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef get_content():\r\n    return 'hello world'\r\nget_content = make_bold(get_content) # 先装饰离函数定义近的\r\nget_content = make_italic(get_content)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcae546344240-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcae546344240-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcae546344240-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcae546344240-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddcae546344240-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcae546344240-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcae546344240-3\"><span class=\"crayon-v\">get_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 先装饰离函数定义近的</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcae546344240-4\"><span class=\"crayon-v\">get_content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make_italic</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<h2>4. <strong>functools.wraps</strong>有什么用？</h2>\n<p>Python的装饰器倍感贴心的地方是对调用方透明。调用方完全不知道也不需要知道调用的函数被装饰了。这样我们就能在调用方的代码完全不改动的前提下，给函数patch功能。</p>\n<p>为了对调用方透明，装饰器返回的对象要伪装成被装饰的函数。伪装得越像，对调用方来说差异越小。有时光伪装函数名和参数是不够的，因为Python的函数对象有一些元信息调用方可能读取了。为了连这些元信息也伪装上，<strong>functools.wraps</strong>出场了。它能用于把被调用函数的<strong>__module__</strong>，<strong>__name__</strong>，<strong>__qualname__</strong>，<strong>__doc__</strong>，<strong>__annotations__</strong>赋值给装饰器返回的函数对象。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddcb1046897776\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport functools\r\n\r\ndef make_bold(func):\r\n    @functools.wraps(func)\r\n    def wrapper(*args, **kwargs):\r\n        return '&lt;b&gt;{}&lt;/b&gt;'.format(func(*args, **kwargs))\r\n    return wrapper</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb1046897776-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb1046897776-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb1046897776-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb1046897776-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb1046897776-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb1046897776-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb1046897776-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddcb1046897776-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">functools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb1046897776-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb1046897776-3\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">make_bold</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb1046897776-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">functools</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wraps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb1046897776-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb1046897776-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;b&gt;{}&lt;/b&gt;'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">func</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb1046897776-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wrapper</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>对比一下效果。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaddcb5725186803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; @make_bold\r\n... def get_content():\r\n...     '''Return page content'''\r\n...     return 'hello world'\r\n\r\n# 不用functools.wraps的结果\r\n&gt;&gt;&gt; get_content.__name__\r\n'wrapper'\r\n&gt;&gt;&gt; get_content.__doc__\r\n&gt;&gt;&gt;\r\n\r\n# 用functools.wraps的结果\r\n&gt;&gt;&gt; get_content.__name__\r\n'get_content'\r\n&gt;&gt;&gt; get_content.__doc__\r\n'Return page content'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaddcb5725186803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaddcb5725186803-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">make</span><span class=\"crayon-sy\">_</span>bold</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-s\">''</span><span class=\"crayon-s\">'Return page content'</span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-6\"><span class=\"crayon-p\"># 不用functools.wraps的结果</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-8\"><span class=\"crayon-s\">'wrapper'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__doc__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-12\"><span class=\"crayon-p\"># 用functools.wraps的结果</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-13\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-14\"><span class=\"crayon-s\">'get_content'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaddcb5725186803-15\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_content</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__doc_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaddcb5725186803-16\"><span class=\"crayon-s\">'Return page content'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>实现装饰器时往往不知道调用方会怎么用，所以养成好习惯加上<strong>functools.wraps</strong>吧。</p>\n<p>这次是真•完结了，有疑问请留言，撒花吧~~~</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88530\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88530votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88530\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "基础知识,装饰器", "url_object_id": "875e724e0a68a5786ec41444529f9643", "praise_nums": "1", "url": "http://python.jobbole.com/88530/", "title": "简单地理解 Python 的装饰器", "create_date": "2017/09/07", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000007055844\">HarryZhu</a>   </div><h1>概述</h1>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c034dc8be50a5d299d769dd7e65e1dd3.png\"><img class=\"aligncenter wp-image-88418 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c034dc8be50a5d299d769dd7e65e1dd3.png\" alt=\"3461276121-57fd531666b90_articlex\" width=\"550\" height=\"550\"></a></p>\n<blockquote><p>秦人不暇自哀,而后人哀之;后人哀之而不鉴之,亦使后人而复哀后人也! –论面向文档编程的重要性</p></blockquote>\n<p>如果想看见识一个人写代码的功力，注释其实是区分老司机和小鲜肉的一个显著的分界线（有没有观察到你们公司的领导基本都在开会或者写文档），通常情况下老司机的文档量与代码量是1：1的比例，而新人往往认为写完功能模块就已经可以完成任务了。生产环境中需要面对现实中大量复杂的业务逻辑和数据校验并与各方对接，文档质量和代码质量就被提升到了相同的高度。很多人没有写注释的习惯，大多数不是因为懒惰，一方面是没有意识到写文档的好处，另一方面是不了解这方面的工具。毕竟从管理上依赖于人的主动性是远不如依赖于工具有效的。本文介绍如何利用Python注释提升文档书写的质量以及效率的小技巧。</p>\n<h1>Python</h1>\n<p>在实际生产中，机器学习工作现在看起来，白天像是个算法工程师的活，晚上就变成运维+测试了。Python 一直以来也都受到测试工程师和运维工程师的偏爱，下面是几个经典的注释活用case。</p>\n<h2>用注释写单元测试:<span style=\"color: #ff0000\"><strong>doctest</strong></span></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/51e69519254569446808483854d8a2f7.png\"><img class=\"aligncenter wp-image-88419 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/51e69519254569446808483854d8a2f7.png\" alt=\"3461276121-57fd531666b90_articlex\" width=\"638\" height=\"479\"></a></p>\n<p>单元测试是代码开发环节必不可少的一环，对于Bug定位和代码质量而言是非常重要的。现在最广为人知的单元测试框架就是Unittest，它借鉴了Java中成熟的单元测试框架的JUnit。即使像Django还对这个框架有特殊的支持，然而在实现Unittest的时候会感觉确实比较啰嗦，setup，teardown…在维护单元测试的时候很多时候感觉力不从心。</p>\n<p>一个巧妙的方式可以是通过<strong>doctest</strong>，用<strong>docstring</strong>注释的方式来完成单元测试，由于每个方法<strong>def</strong>下面都先跟着一段测试用例，然后紧跟着就是代码正文，这样一来很方便我们测试现有代码的质量，另一方面又便于修改。</p>\n<p>举个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6c8610929293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef factorial(n):\r\n    \"\"\"Return the factorial of n, an exact integer &gt;= 0.\r\n\r\n    &gt;&gt;&gt; [factorial(n) for n in range(6)]\r\n    [1, 1, 2, 6, 24, 120]\r\n    &gt;&gt;&gt; factorial(30)\r\n    265252859812191058636308480000000\r\n    &gt;&gt;&gt; factorial(-1)\r\n    Traceback (most recent call last):\r\n        ...\r\n    ValueError: n must be &gt;= 0\r\n\r\n    Factorials of floats are OK, but the float must be an exact integer:\r\n    &gt;&gt;&gt; factorial(30.1)\r\n    Traceback (most recent call last):\r\n        ...\r\n    ValueError: n must be exact integer\r\n    &gt;&gt;&gt; factorial(30.0)\r\n    265252859812191058636308480000000\r\n\r\n    It must also not be ridiculously large:\r\n    &gt;&gt;&gt; factorial(1e100)\r\n    Traceback (most recent call last):\r\n        ...\r\n    OverflowError: n too large\r\n    \"\"\"\r\n\r\n    import math\r\n    if not n &gt;= 0:\r\n        raise ValueError(\"n must be &gt;= 0\")\r\n    if math.floor(n) != n:\r\n        raise ValueError(\"n must be exact integer\")\r\n    if n+1 == n:  # catch a value like 1e300\r\n        raise OverflowError(\"n too large\")\r\n    result = 1\r\n    factor = 2\r\n    while factor &lt;= n:\r\n        result *= factor\r\n        factor += 1\r\n    return result\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    import doctest\r\n    doctest.testmod()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6c8610929293-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6c8610929293-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">factorial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Return the factorial of n, an exact integer &gt;= 0.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-4\"><span class=\"crayon-s\">    &gt;&gt;&gt; [factorial(n) for n in range(6)]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-5\"><span class=\"crayon-s\">    [1, 1, 2, 6, 24, 120]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-6\"><span class=\"crayon-s\">    &gt;&gt;&gt; factorial(30)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-7\"><span class=\"crayon-s\">    265252859812191058636308480000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-8\"><span class=\"crayon-s\">    &gt;&gt;&gt; factorial(-1)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-9\"><span class=\"crayon-s\">    Traceback (most recent call last):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-10\"><span class=\"crayon-s\">        ...</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-11\"><span class=\"crayon-s\">    ValueError: n must be &gt;= 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-13\"><span class=\"crayon-s\">    Factorials of floats are OK, but the float must be an exact integer:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-14\"><span class=\"crayon-s\">    &gt;&gt;&gt; factorial(30.1)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-15\"><span class=\"crayon-s\">    Traceback (most recent call last):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-16\"><span class=\"crayon-s\">        ...</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-17\"><span class=\"crayon-s\">    ValueError: n must be exact integer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-18\"><span class=\"crayon-s\">    &gt;&gt;&gt; factorial(30.0)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-19\"><span class=\"crayon-s\">    265252859812191058636308480000000</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-20\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-21\"><span class=\"crayon-s\">    It must also not be ridiculously large:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-22\"><span class=\"crayon-s\">    &gt;&gt;&gt; factorial(1e100)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-23\"><span class=\"crayon-s\">    Traceback (most recent call last):</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-24\"><span class=\"crayon-s\">        ...</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-25\"><span class=\"crayon-s\">    OverflowError: n too large</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-26\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">math</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"n must be &gt;= 0\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"n must be exact integer\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># catch a value like 1e300</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">OverflowError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"n too large\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">factor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">factor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">factor</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-39\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">factor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">result</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-42\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-43\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6c8610929293-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">doctest</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6c8610929293-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">doctest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">testmod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0142 seconds] -->\r\n<p>上面是官网提供的一个求N的阶乘函数示例，在<strong>docstring</strong> 中通过 <strong>&gt;&gt;&gt;</strong>符号来开始一个单元测试，之后换行输入预期结果即可。实际上就是复制粘贴一下调试过程和结果，真的再简单不过了，想实现TDD也因此变得非常轻松。</p>\n<h2>用注释写API文档:<span style=\"color: #ff0000\"><strong>apidoc</strong></span></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6f275296baac15a283d7dea414ec2332.png\"><img class=\"aligncenter wp-image-88420 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6f275296baac15a283d7dea414ec2332.png\" alt=\"3461276121-57fd531666b90_articlex\" width=\"800\" height=\"440\"></a></p>\n<p>在我们完成机器学习模型后，想要提供一个对外服务的接口以贡献我们的算力时就需要完备的API文档，也是通过API的调用才能为我们的模型提供源源不断的校验数据，对于提升模型效果有非常实际的意义。对大多数人而言调用API来完成开发都是一件比较开心的事情，因为我们可以少做很多工作就可以实现强大功能。然而，当我们需要对外提供API时就要面临不一样的考验了，接口鉴权、接口设计、版本控制、并发问题、日志埋点…这些都是需要面对的新问题，而利用 <strong>apidoc</strong> 可以很好地解决这些API文档中常见的诸多问题，相当于通过模板提升了我们的接口设计的能力。</p>\n<p><strong>apidoc</strong>为Python提供了一种类似于 <strong>docstring</strong> 的方式来写API文档，从语法上看比较类似于 R中的<strong>roxygen</strong>，都需要用户以 <strong>@</strong>xxx 符号作为一个开头，随后书写相关的定义和功能。</p>\n<p><a href=\"http://apidocjs.com/example/\">举个例子</a>：</p>\n<p>下面是一个API接口的定义方法，最核心的部分就是</p>\n<ol>\n<li>路由</li>\n<li>GET/POST方法</li>\n<li>名称/分组</li>\n<li>参数与调用例子</li>\n</ol>\n<p>（这年头没有用例的代码都是耍流氓）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6dd768080130\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"\"\"\r\n@api {get} /user/:id Request User information\r\n@apiName GetUser\r\n@apiGroup User\r\n\r\n@apiParam {Number} id Users unique ID.\r\n\r\n@apiSuccess {String} firstname Firstname of the User.\r\n@apiSuccess {String} lastname  Lastname of the User.\r\n\"\"\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6dd768080130-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6dd768080130-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6dd768080130-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6dd768080130-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6dd768080130-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6dd768080130-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6dd768080130-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6dd768080130-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6dd768080130-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6dd768080130-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6dd768080130-1\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6dd768080130-2\"><span class=\"crayon-s\">@api {get} /user/:id Request User information</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6dd768080130-3\"><span class=\"crayon-s\">@apiName GetUser</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6dd768080130-4\"><span class=\"crayon-s\">@apiGroup User</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6dd768080130-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6dd768080130-6\"><span class=\"crayon-s\">@apiParam {Number} id Users unique ID.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6dd768080130-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6dd768080130-8\"><span class=\"crayon-s\">@apiSuccess {String} firstname Firstname of the User.</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6dd768080130-9\"><span class=\"crayon-s\">@apiSuccess {String} lastname  Lastname of the User.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6dd768080130-10\"><span class=\"crayon-s\">\"\"\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>我们可以直接撸一个<a href=\"https://github.com/apidoc/apidoc\">官方示例</a>来学习如何使用apidoc。</p>\n<p>首先，下载示例源码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6e5745883762\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngit clone https://github.com/apidoc/apidoc\r\ncd apidoc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6e5745883762-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6e5745883762-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6e5745883762-1\"><span class=\"crayon-e\">git </span><span class=\"crayon-e\">clone </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apidoc</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">apidoc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6e5745883762-2\"><span class=\"crayon-k \">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apidoc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>然后，安装 <strong>apidoc</strong> 组件</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6ec220737305\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo npm install apidoc -g</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6ec220737305-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6ec220737305-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">apidoc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">g</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>接着，利用官方代码来制作一个例子，并且访问即可。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6f2577381561\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napidoc -i example/ -o output/ -t template/\r\nopen output/index.html</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6f2577381561-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6f2577381561-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6f2577381561-1\"><span class=\"crayon-v\">apidoc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">example</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6f2577381561-2\"><span class=\"crayon-k \">open</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>几个参数的含义如下：<br>\n<strong>-i</strong>:input，表示输入的文件夹<br>\n<strong>-o</strong>:output，表示输出文件夹<br>\n<strong>-t</strong>:template，表示模板文件，通过替换模板我们可以修改文档皮肤</p>\n<p>在 example 文件夹下，我们需要在apidoc.json 中填写配置文件，定义文档的header和footer部分内容，其余的文件会被自动识别出其中的<strong>docstring</strong>作为API文档的一部分。</p>\n<p>由于<strong>apidoc</strong>的<a href=\"http://apidocjs.com/#params\">官方文档</a>非常简单清晰，所以这里不过多强调语法。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9fda76488716db9ddd71ee6678efafa3.png\"><img class=\"aligncenter wp-image-88421 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9fda76488716db9ddd71ee6678efafa3.png\" alt=\"3461276121-57fd531666b90_articlex\" width=\"800\" height=\"509\"></a></p>\n<p><strong>apidoc</strong> 还为我们提供了接口调试的功能，在实际使用的时候要注意：</p>\n<ol>\n<li>我们需要一个web server 才可以使用这个接口调试的功能</li>\n<li>要注意跨域的问题。</li>\n</ol>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c0c31d6dec9554a4e64f08221f084e50.png\"><img class=\"aligncenter wp-image-88422 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c0c31d6dec9554a4e64f08221f084e50.png\" alt=\"3461276121-57fd531666b90_articlex\" width=\"800\" height=\"523\"></a></p>\n<p>通过版本对比，我们还可以快速排查API接口的变化情况。需要注意的是这个功能要求我们要将历史的文档记录也要保存在该目录下的文件中，通常我们可以把历史的注释输出到一个特定文件中保存。</p>\n<p>总的来说，虽然，API文档的书写并不是一件难度非常高的事情，却能体现系统模块设计和用户体验设计的功力，我们应该对那些无代码示例，无版本控制的API文档say no！</p>\n<h2>用注释写命令行接口:<span style=\"color: #ff0000\"><strong>docopt</strong></span></h2>\n<p>利用<a href=\"https://github.com/docopt/docopt\"><strong>docopt</strong></a>，我们可以在注释中直接声明文件的命令行传入参数，而不需要通过 <strong>argvs</strong>变量来捕获输入值再做判断，这在调用运维脚本或者若干任务调度脚本的时候尤其管用，极大地提升了CLI的效率。</p>\n<p>举个例子：（此处代码仅供参考）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb6fa456329129\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"\"\"Usage:\r\n  fiannceR.py tcp &lt;host&gt; &lt;port&gt; [--timeout=&lt;seconds&gt;]\r\n  fiannceR.py serial &lt;port&gt; [--baud=9600] [--timeout=&lt;seconds&gt;]\r\n  fiannceR.py -h | --help | --version\r\n\r\n\"\"\"\r\nfrom docopt import docopt\r\n\r\nif __name__ == '__main__':\r\n    arguments = docopt(__doc__, version='0.1.1rc')\r\n    print(arguments)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6fa456329129-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6fa456329129-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6fa456329129-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6fa456329129-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb6fa456329129-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb6fa456329129-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-1\"><span class=\"crayon-s\">\"\"\"Usage:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6fa456329129-2\"><span class=\"crayon-s\">  fiannceR.py tcp &lt;host&gt; &lt;port&gt; [--timeout=&lt;seconds&gt;]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-3\"><span class=\"crayon-s\">  fiannceR.py serial &lt;port&gt; [--baud=9600] [--timeout=&lt;seconds&gt;]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6fa456329129-4\"><span class=\"crayon-s\">  fiannceR.py -h | --help | --version</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6fa456329129-6\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-7\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6fa456329129-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb6fa456329129-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__doc__</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'0.1.1rc'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb6fa456329129-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>随后，我们可以在命令行中成功调用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb701098034701\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfiannceR.py tcp 0.0.0.0 3838</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb701098034701-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb701098034701-1\"><span class=\"crayon-v\">fiannceR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3838</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这里的 arguments 将传出一个字典对象，以Key-Value的形式将命令行中的输入值捕获。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb707703622609\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{'--baud': None,\r\n '--help': False,\r\n '--timeout': None,\r\n '--version': False,\r\n '-h': False,\r\n '&lt;host&gt;': '0.0.0.0',\r\n '&lt;port&gt;': '3838',\r\n 'serial': False,\r\n 'tcp': True}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb707703622609-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb707703622609-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb707703622609-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb707703622609-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb707703622609-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb707703622609-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb707703622609-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb707703622609-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb707703622609-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb707703622609-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'--baud'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb707703622609-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--help'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb707703622609-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--timeout'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb707703622609-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'--version'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb707703622609-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'-h'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb707703622609-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;host&gt;'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0.0.0.0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb707703622609-7\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&lt;port&gt;'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'3838'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb707703622609-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'serial'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb707703622609-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tcp'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h1>总结</h1>\n<p>如果真的要从数据撸到模型、接口，那么一排注释的画面真是美得不敢想象。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaeb71a242823931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"\"\"unitest\r\n&gt;&gt;&gt; FinanceR('20161001')\r\n21.01\r\n\"\"\"\r\ndef FinanceR(date):\r\n    price = get_price(date)\r\n    return(price)\r\n\r\nclass(BaseHandler):\r\n    def get(self):   \r\n        \"\"\"apidoc\r\n           @api {get} /price/:date 获取当前价格\r\n           @apiName GetPrice\r\n           @apiGroup Quota\r\n\r\n           @apiParam {Number} date 交易日期\r\n\r\n           @apiSuccess {String} price\r\n        \"\"\"\r\n        date = self.get_argument('date',None)\r\n        try:\r\n            price = FinanceR(date)\r\n            self.write({'data':{'price':price},'response':{'message':'success','code':200}})\r\n        except Exception as e:\r\n            self.write({'data':None,'response':{'message':str(e),'code':404}})\r\n            \r\n\"\"\"Usage:\r\n  fiannceR.py tcp &lt;host&gt; &lt;port&gt; [--timeout=&lt;seconds&gt;]\r\n  fiannceR.py serial &lt;port&gt; [--baud=9600] [--timeout=&lt;seconds&gt;]\r\n  fiannceR.py -h | --help | --version\r\n\r\n\"\"\"\r\nfrom docopt import docopt\r\n\r\nif __name__ == '__main__':\r\n    arguments = docopt(__doc__, version='0.1.1rc')\r\n    print(arguments)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaeb71a242823931-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaeb71a242823931-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-1\"><span class=\"crayon-s\">\"\"\"unitest</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-2\"><span class=\"crayon-s\">&gt;&gt;&gt; FinanceR('20161001')</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-3\"><span class=\"crayon-s\">21.01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-4\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FinanceR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">price</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_price</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">price</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BaseHandler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"apidoc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-12\"><span class=\"crayon-s\">           @api {get} /price/:date 获取当前价格</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-13\"><span class=\"crayon-s\">           @apiName GetPrice</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-14\"><span class=\"crayon-s\">           @apiGroup Quota</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-16\"><span class=\"crayon-s\">           @apiParam {Number} date 交易日期</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-18\"><span class=\"crayon-s\">           @apiSuccess {String} price</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-19\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_argument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'date'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">price</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FinanceR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">date</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'price'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">price</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'response'</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'success'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'response'</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">404</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-26\"><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-27\"><span class=\"crayon-s\">\"\"\"Usage:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-28\"><span class=\"crayon-s\">  fiannceR.py tcp &lt;host&gt; &lt;port&gt; [--timeout=&lt;seconds&gt;]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-29\"><span class=\"crayon-s\">  fiannceR.py serial &lt;port&gt; [--baud=9600] [--timeout=&lt;seconds&gt;]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-30\"><span class=\"crayon-s\">  fiannceR.py -h | --help | --version</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-32\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-33\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-34\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-35\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaeb71a242823931-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">arguments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">docopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__doc__</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'0.1.1rc'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaeb71a242823931-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>欢迎大家留言讨论，给出更多应用案例，交流分享。</p>\n<h1>参考文献</h1>\n<ul>\n<li><a href=\"http://apidocjs.com/\">APIDoc</a></li>\n<li><a href=\"http://pythonguidecn.readthedocs.io/zh/latest/writing/tests.html\">Python 指南：测试你的代码</a></li>\n<li><a href=\"https://docs.python.org/3/library/doctest.html\">doctest</a></li>\n<li><a href=\"https://nose.readthedocs.io/en/latest/\">nose is nicer testing for python</a></li>\n<li><a href=\"http://testrun.org/tox/latest/\">tox: standardize testing in Python</a></li>\n<li><a href=\"https://github.com/bigwiv/Biopython-cn/blob/master/cn/chr19.rst\">Biopython测试框架</a></li>\n<li><a href=\"http://pyzh.readthedocs.io/en/latest/awesome-python-libraries.html#docopt\">Docopt</a></li>\n<li><a href=\"http://zh-sphinx-doc.readthedocs.io/en/latest/contents.html\">Sphinx</a><a href=\"https://github.com/docopt/docopt.R\">docopt.R</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88417\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88417votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88417\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/c034dc8be50a5d299d769dd7e65e1dd3.png"], "tags": "基础知识,文档", "url_object_id": "a0032b83abf49e5468618dcf6d0b7bc3", "praise_nums": "1", "url": "http://python.jobbole.com/88417/", "title": "Python 开发者面向文档编程的正确姿势", "create_date": "2017/08/27", "comment_nums": 0}
{"fav_nums": 5, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/078ad2067419\">Andrew_liu</a>   </div><p>本文希望达到以下目标:</p>\n<ol>\n<li>简要介绍Scarpy</li>\n<li>阅读官网入门文档并实现文档中的范例</li>\n<li>使用Scarpy优豆瓣爬虫的抓取</li>\n<li>制定下一步学习目标</li>\n</ol>\n<blockquote><p>初学<strong>Scrapy</strong>, 如有翻译不当, 或者代码错误, 请指出, 非常感谢</p></blockquote>\n<h1>1. Scrapy简介</h1>\n<hr>\n<blockquote><p>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。<br>\n其最初是为了页面抓取 (更确切来说, 网络抓取 )所设计的， 也可以应用在获取API所返回的数据(例如 Amazon Associates Web Services ) 或者通用的网络爬虫。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试</p></blockquote>\n<p><strong>Scrapy</strong> 使用了 <strong>Twisted</strong>异步网络库来处理网络通讯。整体架构大致如下</p>\n<div>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3dfaface114f6930374aa83020c7f0de.png\"><img class=\"aligncenter wp-image-88432 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3dfaface114f6930374aa83020c7f0de.png\" alt=\"Scrapy Architecture\" width=\"550\" height=\"388\"></a></p>\n<div style=\"text-align: center\">Scrapy</div>\n</div>\n<p>Scrapy主要包括了以下组件：</p>\n<ul>\n<li>引擎(Scrapy): 用来处理整个系统的数据流处理, 触发事务(框架核心)</li>\n<li>调度器(Scheduler): 用来接受引擎发过来的请求, 压入队列中, 并在引擎再次请求的时候返回. 可以想像成一个URL（抓取网页的网址或者说是链接）的优先队列, 由它来决定下一个要抓取的网址是什么, 同时去除重复的网址</li>\n<li>下载器(Downloader): 用于下载网页内容, 并将网页内容返回给蜘蛛(Scrapy下载器是建立在twisted这个高效的异步模型上的)</li>\n<li>爬虫(Spiders): 爬虫是主要干活的, 用于从特定的网页中提取自己需要的信息, 即所谓的实体(Item)。用户也可以从中提取出链接,让Scrapy继续抓取下一个页面</li>\n<li>项目管道(Pipeline): 负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。当页面被爬虫解析后，将被发送到项目管道，并经过几个特定的次序处理数据。</li>\n<li>下载器中间件(Downloader Middlewares): 位于Scrapy引擎和下载器之间的框架，主要是处理Scrapy引擎与下载器之间的请求及响应。</li>\n<li>爬虫中间件(Spider Middlewares): 介于Scrapy引擎和爬虫之间的框架，主要工作是处理蜘蛛的响应输入和请求输出。</li>\n<li>调度中间件(Scheduler Middewares): 介于Scrapy引擎和调度之间的中间件，从Scrapy引擎发送到调度的请求和响应。</li>\n</ul>\n<p><strong>Scrapy运行流程大概如下：</strong></p>\n<ol>\n<li>首先，引擎从调度器中取出一个链接(URL)用于接下来的抓取</li>\n<li>引擎把URL封装成一个请求(Request)传给下载器，下载器把资源下载下来，并封装成应答包(Response)</li>\n<li>然后，爬虫解析Response</li>\n<li>若是解析出实体（Item）,则交给实体管道进行进一步的处理。</li>\n<li>若是解析出的是链接（URL）,则把URL交给Scheduler等待抓取</li>\n</ol>\n<h1>2. 安装Scrapy</h1>\n<hr>\n<p>使用以下命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf08f3072409487\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo pip install virtualenv  #安装虚拟环境工具\r\nvirtualenv ENV  #创建一个虚拟环境目录\r\nsource ./ENV/bin/active  #激活虚拟环境\r\npip install Scrapy\r\n#验证是否安装成功\r\npip list\r\n#输出如下\r\ncffi (0.8.6)\r\ncryptography (0.6.1)\r\ncssselect (0.9.1)\r\nlxml (3.4.1)\r\npip (1.5.6)\r\npycparser (2.10)\r\npyOpenSSL (0.14)\r\nqueuelib (1.2.2)\r\nScrapy (0.24.4)\r\nsetuptools (3.6)\r\nsix (1.8.0)\r\nTwisted (14.0.2)\r\nw3lib (1.10.0)\r\nwsgiref (0.1.2)\r\nzope.interface (4.1.1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf08f3072409487-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf08f3072409487-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#安装虚拟环境工具</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-2\"><span class=\"crayon-e\">virtualenv </span><span class=\"crayon-v\">ENV</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#创建一个虚拟环境目录</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-3\"><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ENV</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">active</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#激活虚拟环境</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-4\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">Scrapy</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-5\"><span class=\"crayon-c\">#验证是否安装成功</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-6\"><span class=\"crayon-e\">pip </span><span class=\"crayon-k \">list</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-7\"><span class=\"crayon-c\">#输出如下</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-8\"><span class=\"crayon-e\">cffi</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.8.6</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-9\"><span class=\"crayon-e\">cryptography</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.6.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-10\"><span class=\"crayon-e\">cssselect</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.9.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-11\"><span class=\"crayon-e\">lxml</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3.4.1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-12\"><span class=\"crayon-e\">pip</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.5.6</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-13\"><span class=\"crayon-e\">pycparser</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2.10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-14\"><span class=\"crayon-e\">pyOpenSSL</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.14</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-15\"><span class=\"crayon-e\">queuelib</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.2.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-16\"><span class=\"crayon-e\">Scrapy</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.24.4</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-17\"><span class=\"crayon-e\">setuptools</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3.6</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-18\"><span class=\"crayon-e\">six</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.8.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-19\"><span class=\"crayon-e\">Twisted</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">14.0.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-20\"><span class=\"crayon-e\">w3lib</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.10.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf08f3072409487-21\"><span class=\"crayon-k \">wsgiref</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.1.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf08f3072409487-22\"><span class=\"crayon-v\">zope</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4.1.1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p><a href=\"http://andrewliu.tk/2014/12/08/Virtualenv%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/\" target=\"_blank\">更多虚拟环境的操作可以查看我的博文</a></p>\n<h1>3. Scrapy Tutorial</h1>\n<hr>\n<p>在抓取之前, 你需要新建一个<strong>Scrapy</strong>工程. 进入一个你想用来保存代码的目录，然后执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0910205736361\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ scrapy startproject tutorial</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0910205736361-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0910205736361-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">startproject </span><span class=\"crayon-v\">tutorial</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这个命令会在当前目录下创建一个新目录 tutorial, 它的结构如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0918672267907\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.\r\n├── scrapy.cfg\r\n└── tutorial\r\n    ├── __init__.py\r\n    ├── items.py\r\n    ├── pipelines.py\r\n    ├── settings.py\r\n    └── spiders\r\n        └── __init__.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0918672267907-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0918672267907-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0918672267907-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0918672267907-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0918672267907-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0918672267907-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0918672267907-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0918672267907-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0918672267907-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0918672267907-1\"><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0918672267907-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cfg</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0918672267907-3\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">tutorial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0918672267907-4\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0918672267907-5\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0918672267907-6\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelines</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0918672267907-7\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0918672267907-8\"><span class=\"crayon-h\">    </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">spiders</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0918672267907-9\"><span class=\"crayon-h\">        </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>这些文件主要是：</p>\n<ul>\n<li>scrapy.cfg: 项目配置文件</li>\n<li>tutorial/: 项目python模块, 之后您将在此加入代码</li>\n<li>tutorial/items.py: 项目items文件</li>\n<li>tutorial/pipelines.py: 项目管道文件</li>\n<li>tutorial/settings.py: 项目配置文件</li>\n<li>tutorial/spiders: 放置spider的目录</li>\n</ul>\n<h2>3.1. 定义Item</h2>\n<p>Items是将要装载抓取的数据的容器，它工作方式像 python 里面的字典，但它提供更多的保护，比如对未定义的字段填充以防止拼写错误。</p>\n<p>通过创建<strong>scrapy.Item类</strong>, 并且定义类型为 <strong>scrapy.Field</strong> 的类属性来声明一个Item.</p>\n<p>我们通过将需要的item模型化，来控制从 <strong>dmoz.org</strong> 获得的站点数据，比如我们要获得站点的名字，url 和网站描述，我们定义这三种属性的域。在 tutorial 目录下的 items.py 文件编辑</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0920248165532\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom scrapy.item import Item, Field\r\n\r\n\r\nclass DmozItem(Item):\r\n    # define the fields for your item here like:\r\n    name = Field()\r\n    description = Field()\r\n    url = Field()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0920248165532-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0920248165532-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0920248165532-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0920248165532-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0920248165532-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0920248165532-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0920248165532-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0920248165532-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0920248165532-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">item </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0920248165532-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0920248165532-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0920248165532-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0920248165532-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># define the fields for your item here like:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0920248165532-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0920248165532-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0920248165532-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h2>3.2. 编写Spider</h2>\n<p>Spider 是用户编写的类, 用于从一个域（或域组）中抓取信息, 定义了用于下载的URL的初步列表, 如何跟踪链接，以及如何来解析这些网页的内容用于提取items。</p>\n<p>要建立一个 Spider，继承 <strong>scrapy.Spider</strong> 基类，并确定三个主要的、强制的属性：</p>\n<ul>\n<li>name：爬虫的识别名，它必须是唯一的，在不同的爬虫中你必须定义不同的名字.</li>\n<li>start_urls：包含了Spider在启动时进行爬取的url列表。因此，第一个被获取到的页面将是其中之一。后续的URL则从初始的URL获取到的数据中提取。我们可以利用正则表达式定义和过滤需要进行跟进的链接。</li>\n<li>parse()：是spider的一个方法。被调用时，每个初始URL完成下载后生成的 Response 对象将会作为唯一的参数传递给该函数。该方法负责解析返回的数据(response data)，提取数据(生成item)以及生成需要进一步处理的URL的 Request 对象。</li>\n</ul>\n<p>这个方法负责解析返回的数据、匹配抓取的数据(解析为 item )并跟踪更多的 URL。</p>\n<p>在 /tutorial/tutorial/spiders 目录下创建 <strong>dmoz_spider.py</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0927392788792\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport scrapy\r\n\r\nclass DmozSpider(scrapy.Spider):\r\n    name = \"dmoz\"\r\n    allowed_domains = [\"dmoz.org\"]\r\n    start_urls = [\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\",\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\"\r\n    ]\r\n\r\n    def parse(self, response):\r\n        filename = response.url.split(\"/\")[-2]\r\n        with open(filename, 'wb') as f:\r\n            f.write(response.body)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0927392788792-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0927392788792-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dmoz\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"dmoz.org\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0927392788792-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wb'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0927392788792-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p>\n<h2>3.3. 爬取</h2>\n<p>当前项目结构</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf092e712058026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n├── scrapy.cfg\r\n└── tutorial\r\n    ├── __init__.py\r\n    ├── items.py\r\n    ├── pipelines.py\r\n    ├── settings.py\r\n    └── spiders\r\n        ├── __init__.py\r\n        └── dmoz_spider.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf092e712058026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf092e712058026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf092e712058026-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf092e712058026-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf092e712058026-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf092e712058026-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf092e712058026-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf092e712058026-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf092e712058026-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf092e712058026-1\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cfg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf092e712058026-2\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">tutorial</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf092e712058026-3\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf092e712058026-4\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf092e712058026-5\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelines</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf092e712058026-6\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf092e712058026-7\"><span class=\"crayon-h\">    </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">spiders</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf092e712058026-8\"><span class=\"crayon-h\">        </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf092e712058026-9\"><span class=\"crayon-h\">        </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">dmoz_spider</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>到项目根目录, 然后运行命令:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0934314693400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ scrapy crawl dmoz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0934314693400-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0934314693400-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">crawl </span><span class=\"crayon-v\">dmoz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>运行结果:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf093a285699042\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n2014-12-15 09:30:59+0800 [scrapy] INFO: Scrapy 0.24.4 started (bot: tutorial)\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Optional features available: ssl, http11\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Overridden settings: {'NEWSPIDER_MODULE': 'tutorial.spiders', 'SPIDER_MODULES': ['tutorial.spiders'], 'BOT_NAME': 'tutorial'}\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Enabled extensions: LogStats, TelnetConsole, CloseSpider, WebService, CoreStats, SpiderState\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Enabled downloader middlewares: HttpAuthMiddleware, DownloadTimeoutMiddleware, UserAgentMiddleware, RetryMiddleware, DefaultHeadersMiddleware, MetaRefreshMiddleware, HttpCompressionMiddleware, RedirectMiddleware, CookiesMiddleware, ChunkedTransferMiddleware, DownloaderStats\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Enabled spider middlewares: HttpErrorMiddleware, OffsiteMiddleware, RefererMiddleware, UrlLengthMiddleware, DepthMiddleware\r\n2014-12-15 09:30:59+0800 [scrapy] INFO: Enabled item pipelines:\r\n2014-12-15 09:30:59+0800 [dmoz] INFO: Spider opened\r\n2014-12-15 09:30:59+0800 [dmoz] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)\r\n2014-12-15 09:30:59+0800 [scrapy] DEBUG: Telnet console listening on 127.0.0.1:6023\r\n2014-12-15 09:30:59+0800 [scrapy] DEBUG: Web service listening on 127.0.0.1:6080\r\n2014-12-15 09:31:00+0800 [dmoz] DEBUG: Crawled (200) &lt;GET http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/&gt; (referer: None)\r\n2014-12-15 09:31:00+0800 [dmoz] DEBUG: Crawled (200) &lt;GET http://www.dmoz.org/Computers/Programming/Languages/Python/Books/&gt; (referer: None)\r\n2014-12-15 09:31:00+0800 [dmoz] INFO: Closing spider (finished)\r\n2014-12-15 09:31:00+0800 [dmoz] INFO: Dumping Scrapy stats:\r\n    {'downloader/request_bytes': 516,\r\n     'downloader/request_count': 2,\r\n     'downloader/request_method_count/GET': 2,\r\n     'downloader/response_bytes': 16338,\r\n     'downloader/response_count': 2,\r\n     'downloader/response_status_count/200': 2,\r\n     'finish_reason': 'finished',\r\n     'finish_time': datetime.datetime(2014, 12, 15, 1, 31, 0, 666214),\r\n     'log_count/DEBUG': 4,\r\n     'log_count/INFO': 7,\r\n     'response_received_count': 2,\r\n     'scheduler/dequeued': 2,\r\n     'scheduler/dequeued/memory': 2,\r\n     'scheduler/enqueued': 2,\r\n     'scheduler/enqueued/memory': 2,\r\n     'start_time': datetime.datetime(2014, 12, 15, 1, 30, 59, 533207)}\r\n2014-12-15 09:31:00+0800 [dmoz] INFO: Spider closed (finished)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf093a285699042-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf093a285699042-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-1\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Scrapy</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.24.4</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">started</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bot</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tutorial</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-2\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Optional </span><span class=\"crayon-e\">features </span><span class=\"crayon-v\">available</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">ssl</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">http11</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-3\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Overridden </span><span class=\"crayon-v\">settings</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'NEWSPIDER_MODULE'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tutorial.spiders'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SPIDER_MODULES'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'tutorial.spiders'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'BOT_NAME'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tutorial'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-4\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Enabled </span><span class=\"crayon-v\">extensions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LogStats</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TelnetConsole</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CloseSpider</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WebService</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CoreStats</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SpiderState</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-5\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Enabled </span><span class=\"crayon-e\">downloader </span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpAuthMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DownloadTimeoutMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserAgentMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RetryMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DefaultHeadersMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MetaRefreshMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpCompressionMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedirectMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CookiesMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ChunkedTransferMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DownloaderStats</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-6\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Enabled </span><span class=\"crayon-e\">spider </span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpErrorMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OffsiteMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RefererMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UrlLengthMiddleware</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DepthMiddleware</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-7\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Enabled </span><span class=\"crayon-e\">item </span><span class=\"crayon-v\">pipelines</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-8\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Spider </span><span class=\"crayon-i\">opened</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-9\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pages</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pages</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">scraped</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-10\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Telnet </span><span class=\"crayon-e\">console </span><span class=\"crayon-e\">listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">6023</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-11\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Web </span><span class=\"crayon-e\">service </span><span class=\"crayon-e\">listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">6080</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-12\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">org</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Computers</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Programming</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Languages</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Python</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Resources</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-13\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">org</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Computers</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Programming</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Languages</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Python</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Books</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-14\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Closing </span><span class=\"crayon-e\">spider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">finished</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-15\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dumping </span><span class=\"crayon-e\">Scrapy </span><span class=\"crayon-v\">stats</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'downloader/request_bytes'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">516</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-17\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'downloader/request_count'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-18\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'downloader/request_method_count/GET'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-19\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'downloader/response_bytes'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16338</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-20\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'downloader/response_count'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-21\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'downloader/response_status_count/200'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-22\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'finish_reason'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finished'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-23\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'finish_time'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2014</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">666214</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-24\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'log_count/DEBUG'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-25\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'log_count/INFO'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-26\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'response_received_count'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-27\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'scheduler/dequeued'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-28\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'scheduler/dequeued/memory'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-29\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'scheduler/enqueued'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-30\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'scheduler/enqueued/memory'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf093a285699042-31\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'start_time'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2014</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">59</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">533207</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf093a285699042-32\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">00</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Spider </span><span class=\"crayon-e\">closed</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">finished</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0193 seconds] -->\r\n<p></p>\n<h2>3.4. 提取Items</h2>\n<h3>3.4.1. 介绍Selector</h3>\n<p>从网页中提取数据有很多方法。Scrapy使用了一种基于 <strong>XPath</strong> 或者 <strong>CSS 表达式</strong>机制： Scrapy Selectors</p>\n<p>出XPath表达式的例子及对应的含义:</p>\n<ul>\n<li><strong>/html/head/title</strong>: 选择HTML文档中 标签内的 元素</li>\n<li><strong>/html/head/title/text()</strong>: 选择 元素内的文本</li>\n<li><strong>//td</strong>: 选择所有的 <strong>元素</strong></li>\n<li><strong>//div[@class=”mine”]</strong>: 选择所有具有<strong>class=”mine”</strong> 属性的 div 元素等</li>\n</ul>\n<blockquote><p>多强大的功能使用可以查看<a href=\"http://www.w3school.com.cn/xpath/\" target=\"_blank\">XPath tutorial</a></p></blockquote>\n<p>为了方便使用 XPaths，Scrapy 提供 Selector 类， 有四种方法 :</p>\n<ul>\n<li>xpath()：返回selectors列表, 每一个selector表示一个xpath参数表达式选择的节点.</li>\n<li>css() : 返回selectors列表, 每一个selector表示CSS参数表达式选择的节点</li>\n<li>extract()：返回一个unicode字符串，该字符串为XPath选择器返回的数据</li>\n<li>re()： 返回unicode字符串列表，字符串作为参数由正则表达式提取出来</li>\n</ul>\n<h3>3.4.2. 取出数据</h3>\n<p>首先使用谷歌浏览器开发者工具, 查看网站源码, 来看自己需要取出的数据形式(这种方法比较麻烦), 更简单的方法是直接对感兴趣的东西右键<strong>审查元素</strong>, 可以直接查看网站源码</p>\n<p>在查看网站源码后, 网站信息在第二个内</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0947279175948\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;ul class=\"directory-url\" style=\"margin-left:0;\"&gt;\r\n\r\n &lt;li&gt;&lt;a href=\"http://www.pearsonhighered.com/educator/academic/product/0,,0130260363,00%2Ben-USS_01DBC.html\" class=\"listinglink\"&gt;Core Python Programming&lt;/a&gt; \r\n- By Wesley J. Chun; Prentice Hall PTR, 2001, ISBN 0130260363. For experienced developers to improve extant skills; professional level examples. Starts by introducing syntax, objects, error handling, functions, classes, built-ins. [Prentice Hall]\r\n&lt;div class=\"flag\"&gt;&lt;a href=\"/public/flag?cat=Computers%2FProgramming%2FLanguages%2FPython%2FBooks&amp;url=http%3A%2F%2Fwww.pearsonhighered.com%2Feducator%2Facademic%2Fproduct%2F0%2C%2C0130260363%2C00%252Ben-USS_01DBC.html\"&gt;&lt;img src=\"/img/flag.png\" alt=\"[!]\" title=\"report an issue with this listing\"&gt;&lt;/a&gt;&lt;/div&gt;\r\n&lt;/li&gt;\r\n...省略部分...\r\n&lt;/ul&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0947279175948-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0947279175948-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0947279175948-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0947279175948-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0947279175948-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0947279175948-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0947279175948-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0947279175948-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0947279175948-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ul </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"directory-url\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"margin-left:0;\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0947279175948-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0947279175948-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.pearsonhighered.com/educator/academic/product/0,,0130260363,00%2Ben-USS_01DBC.html\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"listinglink\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Core </span><span class=\"crayon-e\">Python </span><span class=\"crayon-v\">Programming</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0947279175948-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">By </span><span class=\"crayon-i\">Wesley</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">J</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Chun</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Prentice </span><span class=\"crayon-e\">Hall </span><span class=\"crayon-v\">PTR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2001</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ISBN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0130260363.</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">For</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">experienced </span><span class=\"crayon-e\">developers </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">improve </span><span class=\"crayon-e\">extant </span><span class=\"crayon-v\">skills</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">professional </span><span class=\"crayon-e\">level </span><span class=\"crayon-v\">examples</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starts </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">introducing </span><span class=\"crayon-v\">syntax</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">objects</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error </span><span class=\"crayon-v\">handling</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">functions</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">built</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ins</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Prentice </span><span class=\"crayon-v\">Hall</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0947279175948-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"flag\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/public/flag?cat=Computers%2FProgramming%2FLanguages%2FPython%2FBooks&amp;url=http%3A%2F%2Fwww.pearsonhighered.com%2Feducator%2Facademic%2Fproduct%2F0%2C%2C0130260363%2C00%252Ben-USS_01DBC.html\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">img </span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/img/flag.png\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alt</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[!]\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"report an issue with this listing\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0947279175948-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0947279175948-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span>省略部分<span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0947279175948-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>那么就可以通过一下方式进行提取数据</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf094f257711957\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#通过如下命令选择每个在网站中的 &lt;li&gt; 元素:\r\nsel.xpath('//ul/li') \r\n\r\n#网站描述:\r\nsel.xpath('//ul/li/text()').extract()\r\n\r\n#网站标题:\r\nsel.xpath('//ul/li/a/text()').extract()\r\n\r\n#网站链接:\r\nsel.xpath('//ul/li/a/@href').extract()\r\n\r\n#如前所述，每个 xpath() 调用返回一个 selectors 列表，所以我们可以结合 xpath() 去挖掘更深的节点。我们将会用到这些特性，所以:\r\n\r\nfor sel in response.xpath('//ul/li')\r\n    title = sel.xpath('a/text()').extract()\r\n    link = sel.xpath('a/@href').extract()\r\n    desc = sel.xpath('text()').extract()\r\n    print title, link, desc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf094f257711957-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf094f257711957-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-1\"><span class=\"crayon-c\">#通过如下命令选择每个在网站中的 &lt;li&gt; 元素:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-2\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-4\"><span class=\"crayon-c\">#网站描述:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-5\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-7\"><span class=\"crayon-c\">#网站标题:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-8\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li/a/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-10\"><span class=\"crayon-c\">#网站链接:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-11\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li/a/@href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-13\"><span class=\"crayon-c\">#如前所述，每个 xpath() 调用返回一个 selectors 列表，所以我们可以结合 xpath() 去挖掘更深的节点。我们将会用到这些特性，所以:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-15\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sel </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">link</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/@href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf094f257711957-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf094f257711957-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">desc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0065 seconds] -->\r\n<p>在已有的爬虫文件中修改代码</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0956841183388\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport scrapy\r\n\r\nclass DmozSpider(scrapy.Spider):\r\n    name = \"dmoz\"\r\n    allowed_domains = [\"dmoz.org\"]\r\n    start_urls = [\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\",\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\"\r\n    ]\r\n\r\n    def parse(self, response):\r\n        for sel in response.xpath('//ul/li'):\r\n            title = sel.xpath('a/text()').extract()\r\n            link = sel.xpath('a/@href').extract()\r\n            desc = sel.xpath('text()').extract()\r\n            print title, link, desc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0956841183388-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0956841183388-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dmoz\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"dmoz.org\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sel </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul/li'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">link</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/@href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0956841183388-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">desc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0956841183388-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">desc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0049 seconds] -->\r\n<p></p>\n<h3>3.4.3. 使用item</h3>\n<p><strong>Item</strong>对象是自定义的python字典,可以使用标准的字典语法来获取到其每个字段的值(字段即是我们之前用Field赋值的属性)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf095d061589496\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; item = DmozItem()\r\n&gt;&gt;&gt; item['title'] = 'Example title'\r\n&gt;&gt;&gt; item['title']\r\n'Example title'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf095d061589496-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf095d061589496-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf095d061589496-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf095d061589496-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf095d061589496-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf095d061589496-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Example title'</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf095d061589496-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf095d061589496-4\"><span class=\"crayon-s\">'Example title'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>一般来说，Spider将会将爬取到的数据以 Item 对象返回, 最后修改爬虫类，使用 Item 来保存数据，代码如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0963244073307\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom scrapy.spider import Spider\r\nfrom scrapy.selector import Selector\r\nfrom tutorial.items import DmozItem \r\n\r\n\r\nclass DmozSpider(Spider):\r\n    name = \"dmoz\"\r\n    allowed_domains = [\"dmoz.org\"]\r\n    start_urls = [\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\",\r\n        \"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\",\r\n    ]\r\n\r\n    def parse(self, response):\r\n        sel = Selector(response)\r\n        sites = sel.xpath('//ul[@class=\"directory-url\"]/li')\r\n        items = []\r\n\r\n        for site in sites:\r\n            item = DmozItem()\r\n            item['name'] = site.xpath('a/text()').extract()\r\n            item['url'] = site.xpath('a/@href').extract()\r\n            item['description'] = site.xpath('text()').re('-\\s[^\\n]*\\\\r')\r\n            items.append(item)\r\n        return items</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0963244073307-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0963244073307-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">spider </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Spider</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selector </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tutorial</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozItem </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"dmoz\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"dmoz.org\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Books/\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.dmoz.org/Computers/Programming/Languages/Python/Resources/\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sites</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//ul[@class=\"directory-url\"]/li'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-18\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">site</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sites</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DmozItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'url'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a/@href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'description'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'-\\s[^\\n]*\\\\r'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0963244073307-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0963244073307-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p></p>\n<h2>3.5. 使用Item Pipeline</h2>\n<p>当Item在Spider中被收集之后，它将会被传递到Item Pipeline，一些组件会按照一定的顺序执行对Item的处理。</p>\n<p>每个item pipeline组件(有时称之为<strong>ItemPipeline</strong>)是实现了简单方法的Python类。他们接收到Item并通过它执行一些行为，同时也决定此Item是否继续通过pipeline，或是被丢弃而不再进行处理。</p>\n<p>以下是item pipeline的一些典型应用：</p>\n<ul>\n<li>清理HTML数据</li>\n<li>验证爬取的数据(检查item包含某些字段)</li>\n<li>查重(并丢弃)</li>\n<li>将爬取结果保存，如保存到数据库、XML、JSON等文件中</li>\n</ul>\n<p>编写你自己的item pipeline很简单，每个item pipeline组件是一个独立的Python类，同时必须实现以下方法:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf096c877984558\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprocess_item(item, spider)  #每个item pipeline组件都需要调用该方法，这个方法必须返回一个 Item (或任何继承类)对象，或是抛出 DropItem异常，被丢弃的item将不会被之后的pipeline组件所处理。\r\n#参数:\r\nitem: 由 parse 方法返回的 Item 对象(Item对象)\r\nspider: 抓取到这个 Item 对象对应的爬虫对象(Spider对象)\r\n\r\nopen_spider(spider)  #当spider被开启时，这个方法被调用。\r\n#参数: \r\nspider : (Spider object) – 被开启的spider\r\n　　\r\nclose_spider(spider)  #当spider被关闭时，这个方法被调用，可以再爬虫关闭后进行相应的数据处理。\r\n#参数: \r\nspider : (Spider object) – 被关闭的spider</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf096c877984558-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf096c877984558-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-1\"><span class=\"crayon-e\">process_item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#每个item pipeline组件都需要调用该方法，这个方法必须返回一个 Item (或任何继承类)对象，或是抛出 DropItem异常，被丢弃的item将不会被之后的pipeline组件所处理。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-2\"><span class=\"crayon-c\">#参数:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-3\"><span class=\"crayon-v\">item</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>由<span class=\"crayon-h\"> </span><span class=\"crayon-i\">parse</span><span class=\"crayon-h\"> </span>方法返回的<span class=\"crayon-h\"> </span><span class=\"crayon-i\">Item</span><span class=\"crayon-h\"> </span>对象<span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Item</span>对象<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-4\"><span class=\"crayon-v\">spider</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>抓取到这个<span class=\"crayon-h\"> </span><span class=\"crayon-i\">Item</span><span class=\"crayon-h\"> </span>对象对应的爬虫对象<span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Spider</span>对象<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-6\"><span class=\"crayon-e\">open_spider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#当spider被开启时，这个方法被调用。</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-7\"><span class=\"crayon-c\">#参数: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-8\"><span class=\"crayon-v\">spider</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Spider </span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span>–<span class=\"crayon-h\"> </span>被开启的<span class=\"crayon-i\">spider</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-9\">　　</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-10\"><span class=\"crayon-e\">close_spider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#当spider被关闭时，这个方法被调用，可以再爬虫关闭后进行相应的数据处理。</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf096c877984558-11\"><span class=\"crayon-c\">#参数: </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf096c877984558-12\"><span class=\"crayon-v\">spider</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Spider </span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span>–<span class=\"crayon-h\"> </span>被关闭的<span class=\"crayon-v\">spider</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>为JSON文件编写一个items</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0973954872125\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom scrapy.exceptions import DropItem\r\n\r\nclass TutorialPipeline(object):\r\n\r\n    # put all words in lowercase\r\n    words_to_filter = ['politics', 'religion']\r\n\r\n    def process_item(self, item, spider):\r\n        for word in self.words_to_filter:\r\n            if word in unicode(item['description']).lower():\r\n                raise DropItem(\"Contains forbidden word: %s\" % word)\r\n        else:\r\n            return item</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0973954872125-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0973954872125-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">exceptions</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DropItem</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TutorialPipeline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># put all words in lowercase</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_to_filter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'politics'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'religion'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">process_item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">word </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">words_to_filter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">word </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">unicode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'description'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DropItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Contains forbidden word: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">word</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0973954872125-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0973954872125-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>在 settings.py 中设置<strong>ITEM_PIPELINES</strong>激活item pipeline，其默认为[]</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf097a197042077\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nITEM_PIPELINES = {'tutorial.pipelines.FilterWordsPipeline': 1}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf097a197042077-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf097a197042077-1\"><span class=\"crayon-v\">ITEM_PIPELINES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'tutorial.pipelines.FilterWordsPipeline'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h2>3.6. 存储数据</h2>\n<p>使用下面的命令存储为<strong>json</strong>文件格式</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0980435106337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscrapy crawl dmoz -o items.json</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0980435106337-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0980435106337-1\"><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">crawl </span><span class=\"crayon-v\">dmoz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h1>4. Scarpy优化豆瓣爬虫的抓取</h1>\n<hr>\n<p>主要针对之间写过的豆瓣爬虫进行重构:</p>\n<ul>\n<li><a href=\"http://andrewliu.tk/2014/12/05/Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB-%E4%BA%8C-%E8%B1%86%E7%93%A3%E6%8A%93%E7%AB%99%E5%B0%8F%E8%AE%A1/\" target=\"_blank\">Python网络爬虫(二)–豆瓣抓站小计</a></li>\n<li><a href=\"http://andrewliu.tk/2014/12/15/Python-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BB%AD-Queue/\" target=\"_blank\">豆瓣抓站重构第二版</a></li>\n</ul>\n<p>豆瓣有反爬虫机制, 只成功了一次后, 就被<strong>baned</strong>后显示403了, 下面说一下爬虫结构</p>\n<p><a href=\"https://github.com/Andrew-liu/scrapy_example/tree/master/douban\" target=\"_blank\">完整的豆瓣爬虫代码链接</a></p>\n<h2>4.1. Item</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0987092189399\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom scrapy.item import Item, Field\r\n\r\n\r\nclass DoubanItem(Item):\r\n    # define the fields for your item here like:\r\n    # name = scrapy.Field()\r\n    name = Field()  #电影名称\r\n    description = Field()  #电影描述\r\n    url = Field()  #抓取的url</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0987092189399-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0987092189399-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0987092189399-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0987092189399-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0987092189399-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0987092189399-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0987092189399-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0987092189399-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0987092189399-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0987092189399-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">item </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0987092189399-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf0987092189399-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0987092189399-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubanItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0987092189399-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># define the fields for your item here like:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0987092189399-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># name = scrapy.Field()</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0987092189399-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#电影名称</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0987092189399-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#电影描述</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0987092189399-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#抓取的url</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<h2>4.2. Spider主程序</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf098d129778005\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\"\"\"\r\n一个简单的Python 爬虫, 用于抓取豆瓣电影Top前250的电影的名称描述等\r\n\r\nAnthor: Andrew Liu\r\nVersion: 0.0.3\r\nDate: 2014-12-17\r\nLanguage: Python2.7.8\r\nEditor: Sublime Text2\r\nOperate: 具体操作请看README.md介绍\r\n\"\"\"\r\n\r\nfrom scrapy.contrib.spiders import CrawlSpider, Rule\r\nfrom scrapy.selector import Selector\r\nfrom douban.items import DoubanItem\r\nfrom scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor\r\n\r\nclass DoubanSpider(CrawlSpider) :\r\n\r\n    name = \"douban\" \r\n    allowed_domains = [\"movie.douban.com\"]\r\n    start_urls = [\"http://movie.douban.com/top250\"]\r\n    rules = (\r\n        #将所有符合正则表达式的url加入到抓取列表中\r\n        Rule(SgmlLinkExtractor(allow = (r'http://movie\\.douban\\.com/top250\\?start=\\d+&amp;filter=&amp;type=',))),\r\n        #将所有符合正则表达式的url请求后下载网页代码, 形成response后调用自定义回调函数\r\n        Rule(SgmlLinkExtractor(allow = (r'http://movie\\.douban\\.com/subject/\\d+', )), callback = 'parse_page', follow = True),\r\n        )\r\n\r\n    def parse_page(self, response) :\r\n        sel = Selector(response)\r\n        item = DoubanItem()\r\n        item['name'] = sel.xpath('//h1/span[@property=\"v:itemreviewed\"]/text()').extract()\r\n        item['description'] = sel.xpath('//div/span[@property=\"v:summary\"]/text()').extract()\r\n        item['url'] = response.url\r\n        return item</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf098d129778005-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf098d129778005-37\">37</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-3\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-4\"><span class=\"crayon-s\">一个简单的Python 爬虫, 用于抓取豆瓣电影Top前250的电影的名称描述等</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-6\"><span class=\"crayon-s\">Anthor: Andrew Liu</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-7\"><span class=\"crayon-s\">Version: 0.0.3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-8\"><span class=\"crayon-s\">Date: 2014-12-17</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-9\"><span class=\"crayon-s\">Language: Python2.7.8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-10\"><span class=\"crayon-s\">Editor: Sublime Text2</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-11\"><span class=\"crayon-s\">Operate: 具体操作请看README.md介绍</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-12\"><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-14\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">spiders </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CrawlSpider</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Rule</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-15\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selector </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-16\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubanItem</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-17\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">linkextractors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sgml </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SgmlLinkExtractor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-18\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-19\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubanSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CrawlSpider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-20\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"douban\"</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"movie.douban.com\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"http://movie.douban.com/top250\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rules</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#将所有符合正则表达式的url加入到抓取列表中</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SgmlLinkExtractor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">allow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'http://movie\\.douban\\.com/top250\\?start=\\d+&amp;filter=&amp;type='</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#将所有符合正则表达式的url请求后下载网页代码, 形成response后调用自定义回调函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SgmlLinkExtractor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">allow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'http://movie\\.douban\\.com/subject/\\d+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'parse_page'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">follow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-30\"> </div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse_page</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DoubanItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//h1/span[@property=\"v:itemreviewed\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'description'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//div/span[@property=\"v:summary\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf098d129778005-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'url'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf098d129778005-37\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p></p>\n<h2>4.3. 未来要解决的问题</h2>\n<ul>\n<li>头部伪装</li>\n<li>表单提交</li>\n<li>编码转换</li>\n</ul>\n<p>豆瓣抓了一会儿, 还没等我兴奋就被禁掉了</p>\n<p><a href=\"http://doc.scrapy.org/en/latest/topics/practices.html#bans\" target=\"_blank\">ban</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04beaf0995037086906\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\n2014-12-17 22:02:17+0800 [douban] DEBUG: Crawled (403) &lt;GET http://www.douban.com/misc/sorry?original-url=http%3A%2F%2Fmovie.douban.com%2Fsubject%2F2209573%2F%3Ffrom%3Dsubject-page&gt; (referer: http://movie.douban.com/subject/1849031/)\r\n2014-12-17 22:02:17+0800 [douban] DEBUG: Ignoring response &lt;403 http://www.douban.com/misc/sorry?original-url=http%3A%2F%2Fmovie.douban.com%2Fsubject%2F2209573%2F%3Ffrom%3Dsubject-page&gt;: HTTP status code is not handled or not allowed\r\n2014-12-17 22:02:17+0800 [douban] DEBUG: Crawled (403) &lt;GET http://www.douban.com/misc/sorry?original-url=http%3A%2F%2Fmovie.douban.com%2Fsubject%2F1849031%2Fcomments%3Fsort%3Dtime&gt; (referer: http://movie.douban.com/subject/1849031/)\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0995037086906-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0995037086906-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0995037086906-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04beaf0995037086906-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04beaf0995037086906-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04beaf0995037086906-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0995037086906-2\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">403</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sorry</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">original</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3A</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fmovie.douban.com</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fsubject</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F2209573</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Ffrom</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Dsubject</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">movie</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">subject</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1849031</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0995037086906-3\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Ignoring </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">403</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sorry</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">original</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3A</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fmovie.douban.com</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fsubject</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F2209573</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Ffrom</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Dsubject</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HTTP </span><span class=\"crayon-e\">status </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handled </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">allowed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04beaf0995037086906-4\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">403</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">misc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sorry</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">original</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3A</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fmovie.douban.com</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fsubject</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2F1849031</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">2Fcomments</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Fsort</span><span class=\"crayon-o\">%</span><span class=\"crayon-cn\">3Dtime</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">movie</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">douban</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">subject</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1849031</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04beaf0995037086906-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0085 seconds] -->\r\n<p></p>\n<h1>5. 参考链接</h1>\n<hr>\n<ul>\n<li><a href=\"http://doc.scrapy.org/en/0.24/index.html#section-basics\" target=\"_blank\">Basic concepts</a></li>\n<li><a href=\"http://doc.scrapy.org/en/0.24/intro/overview.html#topics-whatelse\" target=\"_blank\">What else? section in Scrapy at a glance</a></li>\n<li><a href=\"http://doc.scrapy.org/en/0.24/topics/item-pipeline.html#topics-item-pipeline\" target=\"_blank\">Item Pipeline</a></li>\n<li><a href=\"http://doc.scrapy.org/en/0.24/intro/tutorial.html\" target=\"_blank\">Scrapy Tutorial</a></li>\n<li><a href=\"http://www.crummy.com/software/BeautifulSoup/bs3/documentation.zh.html\" target=\"_blank\">BeautifulSoup</a></li>\n<li><a href=\"http://wwwsearch.sourceforge.net/mechanize/\" target=\"_blank\">mechanize</a></li>\n<li><a href=\"http://scrapy.org/\" target=\"_blank\">scrapy</a></li>\n<li><a href=\"http://doc.scrapy.org/en/0.24/topics/selectors.html#topics-selectors\" target=\"_blank\">Selectors documentation</a></li>\n<li><a href=\"http://wsky.org/archives/191.html\" target=\"_blank\">scrapy 中文教程（爬cnbeta实例）</a></li>\n<li><a href=\"http://www.dmoz.org/\" target=\"_blank\">dmoz</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88431\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88431votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88431\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3dfaface114f6930374aa83020c7f0de.png"], "tags": "系列教程,Scrapy,爬虫", "url_object_id": "b969ff2acfa81e6bf9f58f81d6eb31da", "praise_nums": "1", "url": "http://python.jobbole.com/88431/", "title": "Python 爬虫 (六) -- Scrapy 框架学习", "create_date": "2017/08/28", "comment_nums": 0}
{"fav_nums": 11, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://codeburst.io/creating-a-full-stack-web-application-with-python-npm-webpack-and-react-8925800503d9\">Angela Juvet Branæs</a>   译文出处：<a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010717720\">疯狂的技术宅</a>   </div><p>把想法变为现实的能力是空想家与实干家的区别。不管你是在一家跨国公司工作，还是正在为自己的创业公司而努力，那些有能力将创意转化为真正产品的人，都具有宝贵的技能并拥有明显的实力。如果你能在不到一个小时的时间里创建一个全栈的Web应用，那么你就有能力为自己下一个伟大的想法迅速的的创建一个简单的MVP，或者在工作中快速构建一个新的应用程序。</p>\n<p><strong>本文介绍了创建一个简单的全栈Web应用所需的步骤，其中包括一个Python服务器和一个React前端。</strong>你可以轻松的在其基础上进行构建，根据你的实际需求进行修改，或是添加一些其他技术特性，例如Redux。</p>\n<p>世界在互联网的驱动下，计算机的基本技术和简单工具已经成为现代商业人士的必备技能。本文适合想要学习怎样制作一个简单的基于web的应用程序，并且具备基本编程技能的人。</p>\n<p>尽管你可以在我的<a href=\"https://github.com/angineering/FullStackTemplate\">GitHub</a>上找到本文所有的源代码，但是如果你能够从头开始创建这个程序，将会得到最好的学习成果。</p>\n<h1>初始项目设置</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2625370311686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.\r\n├── README.md\r\n└── fullstack_template/\r\n    ├── server/\r\n    └── static/\r\n        ├── css/\r\n        ├── dist/\r\n        ├── images/\r\n        └── js/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2625370311686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2625370311686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2625370311686-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2625370311686-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2625370311686-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2625370311686-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2625370311686-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2625370311686-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2625370311686-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2625370311686-1\"><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2625370311686-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2625370311686-3\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">fullstack_template</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2625370311686-4\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2625370311686-5\"><span class=\"crayon-h\">    </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">static</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2625370311686-6\"><span class=\"crayon-h\">        </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">css</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2625370311686-7\"><span class=\"crayon-h\">        </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">dist</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2625370311686-8\"><span class=\"crayon-h\">        </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">images</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2625370311686-9\"><span class=\"crayon-h\">        </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">js</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>我们将使用npm包管理器来处理Javascript依赖项。Npm是非常棒的，因为它易于使用，有良好的文档支持，有将近50万个包可供使用，以及合理的默认项目设置方案。</p>\n<blockquote><p>使用包管理器可以使您的项目依赖项保持最新状态，并能够获取和安装最新的包。</p></blockquote>\n<p>让我们初始化项目：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2631374073737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd fullstack_template/static\r\n$ npm init</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2631374073737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2631374073737-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2631374073737-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fullstack_template</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">static</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2631374073737-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-v\">init</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在初始化的过程中可以接受默认设置，但是你最好填写自己的程序名称和Git库等参数，结束后会自动在你的static目录下生成一个名为package.json 的文件。</p>\n<p><strong>package.json文件有如下几个作用：</strong></p>\n<ol>\n<li>跟踪所有的依赖项及其版本。</li>\n<li>它可是使其他开发人员了解你的项目，比如应用的名称、说明、所有者和所在存储库的位置。</li>\n<li>可以非常容易的通过npm进行自动化安装、运行和更新。</li>\n</ol>\n<h1>安装和配置Webpack</h1>\n<p>Webpack是一个模块打包器。它可以处理你所有的模块依赖，并生成静态资源。 使用模块打包器可以减少浏览器需要加载的模块数量，从而大大缩短了网页的加载时间。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e474befecc86207e10115bad821e0a8a.png\"><img class=\"aligncenter wp-image-88402 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e474befecc86207e10115bad821e0a8a.png\" alt=\"48\" width=\"800\" height=\"341\"></a><br>\n<em>演示了Webpack是怎样工作的</em></p>\n<p>安装Webpack：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2636039103826\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm i webpack --save-dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2636039103826-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2636039103826-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webpack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">save</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>要使用Webpack，我们需要添加一个 Webpack 配置文件。这个配置告诉 Webpack 在哪里可以找到 JavaScript 和 React 文件，以及在哪里放置生成的JavaScript包。</p>\n<p>在static目录中添加一个名为webpack.config.js的文件，下面的内容如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2639801942567\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconst webpack = require('webpack');\r\nconst config = {\r\n    entry:  __dirname + '/js/index.jsx',\r\n    output: {\r\n        path: __dirname + '/dist',\r\n        filename: 'bundle.js',\r\n    },\r\n    resolve: {\r\n        extensions: ['.js', '.jsx', '.css']\r\n    },\r\n};\r\nmodule.exports = config;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2639801942567-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2639801942567-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-1\"><span class=\"crayon-e\">const </span><span class=\"crayon-v\">webpack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'webpack'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-2\"><span class=\"crayon-e\">const </span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">entry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">__dirname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/js/index.jsx'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__dirname</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/dist'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">filename</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'bundle.js'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resolve</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">extensions</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'.js'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'.jsx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'.css'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2639801942567-11\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2639801942567-12\"><span class=\"crayon-v\">module</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exports</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h1>添加运行命令</h1>\n<p>向package.json文件中添加一些运行命令会是你的开发过程更加顺畅。我总是在自己的package.json 文件中添加一些<em>build</em>, <em>dev-build</em> 和 <em>watch</em> 命令。</p>\n<p><em>build</em>用于构建生产环境版本, <em>dev-build</em>用于开发时的构建版本，<em>watch</em>的作用和<em>dev-build</em>类似，只不过可以自动监视项目文件是否修改，并且自动重新构建被修改的部分，你只需要刷新浏览器就可以看到改动后的结果。</p>\n<p>自动化构建你的项目还有一个好处，那就是你不会耗费时间去思考为什么修改了代码却看不到效果，一般遇到这种情况纯粹是因为你忘记了构建它们！</p>\n<p>以下是我的 package.json 文件内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe263d070923150\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"name\": \"FullStackTemplate\",\r\n  \"version\": \"1.0.0\",\r\n  \"description\": \"A Template for creating a Full Stack Web Application using Python, NPM, Webpack and React\",\r\n  \"main\": \"index.js\",\r\n  \"scripts\": {\r\n    \"build\": \"webpack -p --progress --config webpack.config.js\",\r\n    \"dev-build\": \"webpack --progress -d --config webpack.config.js\",\r\n    \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\",\r\n    \"watch\": \"webpack --progress -d --config webpack.config.js --watch\"\r\n  },\r\n  \"keywords\": [\r\n    \"fullstack\",\r\n    \"template\",\r\n    \"python\",\r\n    \"react\",\r\n    \"npm\",\r\n    \"webpack\"\r\n  ],\r\n  \"author\": \"Angela Branaes\",\r\n  \"license\": \"MIT\",\r\n  \"devDependencies\": {\r\n    \"webpack\": \"^3.0.0\"\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe263d070923150-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe263d070923150-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"FullStackTemplate\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1.0.0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"description\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"A Template for creating a Full Stack Web Application using Python, NPM, Webpack and React\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"main\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"index.js\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"scripts\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"webpack -p --progress --config webpack.config.js\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dev-build\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"webpack --progress -d --config webpack.config.js\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"test\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"watch\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"webpack --progress -d --config webpack.config.js --watch\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"keywords\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"fullstack\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"template\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"python\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"react\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"npm\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"webpack\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"author\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Angela Branaes\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"license\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"MIT\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"devDependencies\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"webpack\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"^3.0.0\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe263d070923150-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe263d070923150-25\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h1>添加Babel支持</h1>\n<p>Babel能够允许我们使用最新的JavaScript特性编码，即便是浏览器还没有支持它们。通过安装ES2015和react presets，Babel能够把使用 Javascript 新特性和 React jsx 的代码转换为与当前浏览器兼容的 JavaScript 语法。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/358a3f5141855612d709c07ac6869a7c.png\"><img class=\"aligncenter wp-image-88403 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/358a3f5141855612d709c07ac6869a7c.png\" alt=\"48\" width=\"800\" height=\"222\"></a><br>\n<em>Babel转换JavaScript代码的示例</em></p>\n<p>安装Babel：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2641795249015\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm i babel-core babel-loader babel-preset-es2015 babel-preset-react --save-dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2641795249015-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2641795249015-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">babel</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">core </span><span class=\"crayon-v\">babel</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">loader </span><span class=\"crayon-v\">babel</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">es2015 </span><span class=\"crayon-v\">babel</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">react</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">save</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>添加Babel presets到package.json文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2645159230689\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"babel\": {\r\n  \"presets\": [\r\n    \"es2015\",\r\n    \"react\"\r\n  ]\r\n},</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2645159230689-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2645159230689-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2645159230689-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2645159230689-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2645159230689-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2645159230689-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2645159230689-1\"><span class=\"crayon-s\">\"babel\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2645159230689-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"presets\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2645159230689-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"es2015\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2645159230689-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"react\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2645159230689-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2645159230689-6\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在 Webpack 的配置中添加一条 babel-loader 规则。注意，我们在规则中排除了node_modules。这可以保证 Babel 不会尝不会对 node 模块进行转换，从而不会影响到node程序的加载速度。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2648618396076\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmodule: {\r\n  rules: [\r\n    {\r\n      test: /\\.jsx?/,\r\n      exclude: /node_modules/,\r\n      use: 'babel-loader'\r\n    }\r\n  ]\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2648618396076-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2648618396076-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2648618396076-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2648618396076-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2648618396076-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2648618396076-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2648618396076-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2648618396076-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2648618396076-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2648618396076-1\"><span class=\"crayon-v\">module</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2648618396076-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">rules</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2648618396076-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2648618396076-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-k \">test</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsx</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2648618396076-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">exclude</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">node_modules</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2648618396076-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">use</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'babel-loader'</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2648618396076-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2648618396076-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2648618396076-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>创建 index.jsx 和 index.html</p>\n<p>为了能在浏览器中看到一些东西，我们将创建一个简单的index.html页面，这个页面只显示一个由JavaScript弹出的“Hello World!”对话框，以此来证明设置是正确的。</p>\n<p>在static目录中创建一个index.html文件，并填写下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe264b107740356\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!— index.html —&gt;\r\n&lt;html&gt;\r\n  &lt;head&gt;\r\n    &lt;meta charset=\"utf-8\"&gt;\r\n    &lt;!-- Latest compiled and minified bootstrap CSS --&gt;\r\n    &lt;link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css\"&gt;\r\n    &lt;title&gt;Creating a Full-Stack Python Application with NPM, React.js and Webpack&lt;/title&gt;\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n    &lt;div id=\"content\" /&gt;\r\n    &lt;script src=\"dist/bundle.js\" type=\"text/javascript\"&gt;&lt;/script&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe264b107740356-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264b107740356-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span>—<span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">html</span><span class=\"crayon-h\"> </span>—<span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">meta </span><span class=\"crayon-v\">charset</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Latest </span><span class=\"crayon-e\">compiled </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">minified </span><span class=\"crayon-e\">bootstrap </span><span class=\"crayon-v\">CSS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-i\">Creating</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Full</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Stack </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">Application </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NPM</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">js </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Webpack</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-ta\">&lt;script </span><span class=\"crayon-e \">src</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"dist/bundle.js\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/javascript\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe264b107740356-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe264b107740356-13\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p>在static/js目录下创建一个index.jsx文件，并添加下面的代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe264e219161716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nalert(“Hello World!”);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe264e219161716-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe264e219161716-1\"><span class=\"crayon-e\">alert</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-e\">Hello </span><span class=\"crayon-v\">World</span><span class=\"crayon-o\">!</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>启动一个独立的终端窗口来运行前面创建的 Webpack watch 命令，这样当我们在工作时，它可以在后台一直运行。它会在没有编码错误的前提下自动构建你的包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2652711306524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm run watch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2652711306524-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2652711306524-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">npm </span><span class=\"crayon-e\">run </span><span class=\"crayon-v\">watch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>打开浏览器并访问index.html，应该能够看到弹出一个写着“Hello World!”的提示窗口。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/406fcb91c0c47c7b1184823eeb9d5695.png\"><img class=\"aligncenter wp-image-88404 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/406fcb91c0c47c7b1184823eeb9d5695.png\" alt=\"48\" width=\"800\" height=\"418\"></a></p>\n<h1>创建一个简单的 React 应用</h1>\n<p>首先需要安装React：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2655241121642\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm i react react-dom --save-dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2655241121642-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2655241121642-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">react </span><span class=\"crayon-v\">react</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">save</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下一步让我们用一个简单的 React 应用替换掉前面的index.jsx，并让它加载一个创建在单独的 App.js 文件中的 React 类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2658652137227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// index.jsx\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nReactDOM.render(&lt;App /&gt;, document.getElementById(\"content\"));</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2658652137227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2658652137227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2658652137227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe2658652137227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2658652137227-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2658652137227-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">jsx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2658652137227-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">React </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2658652137227-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ReactDOM </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"react-dom\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe2658652137227-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./App\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe2658652137227-5\"><span class=\"crayon-v\">ReactDOM</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">App</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getElementById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"content\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>React 类需要在不同的React源码文件中做导出，以方便后面的使用。通常每个文件中只写一个类，并且导出。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe265b669370199\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// App.jsx\r\nimport React from “react”;\r\nexport default class App extends React.Component {\r\n  render () {\r\n    return &lt;p&gt; Hello React!&lt;/p&gt;;\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265b669370199-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265b669370199-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265b669370199-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265b669370199-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265b669370199-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265b669370199-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265b669370199-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe265b669370199-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">jsx</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265b669370199-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">React </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span>“<span class=\"crayon-i\">react</span>”<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265b669370199-3\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">default </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App </span><span class=\"crayon-e\">extends </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265b669370199-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">render</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265b669370199-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hello </span><span class=\"crayon-v\">React</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265b669370199-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265b669370199-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>如果我们现在刷新浏览器，页面上将会显示“Hello React!”，而不再是“Hello World!”提示框。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a2c0ea6f4faa109a863e7d1cfd31666a.png\"><img class=\"aligncenter wp-image-88405 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a2c0ea6f4faa109a863e7d1cfd31666a.png\" alt=\"48\" width=\"800\" height=\"419\"></a></p>\n<h1>配置Python服务</h1>\n<p>关于Python服务器我们将会使用Flask。Flask是小型Python应用的最佳选择之一。“微框架（microframework）”可以使你在短短几分钟内轻松快速的使一个服务跑起来。对于大型应用和某些专业领域，企业通常会使用 Pyramid 或 Django。如果你想在自己的环境中拥有很大的灵活性和能够自定义配置的特性，Pyramid是一个不错的选择。Django则提供了一个全功能的Web框架，同时使你不必为应用的配置花费太多的时间，比如在数据库配置等方面。</p>\n<p>创建一个新的<a href=\"http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/\">virtualenv</a>并安装<a href=\"http://flask.pocoo.org/\">Flask</a></p>\n<p>在server目录中创建Flask服务源码文件，添加一个用来返回返回“Hello World!”的端点路由“/hello”，再添加一个主页面端点路由 “/“ 用来渲染index.html 模版。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe265f833993317\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# server.py\r\nfrom flask import Flask, render_template\r\n\r\napp = Flask(__name__, static_folder=\"../static/dist\", template_folder=\"../static\")\r\n\r\n@app.route(\"/\")\r\ndef index():\r\n    return render_template(\"index.html\")\r\n\r\n@app.route(\"/hello\")\r\ndef hello():\r\n    return \"Hello World!”\r\n\r\nif __name__ == \"__main__\":\r\napp.run()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04acfe265f833993317-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04acfe265f833993317-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-1\"><span class=\"crayon-c\"># server.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_template</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-4\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static_folder</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"../static/dist\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">template_folder</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"../static\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-6\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-7\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"index.html\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-10\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/hello\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-11\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello World!”</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04acfe265f833993317-14\"><span class=\"crayon-s\">if __name__ == \"</span><span class=\"crayon-k \">__main__</span>\"<span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04acfe265f833993317-15\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>运行python服务：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04acfe2662266583930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python server.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04acfe2662266583930-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04acfe2662266583930-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>接下来访问<a href=\"http://localhost:5000/\">http://localhost:5000/</a>就可以看到 react 应用提供的的“Hello React!”提示。访问<a href=\"http://localhost:5000/hello\">http://localhost:5000/hello</a> 将会看到由Python端点路由返回的“Hello World!”</p>\n<p><strong>恭喜，现在你已经有了一个基本的全栈应用</strong></p>\n<p>如果你想要学习如何与服务器进行通信，以及怎样使自己的程序更加美观，请等待本文的下半部分：《一个小时搭建一个全栈Web应用框架——界面美化与功能实现》</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88394\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88394votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88394\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/e474befecc86207e10115bad821e0a8a.png"], "tags": "实践项目,web开发", "url_object_id": "18b49f09811edc19ec325616cb7871da", "praise_nums": "2", "url": "http://python.jobbole.com/88394/", "title": "一个小时搭建一个全栈 Web 应用框架", "create_date": "2017/08/25", "comment_nums": 3}
{"fav_nums": 0, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://nothingbutsnark.svbtle.com/how-to-argue-for-pythons-use\">TALL, SNARKY CANADIAN</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/how-to-argue-for-pythons-use?lang=chs&amp;page=1#\">开源中国</a>   </div><p>最近我写了一篇关于<a href=\"http://nothingbutsnark.svbtle.com/why-i-dont-worry-about-pythons-popularity\" rel=\"nofollow\">我为什么不担心Python流失用户</a>的文章。几分钟之后有人问我Python的<strong>用法</strong>(<strong>usage</strong>)，而这篇文章没有提及，但却是一个让人深思的问题。我们看到，使用Python的用户很可能在未来保持高位，但是Python是否会被用到尽可能多的项目中是不能保证的；<strong>用户</strong>(<strong>users</strong>)数目很多而且稳定，但是项目中Python的<strong>用处</strong>(<strong>use</strong>)并不确定。</p>\n<p>这篇文章的用意是帮助表明Python仍然对大多数软件项目是切实可行的。我不担心把Python推销给反对其他动态语言(如Ruby)的人，因为我认为这些争论与个人喜好有关。这篇文章是讲给那些推销静态类型语言的人。具体上，这篇文章是针对Go的，但也可以是其他任何静态类型语言。</p>\n<p>”为什么Go?”，你可能会问。因为Go实际上在获取Python的用户。当2003到2005年间Python的增长曲线是个曲棍球棒时，Python还不是被推下山巅的王者，而是个弱者。传统上，Python从Java之类的语言阵营中获得用户，并且留住了他们(我不想谈C++用户，因为通常他们有严格的性能需求，需要一个系统语言，或者是性能成瘾者，并且需要好好恢复)。但是Go的情况不太一样。如今Python是使用最多的语言之一，而不再是弱者了。一旦在静态类型语言社区中出现一门语言，它的生产效率/性能的取舍相当好，那便足以说服一些Python的程序员选择Go而不再是Python了。</p>\n<h1 id=\"content_h1_3_5\">如今的Go</h1>\n<p>首先我应该说，Go是目前我第二喜欢的语言。如果今天我要启动一个项目，但不能说服人们使用Python，那我会提议使用Go。不要误解我在本文中说Go是门不好的语言。这篇文章的要点是说服其他人，Python是生产率/性能取舍游戏中Go之外切实可行的替代方案，而不是表达Go是门不好的语言。认为这篇文章是反Go的，那就是你的个人想法，而且不应该这样认为。</p>\n<p>我应该说，我偶尔在工作中使用Go，并有点想关注这门语言的社区。既然我不能仅凭想象就成为Go专家，但这番话并不是仅从文档或者博客中提取出来的。但是由于我是Python开发团队的一份子，无论我如何试图表现得公平，固有的偏见某种程度上还是有的。</p>\n<p>那么，带着这些警告，我们来看下Go提供给开发者什么。</p>\n<h2>生产率</h2>\n<p>我看待Go的方式是，使用你最喜欢的编程语言，移除那些难于加速生产率的特性，就是Go。静态类型的影响被降到最小，因为通常只有在API边界时你才会面对它。结构类型同样使事情变得简单(把它认为是鸭子类型)。语法并不笨拙(虽然它使用了花括号)。不要认为Go是C/C++去掉不安全的特性，加上生产率更高的东西，不然你会很失望(比如，“为什么我不能使用<strong>make()</strong>内置函数，也不能像map类型一样对返回值进行计数”，这种看待Go的方式是错误的；这就是为什么C++开发者没有转到Go的原因)。快速编译也使开发周期更像一个动态语言，而不是一个需要编译的语言。而且事实上有些人喜欢没有异常机制带来的冗长，因为这促使你处理每种异常情形而不是(意外地)忽略它们(这是贯穿Go初始系统语言设计的实例)。还有，这门语言本身相当短小易记，并有严格的前向兼容性要求(forward-compatibility requirements)(你不可能更快地获得泛型)，大体上使用Go来编码是件很愉快的事情。</p>\n<p>由于是静态类型，Go可以很容易地获得工具支持(它对之前以此为设计目标的语言也有帮助)。Go确保核心工具跟随Go本身提供，也是明智之举。<a href=\"http://golang.org/cmd/go/#hdr-Run_gofmt_on_package_sources\" rel=\"nofollow\">go fmt</a>强制执行Go风格的规则，并允许通过用户自定义的规则来重构代码(“采用制表符缩进”不再是问题，因为这意味着你可以随心所欲地设置编辑器来代表制表符，然后<strong>go fmt</strong>将其转换为普通制表符以适用VCS)。<a href=\"http://golang.org/cmd/go/#hdr-Run_go_tool_fix_on_packages\" rel=\"nofollow\">go fix</a>会更新代码以跟最新发布的版本保持一致。<a href=\"http://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"nofollow\">go get</a>获取依赖并安装。</p>\n<p>Go最后一个生产率功能是它静态编译所有东西，使部署更简单。如果你使用容器来开发和部署，这也不算什么。只有当你发布单个文件的命令行工具，而不是一组依赖和你自己的代码时，这才算得上事。</p>\n<h2>性能</h2>\n<p>就性能来说，Go做的很好。很难指出任何基准能准确的证明Go总是最快的选择，甚至<a href=\"http://benchmarksgame.alioth.debian.org/\" rel=\"nofollow\">计算机语言基准游戏</a>中<a href=\"http://benchmarksgame.alioth.debian.org/u64q/benchmark.php?test=all&amp;lang=python3&amp;lang2=go&amp;data=u64q\" rel=\"nofollow\">一些基准证明CPython 3是最快的</a>。但是通常情况下可以认为对于你的任何工作来说Go已经足够快了。</p>\n<p>Go真正出色的地方是<a href=\"http://golang.org/doc/effective_go.html#concurrency\" rel=\"nofollow\">并发性</a>(concurrency) 。要注意并发代码并不是通常误解的并行(parallelized)代码; 并发代码仍然可以是单线程的，仅仅在任务切换方面更加简单/出色。Go通过使用goroutine使连续并发的代码执行起来绝对的简单。如果你不想使用共享内存的方式(虽然也同样支持)，该语言提供的通信管道允许以非常简洁的消息传递方式进行并发编程。将所有特征整合进此语言中成为尽可能使用该语言开发并发代码的又一原因。换句话说，Go程序运行很快，该语言尽力使你在合理的方式上获得该效果。</p>\n<h1 id=\"content_h1_7_5\">如今的Python</h1>\n<p>如果顺利的话我已经让你相信Go是一种优秀的编程语言，除非因为其他原因，一些人不会认为我在整篇文章对Go的描述很糟糕。现在我们讨论一下Python的生产率/性能是怎么样的。</p>\n<h2>生产率</h2>\n<p>首先也是最重要的，Python非常容易学习。这也是为什么<a href=\"http://cacm.acm.org/blogs/blog-cacm/176450-python-is-now-the-most-popular-introductory-teaching-language-at-top-us-universities/fulltext\" rel=\"nofollow\">在当前高评价的美国大学中</a>将<a href=\"http://cacm.acm.org/blogs/blog-cacm/176450-python-is-now-the-most-popular-introductory-teaching-language-at-top-us-universities/fulltext\" rel=\"nofollow\">Python作为</a>首选的<a href=\"http://cacm.acm.org/blogs/blog-cacm/176450-python-is-now-the-most-popular-introductory-teaching-language-at-top-us-universities/fulltext\" rel=\"nofollow\">教学语言</a> 。这相当于该语言拥有成熟稳定的新程序员的来源以及更容易培训其他程序员。 我想，要说服别人只用几行Python代码就会完成很多工作这并不难(<a href=\"http://benchmarksgame.alioth.debian.org/u64q/benchmark.php?test=all&amp;lang=python3&amp;lang2=go&amp;data=u64q\" rel=\"nofollow\">Go/Python 3比较</a> 显示Python每次都比Go使用更少的代码完成相同的工作)。所以我会坚持认为使用Python会更高产，即使和Go相比，这不会有人反对。</p>\n<p>通常大家反对Python的地方是在工具支持方面。但是如果你注意到我指出的Go相关的支持工具，fmt, fix, 和 get, Python社区也有对等的工具。对遵循<a href=\"http://legacy.python.org/dev/peps/pep-0008/\" rel=\"nofollow\">PEP 8</a>的风格格式化(style formating), 可以在提交检查时使用<a href=\"https://pypi.python.org/pypi/pep8\" rel=\"nofollow\">pep8</a>，或者如果想要更多go fmt风格的自动重写可以使用<a href=\"https://pypi.python.org/pypi/autopep8/\" rel=\"nofollow\">autopep8</a>。对用于重构的go fix或go fmt，你可以说<a href=\"https://docs.python.org/3/library/2to3.html\" rel=\"nofollow\">2to3</a>也可以完成同样的功能。对于go get, Python有<a href=\"https://pip.pypa.io/\" rel=\"nofollow\">pip</a>。我们有<a href=\"https://docs.python.org/3/library/venv.html#module-venv\" rel=\"nofollow\">venv</a>/<a href=\"http://virtualenv.readthedocs.org/\" rel=\"nofollow\">virtualenv</a>或<a href=\"https://pypi.python.org/pypi/cx_Freeze\" rel=\"nofollow\">cx_Freeze</a>这样的代码冻结工具(跟其他一样，位于容器之上?on top of containerization like anything else)，而不是静态编译的二进制包。甚至有贯穿项目的代码分析工具如<a href=\"http://pylint.org/\" rel=\"nofollow\">pylint</a>。说Python因为缺少工具支持而不能用于大型项目，这种观点对我来说是很肤浅的。</p>\n<div class=\"translator-info\">\n<p>如果说有哪方面Python完全做的好，那就一定是它丰富的第三方扩展库和相应的工具可供使用，就像在PyPI上面看到的那样（我相信肯定有人忍不住要争论说，“并不是所有的第三方库都能够在Python3上面运行啊”，事实确实如此，然而，这些第三方扩展库对Python3的支持已经相当好了，而且还在继续改善中，所以我不会太在意这个争论，另外，你可以同时使用Python2/3两个版本进行编码，不需要关心针对哪个版本）。看一下godoc.org，上面显示Go也并不缺少社区支持，Pytho之所以能够拥有更多可用的第三方库仅仅是因为它的年龄，这个状态也会继续持续。</p>\n<h2>性能</h2>\n<p>因为Python已经存在很久，且变得如此庞大， 简单地去说 “Python是足够快的” 不能说明整个的情况， 那是因为有各种各样的实现加速的方式。但是在深入到VM级别的选项之后，意味着Python的stdlib提供了获得加速的选项。举例来说， <a href=\"https://docs.python.org/3/library/concurrent.futures.html#module-concurrent.futures\" rel=\"nofollow\">concurrent.futures</a> 是尴尬地执行并行代码的方式，这种方式是极其简单的。而在Python 3.3中，新的<a href=\"https://docs.python.org/3/library/asyncio.html#module-asyncio\" rel=\"nofollow\">asyncio</a>编写了异步代码。它没有像Go那样被集成进语言，在Python中的并发程序设计是可行的，且在方式上也未必是那么痛苦的。</p>\n<p>但是最好的办法是，你可以在选择的VM里改变Python代码的性能。</p>\n<h1 id=\"content_h3_11_5\">CPython + Cython</h1>\n<p>如果你在使用 C 拓展模块，CPython 就会使你最好的选择(可能你不知道这个术语，CPython 是你可以在 <a href=\"https://www.python.org/\" target=\"_blank\" rel=\"nofollow\">python.org</a> 获得的解释器)。对大多数的情况而言性能至少合理些– 因为某些原因，一些人认为Python 开发团队不关心性能，这个一个谎言 – 而且即将会成为新的特性，因为 CPython 同时担当着语言规范的作用。</p>\n<p>如果认为你的一些内循环代码确实需要提高些速度， <a href=\"http://cython.org/\" rel=\"nofollow\">Cython</a> 是 CPython 的选择。Cython 会尽可能的将你的 Python 代码编译成 C 拓展代码。有若干种支持的方法可以产生更好的 C 代码，所以这取决于你需要怎样的 Cython 特性。Cython 同时也使写出 C 拓展模块更加简单(但要继续读下去，除了CPython 还有其他的选择)。</p>\n<h1 id=\"content_h3_12_5\">PyPy + cffi</h1>\n<p>如果你不依赖于已存在的 C 拓展模块，<a href=\"http://pypy.org/\" target=\"_blank\" rel=\"nofollow\">PyPy</a> 会给你提供总体上最好的性能。它的JIT非常好而且它的团队欢迎受到使用 CPython 并且运行更快的代码的挑战，因为他们痛恨在 <a href=\"http://speed.pypy.org/\" rel=\"nofollow\">speed.pypy.org</a> 中显示的那么慢。实话说，除非PyPy不支持你真的想用的那个版本的 Python – 因为 PyPy 确实会落后2个版本, 比如<a href=\"http://pypy.org/py3donate.html\" target=\"_blank\" rel=\"nofollow\">pypy3</a> 现在支持 Python 3.2 然而 3.4 是最新的 CPython 发布版; 它们期盼在这个问题上能得到帮助(donation) – 我只能考虑不使用PyPy因为你依赖于已存在的C拓展模块C(<a href=\"http://www.numpy.org/\" rel=\"nofollow\"> numpy </a>是最常见的问题，虽然 <a href=\"http://pypy.org/numpydonate.html\" target=\"_blank\" rel=\"nofollow\">PyPy is looking for donations</a> 可修复这个问题)。</p>\n<p>但这不意味着，如果<strong>你</strong>想封装一些C代码就用不了PyPy。PyPy项目还有另外一个子项目<a href=\"https://cffi.readthedocs.org/\" rel=\"nofollow\">cffi</a>，这个项目的目的是使Python代码也可以利用封装的C代码。使用cffi的关键好处在于，一旦你使用了cffi，C代码就可以用于CPython<strong>和</strong>PyPy(我认为IronPython和Jython也在添加对cffi的支持)。所以如果你在封装C代码，我强烈建议你看下cffi，而不是手动写C扩展模块或者使用Cython，这样你有更好的Python实现的支持，还能使用PyPy。</p>\n<h1 id=\"content_h2_13_9\">Numba</h1>\n<p>如果你在做数值相关的工作，你肯定应该考虑<a href=\"http://numba.pydata.org/\" rel=\"nofollow\">Numba</a>这个选择。在科学计算上，<a href=\"http://economics.sas.upenn.edu/~jesusfv/comparison_languages.pdf\" rel=\"nofollow\">经济学家注意到了它的性能</a>。虽然在普通的Python编程上，它不能帮到什么忙，但是如果在Python非常强大的科学计算栈中用到了numpy或者其他模块，Numba使用LLVM来进行JIT肯定会有帮助。</p>\n<h1 id=\"content_h1_14_5\">未来的 Python</h1>\n<p>考虑到所有内容，Python肯定不是停滞不前的(Go也没有，比如它们都在忙于用Go重写编译器和将连接器以外的东西转移进编译器来获得更快的编译速度）。Python 的未来看起来还是光明的。</p>\n<h2>生产率</h2>\n<p>Python 是一种在进化的语言。不像 Go，Python 乐于改变该语言，甚至是以永远不再向后兼容的方式。这意味着Python会比Go更快的速度变得更加高效(虽然在Go 2开发之前Go的团队对该语言进化持哪种观点还是未知的)。</p>\n<p>在工具方面，标准化的 <a href=\"http://legacy.python.org/dev/peps/pep-3107/\" rel=\"nofollow\">函数注解</a> 是为了声明类型。 这是在 <a href=\"https://mail.python.org/pipermail/python-dev/2014-April/133873.html\" rel=\"nofollow\">PyCon 2014 语言峰会</a>期间提出的，针对函数参数和返回值，里面提到有大量的项目现在想要有一种声明预期类型的方法，使用函数注解考虑到了在某些方面的标准化，最终可能对标准库函数也会是有用的。在<a href=\"http://mypy-lang.org/%20+%20https://github.com/google/pytypedecl\" rel=\"nofollow\">pytypedecl的邮件列表</a>上的讨论还没有开始，但是我知道PEP大概是要开始了。不仅仅是对像Cython和Numba这样的项目在什么地方使用打印信息，还包括在诸如代码分析，重构等的时候使用。</p>\n<h2>性能</h2>\n<p>长远看来，有两个项目可以帮助提升Python的性能。一个是新的Python虚拟机Pyston。尽管Pyston刚出现时间不长，但它的目标是要使用LLVM的JIT(<span style=\"color: #ff0000\"><strong>是的这不由得让人想起Unladen Swallow，然而LLVM的JIT已经比它在2009年时好很多了</strong></span>，所以这个项目还是颇有希望取得好效果的)。</p>\n<p>其实PyPy-STM才是真正能够让我兴奋的项目，”STM”表示”软件事务性内存”，它基本上是允许Python丢弃GIL的。PyPy-STM此时的性能比PyPy要慢大约1.2-3倍，这样的表现已经相当不错了。目前他们正在寻找资助，来继续这项工作，要实现这个目标：使得带有两个线程的PyPy-STM值得在PyPy上普遍运行。</p>\n<h1 class=\"translator-info\">在黑暗中做出选择</h1>\n<p>希望这篇博客传达的不是一个总结， 而是一个关于生产力/性能折衷的方案。 Python已经清晰地拥有了强大的生产力辅助并且没有哪个领域表现不佳，这仍是我选择的语言。如果你发现自己有可能选择Python项目以外的东西，请一定要停下来思考没有使用Python所带来的生产力损失，然后看看你有各种选项让Python加快执行，这样你再去做一个全面的关于Python是否可以为你的项目工作的选择。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88461\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88461votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88461\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "tags": "观点与动态,语言", "url_object_id": "ab91e97e105cfc2c9d1fac99097b2ef1", "praise_nums": "1", "url": "http://python.jobbole.com/88461/", "title": "如何为使用 Python 语言而辩论", "create_date": "2017/08/31", "comment_nums": 0}
{"fav_nums": 9, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/e062b3dd110c\">Andrew_liu</a>   </div><p>python的网络变成比c语言简单许多, 封装许多底层的实现细节, 方便程序员使用的同时, 也使程序员比较难了解一些底层的东西, 我觉得学<strong>网络编程</strong>还是用c语言更好一点.</p>\n<blockquote><p>写这篇博文, 也希望回顾并整理一下以前学过的c语言和linux下一些东西, 会将一些Linux网络编程的函数和Python网络变成函数做一个简单的对照, 方便记忆</p></blockquote>\n<h1>1. Socket套接字的概念</h1>\n<hr>\n<p><strong>Socket(翻译为套接字, 我觉得很挫)</strong>,是操作系统内核中的一个数据结构，它是<strong>网络中的节点进行相互通信的门户</strong>。它是网络进程的ID。网络通信，归根到底还是进程间的通信（不同计算机上的进程间通信, 又称进程间通信, IP协议进行的主要是端到端通信）。在网络中，每一个节点（计算机或路由）都有一个网络地址，也就是IP地址。两个进程通信时，首先要确定各自所在的网络节点的网络地址。但是，网络地址只能确定进程所在的计算机，而一台计算机上很可能同时运行着多个进程，所以仅凭网络地址还不能确定到底是和网络中的哪一个进程进行通信，因此套接口中还需要包括其他的信息，也就是端口号（PORT）。在一台计算机中，一个端口号一次只能分配给一个进程，也就是说，在一台计算机中，端口号和进程之间是一一对应关系。</p>\n<p>所以，使用端口号和网络地址的组合可以唯一的确定整个网络中的一个网络进程.</p>\n<blockquote><p>端口号的范围从0~65535，一类是由互联网指派名字和号码公司ICANN负责分配给一些常用的应用程序固定使用的“周知的端口”，其值一般为0~1023, 用户自定义端口号一般大于等于1024, 我比较喜欢用8888</p></blockquote>\n<p>每一个socket都用一个半相关描述{协议、本地地址、本地端口}来表示；一个完整的套接字则用一个相关描述{协议、本地地址、本地端口、远程地址、远程端口}来表示。socket也有一个类似于打开文件的函数调用，该函数返回一个整型的socket描述符，随后的连接建立、数据传输等操作都是通过socket来实现的</p>\n<h2>1.1. Socket类型</h2>\n<blockquote><p>socket类型在Liunx和Python是一样的, 只是Python中的类型都定义在<strong>socket模块</strong>中, 调用方式<strong>socket.SOCK_XXXX</strong></p></blockquote>\n<ul>\n<li>流式socket（SOCK_STREAM） <strong>用于TCP通信</strong></li>\n</ul>\n<blockquote><p>流式套接字提供可靠的、面向连接的通信流；它使用TCP协议，从而保证了数据传输的正确性和顺序性</p></blockquote>\n<ul>\n<li>数据报socket（SOCK_DGRAM） <strong>用于UDP通信</strong></li>\n</ul>\n<blockquote><p>数据报套接字定义了一种无连接的服务，数据通过相互独立的报文进行传输，是无序的，并且不保证是可靠、无差错的。它使用数据报协议UDP</p></blockquote>\n<ul>\n<li>原始socket（SOCK_RAW） <strong>用于新的网络协议实现的测试等</strong></li>\n</ul>\n<blockquote><p>原始套接字，普通的套接字无法处理ICMP、IGMP等网络报文，而SOCK_RAW可以, 其次，SOCK_RAW也可以处理特殊的IPv4报文；此外，利用原始套接字，可以通过IP_HDRINCL套接字选项由用户构造IP头。</p></blockquote>\n<h1>2. Socket编程</h1>\n<hr>\n<h2>2.1. TCP通信</h2>\n<p>TCP通信的基本步骤如下：<br>\n服务端：socket—bind—listen—while(True){—accept—recv—send—-}—close<br>\n客户端：socket———————————-connect—send—recv——-close</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9fe0c92fbce827c80d976dd417a8a82.png\"><img class=\"aligncenter wp-image-88398 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9fe0c92fbce827c80d976dd417a8a82.png\" alt=\"48\" width=\"329\" height=\"368\"></a></p>\n<div style=\"text-align: center\">TCP</div>\n<p><strong>socket函数</strong><br>\n使用给定的地址族、套接字类型、协议编号（默认为0）来创建套接字</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313868927723619\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint socket(int domain, int type, int protocol);\r\ndomain：AF_INET：Ipv4网络协议 AF_INET6：IPv6网络协议\r\ntype : tcp：SOCK_STREAM   udp：SOCK_DGRAM\r\nprotocol : 指定socket所使用的传输协议编号。通常为0.\r\n返回值：成功则返回套接口描述符，失败返回-1。\r\n\r\n#python\r\nsocket.socket([family[, type[, proto]]])\r\nfamily : AF_INET (默认ipv4), AF_INET6(ipv6) or AF_UNIX(Unix系统进程间通信). \r\ntype : SOCK_STREAM (TCP), SOCK_DGRAM(UDP) . \r\nprotocol : 一般为0或者默认\r\n\r\n如果socket创建失败会抛出一个socket.error异常</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313868927723619-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313868927723619-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">domain</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-3\"><span class=\"crayon-i\">domain</span>：<span class=\"crayon-v\">AF</span><span class=\"crayon-sy\">_</span>INET：<span class=\"crayon-i\">Ipv4</span>网络协议<span class=\"crayon-h\"> </span><span class=\"crayon-v\">AF</span><span class=\"crayon-sy\">_</span>INET6：<span class=\"crayon-i\">IPv6</span>网络协议</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-4\"><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">tcp</span>：<span class=\"crayon-e\">SOCK_STREAM   </span><span class=\"crayon-i\">udp</span>：<span class=\"crayon-e\">SOCK_DGRAM</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-5\"><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>指定<span class=\"crayon-k \">socket</span>所使用的传输协议编号。通常为<span class=\"crayon-cn\">0.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-6\">返回值：成功则返回套接口描述符，失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span>。</div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-8\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-9\"><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">family</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proto</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-10\"><span class=\"crayon-v\">family</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AF_INET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>默认<span class=\"crayon-v\">ipv4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AF_INET6</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ipv6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AF_UNIX</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">Unix</span>系统进程间通信<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-11\"><span class=\"crayon-k \">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOCK_STREAM</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">TCP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SOCK_DGRAM</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">UDP</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-12\"><span class=\"crayon-v\">protocol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>一般为<span class=\"crayon-cn\">0</span>或者默认</div><div class=\"crayon-line\" id=\"crayon-59d04b6313868927723619-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313868927723619-14\">如果<span class=\"crayon-k \">socket</span>创建失败会抛出一个<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">error</span>异常</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p>\n<h3>2.1.1. 服务器端函数</h3>\n<p><strong>bind函数</strong><br>\n将套接字绑定到地址, python下,以元组（host,port）的形式表示地址, Linux下使用<strong>sockaddr_in</strong>结构体指针</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313873528251060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint bind(int sockfd, struct sockaddr * my_addr, int addrlen);\r\nsockfd : 前面socket()的返回值\r\nmy_addr : 结构体指针变量\r\n#####\r\nstruct sockaddr_in  //常用的结构体\r\n{\r\nunsigned short int sin_family;  //即为sa_family AF_INET\r\nuint16_t sin_port;  //为使用的port编号\r\nstruct in_addr sin_addr;  //为IP地址\r\nunsigned char sin_zero[8];  //未使用\r\n};\r\nstruct in_addr\r\n{\r\nuint32_t s_addr;\r\n};\r\n####\r\naddrlen : sockaddr的结构体长度。通常是计算sizeof(struct sockaddr);\r\n返回值：成功则返回0，失败返回-1\r\n\r\n\r\n\r\n#python\r\ns.bind(address)\r\ns为socket.socket()返回的套接字对象\r\naddress为元组（host,port）\r\nhost: ip地址, 为一个字符串\r\npost: 自定义主机号, 为整型</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313873528251060-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313873528251060-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addrlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>前面<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>的返回值</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-4\"><span class=\"crayon-v\">my_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>结构体指针变量</div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-5\"><span class=\"crayon-c\">#####</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-6\"><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sockaddr_in</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span>常用的结构体</div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-8\"><span class=\"crayon-e\">unsigned </span><span class=\"crayon-e\">short </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sin_family</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span>即为<span class=\"crayon-e\">sa_family </span><span class=\"crayon-e\">AF_INET</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-9\"><span class=\"crayon-e\">uint16_t </span><span class=\"crayon-v\">sin_port</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span>为使用的<span class=\"crayon-i\">port</span>编号</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-10\"><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">in_addr </span><span class=\"crayon-v\">sin_addr</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span>为<span class=\"crayon-i\">IP</span>地址</div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-11\"><span class=\"crayon-e\">unsigned </span><span class=\"crayon-e\">char </span><span class=\"crayon-v\">sin_zero</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span>未使用</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-12\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-13\"><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">in_addr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-14\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-15\"><span class=\"crayon-e\">uint32_t </span><span class=\"crayon-v\">s_addr</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-17\"><span class=\"crayon-c\">####</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-18\"><span class=\"crayon-v\">addrlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sockaddr</span>的结构体长度。通常是计算<span class=\"crayon-e\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-19\">返回值：成功则返回<span class=\"crayon-cn\">0</span>，失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-20\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-22\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-23\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-24\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-25\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-26\"><span class=\"crayon-i\">address</span>为元组（<span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">port</span>）</div><div class=\"crayon-line\" id=\"crayon-59d04b6313873528251060-27\"><span class=\"crayon-v\">host</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ip</span>地址<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>为一个字符串</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313873528251060-28\"><span class=\"crayon-v\">post</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>自定义主机号<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>为整型</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p><strong>listen函数</strong><br>\n使服务器的这个端口和IP处于监听状态，等待网络中某一客户机的连接请求。如果客户端有连接请求，端口就会接受这个连接</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313878943621782\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint listen(int sockfd,int backlog);\r\nsockfd : 为前面socket的返回值.\r\nbacklog : 指定同时能处理的最大连接要求，通常为10或者5。最大值可设至128\r\n返回值：成功则返回0，失败返回-1\r\n\r\n#python\r\ns.listen(backlog)\r\ns为socket.socket()返回的套接字对象\r\nbacklog : 操作系统可以挂起的最大连接数量。该值至少为1，大部分应用程序设为5就可以了</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313878943621782-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313878943621782-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313878943621782-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313878943621782-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313878943621782-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313878943621782-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313878943621782-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313878943621782-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313878943621782-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313878943621782-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313878943621782-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313878943621782-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">backlog</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313878943621782-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313878943621782-4\"><span class=\"crayon-v\">backlog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>指定同时能处理的最大连接要求，通常为<span class=\"crayon-cn\">10</span>或者<span class=\"crayon-cn\">5</span>。最大值可设至<span class=\"crayon-cn\">128</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313878943621782-5\">返回值：成功则返回<span class=\"crayon-cn\">0</span>，失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313878943621782-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313878943621782-7\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313878943621782-8\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">backlog</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313878943621782-9\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313878943621782-10\"><span class=\"crayon-v\">backlog</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>操作系统可以挂起的最大连接数量。该值至少为<span class=\"crayon-cn\">1</span>，大部分应用程序设为<span class=\"crayon-cn\">5</span>就可以了</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p><strong>accept函数</strong><br>\n接受远程计算机的连接请求，建立起与客户机之间的通信连接。服务器处于监听状态时，如果某时刻获得客户机的连接请求，此时并不是立即处理这个请求，而是将这个请求放在等待队列中，当系统空闲时再处理客户机的连接请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b631387c436787055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint accept(int s,struct sockaddr * addr,int * addrlen);\r\nsockfd : 为前面socket的返回值.\r\naddr : 为结构体指针变量，和bind的结构体是同种类型的，系统会把远程主机的信息（远程主机的地址和端口号信息）保存到这个指针所指的结构体中。\r\naddrlen : 表示结构体的长度，为整型指针 \r\n返回值：成功则返回新的socket处理代码new_fd，失败返回-1\r\n\r\n#python\r\ns.accept()\r\ns为socket.socket()返回的套接字对象\r\n返回（conn,address）,其中conn是新的套接字对象，可以用来接收和发送数据。address是连接客户端的地址</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387c436787055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387c436787055-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387c436787055-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387c436787055-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387c436787055-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387c436787055-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387c436787055-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addrlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387c436787055-4\"><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为结构体指针变量，和<span class=\"crayon-i\">bind</span>的结构体是同种类型的，系统会把远程主机的信息（远程主机的地址和端口号信息）保存到这个指针所指的结构体中。</div><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-5\"><span class=\"crayon-v\">addrlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示结构体的长度，为整型指针<span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387c436787055-6\">返回值：成功则返回新的<span class=\"crayon-k \">socket</span>处理代码<span class=\"crayon-v\">new</span><span class=\"crayon-sy\">_</span>fd，失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387c436787055-8\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-9\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387c436787055-10\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line\" id=\"crayon-59d04b631387c436787055-11\">返回（<span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">address</span>）<span class=\"crayon-sy\">,</span>其中<span class=\"crayon-i\">conn</span>是新的套接字对象，可以用来接收和发送数据。<span class=\"crayon-i\">address</span>是连接客户端的地址</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p></p>\n<h3>2.1.2. 客户端函数</h3>\n<p><strong>connect函数</strong><br>\n用来请求连接远程服务器</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b631387f366998490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint connect (int sockfd,struct sockaddr * serv_addr,int addrlen);\r\nsockfd : 为前面socket的返回值.\r\nserv_addr : 为结构体指针变量，存储着远程服务器的IP与端口号信息\r\naddrlen : 表示结构体变量的长度\r\n返回值：成功则返回0，失败返回-1\r\n\r\n#python\r\ns.connect(address)\r\ns为socket.socket()返回的套接字对象\r\naddress : 格式为元组（hostname,port），如果连接出错，返回socket.error错误</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387f366998490-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387f366998490-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387f366998490-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387f366998490-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631387f366998490-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631387f366998490-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387f366998490-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">connect</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">serv_addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addrlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387f366998490-4\"><span class=\"crayon-v\">serv_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为结构体指针变量，存储着远程服务器的<span class=\"crayon-i\">IP</span>与端口号信息</div><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-5\"><span class=\"crayon-v\">addrlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示结构体变量的长度</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387f366998490-6\">返回值：成功则返回<span class=\"crayon-cn\">0</span>，失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387f366998490-8\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-9\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631387f366998490-10\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line\" id=\"crayon-59d04b631387f366998490-11\"><span class=\"crayon-v\">address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>格式为元组（<span class=\"crayon-v\">hostname</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">port</span>），如果连接出错，返回<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">error</span>错误</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p>\n<h3>2.1.3. 通用函数</h3>\n<p>接收远端主机传来的数据</p>\n<p><strong>recv函数</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313883183270389\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint recv(int sockfd,void *buf,int len,unsigned int flags);\r\nsockfd : 为前面accept的返回值.也就是新的套接字。\r\nbuf : 表示缓冲区\r\nlen : 表示缓冲区的长度\r\nflags : 通常为0\r\n返回值：成功则返回实际接收到的字符数，可能会少于你所指定的接收长度。失败返回-1\r\n\r\n\r\n#python\r\ns.recv(bufsize[,flag])\r\ns为socket.socket()返回的套接字对象\r\nbufsize : 指定要接收的数据大小\r\nflag : 提供有关消息的其他信息，通常可以忽略\r\n返回值为数据以字符串形式</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313883183270389-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313883183270389-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">unsigned </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-i\">accept</span>的返回值<span class=\"crayon-sy\">.</span>也就是新的套接字。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-4\"><span class=\"crayon-v\">buf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示缓冲区</div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-5\"><span class=\"crayon-k \">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示缓冲区的长度</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-6\"><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>通常为<span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-7\">返回值：成功则返回实际接收到的字符数，可能会少于你所指定的接收长度。失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-10\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-11\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bufsize</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-12\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-13\"><span class=\"crayon-v\">bufsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>指定要接收的数据大小</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313883183270389-14\"><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>提供有关消息的其他信息，通常可以忽略</div><div class=\"crayon-line\" id=\"crayon-59d04b6313883183270389-15\">返回值为数据以字符串形式</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p><strong>send函数</strong><br>\n发送数据给指定的远端主机</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313886013661235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint send(int s,const void * msg,int len,unsigned int flags);\r\nsockfd : 为前面socket的返回值.\r\nmsg : 一般为常量字符串\r\nlen : 表示长度\r\nflags : 通常为0\r\n返回值：成功则返回实际传送出去的字符数，可能会少于你所指定的发送长度。失败返回-1\r\n\r\n#python\r\ns.send(string[,flag])\r\ns为socket.socket()返回的套接字对象\r\nstring : 要发送的字符串数据 \r\nflag : 提供有关消息的其他信息，通常可以忽略\r\n返回值是要发送的字节数量，该数量可能小于string的字节大小。\r\ns.sendall(string[,flag])\r\n#完整发送TCP数据。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。\r\n返回值 : 成功返回None，失败则抛出异常。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313886013661235-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313886013661235-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">const </span><span class=\"crayon-v\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">unsigned </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-4\"><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>一般为常量字符串</div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-5\"><span class=\"crayon-k \">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示长度</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-6\"><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>通常为<span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-7\">返回值：成功则返回实际传送出去的字符数，可能会少于你所指定的发送长度。失败返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-9\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-10\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-11\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-12\"><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>要发送的字符串数据<span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-13\"><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>提供有关消息的其他信息，通常可以忽略</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-14\">返回值是要发送的字节数量，该数量可能小于<span class=\"crayon-k \">string</span>的字节大小。</div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-15\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313886013661235-16\"><span class=\"crayon-c\">#完整发送TCP数据。将string中的数据发送到连接的套接字，但在返回之前会尝试发送所有数据。</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313886013661235-17\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>成功返回<span class=\"crayon-t\">None</span>，失败则抛出异常。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p><strong>close函数</strong><br>\n关闭套接字</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b631388a624900517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint close(int fd);\r\nfd : 为前面的sockfd\r\n返回值：若文件顺利关闭则返回0，发生错误时返回-1\r\n\r\n#python\r\ns.close()\r\ns为socket.socket()返回的套接字对象</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b631388a624900517-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388a624900517-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388a624900517-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388a624900517-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388a624900517-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388a624900517-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388a624900517-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388a624900517-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b631388a624900517-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388a624900517-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388a624900517-3\"><span class=\"crayon-v\">fd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面的<span class=\"crayon-i\">sockfd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388a624900517-4\">返回值：若文件顺利关闭则返回<span class=\"crayon-cn\">0</span>，发生错误时返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388a624900517-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388a624900517-6\"><span class=\"crayon-c\">#python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388a624900517-7\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388a624900517-8\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h2>2.2. 简单的客户端服务器TCP连接</h2>\n<p>一个简单的回显服务器和客户端模型, 客户端发出的数据, 服务器会回显到客户端的终端上(只是一个简单的模型, 没考虑错误处理等问题)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b631388e775893686\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#服务器端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport socket   #socket模块\r\nimport commands   #执行系统命令模块\r\n\r\n\r\nBUF_SIZE = 1024  #设置缓冲区大小\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\nserver = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  #生成一个新的socket对象\r\nserver.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)  #设置地址复用\r\nserver.bind(server_addr)  #绑定地址\r\nserver.listen(5)  #监听, 最大监听数为5\r\nwhile True:\r\n    client, client_addr = server.accept()  #接收TCP连接, 并返回新的套接字和地址\r\n    print 'Connected by', client_addr\r\n    while True :\r\n        data = client.recv(BUF_SIZE)  #从客户端接收数据\r\n        print data\r\n        client.sendall(data)  #发送数据到客户端\r\nserver.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631388e775893686-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631388e775893686-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-1\"><span class=\"crayon-c\">#服务器端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#socket模块</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">commands</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#执行系统命令模块</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-9\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-10\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-11\"><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#生成一个新的socket对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-12\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setsockopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOL_SOCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SO_REUSEADDR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置地址复用</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-13\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#绑定地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-14\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#监听, 最大监听数为5</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-15\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#接收TCP连接, 并返回新的套接字和地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Connected by'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">client_addr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-18\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从客户端接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631388e775893686-21\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#发送数据到客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631388e775893686-22\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313891433823419\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#客户端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport sys\r\nimport socket\r\n\r\n\r\nBUF_SIZE = 1024  #设置缓冲区的大小\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\ntry : \r\n    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  #返回新的socket对象\r\nexcept socket.error, msg :\r\n    print \"Creating Socket Failure. Error Code : \" + str(msg[0]) + \" Message : \" + msg[1]\r\n    sys.exit()\r\nclient.connect(server_addr)  #要连接的服务器地址\r\nwhile True:\r\n    data = raw_input(\"Please input some string &gt; \")  \r\n    if not data :\r\n        print \"input can't empty, Please input again..\"\r\n        continue\r\n    client.sendall(data)  #发送数据到服务器\r\n    data = client.recv(BUF_SIZE)  #从服务器端接收数据\r\n    print data\r\nclient.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313891433823419-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313891433823419-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-1\"><span class=\"crayon-c\">#客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-9\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区的大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-10\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-11\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回新的socket对象</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-13\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Creating Socket Failure. Error Code : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" Message : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-16\"><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#要连接的服务器地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-17\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">raw_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Please input some string &gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"input can't empty, Please input again..\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#发送数据到服务器</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从服务器端接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313891433823419-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313891433823419-25\"><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p></p>\n<h3>2.2.1. 带错误处理的客户端服务器TCP连接</h3>\n<blockquote><p>在进行网络编程时, 最好使用大量的错误处理, 能够尽量的发现错误, 也能够使代码显得更加严谨</p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313895141604134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#服务器端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport sys\r\nimport socket   #socket模块\r\n\r\nBUF_SIZE = 1024  #设置缓冲区大小\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\ntry :\r\n  server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  #生成一个新的socket对象\r\nexcept socket.error, msg :\r\n    print \"Creating Socket Failure. Error Code : \" + str(msg[0]) + \" Message : \" + msg[1]\r\n    sys.exit()\r\nprint \"Socket Created!\"\r\nserver.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)  #设置地址复用\r\ntry : \r\n    server.bind(server_addr)  #绑定地址\r\nexcept socket.error, msg :\r\n  print \"Binding Failure. Error Code : \" + str(msg[0]) + \" Message : \" + msg[1]\r\n  sys.exit()\r\nprint \"Socket Bind!\"\r\nserver.listen(5)  #监听, 最大监听数为5\r\nprint \"Socket listening\"\r\nwhile True:\r\n    client, client_addr = server.accept()  #接收TCP连接, 并返回新的套接字和地址, 阻塞函数\r\n    print 'Connected by', client_addr\r\n    while True :\r\n        data = client.recv(BUF_SIZE)  #从客户端接收数据\r\n        print data\r\n        client.sendall(data)  #发送数据到客户端\r\nserver.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313895141604134-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313895141604134-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-1\"><span class=\"crayon-c\">#服务器端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#socket模块</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-8\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区大小</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-9\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-10\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#生成一个新的socket对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-12\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Creating Socket Failure. Error Code : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" Message : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-15\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Socket Created!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-16\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setsockopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOL_SOCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SO_REUSEADDR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置地址复用</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-17\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#绑定地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-19\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Binding Failure. Error Code : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" Message : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-22\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Socket Bind!\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-23\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#监听, 最大监听数为5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-24\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Socket listening\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-25\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#接收TCP连接, 并返回新的套接字和地址, 阻塞函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Connected by'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">client_addr</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-28\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从客户端接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313895141604134-31\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#发送数据到客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313895141604134-32\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b6313899270641982\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#客户端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport sys\r\nimport socket\r\n\r\n\r\nBUF_SIZE = 1024  #设置缓冲区的大小\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\ntry : \r\n    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)  #返回新的socket对象\r\nexcept socket.error, msg :\r\n    print \"Creating Socket Failure. Error Code : \" + str(msg[0]) + \" Message : \" + msg[1]\r\n    sys.exit()\r\nclient.connect(server_addr)  #要连接的服务器地址\r\nwhile True:\r\n    data = raw_input(\"Please input some string &gt; \")  \r\n    if not data :\r\n        print \"input can't empty, Please input again..\"\r\n        continue\r\n    client.sendall(data)  #发送数据到服务器\r\n    data = client.recv(BUF_SIZE)  #从服务器端接收数据\r\n    print data\r\nclient.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b6313899270641982-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b6313899270641982-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-1\"><span class=\"crayon-c\">#客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-9\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区的大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-10\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-11\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回新的socket对象</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-13\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Creating Socket Failure. Error Code : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" Message : \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-16\"><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#要连接的服务器地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-17\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">raw_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Please input some string &gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"input can't empty, Please input again..\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#发送数据到服务器</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从服务器端接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b6313899270641982-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b6313899270641982-25\"><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p></p>\n<h2>2.3. UDP通信</h2>\n<p>UDP通信流程图如下：<br>\n服务端：socket—bind—recvfrom—sendto—close<br>\n客户端：socket———-sendto—recvfrom—close</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/de03ba3a5dad9d0ba8cfd9942b84e9c7.png\"><img class=\"aligncenter wp-image-88399 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/de03ba3a5dad9d0ba8cfd9942b84e9c7.png\" alt=\"48\" width=\"343\" height=\"277\"></a><br>\nUDP</p>\n<p><strong>sendto()函数</strong><br>\n发送UDP数据, 将数据发送到套接字</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b631389d877589995\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint sendto(int sockfd, const void *msg,int len,unsigned int flags,const struct sockaddr *to, int tolen);\r\nsockfd : 为前面socket的返回值.\r\nmsg : 一般为常量字符串\r\nlen : 表示长度\r\nflags : 通常为0\r\nto : 表示目地机的IP地址和端口号信息, 表示地址的结构体\r\ntolen : 常常被赋值为sizeof (struct sockaddr)\r\n返回值 :　返回实际发送的数据字节长度或在出现发送错误时返回-1。\r\n\r\n\r\n#Python\r\ns.sendto(string[,flag],address)\r\ns为socket.socket()返回的套接字对象\r\naddress : 指定远程地址, 形式为（ipaddr，port）的元组\r\nflag : 提供有关消息的其他信息，通常可以忽略\r\n返回值 : 发送的字节数。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b631389d877589995-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b631389d877589995-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sendto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">const </span><span class=\"crayon-v\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">msg</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">unsigned </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">const </span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">to</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tolen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-4\"><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>一般为常量字符串</div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-5\"><span class=\"crayon-k \">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示长度</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-6\"><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>通常为<span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-7\"><span class=\"crayon-v\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示目地机的<span class=\"crayon-i\">IP</span>地址和端口号信息<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>表示地址的结构体</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-8\"><span class=\"crayon-v\">tolen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>常常被赋值为<span class=\"crayon-e\">sizeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-9\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span>　返回实际发送的数据字节长度或在出现发送错误时返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span>。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-12\"><span class=\"crayon-c\">#Python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-13\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-14\"><span class=\"crayon-i\">s</span>为<span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>返回的套接字对象</div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-15\"><span class=\"crayon-v\">address</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>指定远程地址<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>形式为（<span class=\"crayon-i\">ipaddr</span>，<span class=\"crayon-i\">port</span>）的元组</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b631389d877589995-16\"><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>提供有关消息的其他信息，通常可以忽略</div><div class=\"crayon-line\" id=\"crayon-59d04b631389d877589995-17\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>发送的字节数。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p><strong>recvfrom()函数</strong><br>\n接受UDP套接字的数据, 与recv()类似</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b63138a1846218688\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#Linux\r\nint recvfrom(int sockfd,void *buf,int len,unsigned int flags,struct sockaddr *from,int *fromlen);\r\nsockfd : 为前面socket的返回值.\r\nmsg : 一般为常量字符串\r\nlen : 表示长度\r\nflags : 通常为0\r\nfrom :是一个struct sockaddr类型的变量，该变量保存连接机的IP地址及端口号\r\nfromlen : 常置为sizeof (struct sockaddr)。\r\n返回值 : 返回接收到的字节数或当出现错误时返回-1，并置相应的errno。\r\n\r\n#Python\r\ns.recvfrom(bufsize[.flag])\r\n返回值 : （data,address）元组, 其中data是包含接收数据的字符串，address是发送数据的套接字地址\r\nbufsize : 指定要接收的数据大小\r\nflag : 提供有关消息的其他信息，通常可以忽略</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a1846218688-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a1846218688-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-1\"><span class=\"crayon-c\">#Linux</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-2\"><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recvfrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockfd</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">buf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">unsigned </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flags</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-st\">from</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">fromlen</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-3\"><span class=\"crayon-v\">sockfd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>为前面<span class=\"crayon-k \">socket</span>的返回值<span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-4\"><span class=\"crayon-v\">msg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>一般为常量字符串</div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-5\"><span class=\"crayon-k \">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>表示长度</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-6\"><span class=\"crayon-v\">flags</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>通常为<span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-7\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span>是一个<span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sockaddr</span>类型的变量，该变量保存连接机的<span class=\"crayon-i\">IP</span>地址及端口号</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-8\"><span class=\"crayon-v\">fromlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>常置为<span class=\"crayon-e\">sizeof</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">struct</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sockaddr</span><span class=\"crayon-sy\">)</span>。</div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-9\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>返回接收到的字节数或当出现错误时返回<span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span>，并置相应的<span class=\"crayon-k \">errno</span>。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-11\"><span class=\"crayon-c\">#Python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-12\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recvfrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bufsize</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-13\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>（<span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">address</span>）元组<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>其中<span class=\"crayon-i\">data</span>是包含接收数据的字符串，<span class=\"crayon-i\">address</span>是发送数据的套接字地址</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a1846218688-14\"><span class=\"crayon-v\">bufsize</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>指定要接收的数据大小</div><div class=\"crayon-line\" id=\"crayon-59d04b63138a1846218688-15\"><span class=\"crayon-v\">flag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>提供有关消息的其他信息，通常可以忽略</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p></p>\n<h2>2.4. 简单的客户端服务器UDP连接</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b63138a4405575662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#服务器端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport socket\r\n\r\nBUF_SIZE = 1024  #设置缓冲区大小\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\nserver = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)  #生成新的套接字对象\r\nserver.bind(server_addr)  #套接字绑定IP和端口\r\nwhile True :\r\n    print \"waitting for data\"\r\n    data, client_addr = server.recvfrom(BUF_SIZE)  #从客户端接收数据\r\n    print 'Connected by', client_addr, ' Receive Data : ', data\r\n    server.sendto(data, client_addr)  #发送数据给客户端\r\nserver.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a4405575662-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a4405575662-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-1\"><span class=\"crayon-c\">#服务器端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-7\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区大小</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-8\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-9\"><span class=\"crayon-v\">server</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_DGRAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#生成新的套接字对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-10\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#套接字绑定IP和端口</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-11\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"waitting for data\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recvfrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从客户端接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Connected by'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' Receive Data : '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a4405575662-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#发送数据给客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a4405575662-16\"><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b63138a8605048192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#客户端\r\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport socket\r\nimport struct\r\n\r\nBUF_SIZE = 1024  #设置缓冲区\r\nserver_addr = ('127.0.0.1', 8888)  #IP和端口构成表示地址\r\nclient = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)  #生成新的套接字对象\r\n\r\nwhile True :\r\n    data = raw_input('Please Input data &gt; ')\r\n    client.sendto(data, server_addr)  #向服务器发送数据\r\n    data, addr = client.recvfrom(BUF_SIZE)  #从服务器接收数据\r\n    print \"Data : \", data\r\nclient.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138a8605048192-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138a8605048192-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-1\"><span class=\"crayon-c\">#客户端</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-2\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-3\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">struct</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-8\"><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1024</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#设置缓冲区</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-9\"><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8888</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#IP和端口构成表示地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-10\"><span class=\"crayon-v\">client</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_DGRAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#生成新的套接字对象</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-12\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">raw_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Please Input data &gt; '</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendto</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#向服务器发送数据</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recvfrom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUF_SIZE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#从服务器接收数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138a8605048192-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Data : \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138a8605048192-17\"><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<h2>2.5. 其他</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04b63138ab260686215\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns.getpeername()\r\n#返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）。\r\n\r\ns.getsockname()\r\n#返回套接字自己的地址。通常是一个元组(ipaddr,port)\r\n\r\ns.setsockopt(level,optname,value)\r\n#设置给定套接字选项的值。\r\n\r\ns.getsockopt(level,optname[.buflen])\r\n#返回套接字选项的值。\r\n\r\ns.settimeout(timeout)\r\n#设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如connect()）\r\n\r\ns.gettimeout()\r\n#返回当前超时期的值，单位是秒，如果没有设置超时期，则返回None。\r\n\r\ns.fileno()\r\n#返回套接字的文件描述符。\r\n\r\ns.setblocking(flag)\r\n#如果flag为0，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式（默认值）。非阻塞模式下，如果调用recv()没有发现任何数据，或send()调用无法立即发送数据，那么将引起socket.error异常。\r\n\r\ns.makefile()\r\n#创建一个与该套接字相关连的文件</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04b63138ab260686215-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04b63138ab260686215-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getpeername</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-2\"><span class=\"crayon-c\">#返回连接套接字的远程地址。返回值通常是元组（ipaddr,port）。</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-4\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getsockname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-5\"><span class=\"crayon-c\">#返回套接字自己的地址。通常是一个元组(ipaddr,port)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-7\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setsockopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">optname</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-8\"><span class=\"crayon-c\">#设置给定套接字选项的值。</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-10\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getsockopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">optname</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">buflen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-11\"><span class=\"crayon-c\">#返回套接字选项的值。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-13\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">settimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-14\"><span class=\"crayon-c\">#设置套接字操作的超时期，timeout是一个浮点数，单位是秒。值为None表示没有超时期。一般，超时期应该在刚创建套接字时设置，因为它们可能用于连接的操作（如connect()）</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-16\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">gettimeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-17\"><span class=\"crayon-c\">#返回当前超时期的值，单位是秒，如果没有设置超时期，则返回None。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-18\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-19\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fileno</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-20\"><span class=\"crayon-c\">#返回套接字的文件描述符。</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-22\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-23\"><span class=\"crayon-c\">#如果flag为0，则将套接字设为非阻塞模式，否则将套接字设为阻塞模式（默认值）。非阻塞模式下，如果调用recv()没有发现任何数据，或send()调用无法立即发送数据，那么将引起socket.error异常。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-24\"> </div><div class=\"crayon-line\" id=\"crayon-59d04b63138ab260686215-25\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">makefile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04b63138ab260686215-26\"><span class=\"crayon-c\">#创建一个与该套接字相关连的文件</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h1>3. 参考链接</h1>\n<hr>\n<p><a href=\"https://docs.python.org/2/library/socket.html\" target=\"_blank\">python-socket官方文档</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88396\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88396votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88396\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/e9fe0c92fbce827c80d976dd417a8a82.png"], "tags": "系列教程,Socket,爬虫", "url_object_id": "f3d19330e59e44dfa10fd4fa1f6c8e6e", "praise_nums": "1", "url": "http://python.jobbole.com/88396/", "title": "Python 爬虫 (三) - Socket 网络编程", "create_date": "2017/08/25", "comment_nums": 0}
{"fav_nums": 3, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010964862\">brantou</a>   </div><p>折腾了将近两天，中间数次想要放弃，还好硬着头皮搞下去了，在此分享出来，希望有同等需求的各位能少走一些弯路。</p>\n<p>源码放在了github上， 欢迎<a href=\"https://github.com/brantou/crawler/blob/master/jobs/jobs/spiders/zhihu.py\">前往查看</a>。</p>\n<p>若是帮你解决了问题，或者给了你启发，不要吝啬给<a href=\"https://github.com/brantou/crawler\">加一星</a>。</p>\n<h1>工具准备</h1>\n<p>在开始之前，请确保 <em>scrpay</em> 正确安装，手头有一款简洁而强大的浏览器， 若是你有使用 <em>postman</em> 那就更好了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c373445390285535\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscrapy genspider zhihu</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c373445390285535-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c373445390285535-1\"><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">genspider </span><span class=\"crayon-v\">zhihu</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用以上命令生成知乎爬虫,代码如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c373451841026556\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# -*- coding: utf-8 -*-\r\nimport scrapy\r\n\r\n\r\nclass ZhihuSpider(scrapy.Spider):\r\n    name = 'zhihu'\r\n    allowed_domains = ['www.zhihu.com']\r\n    start_urls = ['http://www.zhihu.com/']\r\n\r\n    def parse(self, response):\r\n        pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373451841026556-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373451841026556-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373451841026556-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373451841026556-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373451841026556-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373451841026556-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-1\"><span class=\"crayon-c\"># -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373451841026556-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373451841026556-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZhihuSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373451841026556-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zhihu'</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'www.zhihu.com'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373451841026556-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'http://www.zhihu.com/'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373451841026556-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373451841026556-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>有一点切记，不要忘了启用 <em>Cookies</em>, <strong>切记切记</strong> ：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c373458211025295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Disable cookies (enabled by default)\r\nCOOKIES_ENABLED = True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c373458211025295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373458211025295-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c373458211025295-1\"><span class=\"crayon-c\"># Disable cookies (enabled by default)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373458211025295-2\"><span class=\"crayon-v\">COOKIES_ENABLED</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h1>模拟登陆</h1>\n<p>过程如下：</p>\n<ul>\n<li>进入登录页，获取 <em>Header</em> 和 <em>Cookie</em> 信息</li>\n</ul>\n<p>完善的 <em>Header</em> 信息能尽量伪装爬虫， 有效 <em>Cookie</em> 信息能迷惑知乎服务端，使其认为当前登录非首次登录，若无有效 <em>Cookie</em> 会遭遇验证码。 在抓取数据之前，请在浏览器中登录过知乎，这样才使得 <em>Cookie</em> 是有效的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ac9b7d3f8088c60aa95a92e658cc8110.jpg\"><img class=\"aligncenter size-full wp-image-88491\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ac9b7d3f8088c60aa95a92e658cc8110.jpg\" alt=\"3255415-6c02f08c8697ef0c\"></a></p>\n<p><em>Header</em> 和 <em>Cookie</em> 整理如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c37345e697059604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheaders = {\r\n    'Host':\r\n    'www.zhihu.com',\r\n    'Connection':\r\n    'keep-alive',\r\n    'Origin':\r\n    'https://www.zhihu.com',\r\n    'User-Agent':\r\n    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36',\r\n    'Content-Type':\r\n    'application/x-www-form-urlencoded; charset=UTF-8',\r\n    'Accept':\r\n    '*/*',\r\n    'X-Requested-With':\r\n    'XMLHttpRequest',\r\n    'DNT':\r\n    1,\r\n    'Referer':\r\n    'https://www.zhihu.com/',\r\n    'Accept-Encoding':\r\n    'gzip, deflate, br',\r\n    'Accept-Language':\r\n    'zh-CN,zh;q=0.8,en;q=0.6',\r\n}\r\n\r\ncookies = {\r\n    'd_c0':\r\n    '\"AHCAtu1iqAmPTped76X1ZdN0X_qAwhjdLUU=|1458699045\"',\r\n    '__utma':\r\n    '51854390.1407411155.1458699046.1458699046.1458699046.1',\r\n    '__utmv':\r\n    '51854390.000--|3=entry_date=20160322=1',\r\n    '_zap':\r\n    '850897bb-cba4-4d0b-8653-fd65e7578ac2',\r\n    'q_c1':\r\n    'b7918ff9a5514d2981c30050c8c732e1|1502937247000|1491446589000',\r\n    'aliyungf_tc':\r\n    'AQAAAHVgviiNyQsAOhSntJ5J/coWYtad',\r\n    '_xsrf':\r\n    'b12fdca8-cb35-407a-bc4c-6b05feff37cb',\r\n    'l_cap_id':\r\n    '\"MDk0MzRjYjM4NjAwNDU0MzhlYWNlODQ3MGQzZWM0YWU=|1503382513|9af99534aa22d5db92c7f58b45f3f3c772675fed\"',\r\n    'r_cap_id':\r\n    '\"M2RlNDZjN2RkNTBmNGFmNDk2ZjY4NjIzY2FmNTE4NDg=|1503382513|13370a99ee367273b71d877de17f05b2986ce0ef\"',\r\n    'cap_id':\r\n    '\"NmZjODUxZjQ0NzgxNGEzNmJiOTJhOTlkMTVjNWIxMDQ=|1503382513|dba2e9c6af7f950547474f827ef440d7a2950163\"',\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37345e697059604-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37345e697059604-47\">47</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-1\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Host'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'www.zhihu.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Connection'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'keep-alive'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Origin'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'https://www.zhihu.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Content-Type'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'application/x-www-form-urlencoded; charset=UTF-8'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'*/*'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'X-Requested-With'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'XMLHttpRequest'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'DNT'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'https://www.zhihu.com/'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Encoding'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'gzip, deflate, br'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Language'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'zh-CN,zh;q=0.8,en;q=0.6'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-24\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-26\"><span class=\"crayon-v\">cookies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'d_c0'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"AHCAtu1iqAmPTped76X1ZdN0X_qAwhjdLUU=|1458699045\"'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'__utma'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'51854390.1407411155.1458699046.1458699046.1458699046.1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'__utmv'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'51854390.000--|3=entry_date=20160322=1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'_zap'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'850897bb-cba4-4d0b-8653-fd65e7578ac2'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'q_c1'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'b7918ff9a5514d2981c30050c8c732e1|1502937247000|1491446589000'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'aliyungf_tc'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'AQAAAHVgviiNyQsAOhSntJ5J/coWYtad'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'_xsrf'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'b12fdca8-cb35-407a-bc4c-6b05feff37cb'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'l_cap_id'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"MDk0MzRjYjM4NjAwNDU0MzhlYWNlODQ3MGQzZWM0YWU=|1503382513|9af99534aa22d5db92c7f58b45f3f3c772675fed\"'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'r_cap_id'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"M2RlNDZjN2RkNTBmNGFmNDk2ZjY4NjIzY2FmNTE4NDg=|1503382513|13370a99ee367273b71d877de17f05b2986ce0ef\"'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'cap_id'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37345e697059604-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'\"NmZjODUxZjQ0NzgxNGEzNmJiOTJhOTlkMTVjNWIxMDQ=|1503382513|dba2e9c6af7f950547474f827ef440d7a2950163\"'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37345e697059604-47\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<ul>\n<li>在浏览器中，模拟登陆，抓取登陆请求信息。</li>\n</ul>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ff5ee2373a04a9b6ffc798c7e8d80e.jpg\"><img class=\"aligncenter size-full wp-image-88492\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ff5ee2373a04a9b6ffc798c7e8d80e.jpg\" alt=\"3255415-6c02f08c8697ef0c\"></a></p>\n<p>从图中可以看到 <em>_xsrf</em> 参数, 这个参数与登陆验证信息无关，但很明显是由登陆页面携带的信息。 <a href=\"https://www.google.com.hk/search?q=xsrf\">Google</a>了下 <em>xsrf</em> 的含义， 用于防范 <a href=\"https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0\">跨站请求伪造</a> 。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d65d2fc45b4be2d967fbb0b2ba8baa0.jpg\"><img class=\"aligncenter size-full wp-image-88493\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d65d2fc45b4be2d967fbb0b2ba8baa0.jpg\" alt=\"3255415-6c02f08c8697ef0c\"></a></p>\n<ul>\n<li>整理以上，代码如下：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c373465720277822\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nloginUrl = 'https://www.zhihu.com/#signin'\r\nsiginUrl = 'https://www.zhihu.com/login/email'\r\n\r\n\r\ndef start_requests(self):\r\n    return [\r\n        scrapy.http.FormRequest(\r\n            self.loginUrl,\r\n            headers=self.headers,\r\n            cookies=self.cookies,\r\n            meta={'cookiejar': 1},\r\n            callback=self.post_login)\r\n    ]\r\n\r\n\r\ndef post_login(self, response):\r\n    xsrf = response.css(\r\n        'div.view-signin &gt; form &gt; input[name=_xsrf]::attr(value)'\r\n    ).extract_first()\r\n    self.headers['X-Xsrftoken'] = xsrf\r\n\r\n    return [\r\n        scrapy.http.FormRequest(\r\n            self.siginUrl,\r\n            method='POST',\r\n            headers=self.headers,\r\n            meta={'cookiejar': response.meta['cookiejar']},\r\n            formdata={\r\n                '_xsrf': xsrf,\r\n                'captcha_type': 'cn',\r\n                'email': 'xxxxxx@163.com',\r\n                'password': 'xxxxxx',\r\n            },\r\n            callback=self.after_login)\r\n    ]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373465720277822-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373465720277822-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-1\"><span class=\"crayon-v\">loginUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://www.zhihu.com/#signin'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-2\"><span class=\"crayon-v\">siginUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://www.zhihu.com/login/email'</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_requests</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormRequest</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">loginUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">post_login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-16\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">post_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'div.view-signin &gt; form &gt; input[name=_xsrf]::attr(value)'</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'X-Xsrftoken'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xsrf</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-22\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormRequest</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">siginUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">formdata</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'_xsrf'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'captcha_type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'cn'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'email'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xxxxxx@163.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'password'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xxxxxx'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373465720277822-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_login</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373465720277822-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n\n</li>\n</ul>\n<h1>设置Bearer Token</h1>\n<p>经过上述步骤登陆成功了，有点小激动，有没有！ 但苦难到此还远没有结束，这个时候尝试抓取最近热门话题，直接返回 <em>code:401</em> ,未授权的访问。 授权信息未设置，导致了此类错误，莫非遗漏了什么，看来只能在浏览器中追踪请求参数来侦测问题。 在浏览器的请求中，包含了<a href=\"https://tools.ietf.org/html/rfc6750\">Bearer Token</a>, 而我在scrapy中模拟的请求中未包含此信息， 所以我被服务器认定为未授权的。 通过观察发现 <em>Bearer Token</em> 的关键部分，就是 <em>Cookies</em> 中的 <em>z_c0</em> 包含的信息。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d837f51190afce07c92dbb460b3a9017.jpg\"><img class=\"aligncenter size-full wp-image-88494\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d837f51190afce07c92dbb460b3a9017.jpg\" alt=\"3255415-6c02f08c8697ef0c\"></a><br>\n<em>z_c0</em> 包含的信息，是在登陆完成时种下的，所以从登陆完成返回的登陆信息里，获取要设置的 <em>Cookie</em> 信息， 然后拼接出 <em>Bearer Token</em>,最后设置到 <em>Header</em> 中。</p>\n<p>代码整理如下:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c37346e520689431\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef after_login(self, response):\r\n    jdict = json.loads(response.body)\r\n    print('after_login', jdict)\r\n    if jdict['r'] == 0:\r\n        z_c0 = response.headers.getlist('Set-Cookie')[2].split(';')[0].split(\r\n            '=')[1]\r\n        self.headers['authorization'] = 'Bearer ' + z_c0\r\n        return scrapy.http.FormRequest(\r\n            url=self.feedUrl,\r\n            method='GET',\r\n            meta={'cookiejar': response.meta['cookiejar']},\r\n            headers=self.headers,\r\n            formdata={\r\n                'action_feed': 'True',\r\n                'limit': '10',\r\n                'action': 'down',\r\n                'after_id': str(self.curFeedId),\r\n                'desktop': 'true'\r\n            },\r\n            callback=self.parse)\r\n    else:\r\n        print(jdict['error'])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d049c37346e520689431-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c37346e520689431-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">after_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">loads</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'after_login'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'r'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">z_c0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getlist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Set-Cookie'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">';'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'='</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'authorization'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Bearer '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">z_c0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormRequest</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feedUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">formdata</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'action_feed'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'True'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'limit'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'10'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'action'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'down'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'after_id'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">curFeedId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-18\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'desktop'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'true'</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c37346e520689431-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c37346e520689431-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jdict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'error'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p></p>\n<h1>获取数据</h1>\n<p>上述步骤后，数据获取就水到渠成了，为了检测成功与否， 把返回信息写到文件中,而且只获取前五十个,代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d049c373475971269576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfeedUrl = 'https://www.zhihu.com/api/v3/feed/topstory'\r\nnextFeedUrl = ''\r\ncurFeedId = 0\r\n\r\n\r\ndef parse(self, response):\r\n    with open('zhihu.json', 'a') as fd:\r\n        fd.write(response.body)\r\n    jdict = json.loads(response.body)\r\n    jdatas = jdict['data']\r\n    for entry in jdatas:\r\n        entry['pid'] = entry['id']\r\n        yield entry\r\n\r\n    jpaging = jdict['paging']\r\n    self.curFeedId += len(jdatas)\r\n    if jpaging['is_end'] == False and self.curFeedId &lt; 50:\r\n        self.nextFeedUrl = jpaging['next']\r\n        yield self.next_request(response)\r\n\r\n\r\ndef next_request(self, response):\r\n    return scrapy.http.FormRequest(\r\n        url=self.nextFeedUrl,\r\n        method='GET',\r\n        meta={'cookiejar': response.meta['cookiejar']},\r\n        headers=self.headers,\r\n        callback=self.parse)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d049c373475971269576-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d049c373475971269576-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-1\"><span class=\"crayon-v\">feedUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://www.zhihu.com/api/v3/feed/topstory'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-2\"><span class=\"crayon-v\">nextFeedUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-3\"><span class=\"crayon-v\">curFeedId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-6\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'zhihu.json'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fd</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">fd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">loads</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">body</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jdatas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">entry </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jdatas</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">entry</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'pid'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">entry</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">entry</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">jpaging</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jdict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'paging'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">curFeedId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jdatas</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jpaging</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'is_end'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">curFeedId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nextFeedUrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jpaging</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'next'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">next_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-20\"> </div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-22\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">FormRequest</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nextFeedUrl</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d049c373475971269576-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d049c373475971269576-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0058 seconds] -->\r\n<p>最终获取的数据如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/683d15c5ed8c852300ebc9b95c89088b.jpg\"><img class=\"aligncenter size-full wp-image-88495\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/683d15c5ed8c852300ebc9b95c89088b.jpg\" alt=\"3255415-6c02f08c8697ef0c\"></a></p>\n<h1>写在最后</h1>\n<p>知乎的数据，只有登录完成之后，才可有效的获取，所以模拟登陆是无法忽略不管的。 所谓的模拟登陆，只是在scrapy中尽量的模拟在浏览器中的交互过程，使服务端无感抓包过程。 请求中附加有效的 <em>Cookies</em> 和 <em>Headers</em> 头信息，可有效的迷惑服务端， 同时在交互的过程中，获取后续请求必要信息和认证信息，使得整个流程能不断先前。</p>\n<p>若是你遇到什么问题，尽量提出来，欢迎一起来讨论解决。</p>\n<p>源码放在了github上， 欢迎<a href=\"https://github.com/brantou/crawler/blob/master/jobs/jobs/spiders/zhihu.py\">前往查看</a>。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88490\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88490votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88490\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/ac9b7d3f8088c60aa95a92e658cc8110.jpg"], "tags": "实践项目,Scrapy,网络爬虫", "url_object_id": "a7e98778c5942f8603ad4de5e3d38db3", "praise_nums": "1", "url": "http://python.jobbole.com/88490/", "title": "Scrapy 模拟登陆知乎--抓取热点话题", "create_date": "2017/09/05", "comment_nums": 1}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/bound2020\">bound</a> 翻译，<a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.pyimagesearch.com/2016/08/22/an-intro-to-linear-classification-with-python/\">www.pyimagesearch.com</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>在过去几周中，我们开始对机器学习有了更多的了解，也认识到机器学习在机器视觉、图像分类和深度学习领域的重要作用。</p>\n<p>我们已经看到卷积神经网络，如LetNet，可以用于对MNIST数据集的手写字迹进行分类。我们使用了k-NN算法来识别一张图片中是否含有猫或狗，并且我们也已经学习了如何调参来优化模型，进而提高分类精度。</p>\n<p>然而，还有一个重要的机器学习的算法我们尚未涉及：这个算法非常容易构建，并能很自然地扩展到神经网络和卷积神经网络中。</p>\n<p>是什么算法呢？</p>\n<p>它是一个简单的线性分类器，并且由于其算法很直观，被认为是更多高级的机器学习和深度学习算法的基石。</p>\n<p>继续阅读来加深你对线性分类器的认识，以及如何使用它们进行图像分类。</p>\n<hr>\n<h3>Python线性分类模型简介</h3>\n<p>本教程的前半部分主要关注线性分类有关的基本原理和数学知识。总的来说，线性分类指的是那些真正从训练数据中“学习”的有参分类算法。</p>\n<p>在这里，我提供了一个真正的线性分类实现代码，以及一个用scikit-learn对一张图片中的内容分类的例子。</p>\n<h3>4大参数化学习和线性分类的组件</h3>\n<p>我已经多次使用“参数化”,但它到底是什么意思？</p>\n<p><strong>简而言之：参数化是确定模型必要参数的过程。</strong></p>\n<p>在机器学习的任务中，参数化根据以下几个方面来确定面对的问题：</p>\n<ol>\n<li><strong>数据</strong>：这是我们将要学习的输入数据。这些数据包括了数据点（例如，特征向量，颜色矩阵，原始像素特征等）和它们对应的标签。</li>\n<li><strong>评分函数</strong>：一个函数接收输入数据，然后将数据匹配到类标签上。例如，我们输入特征向量后，评分函数就开始处理这些数据，调用某个函数f（比如我们的评分函数），最后返回预测的分类标签。</li>\n<li><strong>损失函数</strong>：损失函数可以量化预测的类标签与真实的类标签之间的匹配程度。这两个标签集合之间的相似度越高，损失就越小（即分类精度越高）。我们的目标是最小化损失函数，相应就能提高分类精度。</li>\n<li><strong>权重矩阵</strong>：权重矩阵，通常标记为<em>W</em>，它是分类器实际优化的权重或参数。我们根据评分函数的输出以及损失函数，调整并优化权重矩阵，提高分类精度。</li>\n</ol>\n<p><i>注意</i>：取决于你使用的模型的种类，参数可能会多的多。但是在最底层，你会经常遇到4个参数化学习的基本模块。</p>\n<p>一旦确定了这4个关键组件，我们就可以使用优化方法来找到评分函数的一组参数W，使得损失函数达到最小值（同时提升对数据的分类准确度）</p>\n<p>接下来，我们就将看到如何利用这些组件，搭建一个将输入数据转化为真实预测值的分类器。</p>\n<h3>线性分类器：从图片到标签</h3>\n<p>在这部分中，我们将更多的从数学角度研究参数模型到机器学习。</p>\n<p>首先，我们需要<strong>数据</strong>。假设训练数据集（图片或者压缩后的特征向量）标记为<img src=\"http://www.pyimagesearch.com/wp-content/latex/05e/05e42209d67fe1eb15a055e9d3b3770e-ffffff-000000-0.png\"> ，每个图或特征向量都有对应的类标签 <img class=\"latex\" title=\"y_{i}\" src=\"http://www.pyimagesearch.com/wp-content/latex/18d/18daef71b5d25ce76b8628a81e4fc76b-ffffff-000000-0.png\" alt=\"y_{i}\">。我们用 <img class=\"latex\" title=\"i = 1 ldots N\" src=\"http://www.pyimagesearch.com/wp-content/latex/d54/d540fefd9219dd60b9fb5f3dc9ff0830-ffffff-000000-0.png\" alt=\"i = 1 ldots N\"> 和<img class=\"latex\" title=\"y_{i}= 1 ldots K\" src=\"http://www.pyimagesearch.com/wp-content/latex/0b8/0b84cc816cdf7369f4e90dbbf964f1ad-ffffff-000000-0.png\" alt=\"y_{i}= 1 ldots K\">表示有N个D维（特征向量的长度）的数据点，划分到K个唯一的类别中。</p>\n<p>为了这些表达式更具体点，参考我们以前的教程：基于提取后的颜色矩阵，<a href=\"http://www.pyimagesearch.com/2016/08/08/k-nn-classifier-for-image-classification/\">使用knn分类器识别图片中的猫和狗。</a></p>\n<p>这份数据集中，总共有N=25，000张图片，每张图片的特征都是一个3D颜色直方图，其中每个管道有8个桶。这样产出的特征向量有D=8 x 8 x 8 = 512个元素。最后，我们有k=2个类别标签，一个是“狗”，另一个是“猫”。</p>\n<p><img class=\"latex\" title=\"f(x_{i}, W, b) = Wx_{i} + b\" src=\"http://www.pyimagesearch.com/wp-content/latex/50f/50f82ea4ed2b4edf1ffdabb9ca6d15fa-ffffff-000000-0.png\" alt=\"f(x_{i}, W, b) = Wx_{i} + b\"></p>\n<p>有了这些变量后，我们必须定义一个评分函数f，将特征向量映射到类标签的打分上。正如本篇博客标题所说，我们将使用一个简单的线性映射：</p>\n<p><img class=\"latex\" title=\"f(x_{i}, W, b) = Wx_{i} + b\" src=\"http://www.pyimagesearch.com/wp-content/latex/50f/50f82ea4ed2b4edf1ffdabb9ca6d15fa-ffffff-000000-0.png\" alt=\"f(x_{i}, W, b) = Wx_{i} + b\"></p>\n<p>我们假设每个 <img class=\"latex\" title=\"x_{i}\" src=\"http://www.pyimagesearch.com/wp-content/latex/05e/05e42209d67fe1eb15a055e9d3b3770e-ffffff-000000-0.png\" alt=\"x_{i}\">都由一个形状为<em>[D x 1]</em>的单列向量所表示。我们在本例中要再次使用颜色直方图，不过如果我们使用的是原始像素粒度，那可以直接把图片中的像素压扁到一个单列向量中。</p>\n<p>我们的权重矩阵W形状为<em>[K x D]</em>（类别标签数乘以特征向量的维数）</p>\n<p>最后，<strong>偏置矩阵</strong><em>b</em>,大小为<em>[K x 1]</em>。实质上，偏置矩阵可以让我们的评分函数向着一个或另一个方向“提升”，而不会真正影响权重矩阵W，这点往往对学习的成功与否非常关键。</p>\n<p>回到Kaggle的猫和狗例子中， 每个都表示为512维颜色直方图，因此的形状是<em>[512 x 1]。</em>权重矩阵W的形状为<em>[2 x 512]</em>，而偏置矩阵b为<em>[2 x 1]</em>。</p>\n<p>下面展示的是线性分类的评分函数f</p>\n<p><img src=\"http://www.pyimagesearch.com/wp-content/uploads/2016/07/intro_linear_classifier_diagram.png\" alt=\"Figure 1: Illustrating the dot product of weight matrix W and feature vector x, followed by addition of bias term. (Inspired by Karpathy's example in the CS231n course).\"></p>\n<p>在上图的左侧是原始输入图片，我们将从中提取特征。在本例中，我们计算的是一个512维的颜色直方图，也可以用其他一些特征表示方式（包括原始像素密度），但是对于这个例子，我们就只用颜色分布，即直方图来表示xi。</p>\n<p>然后我们有了权重矩阵W，有2行（每个类标签一行）和512列（每一列都是特征向量中的条目）</p>\n<p>将W和xi<a href=\"https://en.wikipedia.org/wiki/Dot_product\">点乘</a>后，再加上大小为<em>[2 x 1]</em>的偏置矩阵bi。</p>\n<p>最后就得到了右边的两个值：猫和狗标签各自的分数。</p>\n<p>看着上面的公式，你可以确信输入xi和yi都是固定的，没法修改。我们当然可以通过不同的特征提取技术来得到不同的xi，但是一旦特征抽取后，<strong>这些值就不会再改变了。</strong></p>\n<p>实际上，我们唯一能控制的参数就是权重矩阵<em>W</em>以及偏置向量b。因此，我们的目标是利用评分函数和损失函数去优化权重和偏置向量，来<em>提升</em>分类的准确度。</p>\n<p>如何优化权重矩阵则取决于我们的损失函数，但通常会涉及梯度下降的某种形式。我们会在以后的博客中重温优化和损失函数的概念，不过现在只要简单理解为给定了一个评分函数后，我们还需要定义一个损失函数，来告诉我们对于输入数据的预测有多“好”。</p>\n<h4>参数学习和线性分类的优点</h4>\n<p>利用参数学习有两个主要的优点，正如我上面详述的方法：</p>\n<ol>\n<li><strong>一旦我们训练完了模型，就可以丢掉输入数据而只保留权重矩阵W和偏置向量b</strong>。这大大减少了模型的大小，因为我们只需要存储两个向量集合（而非整个训练集）。</li>\n<li><strong>对新的测试数据分类很快</strong>。为了执行分类，我们要做的只是点乘W和xi，然后再加上偏置b。这样做远比将每个测试点和整个训练集比较（比如像<a href=\"http://www.pyimagesearch.com/2016/08/08/k-nn-classifier-for-image-classification/\">knn算法</a>那样）快的多。</li>\n</ol>\n<p>既然我们理解了线性分类的原理，就一起看下如何在python，opencv和scikit-learn中实现。</p>\n<h4>使用python，opencv和scikit-learn对图片线性分类</h4>\n<p>就像在之前的例子<a href=\"http://www.pyimagesearch.com/2016/08/08/k-nn-classifier-for-image-classification/\">Kaggle 猫vs狗数据集和knn算法</a>中，我们将从数据集中提取颜色直方图，不过和前面例子不同的是，我们将用一个线性分类器，而非knn。</p>\n<p>准确地说，我们将使用线性支持向量机（<a href=\"https://en.wikipedia.org/wiki/Support_vector_machine\">SVM</a>），即在n维空间中的数据之间构造一个最大间隔分离超平面。这个分离超平面的目标是将类别为i的所有（或者在给定的容忍度下，尽可能多）的样本分到超平面的一边，而所有类别非i的样本分到另一边。</p>\n<p>关于支持向量机的具体描述已经超出本博客的范围。（不过在<strong><a href=\"https://www.pyimagesearch.com/pyimagesearch-gurus/\" target=\"_blank\">PyImageSearch Gurus course</a></strong>有详细描述）</p>\n<p>同时，只需知道我们的线性SVM使用了和本博客“线性分类器：从图片到标签”部分中相似的评分函数，然后使用损失函数，用于确定最大分离超平面来对数据点分类（同样，我们将在以后的博客中讲述损失函数）。</p>\n<p>我们从打开一个新文件开始，命名为<span id=\"crayon-58f2c08ecaa43390171906\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">linear_classifier</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py，然后插入以下代码：</span></span></span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252c2526988821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# import the necessary packages\r\nfrom sklearn.preprocessing import LabelEncoder\r\nfrom sklearn.svm import LinearSVC\r\nfrom sklearn.metrics import classification_report\r\nfrom sklearn.cross_validation import train_test_split\r\nfrom imutils import paths\r\nimport numpy as np\r\nimport argparse\r\nimport imutils\r\nimport cv2\r\nimport os</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252c2526988821-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252c2526988821-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252c2526988821-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252c2526988821-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252c2526988821-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252c2526988821-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-1\"><span class=\"crayon-c\"># import the necessary packages</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252c2526988821-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">preprocessing </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LabelEncoder</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">svm </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearSVC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252c2526988821-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">metrics </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">classification_report</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cross_validation </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252c2526988821-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">imutils </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">paths</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252c2526988821-8\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">argparse</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-9\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">imutils</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252c2526988821-10\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cv2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252c2526988821-11\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>从第2行至11行导入了必须的python包。我们要使用scikit-learn库，因此如果你还没安装的话，跟着这些步骤，确保将其安装到你机器上。</p>\n<p>我们还将使用我的<a href=\"https://github.com/jrosebr1/imutils\">imutils包</a>，用于方便处理图像的一系列函数。如果你还没有安装imutils，那就让pip安装。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252cd822585714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Shell</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pip install imutils</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252cd822585714-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252cd822585714-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">imutils</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>现在我们定义<span id=\"crayon-58f2c08ecaa63531658100\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">extract_color_histogram</span></span></span> 函数，用于提取和量化输入图片的内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252d2751519772\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef extract_color_histogram(image, bins=(8, 8, 8)):\r\n\t# extract a 3D color histogram from the HSV color space using\r\n\t# the supplied number of `bins` per channel\r\n\thsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)\r\n\thist = cv2.calcHist([hsv], [0, 1, 2], None, bins,\r\n\t\t[0, 180, 0, 256, 0, 256])\r\n \r\n\t# handle normalizing the histogram if we are using OpenCV 2.4.X\r\n\tif imutils.is_cv2():\r\n\t\thist = cv2.normalize(hist)\r\n \r\n\t# otherwise, perform \"in place\" normalization in OpenCV 3 (I\r\n\t# personally hate the way this is done\r\n\telse:\r\n\t\tcv2.normalize(hist, hist)\r\n \r\n\t# return the flattened histogram as the feature vector\r\n\treturn hist.flatten()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d2751519772-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d2751519772-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">extract_color_histogram</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bins</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># extract a 3D color histogram from the HSV color space using</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># the supplied number of `bins` per channel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">hsv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cvtColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_BGR2HSV</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">hist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">calcHist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hsv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bins</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-6\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">180</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># handle normalizing the histogram if we are using OpenCV 2.4.X</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imutils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_cv2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">hist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">normalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># otherwise, perform \"in place\" normalization in OpenCV 3 (I</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># personally hate the way this is done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">normalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d2751519772-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># return the flattened histogram as the feature vector</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d2751519772-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">flatten</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0108 seconds] -->\r\n<p>这个函数接收一个输入<span id=\"crayon-58f2c08ecaa68926689295\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">image</span></span></span> ，将其转化为HSV颜色空间，然后利用为每个通道提供的bins，计算3D颜色直方图。</p>\n<p>利用<span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">calcHist函数计算出颜色直方图后，将其归一化后返回给调用函数。</span></p>\n<p>有关extract_color_histogram方法更详细的描述，<a href=\"http://www.pyimagesearch.com/2016/08/08/k-nn-classifier-for-image-classification/\">参阅这篇博客</a>。</p>\n<p>接着，我们从命令行解析参数，并初始化几个变量:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252d6446309869\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# import the necessary packages\r\nfrom sklearn.preprocessing import LabelEncoder\r\nfrom sklearn.svm import LinearSVC\r\nfrom sklearn.metrics import classification_report\r\nfrom sklearn.cross_validation import train_test_split\r\nfrom imutils import paths\r\nimport numpy as np\r\nimport argparse\r\nimport imutils\r\nimport cv2\r\nimport os\r\n\r\ndef extract_color_histogram(image, bins=(8, 8, 8)):\r\n\t# extract a 3D color histogram from the HSV color space using\r\n\t# the supplied number of `bins` per channel\r\n\thsv = cv2.cvtColor(image, cv2.COLOR_BGR2HSV)\r\n\thist = cv2.calcHist([hsv], [0, 1, 2], None, bins,\r\n\t\t[0, 180, 0, 256, 0, 256])\r\n\r\n\t# handle normalizing the histogram if we are using OpenCV 2.4.X\r\n\tif imutils.is_cv2():\r\n\t\thist = cv2.normalize(hist)\r\n\r\n\t# otherwise, perform \"in place\" normalization in OpenCV 3 (I\r\n\t# personally hate the way this is done\r\n\telse:\r\n\t\tcv2.normalize(hist, hist)\r\n\r\n\t# return the flattened histogram as the feature vector\r\n\treturn hist.flatten()\r\n\r\n# construct the argument parse and parse the arguments\r\nap = argparse.ArgumentParser()\r\nap.add_argument(\"-d\", \"--dataset\", required=True,\r\n\thelp=\"path to input dataset\")\r\nargs = vars(ap.parse_args())\r\n\r\n# grab the list of images that we'll be describing\r\nprint(\"[INFO] describing images...\")\r\nimagePaths = list(paths.list_images(args[\"dataset\"]))\r\n\r\n# initialize the data matrix and labels list\r\ndata = []\r\nlabels = []</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252d6446309869-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252d6446309869-44\">44</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-1\"><span class=\"crayon-c\"># import the necessary packages</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">preprocessing </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LabelEncoder</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">svm </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearSVC</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">metrics </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">classification_report</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cross_validation </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">imutils </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">paths</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-8\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">argparse</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-9\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">imutils</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-10\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cv2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-11\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-13\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">extract_color_histogram</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bins</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># extract a 3D color histogram from the HSV color space using</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># the supplied number of `bins` per channel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">hsv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cvtColor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COLOR_BGR2HSV</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">hist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">calcHist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hsv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bins</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">180</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-20\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># handle normalizing the histogram if we are using OpenCV 2.4.X</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-21\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imutils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_cv2</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-22\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">hist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">normalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-24\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># otherwise, perform \"in place\" normalization in OpenCV 3 (I</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-25\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># personally hate the way this is done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-27\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">normalize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-28\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-29\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># return the flattened histogram as the feature vector</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-30\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">flatten</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-32\"><span class=\"crayon-c\"># construct the argument parse and parse the arguments</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-33\"><span class=\"crayon-v\">ap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">argparse</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ArgumentParser</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-34\"><span class=\"crayon-v\">ap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_argument</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"-d\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"--dataset\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">required</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-k \">help</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"path to input dataset\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-36\"><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">vars</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ap</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse_args</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-38\"><span class=\"crayon-c\"># grab the list of images that we'll be describing</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-39\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[INFO] describing images...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-40\"><span class=\"crayon-v\">imagePaths</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">paths</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">list_images</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"dataset\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-42\"><span class=\"crayon-c\"># initialize the data matrix and labels list</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252d6446309869-43\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252d6446309869-44\"><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p>33行到36行解析命令行参数。我们这里只需要一个简单的开关，<span id=\"crayon-58f2c08ecaa76067480952\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-o\">—</span><span class=\"crayon-v\">dataset是kaggle 猫vs狗数据集的路径。</span></span></span></p>\n<p>然后我们将25000张图片保存的磁盘位置赋值给<span id=\"crayon-58f2c08ecaa79653398523\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">imagePaths，跟着初始化一个data矩阵，存储提取后的特征向量和类别labels。</span></span></span></p>\n<p>说到提取特征，我们接着这样做：</p>\n<div class=\"crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate\">\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252dc861411255\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# loop over the input images\r\nfor (i, imagePath) in enumerate(imagePaths):\r\n\t# load the image and extract the class label (assuming that our\r\n\t# path as the format: /path/to/dataset/{class}.{image_num}.jpg\r\n\timage = cv2.imread(imagePath)\r\n\tlabel = imagePath.split(os.path.sep)[-1].split(\".\")[0]\r\n \r\n\t# extract a color histogram from the image, then update the\r\n\t# data matrix and labels list\r\n\thist = extract_color_histogram(image)\r\n\tdata.append(hist)\r\n\tlabels.append(label)\r\n \r\n\t# show an update every 1,000 images\r\n\tif i &gt; 0 and i % 1000 == 0:\r\n\t\tprint(\"[INFO] processed {}/{}\".format(i, len(imagePaths)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252dc861411255-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252dc861411255-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-1\"><span class=\"crayon-c\"># loop over the input images</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imagePath</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">imagePaths</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># load the image and extract the class label (assuming that our</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># path as the format: /path/to/dataset/{class}.{image_num}.jpg</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cv2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">imagePath</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">imagePath</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sep</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\".\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># extract a color histogram from the image, then update the</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># data matrix and labels list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">hist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">extract_color_histogram</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hist</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-13\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-c\"># show an update every 1,000 images</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252dc861411255-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252dc861411255-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[INFO] processed {}/{}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">imagePaths</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n\n</div>\n<div class=\"crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate\">\n<p>在47行，我们开始对输入的<span id=\"crayon-58f2c08ecaa84100354209\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">imagePaths进行遍历，对于每个imagePath，我们从磁盘中加载image，提取类别label，然后通过计算颜色直方图来量化图片。然后我们更新data和labels各自的列表。</span></span></span></p>\n<p>目前，我们的labels是一个字符串列表，如“狗”或者“猫”。但是，很多scikit-learn中的机器学习算法倾向于将labels编码为整数，每个标签有一个唯一的数字。</p>\n<p>使用LabelEncoder类可以很方便的将类别标签从字符串转变为整数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252e0646269679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# import the necessary packages\r\nfrom sklearn.preprocessing import LabelEncoder\r\nfrom sklearn.svm import LinearSVC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e0646269679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e0646269679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e0646269679-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252e0646269679-1\"><span class=\"crayon-c\"># import the necessary packages</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e0646269679-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">preprocessing </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LabelEncoder</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e0646269679-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sklearn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">svm </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LinearSVC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>调用了 <span id=\"crayon-58f2c08ecaa9e406476337\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fit_transform方法后，现在我们的labels表示为整数列表。</span></span></span></p>\n<p>代码的最后一部分将数据划分为训练和测试两组、训练线性SVM、评估模型。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252e3913746445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# partition the data into training and testing splits, using 75%\r\n# of the data for training and the remaining 25% for testing\r\nprint(\"[INFO] constructing training/testing split...\")\r\n(trainData, testData, trainLabels, testLabels) = train_test_split(\r\n\tnp.array(data), labels, test_size=0.25, random_state=42)\r\n \r\n# train the linear regression clasifier\r\nprint(\"[INFO] training Linear SVM classifier...\")\r\nmodel = LinearSVC()\r\nmodel.fit(trainData, trainLabels)\r\n \r\n# evaluate the classifier\r\nprint(\"[INFO] evaluating classifier...\")\r\npredictions = model.predict(testData)\r\nprint(classification_report(testLabels, predictions,\r\n\ttarget_names=le.classes_))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e3913746445-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec252e3913746445-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-1\"><span class=\"crayon-c\"># partition the data into training and testing splits, using 75%</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-2\"><span class=\"crayon-c\"># of the data for training and the remaining 25% for testing</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-3\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[INFO] constructing training/testing split...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trainData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">testData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trainLabels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">testLabels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">train_test_split</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.25</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_state</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">42</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-6\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-7\"><span class=\"crayon-c\"># train the linear regression clasifier</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-8\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[INFO] training Linear SVM classifier...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-9\"><span class=\"crayon-v\">model</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LinearSVC</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-10\"><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">trainData</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">trainLabels</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-12\"><span class=\"crayon-c\"># evaluate the classifier</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-13\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"[INFO] evaluating classifier...\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-14\"><span class=\"crayon-v\">predictions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">model</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">testData</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec252e3913746445-15\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">classification_report</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">testLabels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">predictions</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec252e3913746445-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-v\">target_names</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">le</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">classes_</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>70和71行构造了训练集和测试集。我们将75%的数据用于训练，剩下的25%用于测试。</p>\n<p>我们将使用scikit-learn库实现的LinearSVC（75和76行）来训练线性SVM。</p>\n<p>最后，80到82行评估我们的模型，显示一个格式整齐的报告，来说明模型的执行情况。</p>\n<p>需要注意的一点是，我故意没有进行调参，只是为了让这个例子简单，容易理解。不过，既然提到了，我就把<span id=\"crayon-58f2c08ecaaac374461314\" class=\"crayon-syntax crayon-syntax-inline crayon-theme-classic crayon-theme-classic-inline crayon-font-monaco\"><span class=\"crayon-pre crayon-code\"><span class=\"crayon-v\">LinearSVC</span></span></span> 分类器的调参作为练习留个读者。可以参考我以前的k-NN分类器调参博客。</p>\n<h4>评估线性分类器</h4>\n<p>为了测试我们的线性分类器，确保你已经下载了：</p>\n<p>1. 本博客中的源代码，可以使用教程底部的“下载”部分。</p>\n<p>2. <a href=\"https://www.kaggle.com/c/dogs-vs-cats/data\">kaggle 猫vs狗数据集</a></p>\n<p>有了代码和数据集之后，你可以执行如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec252e8226756627\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Shell</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python linear_classifier.py --dataset kaggle_dogs_vs_cats</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec252e8226756627-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec252e8226756627-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">linear_classifier</span><span class=\"crayon-e\">.py</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">dataset </span><span class=\"crayon-v\">kaggle_dogs_vs_cats</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>特征提取过程大约要花费1-3分钟不等，具体时间根据机器的速度。</p>\n<p>之后，训练并评估我们的线性SVM：</p>\n<p><img src=\"http://www.pyimagesearch.com/wp-content/uploads/2016/07/intro_linear_classifier_results_zoomed.jpg\" alt=\"Figure 2: Training and evaluating our linear classifier using Python, OpenCV, and scikit-learn.\"></p>\n<p>正如上图所示，我们的分类精度有64%，大致接近本<a href=\"http://www.pyimagesearch.com/2016/08/15/how-to-tune-hyperparameters-with-python-and-scikit-learn/\">教程</a>中调参后的knn算法精度。</p>\n<p>注意：对线性SVM调参可以得到更高的分类精度，为了使教程稍微短一点，而且不至于太复杂，我简单地省略了这个步骤。</p>\n<p>此外，我们不仅得到了和knn相同的分类精度，模型的测试时间也快的多，只需要将权重矩阵和数据集进行点乘（高度优化后），然后是一个简单的加法。</p>\n<p>我们也可以在训练完成后丢弃训练集，只保留权重矩阵W和偏置向量b，从而大大精简了模型表示。</p>\n<h3>总结</h3>\n<p>在今天的博客中，我讨论了参数学习和线性分类的基础概念。虽然线性分类器比较简单， 但它被视为更多高级的机器学习和深度学习算法的基石，并能很自然地扩展到神经网络和卷积神经网络中。</p>\n<p>你看，卷积神经网络可以将原始像素映射到类别标签，类似于我们在本教程中所作的那些，只是评分函数f更复杂，并且参数更多。</p>\n<p>参数学习的一大好处就是可以在训练完毕之后，丢弃原训练数据。我们可以只用从数据中学到的参数（比如，权重矩阵和偏置向量）来进行分类。</p>\n<p>这使得分类变得非常高效，因为（1）我们不需要像knn那样在模型中存储一份训练数据的拷贝（2）我们不用将测试图片一个一个的和训练图片进行比较（一个O(N)的操作，并且当数据集很大时就变得非常麻烦）</p>\n<p>简而言之，这个方法明显更快，只需一个简单的点乘和加法。非常简洁，不是吗？</p>\n<p>最后，我们在kaggle 狗vs猫的数据集上，利用Python, OpenCV, 和 scikit-learn进行线性分类。从数据集提取出颜色直方图之后，我们在特征向量上训练一个线性支持向量机，并且得到64%的分类精度，这已经很不错了，因为（1）颜色直方图并非狗和猫特征化的最佳选择（2）我们没有对线性SVM进行调参。</p>\n<p>到这里，我们开始理解了构建神经网络、卷积神经网络和深度学习模型的基本模块，但还有很长一段路要走。</p>\n<p>首先，我们需要更详细地了解损失函数，特别是如何使用损失函数来优化权重矩阵以获得更准确的预测。 未来的博客文章将更详细地介绍这些概念。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/bf8ad2e583c81edfd7f97d579c12ba12.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88487\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88487votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88487\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/bound2020\">bound</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/bound2020\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/bound2020\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/bound2020/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/bound2020/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"], "tags": "实践项目,机器学习", "url_object_id": "0e7034c357265ca0883ee14cc29c7cb2", "praise_nums": "1", "url": "http://python.jobbole.com/88487/", "title": "Python线性分类模型简介", "create_date": "2017/09/01", "comment_nums": 0}
{"fav_nums": 7, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/b7f41df6202d\">Andrew_liu</a>   </div><h1>1. Cookie原理</h1>\n<hr>\n<blockquote><p>HTTP是无状态的面向连接的协议, 为了保持连接状态, 引入了Cookie机制</p></blockquote>\n<p>Cookie是http消息头中的一种属性，包括：</p>\n<ul>\n<li>Cookie名字（Name）Cookie的值（Value）</li>\n<li>Cookie的过期时间（Expires/Max-Age）</li>\n<li>Cookie作用路径（Path）</li>\n<li>Cookie所在域名（Domain），使用Cookie进行安全连接（Secure）。</li>\n</ul>\n<p>前两个参数是Cookie应用的必要条件，另外，还包括Cookie大小（Size，不同浏览器对Cookie个数及大小限制是有差异的）。</p>\n<p><a href=\"http://en.wikipedia.org/wiki/HTTP_cookie\" target=\"_blank\">更详细的cookie</a></p>\n<h1>2. 模拟登陆</h1>\n<hr>\n<blockquote><p>这次主要爬取的网站是<a href=\"http://www.zhihu.com\" target=\"_blank\">知乎</a></p></blockquote>\n<p>爬取知乎就需要登陆的, 通过之前的python内建库, 可以很容易的实现表单提交</p>\n<p><strong>现在就来看看如何通过Scrapy实现表单提交</strong></p>\n<p>首先查看登陆时的表单结果, 依然像前面使用的技巧一样, 故意输错密码, 方面抓到登陆的网页头部和表单(<strong>我使用的Chrome自带的开发者工具中的Network功能</strong>)</p>\n<div>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7a2b2dc9d96e05848eee5262c928c4a.png\"><img class=\"aligncenter size-full wp-image-88479\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7a2b2dc9d96e05848eee5262c928c4a.png\" alt=\"cpp_py_medium\"></a></p>\n<div style=\"text-align: center\">表单截图</div>\n</div>\n<p>查看抓取到的表单可以发现有四个部分:</p>\n<ul>\n<li>邮箱和密码就是个人登陆的邮箱和密码</li>\n<li>rememberme字段表示是否记住账号</li>\n<li>第一个字段是<strong>_xsrf</strong>,猜测是一种验证机制</li>\n</ul>\n<blockquote><p>现在只有<strong>_xsrf</strong>不知道, 猜想这个验证字段肯定会实现在请求网页的时候发送过来, 那么我们查看当前网页的源码(鼠标右键然后查看网页源代码, 或者直接用快捷键)</p></blockquote>\n<div>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c91a1f262b8e2ef011a17e088bcf9b06.png\"><img class=\"aligncenter size-full wp-image-88480\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c91a1f262b8e2ef011a17e088bcf9b06.png\" alt=\"cpp_py_medium\"></a></p>\n<div style=\"text-align: center\">查询网页源码</div>\n</div>\n<p>发现我们的猜测是正确的</p>\n<p>那么现在就可以来写表单登陆功能了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7cbf575081614\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef start_requests(self):\r\n        return [Request(\"https://www.zhihu.com/login\", callback = self.post_login)]  #重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数\r\n\r\n    #FormRequeset\r\n    def post_login(self, response):\r\n        print 'Preparing login'\r\n        #下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单\r\n        xsrf = Selector(response).xpath('//input[@name=\"_xsrf\"]/@value').extract()[0]\r\n        print xsrf\r\n        #FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单\r\n        #登陆成功后, 会调用after_login回调函数\r\n        return [FormRequest.from_response(response,   \r\n                            formdata = {\r\n                            '_xsrf': xsrf,\r\n                            'email': '123456',\r\n                            'password': '123456'\r\n                            },\r\n                            callback = self.after_login\r\n                            )]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cbf575081614-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cbf575081614-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_requests</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"https://www.zhihu.com/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">post_login</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#FormRequeset</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">post_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Preparing login'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//input[@name=\"_xsrf\"]/@value'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#登陆成功后, 会调用after_login回调函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FormRequest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-13\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">formdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-14\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'_xsrf'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-15\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'email'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-16\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'password'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-17\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cbf575081614-18\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after</span><span class=\"crayon-sy\">_</span>login</div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cbf575081614-19\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p></p>\n<blockquote><p>其中主要的功能都在函数的注释中说明</p></blockquote>\n<h1>3. Cookie的保存</h1>\n<hr>\n<p>为了能使用同一个状态持续的爬取网站, 就需要保存<strong>cookie</strong>, 使用cookie保存状态, <strong>Scrapy</strong>提供了cookie处理的中间件, 可以直接拿来使用</p>\n<p><a href=\"http://doc.scrapy.org/en/0.24/topics/downloader-middleware.html?highlight=cookie#module-scrapy.contrib.downloadermiddleware.cookies\" target=\"_blank\">CookiesMiddleware</a></p>\n<blockquote><p>这个cookie中间件保存追踪web服务器发出的cookie, 并将这个cookie在接来下的请求的时候进行发送</p></blockquote>\n<p>Scrapy官方的文档中给出了下面的代码范例 :</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7cca890041758\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i, url in enumerate(urls):\r\n    yield scrapy.Request(\"http://www.example.com\", meta={'cookiejar': i},\r\n        callback=self.parse_page)\r\n\r\ndef parse_page(self, response):\r\n    # do some processing\r\n    return scrapy.Request(\"http://www.example.com/otherpage\",\r\n        meta={'cookiejar': response.meta['cookiejar']},\r\n        callback=self.parse_other_page)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cca890041758-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cca890041758-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cca890041758-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cca890041758-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cca890041758-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cca890041758-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cca890041758-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cca890041758-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cca890041758-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7cca890041758-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cca890041758-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://www.example.com\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cca890041758-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse_page</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cca890041758-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cca890041758-5\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse_page</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cca890041758-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># do some processing</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cca890041758-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://www.example.com/otherpage\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cca890041758-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">meta</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cca890041758-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse_other_page</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>那么可以对我们的爬虫类中方法进行修改, 使其追踪cookie</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7ccf656530222\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数\r\n    def start_requests(self):\r\n        return [Request(\"https://www.zhihu.com/login\", meta = {'cookiejar' : 1}, callback = self.post_login)]  #添加了meta\r\n\r\n    #FormRequeset出问题了\r\n    def post_login(self, response):\r\n        print 'Preparing login'\r\n        #下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单\r\n        xsrf = Selector(response).xpath('//input[@name=\"_xsrf\"]/@value').extract()[0]\r\n        print xsrf\r\n        #FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单\r\n        #登陆成功后, 会调用after_login回调函数\r\n        return [FormRequest.from_response(response,   #\"http://www.zhihu.com/login\",\r\n                            meta = {'cookiejar' : response.meta['cookiejar']}, #注意这里cookie的获取\r\n                            headers = self.headers,\r\n                            formdata = {\r\n                            '_xsrf': xsrf,\r\n                            'email': '123456',\r\n                            'password': '123456'\r\n                            },\r\n                            callback = self.after_login,\r\n                            dont_filter = True\r\n                            )]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ccf656530222-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ccf656530222-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-1\"><span class=\"crayon-c\">#重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_requests</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"https://www.zhihu.com/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">meta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">post_login</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#添加了meta</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#FormRequeset出问题了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">post_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Preparing login'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//input[@name=\"_xsrf\"]/@value'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#登陆成功后, 会调用after_login回调函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FormRequest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#\"http://www.zhihu.com/login\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-14\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">meta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#注意这里cookie的获取</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-15\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-16\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">formdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-17\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'_xsrf'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-18\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'email'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-19\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'password'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-20\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-21\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_login</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ccf656530222-22\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">dont_filter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ccf656530222-23\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0064 seconds] -->\r\n<p></p>\n<h1>4. 伪装头部</h1>\n<hr>\n<p>有时候登陆网站需要进行头部伪装, 比如增加防盗链的头部, 还有模拟服务器登陆, 这些都在前面的爬虫知识中提到过</p>\n<div>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/2e79d77fd25b51caea2eadfcea763113.png\"><img class=\"aligncenter size-full wp-image-88481\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/2e79d77fd25b51caea2eadfcea763113.png\" alt=\"cpp_py_medium\"></a></p>\n<div style=\"text-align: center\">Headers</div>\n</div>\n<p>为了保险, 我们可以在头部中填充更多的字段, 如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7cd4477854114\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheaders = {\r\n    \"Accept\": \"*/*\",\r\n    \"Accept-Encoding\": \"gzip,deflate\",\r\n    \"Accept-Language\": \"en-US,en;q=0.8,zh-TW;q=0.6,zh;q=0.4\",\r\n    \"Connection\": \"keep-alive\",\r\n    \"Content-Type\":\" application/x-www-form-urlencoded; charset=UTF-8\",\r\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\",\r\n    \"Referer\": \"http://www.zhihu.com/\"\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd4477854114-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd4477854114-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd4477854114-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd4477854114-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd4477854114-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd4477854114-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd4477854114-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd4477854114-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd4477854114-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd4477854114-1\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd4477854114-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*/*\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd4477854114-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept-Encoding\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gzip,deflate\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd4477854114-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept-Language\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"en-US,en;q=0.8,zh-TW;q=0.6,zh;q=0.4\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd4477854114-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Connection\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"keep-alive\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd4477854114-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Content-Type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\" application/x-www-form-urlencoded; charset=UTF-8\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd4477854114-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"User-Agent\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd4477854114-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Referer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://www.zhihu.com/\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd4477854114-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>在scrapy中<strong>Request</strong>和<strong>FormRequest</strong>初始化的时候都有一个headers字段, 可以自定义头部, 这样我们可以添加headers字段</p>\n<p>形成最终版的登陆函数</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7cd8022472169\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\nfrom scrapy.contrib.spiders import CrawlSpider, Rule\r\nfrom scrapy.selector import Selector\r\nfrom scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor\r\nfrom scrapy.http import Request, FormRequest\r\nfrom zhihu.items import ZhihuItem\r\n\r\n\r\n\r\nclass ZhihuSipder(CrawlSpider) :\r\n    name = \"zhihu\"\r\n    allowed_domains = [\"www.zhihu.com\"]\r\n    start_urls = [\r\n        \"http://www.zhihu.com\"\r\n    ]\r\n    rules = (\r\n        Rule(SgmlLinkExtractor(allow = ('/question/\\d+#.*?', )), callback = 'parse_page', follow = True),\r\n        Rule(SgmlLinkExtractor(allow = ('/question/\\d+', )), callback = 'parse_page', follow = True),\r\n    )\r\n    headers = {\r\n    \"Accept\": \"*/*\",\r\n    \"Accept-Encoding\": \"gzip,deflate\",\r\n    \"Accept-Language\": \"en-US,en;q=0.8,zh-TW;q=0.6,zh;q=0.4\",\r\n    \"Connection\": \"keep-alive\",\r\n    \"Content-Type\":\" application/x-www-form-urlencoded; charset=UTF-8\",\r\n    \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\",\r\n    \"Referer\": \"http://www.zhihu.com/\"\r\n    }\r\n\r\n    #重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数\r\n    def start_requests(self):\r\n        return [Request(\"https://www.zhihu.com/login\", meta = {'cookiejar' : 1}, callback = self.post_login)]\r\n\r\n    #FormRequeset出问题了\r\n    def post_login(self, response):\r\n        print 'Preparing login'\r\n        #下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单\r\n        xsrf = Selector(response).xpath('//input[@name=\"_xsrf\"]/@value').extract()[0]\r\n        print xsrf\r\n        #FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单\r\n        #登陆成功后, 会调用after_login回调函数\r\n        return [FormRequest.from_response(response,   #\"http://www.zhihu.com/login\",\r\n                            meta = {'cookiejar' : response.meta['cookiejar']},\r\n                            headers = self.headers,  #注意此处的headers\r\n                            formdata = {\r\n                            '_xsrf': xsrf,\r\n                            'email': '1095511864@qq.com',\r\n                            'password': '123456'\r\n                            },\r\n                            callback = self.after_login,\r\n                            dont_filter = True\r\n                            )]\r\n\r\n    def after_login(self, response) :\r\n        for url in self.start_urls :\r\n            yield self.make_requests_from_url(url)\r\n\r\n    def parse_page(self, response):\r\n        problem = Selector(response)\r\n        item = ZhihuItem()\r\n        item['url'] = response.url\r\n        item['name'] = problem.xpath('//span[@class=\"name\"]/text()').extract()\r\n        print item['name']\r\n        item['title'] = problem.xpath('//h2[@class=\"zm-item-title zm-editable-content\"]/text()').extract()\r\n        item['description'] = problem.xpath('//div[@class=\"zm-editable-content\"]/text()').extract()\r\n        item['answer']= problem.xpath('//div[@class=\" zm-editable-content clearfix\"]/text()').extract()\r\n        return item</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cd8022472169-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cd8022472169-68\">68</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">spiders </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CrawlSpider</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Rule</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">selector </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">contrib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">linkextractors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sgml </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SgmlLinkExtractor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">http </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FormRequest</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-7\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZhihuItem</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZhihuSipder</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">CrawlSpider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"zhihu\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">allowed_domains</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"www.zhihu.com\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"http://www.zhihu.com\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">rules</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SgmlLinkExtractor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">allow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/question/\\d+#.*?'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'parse_page'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">follow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Rule</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SgmlLinkExtractor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">allow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/question/\\d+'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'parse_page'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">follow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"*/*\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept-Encoding\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"gzip,deflate\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Accept-Language\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"en-US,en;q=0.8,zh-TW;q=0.6,zh;q=0.4\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Connection\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"keep-alive\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Content-Type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\" application/x-www-form-urlencoded; charset=UTF-8\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"User-Agent\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"Referer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://www.zhihu.com/\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-30\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#重写了爬虫类的方法, 实现了自定义请求, 运行成功后会调用callback回调函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_requests</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"https://www.zhihu.com/login\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">meta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">post_login</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-34\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#FormRequeset出问题了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">post_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Preparing login'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#下面这句话用于抓取请求网页后返回网页中的_xsrf字段的文字, 用于成功提交表单</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//input[@name=\"_xsrf\"]/@value'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#FormRequeset.from_response是Scrapy提供的一个函数, 用于post表单</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#登陆成功后, 会调用after_login回调函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FormRequest</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">from_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#\"http://www.zhihu.com/login\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-44\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">meta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">meta</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'cookiejar'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-45\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#注意此处的headers</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-46\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">formdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-47\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'_xsrf'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xsrf</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-48\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'email'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1095511864@qq.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-49\"><span class=\"crayon-h\">                            </span><span class=\"crayon-s\">'password'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'123456'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-50\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-51\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">callback</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">after_login</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-52\"><span class=\"crayon-h\">                            </span><span class=\"crayon-v\">dont_filter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-53\"><span class=\"crayon-h\">                            </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-54\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">after_login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">make_requests_from_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-58\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse_page</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">problem</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Selector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZhihuItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'url'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-63\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">problem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//span[@class=\"name\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">problem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//h2[@class=\"zm-item-title zm-editable-content\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'description'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">problem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//div[@class=\"zm-editable-content\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cd8022472169-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'answer'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">problem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//div[@class=\" zm-editable-content clearfix\"]/text()'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cd8022472169-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0294 seconds] -->\r\n<p></p>\n<h1>5. Item类和抓取间隔</h1>\n<hr>\n<p><a href=\"https://github.com/Andrew-liu/scrapy_example/tree/master/zhihu\" target=\"_blank\">完整的知乎爬虫代码链接</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7cde345600482\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom scrapy.item import Item, Field\r\n\r\n\r\nclass ZhihuItem(Item):\r\n    # define the fields for your item here like:\r\n    # name = scrapy.Field()\r\n    url = Field()  #保存抓取问题的url\r\n    title = Field()  #抓取问题的标题\r\n    description = Field()  #抓取问题的描述\r\n    answer = Field()  #抓取问题的答案\r\n    name = Field()  #个人用户的名称</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cde345600482-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cde345600482-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cde345600482-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cde345600482-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7cde345600482-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7cde345600482-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">item </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cde345600482-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cde345600482-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZhihuItem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># define the fields for your item here like:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cde345600482-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># name = scrapy.Field()</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#保存抓取问题的url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cde345600482-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">title</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#抓取问题的标题</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">description</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#抓取问题的描述</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7cde345600482-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">answer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#抓取问题的答案</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7cde345600482-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Field</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#个人用户的名称</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>设置抓取间隔, 访问由于爬虫的过快抓取, 引发网站的发爬虫机制, 在<strong>setting.py</strong>中设置</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7ce2862709189\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nBOT_NAME = 'zhihu'\r\n\r\nSPIDER_MODULES = ['zhihu.spiders']\r\nNEWSPIDER_MODULE = 'zhihu.spiders'\r\nDOWNLOAD_DELAY = 0.25   #设置下载间隔为250ms</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce2862709189-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce2862709189-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce2862709189-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce2862709189-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce2862709189-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce2862709189-1\"><span class=\"crayon-v\">BOT_NAME</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zhihu'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce2862709189-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce2862709189-3\"><span class=\"crayon-v\">SPIDER_MODULES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'zhihu.spiders'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce2862709189-4\"><span class=\"crayon-v\">NEWSPIDER_MODULE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zhihu.spiders'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce2862709189-5\"><span class=\"crayon-v\">DOWNLOAD_DELAY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.25</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#设置下载间隔为250ms</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p><a href=\"http://scrapy-chs.readthedocs.org/zh_CN/latest/topics/settings.html\" target=\"_blank\">更多设置可以查看官方文档</a></p>\n<p>抓取结果(<strong>只是截取了其中很少一部分</strong>)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd7ce6187276484\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\n 'url': 'http://www.zhihu.com/question/20688855/answer/16577390'}\r\n2014-12-19 23:24:15+0800 [zhihu] DEBUG: Crawled (200) &lt;GET http://www.zhihu.com/question/20688855/answer/15861368&gt; (referer: http://www.zhihu.com/question/20688855/answer/19231794)\r\n[]\r\n2014-12-19 23:24:15+0800 [zhihu] DEBUG: Scraped from &lt;200 http://www.zhihu.com/question/20688855/answer/15861368&gt;\r\n    {'answer': [u'\\u9009\\u4f1a\\u8ba1\\u8fd9\\u4e2a\\u4e13\\u4e1a\\uff0c\\u8003CPA\\uff0c\\u5165\\u8d22\\u52a1\\u8fd9\\u4e2a\\u884c\\u5f53\\u3002\\u8fd9\\u4e00\\u8def\\u8d70\\u4e0b\\u6765\\uff0c\\u6211\\u53ef\\u4ee5\\u5f88\\u80af\\u5b9a\\u7684\\u544a\\u8bc9\\u4f60\\uff0c\\u6211\\u662f\\u771f\\u7684\\u559c\\u6b22\\u8d22\\u52a1\\uff0c\\u70ed\\u7231\\u8fd9\\u4e2a\\u884c\\u4e1a\\uff0c\\u56e0\\u6b64\\u575a\\u5b9a\\u4e0d\\u79fb\\u5730\\u5728\\u8fd9\\u4e2a\\u884c\\u4e1a\\u4e2d\\u8d70\\u4e0b\\u53bb\\u3002',\r\n                u'\\u4e0d\\u8fc7\\u4f60\\u8bf4\\u6709\\u4eba\\u4ece\\u5c0f\\u5c31\\u559c\\u6b22\\u8d22\\u52a1\\u5417\\uff1f\\u6211\\u89c9\\u5f97\\u51e0\\u4e4e\\u6ca1\\u6709\\u5427\\u3002\\u8d22\\u52a1\\u7684\\u9b45\\u529b\\u5728\\u4e8e\\u4f60\\u771f\\u6b63\\u61c2\\u5f97\\u5b83\\u4e4b\\u540e\\u3002',\r\n                u'\\u901a\\u8fc7\\u5b83\\uff0c\\u4f60\\u53ef\\u4ee5\\u5b66\\u4e60\\u4efb\\u4f55\\u4e00\\u79cd\\u5546\\u4e1a\\u7684\\u7ecf\\u8425\\u8fc7\\u7a0b\\uff0c\\u4e86\\u89e3\\u5176\\u7eb7\\u7e41\\u5916\\u8868\\u4e0b\\u7684\\u5b9e\\u7269\\u6d41\\u3001\\u73b0\\u91d1\\u6d41\\uff0c\\u751a\\u81f3\\u4f60\\u53ef\\u4ee5\\u638c\\u63e1\\u5982\\u4f55\\u53bb\\u7ecf\\u8425\\u8fd9\\u79cd\\u5546\\u4e1a\\u3002',\r\n                u'\\u5982\\u679c\\u5bf9\\u4f1a\\u8ba1\\u7684\\u8ba4\\u8bc6\\u4ec5\\u4ec5\\u505c\\u7559\\u5728\\u505a\\u5206\\u5f55\\u8fd9\\u4e2a\\u5c42\\u9762\\uff0c\\u5f53\\u7136\\u4f1a\\u89c9\\u5f97\\u67af\\u71e5\\u65e0\\u5473\\u3002\\u5f53\\u4f60\\u5bf9\\u5b83\\u7684\\u8ba4\\u8bc6\\u8fdb\\u5165\\u5230\\u6df1\\u5c42\\u6b21\\u7684\\u65f6\\u5019\\uff0c\\u4f60\\u81ea\\u7136\\u5c31\\u4f1a\\u559c\\u6b22\\u4e0a\\u5b83\\u4e86\\u3002\\n\\n\\n'],\r\n     'description': [u'\\u672c\\u4eba\\u5b66\\u4f1a\\u8ba1\\u6559\\u80b2\\u4e13\\u4e1a\\uff0c\\u6df1\\u611f\\u5176\\u67af\\u71e5\\u4e4f\\u5473\\u3002\\n\\u5f53\\u521d\\u662f\\u51b2\\u7740\\u5e08\\u8303\\u4e13\\u4e1a\\u62a5\\u7684\\uff0c\\u56e0\\u4e3a\\u68a6\\u60f3\\u662f\\u6210\\u4e3a\\u4e00\\u540d\\u8001\\u5e08\\uff0c\\u4f46\\u662f\\u611f\\u89c9\\u73b0\\u5728\\u666e\\u901a\\u521d\\u9ad8\\u4e2d\\u8001\\u5e08\\u5df2\\u7ecf\\u8d8b\\u4e8e\\u9971\\u548c\\uff0c\\u800c\\u987a\\u6bcd\\u4eb2\\u5927\\u4eba\\u7684\\u610f\\u9009\\u4e86\\u8fd9\\u4e2a\\u4e13\\u4e1a\\u3002\\u6211\\u559c\\u6b22\\u4e0a\\u6559\\u80b2\\u5b66\\u7684\\u8bfe\\uff0c\\u5e76\\u597d\\u7814\\u7a76\\u5404\\u79cd\\u6559\\u80b2\\u5fc3\\u7406\\u5b66\\u3002\\u4f46\\u4f1a\\u8ba1\\u8bfe\\u4f3c\\u4e4e\\u662f\\u4e3b\\u6d41\\u3001\\u54ce\\u3002\\n\\n\\u4e00\\u76f4\\u4e0d\\u559c\\u6b22\\u94b1\\u4e0d\\u94b1\\u7684\\u4e13\\u4e1a\\uff0c\\u6240\\u4ee5\\u5f88\\u597d\\u5947\\u5927\\u5bb6\\u9009\\u4f1a\\u8ba1\\u4e13\\u4e1a\\u5230\\u5e95\\u662f\\u51fa\\u4e8e\\u4ec0\\u4e48\\u76ee\\u7684\\u3002\\n\\n\\u6bd4\\u5982\\u8bf4\\u5b66\\u4e2d\\u6587\\u7684\\u4f1a\\u8bf4\\u4ece\\u5c0f\\u559c\\u6b22\\u770b\\u4e66\\uff0c\\u4f1a\\u6709\\u4ece\\u5c0f\\u559c\\u6b22\\u4f1a\\u8ba1\\u501f\\u554a\\u8d37\\u554a\\u7684\\u7684\\u4eba\\u5417\\uff1f'],\r\n     'name': [],\r\n     'title': [u'\\n\\n', u'\\n\\n'],\r\n     'url': 'http://www.zhihu.com/question/20688855/answer/15861368'}\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd7ce6187276484-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd7ce6187276484-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'url'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.zhihu.com/question/20688855/answer/16577390'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-3\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">question</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">20688855</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">answer</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">15861368</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">question</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">20688855</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">answer</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">19231794</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-5\"><span class=\"crayon-cn\">2014</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0800</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Scraped </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">200</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zhihu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">question</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">20688855</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">answer</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">15861368</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'answer'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u9009\\u4f1a\\u8ba1\\u8fd9\\u4e2a\\u4e13\\u4e1a\\uff0c\\u8003CPA\\uff0c\\u5165\\u8d22\\u52a1\\u8fd9\\u4e2a\\u884c\\u5f53\\u3002\\u8fd9\\u4e00\\u8def\\u8d70\\u4e0b\\u6765\\uff0c\\u6211\\u53ef\\u4ee5\\u5f88\\u80af\\u5b9a\\u7684\\u544a\\u8bc9\\u4f60\\uff0c\\u6211\\u662f\\u771f\\u7684\\u559c\\u6b22\\u8d22\\u52a1\\uff0c\\u70ed\\u7231\\u8fd9\\u4e2a\\u884c\\u4e1a\\uff0c\\u56e0\\u6b64\\u575a\\u5b9a\\u4e0d\\u79fb\\u5730\\u5728\\u8fd9\\u4e2a\\u884c\\u4e1a\\u4e2d\\u8d70\\u4e0b\\u53bb\\u3002'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u4e0d\\u8fc7\\u4f60\\u8bf4\\u6709\\u4eba\\u4ece\\u5c0f\\u5c31\\u559c\\u6b22\\u8d22\\u52a1\\u5417\\uff1f\\u6211\\u89c9\\u5f97\\u51e0\\u4e4e\\u6ca1\\u6709\\u5427\\u3002\\u8d22\\u52a1\\u7684\\u9b45\\u529b\\u5728\\u4e8e\\u4f60\\u771f\\u6b63\\u61c2\\u5f97\\u5b83\\u4e4b\\u540e\\u3002'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u901a\\u8fc7\\u5b83\\uff0c\\u4f60\\u53ef\\u4ee5\\u5b66\\u4e60\\u4efb\\u4f55\\u4e00\\u79cd\\u5546\\u4e1a\\u7684\\u7ecf\\u8425\\u8fc7\\u7a0b\\uff0c\\u4e86\\u89e3\\u5176\\u7eb7\\u7e41\\u5916\\u8868\\u4e0b\\u7684\\u5b9e\\u7269\\u6d41\\u3001\\u73b0\\u91d1\\u6d41\\uff0c\\u751a\\u81f3\\u4f60\\u53ef\\u4ee5\\u638c\\u63e1\\u5982\\u4f55\\u53bb\\u7ecf\\u8425\\u8fd9\\u79cd\\u5546\\u4e1a\\u3002'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u5982\\u679c\\u5bf9\\u4f1a\\u8ba1\\u7684\\u8ba4\\u8bc6\\u4ec5\\u4ec5\\u505c\\u7559\\u5728\\u505a\\u5206\\u5f55\\u8fd9\\u4e2a\\u5c42\\u9762\\uff0c\\u5f53\\u7136\\u4f1a\\u89c9\\u5f97\\u67af\\u71e5\\u65e0\\u5473\\u3002\\u5f53\\u4f60\\u5bf9\\u5b83\\u7684\\u8ba4\\u8bc6\\u8fdb\\u5165\\u5230\\u6df1\\u5c42\\u6b21\\u7684\\u65f6\\u5019\\uff0c\\u4f60\\u81ea\\u7136\\u5c31\\u4f1a\\u559c\\u6b22\\u4e0a\\u5b83\\u4e86\\u3002\\n\\n\\n'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-10\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'description'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\u672c\\u4eba\\u5b66\\u4f1a\\u8ba1\\u6559\\u80b2\\u4e13\\u4e1a\\uff0c\\u6df1\\u611f\\u5176\\u67af\\u71e5\\u4e4f\\u5473\\u3002\\n\\u5f53\\u521d\\u662f\\u51b2\\u7740\\u5e08\\u8303\\u4e13\\u4e1a\\u62a5\\u7684\\uff0c\\u56e0\\u4e3a\\u68a6\\u60f3\\u662f\\u6210\\u4e3a\\u4e00\\u540d\\u8001\\u5e08\\uff0c\\u4f46\\u662f\\u611f\\u89c9\\u73b0\\u5728\\u666e\\u901a\\u521d\\u9ad8\\u4e2d\\u8001\\u5e08\\u5df2\\u7ecf\\u8d8b\\u4e8e\\u9971\\u548c\\uff0c\\u800c\\u987a\\u6bcd\\u4eb2\\u5927\\u4eba\\u7684\\u610f\\u9009\\u4e86\\u8fd9\\u4e2a\\u4e13\\u4e1a\\u3002\\u6211\\u559c\\u6b22\\u4e0a\\u6559\\u80b2\\u5b66\\u7684\\u8bfe\\uff0c\\u5e76\\u597d\\u7814\\u7a76\\u5404\\u79cd\\u6559\\u80b2\\u5fc3\\u7406\\u5b66\\u3002\\u4f46\\u4f1a\\u8ba1\\u8bfe\\u4f3c\\u4e4e\\u662f\\u4e3b\\u6d41\\u3001\\u54ce\\u3002\\n\\n\\u4e00\\u76f4\\u4e0d\\u559c\\u6b22\\u94b1\\u4e0d\\u94b1\\u7684\\u4e13\\u4e1a\\uff0c\\u6240\\u4ee5\\u5f88\\u597d\\u5947\\u5927\\u5bb6\\u9009\\u4f1a\\u8ba1\\u4e13\\u4e1a\\u5230\\u5e95\\u662f\\u51fa\\u4e8e\\u4ec0\\u4e48\\u76ee\\u7684\\u3002\\n\\n\\u6bd4\\u5982\\u8bf4\\u5b66\\u4e2d\\u6587\\u7684\\u4f1a\\u8bf4\\u4ece\\u5c0f\\u559c\\u6b22\\u770b\\u4e66\\uff0c\\u4f1a\\u6709\\u4ece\\u5c0f\\u559c\\u6b22\\u4f1a\\u8ba1\\u501f\\u554a\\u8d37\\u554a\\u7684\\u7684\\u4eba\\u5417\\uff1f'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-11\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'name'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-12\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'title'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\n\\n'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'\\n\\n'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd7ce6187276484-13\"><span class=\"crayon-h\">     </span><span class=\"crayon-s\">'url'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://www.zhihu.com/question/20688855/answer/15861368'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd7ce6187276484-14\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0073 seconds] -->\r\n<p></p>\n<h1>6. 存在问题</h1>\n<ul>\n<li><strong>Rule</strong>设计不能实现全网站抓取, 只是设置了简单的问题的抓取</li>\n<li><strong>Xpath</strong>设置不严谨, 需要重新思考</li>\n<li><strong>Unicode</strong>编码应该转换成<strong>UTF-8</strong></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88478\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88478votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88478\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/c7a2b2dc9d96e05848eee5262c928c4a.png"], "tags": "系列教程,Scrapy,爬虫", "url_object_id": "e7bc08bb05b1484d036a4c682e04a90b", "praise_nums": "1", "url": "http://python.jobbole.com/88478/", "title": "Python 爬虫(七)-- Scrapy 模拟登录", "create_date": "2017/08/31", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.airpair.com/python/posts/django-flask-pyramid\">Ryan Brown</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/django-flask-pyramid\">开源中国</a>   </div><p>Pyramid, Django, 和 Flask都是优秀的框架，为项目选择其中的哪一个都是伤脑筋的事。我们将会用三种框架实现相同功能的应用来更容易的对比三者。也可以直接跳到框架实战（Frameworks in Action）章节查看代码（<a href=\"https://github.com/ryansb/wut4lunch_demos\" target=\"_blank\" rel=\"nofollow\">code</a>）。</p>\n<h1>1 简介</h1>\n<p>世界上可选的基于Python的web框架有很多。Django, Flask, Pyramid, Tornado, Bottle, Diesel, Pecan, Falcon等等，都在争取开发者支持。作为一开发者从一堆选择中筛选出一个来完成项目将会成为下一个大工程。我们今天专注于Flask, Pyramid, 和 Django。它们涵盖了从小微项目到企业级的web服务。</p>\n<p>为了更容易在三者中作出选择（至少更了解它们），我们将用每一个框架构建同样的应用并比较它们的代码，对于每一个方法我们会高亮显示它的优点和缺点。如果你只想要代码，直接跳到框架实战章节（<em>Frameworks in Action），</em>或者查看其在<a href=\"https://github.com/ryansb/wut4lunch_demos\" rel=\"nofollow\">Github</a>上的代码。</p>\n<p>Flask是一个面向简单需求小型应用的“微框架（microframework）”。Pyramid和Django都是面向大型应用的，但是有不同的拓展性和灵活性。Pyramid的目的是更灵活，能够让开发者为项目选择合适的工具。这意味着开发者能够选择数据库、URL结构、模板类型等等。Django目的是囊括web应用的所有内容，所以开发者只需要打开箱子开始工作，将Django的模块拉进箱子中。</p>\n<p>Django包括一个开箱即用的 <a href=\"http://en.wikipedia.org/wiki/Object-relational_mapping\" rel=\"nofollow\">ORM</a> ，而Pyramid和 Flask让开发者自己选择如何或者是否存储他们的数据。到目前为止对于非Django的web应用来说最流行的ORM是<a href=\"http://www.sqlalchemy.org/\" rel=\"nofollow\">SQLAlchemy</a>，同时还有多种其他选择，从 <a href=\"http://aws.amazon.com/dynamodb/\" rel=\"nofollow\">DynamoDB</a>和<a href=\"http://www.mongodb.org/\" rel=\"nofollow\">MongoDB</a> 到简单本地存储的<a href=\"https://github.com/google/leveldb\" rel=\"nofollow\">LevelDB</a> 或朴实的<a href=\"http://www.sqlite.org/\" rel=\"nofollow\">SQLite</a>。Pyramid被设计为可使用任何数据持久层，甚至是还没有开发出来的。</p>\n<h1>2、关于框架</h1>\n<p>Django的”batteries included” 特性让开发者不需要提前为他们的应用程序基础设施做决定，因为他们知道Python已经深入到了web应用当中。Django已经内建了模板、表单、路由、认证、基本数据库管理等等。比较起来，Pyramid包括路由和认证，但是模板和数据库管理需要额外的库。</p>\n<p>前面为 Flask和Pyramid apps选择组件的额外工作给那些使用案例不适用标准ORM的开发者提供了更多的灵活性，同样也给使用不同工作流和模版化系统的开发者们带来了灵活性。</p>\n<p>Flask，作为三个框架里面最稚气的一个，开始于2010年年中。Pyramid框架是从<a href=\"http://www.pylonsproject.org/about/history\" rel=\"nofollow\">Pylons</a>项目开始的，在2010年底获得 Pyramid这个名字，虽然在2005年就已经发布了第一个版本。Django 2006年发布了第一个版本，就在Pylons项目（最后叫Pyramid）开始之后。Pyramid和Django都是非常成熟的框架，积累了众多插件和扩展以满足难以置信的巨大需求。</p>\n<p>虽然Flask历史相对更短，但它能够学习之前出现的框架并且把注意力放在了微小项目上。它大多数情况被使用在一些只有一两个功能的小型项目上。例如 <a href=\"http://httpbin.org/\" rel=\"nofollow\">httpbin</a>，一个简单的（但很强大的）调试和测试HTTP库的项目。</p>\n<h1>3. 社区</h1>\n<p>最具活力的社区当属Django，其有80,000个StackOverflow问题和一系列来自开发者和优秀用户的良好的博客。Flask和<a href=\"http://www.oschina.net/p/pyramid\" target=\"_blank\" rel=\"nofollow\">Pyramid</a>社区并没有那么大，但它们的社区在邮件列表和IRC上相当活跃。StackOverflow上仅有5,000个相关的标签，Flask比Django小了15倍。在Github上，它们的star近乎相当，Django有11,300个，Flask有10,900个。</p>\n<p>三个框架都使用的是BSD衍生的协议。<a href=\"http://www.oschina.net/p/flask\" target=\"_blank\" rel=\"nofollow\">Flask</a>和<a href=\"http://www.oschina.net/p/django\" target=\"_blank\" rel=\"nofollow\">Django</a>的协议是BSD 3条款，Pyramid的<a href=\"http://repoze.org/license.html\" target=\"_blank\" rel=\"nofollow\">Repoze Public License RPL</a>是BSD协议 4条款的衍生。</p>\n<h1>4. Bootstrapping</h1>\n<p>Django和Pyramid都内建bootstrapping工具。Flask没有包含类似的工具，因为Flask的目标用户不是那种<em>试图</em>构建大型<a href=\"http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller\" target=\"_blank\" rel=\"nofollow\">MVC</a>应用的人。</p>\n<h2>4.1 Flask</h2>\n<p>Flask的hello world应用非常的简单，仅仅单个Python文件的7行代码就够了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2305303748087\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# from http://flask.pocoo.org/ tutorial\r\nfrom flask import Flask\r\napp = Flask(__name__)\r\n\r\n@app.route(\"/\") # take note of this decorator syntax, it's a common pattern\r\ndef hello():\r\n    return \"Hello World!\"\r\n\r\nif __name__ == \"__main__\":\r\n    app.run()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2305303748087-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2305303748087-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2305303748087-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2305303748087-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2305303748087-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2305303748087-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2305303748087-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2305303748087-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2305303748087-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2305303748087-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2305303748087-1\"><span class=\"crayon-c\"># from http://flask.pocoo.org/ tutorial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2305303748087-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2305303748087-3\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2305303748087-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2305303748087-5\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># take note of this decorator syntax, it's a common pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2305303748087-6\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2305303748087-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Hello World!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2305303748087-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2305303748087-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2305303748087-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>这是Flask没有bootstrapping工具的原因：没有它们的需求。从Flask主页上的Hello World特性看，没有构建Python web应用经验的开发者可以立即开始hacking。</p>\n<p>对于各部分需要更多分离的项目，Flask有blueprints。例如，你可以将所有用户相关的函数放在users.py中，将销售相关的函数放在ecommerce.py中，然后在site.py中添加引用它们来结构化你的Flask应用。我们不会深入这个功能，因为它超出了我们展示demo应用的需求。</p>\n<h2>4.2 Pyramid</h2>\n<p>Pyramid 的 bootstrapping工具叫 pcreate，是Pyramid的组成部分. 之前的 <a href=\"http://pythonpaste.org/\" rel=\"nofollow\">Paste</a> 工具套装提供了 bootstrapping ，但是从那之后被 Pyramid专用工具链替代了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2316864381883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ pcreate -s starter hello_pyramid # Just make a Pyramid project</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2316864381883-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2316864381883-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pcreate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">starter </span><span class=\"crayon-v\">hello_pyramid</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># Just make a Pyramid project</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>Pyramid 比 Flask 适用于更大更复杂的应用程序. 因为这一点,它的 bootstrapping工具创建更大的项目骨架. Pyramid 同样加入了基本的配置文件，一个例子模版和用于将程序打包上传到 <a href=\"https://pypi.python.org/\" rel=\"nofollow\">Python Package Index</a>的所有文件。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd231e768490264\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhello_pyramid\r\n├── CHANGES.txt\r\n├── development.ini\r\n├── MANIFEST.in\r\n├── production.ini\r\n├── hello_pyramid\r\n│   ├── __init__.py\r\n│   ├── static\r\n│   │   ├── pyramid-16x16.png\r\n│   │   ├── pyramid.png\r\n│   │   ├── theme.css\r\n│   │   └── theme.min.css\r\n│   ├── templates\r\n│   │   └── mytemplate.pt\r\n│   ├── tests.py\r\n│   └── views.py\r\n├── README.txt\r\n└── setup.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd231e768490264-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd231e768490264-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-1\"><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">_</span>pyramid</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHANGES</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-3\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">development</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">ini</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-4\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">MANIFEST</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">in</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-5\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">production</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">ini</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-6\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">_</span>pyramid</div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-7\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-8\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">static</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-9\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">pyramid</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16x16.png</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-10\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">pyramid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">png</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-11\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">css</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-12\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">theme</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">css</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-13\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">templates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-14\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">mytemplate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">pt</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-15\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-16\">│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd231e768490264-17\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd231e768490264-18\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">setup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>作为最后描述的框架，Pyramid的bootstrapper非常灵活. 不局限于一个默认的程序;pcreate 可以使用任意数量的项目模版. 包括我们上面用到的pcreate里面的”starter”的模版, 还有 SQLAlchemy- ，<a href=\"http://www.zodb.org/en/latest/\" rel=\"nofollow\">ZODB</a>-支持scaffold项目. 在 PyPi可以发现已经为<a href=\"https://pypi.python.org/pypi/pyramid_appengine/\" rel=\"nofollow\">Google App Engine</a>, <a href=\"https://github.com/Pylons/pyramid_jqm\" rel=\"nofollow\">jQuery Mobile</a>, <a href=\"https://pypi.python.org/pypi/jinja2-alchemy-starter\" rel=\"nofollow\">Jinja2 templating</a>, <a href=\"https://pypi.python.org/pypi/pyramid_modern\" rel=\"nofollow\">modern frontend frameworks</a>做好的scaffolds， 还有更多~</p>\n<h2>4.3 Django</h2>\n<p>Django 也有自己的 bootstrap 工具, 内置在 django-admin 中.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2326967091162\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndjango-admin startproject hello_django\r\ndjango-admin startapp howdy # make an application within our project</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2326967091162-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2326967091162-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2326967091162-1\"><span class=\"crayon-v\">django</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">admin </span><span class=\"crayon-e\">startproject </span><span class=\"crayon-e\">hello_django</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2326967091162-2\"><span class=\"crayon-v\">django</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">admin </span><span class=\"crayon-e\">startapp </span><span class=\"crayon-v\">howdy</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># make an application within our project</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>Django 跟 Pyramid 区别在于: Django 由多个应用程序组成一个项目, 而 Pyramid 以及 Flask 项目是包含 View 和 Model 单一应用程序 . 理论上, Flask 和 Pyramid 的项目允许存在多个 project/app, 不过在默认配置中只能有一个.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd232c546578160\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhello_django\r\n├── hello_django\r\n│   ├── __init__.py\r\n│   ├── settings.py\r\n│   ├── urls.py\r\n│   └── wsgi.py\r\n├── howdy\r\n│   ├── admin.py\r\n│   ├── __init__.py\r\n│   ├── migrations\r\n│   │   └── __init__.py\r\n│   ├── models.py\r\n│   ├── tests.py\r\n│   └── views.py\r\n└── manage.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd232c546578160-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd232c546578160-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-1\"><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">_</span>django</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">_</span>django</div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-3\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-4\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-5\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-6\">│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">wsgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-7\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">howdy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-8\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-9\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-10\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">migrations</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-11\">│<span class=\"crayon-h\">   </span>│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-12\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">models</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-13\">│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd232c546578160-14\">│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">views</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd232c546578160-15\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">manage</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>Django 默认只在项目中创建 空白的 model 和模板文件, 供新手参考的示范代码不多. 此外, 开发者在发布应用程序的时候, 还要自己配置, 这也是个麻烦.</p>\n<p>bootstrap 工具的缺点是没有指导开发者如何打包应用. 对于那些没有经验的新手来说, 第一次部署应用将是个很头疼的问题. 像 <a href=\"https://github.com/tangentlabs/django-oscar\" rel=\"nofollow\">django-oscar</a> 这样的大社区, 项目都是打包好了, 放在 PyPi 上供大家安装. 但是 Github 上面的小项目缺少统一的打包方式.</p>\n<h1>5 模板</h1>\n<p>一个Python应用能够响应HTTP请求将是一个伟大的开端，但是有可能你的大多数用户是没有兴趣使用curl与你的web应用交互的。幸运的是，这三个竞争者提供了使用自定义信息填充HTML的方法，以便让大伙们能够享受时髦的<a href=\"http://getbootstrap.com/\" rel=\"nofollow\">Bootstrap</a> 前端。</p>\n<p>模板让你能够直接向页面注入动态信息，而不是采用AJAX。你只需要一次请求就可以获取整个页面以及所有的动态数据，这对用户体验来说是很好的。这对于手机网站来说尤其重要，因为一次请求花费的时间会更长。</p>\n<p>所有的模板选项依赖于“上下文环境（context）”，其为模板转换为HTML提供了动态信息。模板的最简单的例子是填充已登录用户的名字以正确的迎接他们。也可以用AJAX获取这种动态信息，但是用一整个调用来填写用户的名字有点过头了，而同时模板又是这么的简单。</p>\n<h2>5.1 Django</h2>\n<p>我们使用的例子正如写的那么简单，假设我们有一个包含了用户名的funllname属性的user对象。在Python中我们这样向模板中传递当前用户：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2335363507886\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef a_view(request):\r\n    # get the logged in user\r\n    # ... do more things\r\n    return render_to_response(\r\n        \"view.html\",\r\n        {\"user\": cur_user}\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2335363507886-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2335363507886-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2335363507886-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2335363507886-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2335363507886-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2335363507886-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2335363507886-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2335363507886-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">a_view</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2335363507886-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># get the logged in user</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2335363507886-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># ... do more things</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2335363507886-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_to_response</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2335363507886-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"view.html\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2335363507886-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cur_user</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2335363507886-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>拥有这个模板的上下文很简单，传入一个Python对象的字典和模板使用的数据结构。现在我们需要在页面上渲染他们的名字，以防页面忘了他们是谁。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd233b087763439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!-- view.html --&gt;\r\n&lt;div class=\"top-bar row\"&gt;\r\n  &lt;div class=\"col-md-10\"&gt;\r\n  &lt;!-- more top bar things go here --&gt;\r\n  &lt;/div&gt;\r\n  {% if user %}\r\n  &lt;div class=\"col-md-2 whoami\"&gt;\r\n    You are logged in as {{ user.fullname }}\r\n  &lt;/div&gt;\r\n  {% endif %}\r\n&lt;/div&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd233b087763439-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd233b087763439-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd233b087763439-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd233b087763439-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd233b087763439-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd233b087763439-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">view</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd233b087763439-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"top-bar row\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-md-10\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd233b087763439-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">things</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">go</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">here</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd233b087763439-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-md-2 whoami\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd233b087763439-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">You</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">are</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">logged</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">fullname</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd233b087763439-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endif</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd233b087763439-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0057 seconds] -->\r\n<p>首先，你会注意到这个 {% if user %} 概念。在Django模板中， {% 用来控制循环和条件的声明。这里的if user声明是为了防止那些不是用户的情况。匿名用户不应该在页面头部看到“你已经登录”的字样。</p>\n<p>在if块内，你可以看到，包含名字非常的简单，只要用{{}}包含着我们要插入的属性就可以了。{{是用来向模板插入真实值的，如{{ user.fullname }}。</p>\n<p>模板的另一个常用情况是展示一组物品，如一个电子商务网站的存货清单页面。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2342767291314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef browse_shop(request):\r\n    # get items\r\n    return render_to_response(\r\n        \"browse.html\",\r\n        {\"inventory\": all_items}\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2342767291314-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2342767291314-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2342767291314-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2342767291314-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2342767291314-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2342767291314-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2342767291314-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">browse_shop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2342767291314-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># get items</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2342767291314-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_to_response</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2342767291314-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"browse.html\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2342767291314-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"inventory\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">all_items</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2342767291314-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>在模板中，我们使用同样的{%来循环清单中的所有条目，并填入它们各自的页面地址。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2348928239656\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{% for widget in inventory %}\r\n    &lt;li&gt;&lt;a href=\"/widget/{{ widget.slug }}/\"&gt;{{ widget.displayname }}&lt;/a&gt;&lt;/li&gt;\r\n{% endfor %}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2348928239656-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2348928239656-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2348928239656-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2348928239656-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">widget </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inventory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2348928239656-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/widget/{{ widget.slug }}/\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">widget</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">displayname</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">a</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2348928239656-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>为了做大部分常见的模板任务，Django可以仅仅使用很少的结构来完成目标，因此很容易上手。</p>\n<h2>5.2 Flask</h2>\n<p>Flask默认使用受Django启发的<a href=\"http://www.oschina.net/p/jinja\" target=\"_blank\" rel=\"nofollow\">Jinja2</a>模板语言，但也可以配置来使用另一门语言。不应该抱怨一个仓促的程序员分不清Django和Jinja模板。事实是，上面的Django例子在Jinja2也有效。为了不去重复相同的例子，我们来看下Jinja2比Django模板更具表现力的地方。</p>\n<p>Jinja和Django模板都提够了过滤的特性，即传入的列表会在展示前通过一个函数。一个拥有博文类别属性的博客，可以利用过滤特性，在一个用逗号分割的列表中展示博文的类别。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd234f437116259\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!-- Django --&gt;\r\n&lt;div class=\"categories\"&gt;Categories: {{ post.categories|join:\", \" }}&lt;/div&gt;\r\n\r\n&lt;!-- now in Jinja --&gt;\r\n&lt;div class=\"categories\"&gt;Categories: {{ post.categories|join(\", \") }}&lt;/div&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd234f437116259-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd234f437116259-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd234f437116259-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd234f437116259-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd234f437116259-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd234f437116259-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Django</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd234f437116259-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"categories\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Categories</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">post</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">categories</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">join</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\", \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd234f437116259-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd234f437116259-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">now </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Jinja</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd234f437116259-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"categories\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">Categories</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">post</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">categories</span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\", \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>在Jinja模板语言中，可以向过滤器传入任意数量的参数，因为Jinja把它看成是 使用括号包含参数的Python函数的一个调用。Django使用冒号来分割过滤器的名字和过滤参数，这限制了参数的数目只能为一。</p>\n<p>Jinjia和Django的for循环有点类似。我们来看看他们的不同。在Jinjia2中，for-else-endfor结构能遍历一个列表，同时也处理了没有项的情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2355648043817\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{% for item in inventory %}\r\n&lt;div class=\"display-item\"&gt;{{ item.render() }}&lt;/div&gt;\r\n{% else %}\r\n&lt;div class=\"display-warn\"&gt;\r\n&lt;h3&gt;No items found&lt;/h3&gt;\r\n&lt;p&gt;Try another search, maybe?&lt;/p&gt;\r\n&lt;/div&gt;\r\n{% endfor %}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2355648043817-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2355648043817-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2355648043817-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2355648043817-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2355648043817-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2355648043817-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2355648043817-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2355648043817-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2355648043817-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inventory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2355648043817-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"display-item\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2355648043817-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2355648043817-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"display-warn\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2355648043817-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">items </span><span class=\"crayon-v\">found</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2355648043817-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">Try</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">another </span><span class=\"crayon-v\">search</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">maybe</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2355648043817-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2355648043817-8\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>Django版的这个功能是一样的，但是是用for-empty-endfor而不是for-else-endfor。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd235b764600908\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{% for item in inventory %}\r\n&lt;div class=\"display-item\"&gt;{{ item.render }}&lt;/div&gt;\r\n{% empty %}\r\n&lt;div class=\"display-warn\"&gt;\r\n&lt;h3&gt;No items found&lt;/h3&gt;\r\n&lt;p&gt;Try another search, maybe?&lt;/p&gt;\r\n&lt;/div&gt;\r\n{% endfor %}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd235b764600908-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd235b764600908-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd235b764600908-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd235b764600908-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd235b764600908-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd235b764600908-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd235b764600908-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd235b764600908-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd235b764600908-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inventory</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd235b764600908-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"display-item\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">render</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd235b764600908-3\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">empty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd235b764600908-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"display-warn\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd235b764600908-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">items </span><span class=\"crayon-v\">found</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h3</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd235b764600908-6\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-st\">Try</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">another </span><span class=\"crayon-v\">search</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">maybe</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd235b764600908-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd235b764600908-8\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>除了语法上的不同，Jinja2通过执行环境和高级特性提供了更多的控制。例如，它可以关闭危险的特性以安全的执行不受信任的模板，或者提前编译模板以确保它们的合法性。</p>\n<h2 id=\"content_h3_13_5\">5.3 Pyramid</h2>\n<p>与Flask类似，Pyramid支持多种模板语言（包括Jinja2和Mako），但是默认只附带一个。Pyramid使用<a href=\"http://docs.pylonsproject.org/projects/pyramid-chameleon/en/latest/\" rel=\"nofollow\">Chameleon</a>,一个 <a href=\"http://wiki.zope.org/ZPT/FrontPage\" rel=\"nofollow\">ZPT</a> (Zope Page Template) 模板语言的实现。我们来回头看看第一个例子，添加用户的名字到网站的顶栏。Python代码除了明确调用了render_template函数外其他看起来都差不多。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2362341760088\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@view_config(renderer='templates/home.pt')\r\ndef my_view(request):\r\n    # do stuff...\r\n    return {'user': user}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2362341760088-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2362341760088-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2362341760088-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2362341760088-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2362341760088-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">view_config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">renderer</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'templates/home.pt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2362341760088-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">my_view</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2362341760088-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># do stuff...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2362341760088-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'user'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>但是我们的模板看起来有些不同。ZPT是一个基于XML得模板标准，所以我们使用了类XSLT语句来操作数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2368564916984\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;div class=\"top-bar row\"&gt;\r\n  &lt;div class=\"col-md-10\"&gt;\r\n  &lt;!-- more top bar things go here --&gt;\r\n  &lt;/div&gt;\r\n  &lt;div tal:condition=\"user\"\r\n       tal:content=\"string:You are logged in as ${user.fullname}\"\r\n       class=\"col-md-2 whoami\"&gt;\r\n  &lt;/div&gt;\r\n&lt;/div&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2368564916984-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2368564916984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2368564916984-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2368564916984-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2368564916984-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2368564916984-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2368564916984-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2368564916984-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2368564916984-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2368564916984-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"top-bar row\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2368564916984-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-md-10\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2368564916984-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">top </span><span class=\"crayon-e\">bar </span><span class=\"crayon-e\">things </span><span class=\"crayon-e\">go </span><span class=\"crayon-v\">here</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2368564916984-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2368564916984-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">condition</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"user\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2368564916984-6\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"string:You are logged in as ${user.fullname}\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2368564916984-7\"><span class=\"crayon-h\">       </span><span class=\"crayon-t\">class</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"col-md-2 whoami\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2368564916984-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2368564916984-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>Chameleon对于模板操作有三种不同的命名空间。TAL（模板属性语言）提供了基本的条件语句，字符串的格式化，以及填充标签内容。上面的例子只用了TAL来完成相关工作。对于更多高级任务，就需要TALES和METAL。TALES（ 模板属性表达式语法的语言）提供了像高级字符串格式化，Python表达式评估，以及导入表达式和模板的表达式。</p>\n<p>METAL（宏扩展模板属性语言）是Chameleon模板最强大的（和复杂的）一部分。宏是可扩展的，并能被定义为带有槽且当宏被调用时可以被填充。</p>\n<h1>6. 利用框架行动起来</h1>\n<p>对于各个框架，我们将通过制作一个叫做wut4lunch的应用来了解，这个应用是告诉整个互联网你午饭吃了什么的社交网络。很自由的一个起始想法，完全可以随意改变。应用将有一个简单的接口，允许用户提交他们午饭的内容，并看到其他用户吃的什么的列表。主页完成后将看起来像这样。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0105126666cfc3204945b1fcd51626.png\"><img class=\"aligncenter size-full wp-image-88448\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0105126666cfc3204945b1fcd51626.png\" alt=\"cpp_py_medium\"></a></p>\n<h2>6.1 使用Flask的Demo应用</h2>\n<p>最短的实现用了34行Python代码和一个22行的Jinja模板。首先，我们有些管理类的任务要做，比如初始化我们的应用并拉近我们的ORM。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2370396445645\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom flask import Flask\r\n\r\n# For this example we'll use SQLAlchemy, a popular ORM that supports a\r\n# variety of backends including SQLite, MySQL, and PostgreSQL\r\nfrom flask.ext.sqlalchemy import SQLAlchemy\r\n\r\napp = Flask(__name__)\r\n# We'll just use SQLite here so we don't need an external database\r\napp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///test.db'\r\n\r\ndb = SQLAlchemy(app)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2370396445645-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2370396445645-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2370396445645-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2370396445645-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2370396445645-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2370396445645-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2370396445645-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-3\"><span class=\"crayon-c\"># For this example we'll use SQLAlchemy, a popular ORM that supports a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2370396445645-4\"><span class=\"crayon-c\"># variety of backends including SQLite, MySQL, and PostgreSQL</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sqlalchemy </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SQLAlchemy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2370396445645-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-7\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2370396445645-8\"><span class=\"crayon-c\"># We'll just use SQLite here so we don't need an external database</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-9\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SQLALCHEMY_DATABASE_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sqlite:///test.db'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2370396445645-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2370396445645-11\"><span class=\"crayon-v\">db</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SQLAlchemy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>现在我们看下我们的模型，这将和另两个样例基本一样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2377603730441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Lunch(db.Model):\r\n    \"\"\"A single lunch\"\"\"\r\n    id = db.Column(db.Integer, primary_key=True)\r\n    submitter = db.Column(db.String(63))\r\n    food = db.Column(db.String(255))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2377603730441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2377603730441-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2377603730441-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2377603730441-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2377603730441-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2377603730441-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Model</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2377603730441-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"A single lunch\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2377603730441-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Integer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">primary_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2377603730441-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">63</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2377603730441-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Column</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">String</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>哇，相当简单。最难的部分是找到合适的 <a href=\"http://docs.sqlalchemy.org/en/rel_0_9/core/types.html\" target=\"_blank\" rel=\"nofollow\">SQLAlchemy数据类型</a>，选择数据库中String域的长度。使用我们的模型也超级简单，这在于我们将要看到 <a href=\"http://docs.sqlalchemy.org/en/latest/orm/query.html\" target=\"_blank\" rel=\"nofollow\">SQLAlchemy查询语法</a>。<br>\n构建我们的提交表单也很简单。在引入<a href=\"https://flask-wtf.readthedocs.org/en/latest/\" target=\"_blank\" rel=\"nofollow\">Flask-WTForms</a>和正确的域类型后，你可以看到表单看起来有点像我们的模型。主要的区别在于新的提交按钮和食物与提交者姓名域的提示。</p>\n<p>应用中的SECRET_KEY域是被WTForms用来创建<a href=\"http://en.wikipedia.org/wiki/Cross-site_request_forgery\" target=\"_blank\" rel=\"nofollow\">CSRF</a>符号的。它也被<a href=\"http://pythonhosted.org/itsdangerous/\" target=\"_blank\" rel=\"nofollow\">itsdangerous</a>（Flask内包含）用来设置cookies和其他数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd237e502119883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom flask.ext.wtf import Form\r\nfrom wtforms.fields import StringField, SubmitField\r\n\r\napp.config['SECRET_KEY'] = 'please, tell nobody'\r\n\r\nclass LunchForm(Form):\r\n    submitter = StringField(u'Hi, my name is')\r\n    food = StringField(u'and I ate')\r\n    # submit button will read \"share my lunch!\"\r\n    submit = SubmitField(u'share my lunch!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd237e502119883-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd237e502119883-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd237e502119883-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd237e502119883-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd237e502119883-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd237e502119883-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd237e502119883-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd237e502119883-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd237e502119883-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd237e502119883-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd237e502119883-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">flask</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wtf </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Form</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd237e502119883-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wtforms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fields </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">StringField</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SubmitField</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd237e502119883-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd237e502119883-4\"><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">config</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SECRET_KEY'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'please, tell nobody'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd237e502119883-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd237e502119883-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd237e502119883-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'Hi, my name is'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd237e502119883-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">StringField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'and I ate'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd237e502119883-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># submit button will read \"share my lunch!\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd237e502119883-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SubmitField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'share my lunch!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>让表单在浏览器中显示意味着模板要有它。我们像下面那样传递进去。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2384147163117\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom flask import render_template\r\n\r\n@app.route(\"/\")\r\ndef root():\r\n    lunches = Lunch.query.all()\r\n    form = LunchForm()\r\n    return render_template('index.html', form=form, lunches=lunches)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2384147163117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2384147163117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2384147163117-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2384147163117-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2384147163117-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2384147163117-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2384147163117-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2384147163117-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">render</span><span class=\"crayon-sy\">_</span>template</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2384147163117-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2384147163117-3\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2384147163117-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2384147163117-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2384147163117-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2384147163117-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render_template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'index.html'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">lunches</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>好了，发生了什么？我们得到已经用Lunch.query.all()提交的午餐列表，并实例化一个表单，让用户提交他们自己的美食之旅。为了简化，变量使用相同的名字出入模板，但这不是必须的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd238a805833252\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;html&gt;\r\n&lt;title&gt;Wut 4 Lunch&lt;/title&gt;\r\n&lt;b&gt;What are people eating?&lt;/b&gt;\r\n\r\n&lt;p&gt;Wut4Lunch is the latest social network where you can tell all your friends\r\nabout your noontime repast!&lt;/p&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd238a805833252-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd238a805833252-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd238a805833252-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd238a805833252-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd238a805833252-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd238a805833252-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd238a805833252-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd238a805833252-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-i\">Wut</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lunch</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd238a805833252-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">What </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">people </span><span class=\"crayon-v\">eating</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd238a805833252-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd238a805833252-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Wut4Lunch </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">latest </span><span class=\"crayon-e\">social </span><span class=\"crayon-e\">network </span><span class=\"crayon-e\">where </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">tell </span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">friends</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd238a805833252-6\"><span class=\"crayon-e\">about </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">noontime </span><span class=\"crayon-v\">repast</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>这就是模板的真实情况，我们在已经吃过的午餐中循环，并在&lt;ul&gt;中展示他们。这几乎与我们前面看到的循环例子一样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2390286490341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;ul&gt;\r\n{% for lunch in lunches %}\r\n&lt;li&gt;&lt;strong&gt;{{ lunch.submitter|safe }}&lt;/strong&gt; just ate &lt;strong&gt;{{ lunch.food|safe }}&lt;/strong&gt;\r\n{% else %}\r\n&lt;li&gt;&lt;em&gt;Nobody has eaten lunch, you must all be starving!&lt;/em&gt;&lt;/li&gt;\r\n{% endfor %}\r\n&lt;/ul&gt;\r\n\r\n&lt;b&gt;What are YOU eating?&lt;/b&gt;\r\n\r\n&lt;form method=\"POST\" action=\"/new\"&gt;\r\n    {{ form.hidden_tag() }}\r\n    {{ form.submitter.label }} {{ form.submitter(size=40) }}\r\n    &lt;br/&gt;\r\n    {{ form.food.label }} {{ form.food(size=50) }}\r\n    &lt;br/&gt;\r\n    {{ form.submit }}\r\n&lt;/form&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2390286490341-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2390286490341-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lunch </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">submitter</span><span class=\"crayon-o\">|</span><span class=\"crayon-i\">safe</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">just</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">food</span><span class=\"crayon-o\">|</span><span class=\"crayon-i\">safe</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-4\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Nobody </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">eaten </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">must</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">starving</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">What </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">YOU </span><span class=\"crayon-v\">eating</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/new\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hidden_tag</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">submitter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">submitter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">br</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">food</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">food</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">50</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">br</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">submit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2390286490341-18\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2390286490341-19\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0064 seconds] -->\r\n<p>模板的&lt;form&gt;部分仅仅渲染我们在root()视图中传入模板的WTForm对象的表单标签和输入。当表单提交时，它将向/new提交一个POST请求，这个请求会被下面的函数处理。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd2397062938694\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom flask import url_for, redirect\r\n\r\n@app.route(u'/new', methods=[u'POST'])\r\ndef newlunch():\r\n    form = LunchForm()\r\n    if form.validate_on_submit():\r\n        lunch = Lunch()\r\n        form.populate_obj(lunch)\r\n        db.session.add(lunch)\r\n        db.session.commit()\r\n    return redirect(url_for('root'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2397062938694-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2397062938694-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2397062938694-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2397062938694-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd2397062938694-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd2397062938694-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url_for</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">redirect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2397062938694-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-3\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'/new'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">u</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2397062938694-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">newlunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2397062938694-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">validate_on_submit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2397062938694-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">populate_obj</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd2397062938694-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">commit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd2397062938694-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">url_for</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'root'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0121 seconds] -->\r\n<p>在验证了表单数据后，我们把内容放入我们Model对象中，并提交到数据库。一旦我们在数据库中存了午餐，它将在人们吃过的午餐列表中出现。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd239d816037460\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif __name__ == \"__main__\":\r\n    db.create_all()  # make our sqlalchemy tables\r\n    app.run()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd239d816037460-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd239d816037460-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd239d816037460-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd239d816037460-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd239d816037460-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">db</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># make our sqlalchemy tables</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd239d816037460-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>最后，我们只需做（非常）少量的工作来让应用运行起来。使用SQLAlchemy，我们可以创建存储午餐的表，然后开始运行我们写的路径管理就行了。</p>\n<h2>6.2 测试Django版APP</h2>\n<p>Django版wut4lunch 和Flask版有点像，但是在Django项目中被分到了好几个文件中。首先，我们看看最相似的部分：数据库模型。它和SQLAlchemy版本的唯一不同之处是声明保存文本的数据库字段有轻微的语法区别。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23a4347364180\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# from wut4lunch/models.py\r\nfrom django.db import models\r\n\r\nclass Lunch(models.Model):\r\n    submitter = models.CharField(max_length=63)\r\n    food = models.CharField(max_length=255)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23a4347364180-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23a4347364180-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23a4347364180-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23a4347364180-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23a4347364180-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23a4347364180-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23a4347364180-1\"><span class=\"crayon-c\"># from wut4lunch/models.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23a4347364180-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">db </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">models</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23a4347364180-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23a4347364180-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">models</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Model</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23a4347364180-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">models</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CharField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">63</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23a4347364180-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">models</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CharField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>在表单系统上。不像Flask，我们可以用Django内建的表单系统。它看起来非常像我们在Flask中使用的WTFroms模块，只是语法有点不同。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23aa960649139\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom django import forms\r\nfrom django.http import HttpResponse\r\nfrom django.shortcuts import render, redirect\r\n\r\nfrom .models import Lunch\r\n\r\n# Create your views here.\r\n\r\nclass LunchForm(forms.Form):\r\n    \"\"\"Form object. Looks a lot like the WTForms Flask example\"\"\"\r\n    submitter = forms.CharField(label='Your name')\r\n    food = forms.CharField(label='What did you eat?')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23aa960649139-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23aa960649139-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">django </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">forms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">http </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpResponse</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">django</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">shortcuts </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">render</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redirect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">models </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lunch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-7\"><span class=\"crayon-c\"># Create your views here.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">forms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"Form object. Looks a lot like the WTForms Flask example\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23aa960649139-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">forms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CharField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Your name'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23aa960649139-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">forms</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">CharField</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'What did you eat?'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>现在我们只需要构造一个LunchForm实例传递到我们的模板。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23b0986579243\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlunch_form = LunchForm(auto_id=False)\r\n\r\ndef index(request):\r\n    lunches = Lunch.objects.all()\r\n    return render(\r\n        request,\r\n        'wut4lunch/index.html',\r\n        {\r\n            'lunches': lunches,\r\n            'form': lunch_form,\r\n        }\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b0986579243-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b0986579243-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-1\"><span class=\"crayon-v\">lunch_form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchForm</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">auto_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">objects</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'wut4lunch/index.html'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'lunches'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'form'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunch_form</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b0986579243-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b0986579243-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>render函数是Django shortcut，以接受请求、模板路径和一个上下文的dict。与Flask的render_template类似，它也接受接入请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23b6744218006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef newlunch(request):\r\n    l = Lunch()\r\n    l.submitter = request.POST['submitter']\r\n    l.food = request.POST['food']\r\n    l.save()\r\n    return redirect('home')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b6744218006-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b6744218006-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b6744218006-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b6744218006-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23b6744218006-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23b6744218006-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23b6744218006-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">newlunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b6744218006-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b6744218006-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'submitter'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b6744218006-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'food'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23b6744218006-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23b6744218006-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'home'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>保存表单应答到数据库是不一样的，Django调用模型的 .save()方法以及处理会话管理而不是用全局数据库会话。干净利落！</p>\n<p>Django提供了一些优雅的特性，让我们管理用户提交的午餐，因此我们可以删除那些不合适的午餐信息。Flask和Pyramid没有自动提供这些功能，而在创建一个Django应用时不需要写另一个管理页面当然也是其一个特性。开发者的时间可不免费啊！我们所要做的就是告诉Django-admin我们的模型，是在wut5lunch/admin.py中添加两行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23bd654655406\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom wut4lunch.models import Lunch\r\nadmin.site.register(Lunch)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23bd654655406-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23bd654655406-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23bd654655406-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wut4lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">models </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23bd654655406-2\"><span class=\"crayon-v\">admin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Lunch</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>Bam。现在我们可以添加删除一些条目，而无需额外的工作。</p>\n<p>最后，让我们看下主页模板的不同之处。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23c3548937823\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;ul&gt;\r\n{% for lunch in lunches %}\r\n&lt;li&gt;&lt;strong&gt;{{ lunch.submitter }}&lt;/strong&gt; just ate &lt;strong&gt;{{ lunch.food }}&lt;/strong&gt;&lt;/li&gt;\r\n{% empty %}\r\n&lt;em&gt;Nobody has eaten lunch, you must all be starving!&lt;/em&gt;\r\n{% endfor %}\r\n&lt;/ul&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c3548937823-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23c3548937823-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c3548937823-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23c3548937823-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c3548937823-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23c3548937823-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c3548937823-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23c3548937823-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23c3548937823-2\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lunch </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23c3548937823-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">just</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23c3548937823-4\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">empty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23c3548937823-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Nobody </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">eaten </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">must</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">starving</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">em</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23c3548937823-6\"><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">endfor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23c3548937823-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>Django拥有方便的快捷方式，在你的页面中引用其他的视图。url标签可以使你重建应用中的URLs，而不需破坏视图。这个是因为url标签会主动查询视图中的URL。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23c9419218575\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;form action=\"{% url 'newlunch' %}\" method=\"post\"&gt;\r\n  {% csrf_token %}\r\n  {{ form.as_ul }}\r\n  &lt;input type=\"submit\" value=\"I ate this!\" /&gt;\r\n&lt;/form&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c9419218575-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23c9419218575-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c9419218575-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23c9419218575-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23c9419218575-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23c9419218575-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"{% url 'newlunch' %}\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"post\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23c9419218575-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">csrf_token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23c9419218575-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">as</span><span class=\"crayon-sy\">_</span>ul<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23c9419218575-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"I ate this!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23c9419218575-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>表单被不同的语法渲染，我们需要人工在表单主体中添加CSRF token，但这些区别更多的是装饰</p>\n<h2>6.3测试Pyramid版App</h2>\n<p>最后，我们看看用Pyramid实现的同样的程序。与Django和Flask的最大不同是模板。只需要对Jinja2做很小的改动就足以解决我们在Django中的问题。这次不是这样的，Pyramid的Chameleon模板的语法更容易让人联想到<a href=\"http://en.wikipedia.org/wiki/XSLT\" rel=\"nofollow\">XSLT</a>而不是别的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23cf575638953\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;!-- pyramid_wut4lunch/templates/index.pt --&gt;\r\n&lt;div tal:condition=\"lunches\"&gt;\r\n  &lt;ul&gt;\r\n    &lt;div tal:repeat=\"lunch lunches\" tal:omit-tag=\"\"&gt;\r\n      &lt;li tal:content=\"string:${lunch.submitter} just ate ${lunch.food}\"/&gt;\r\n    &lt;/div&gt;\r\n  &lt;/ul&gt;\r\n&lt;/div&gt;\r\n&lt;div tal:condition=\"not:lunches\"&gt;\r\n  &lt;em&gt;Nobody has eaten lunch, you must all be starving!&lt;/em&gt;\r\n&lt;/div&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23cf575638953-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23cf575638953-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23cf575638953-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23cf575638953-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23cf575638953-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23cf575638953-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pyramid_wut4lunch</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">templates</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23cf575638953-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">condition</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"lunches\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23cf575638953-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">repeat</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"lunch lunches\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">omit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tag</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"string:${lunch.submitter} just ate ${lunch.food}\"</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23cf575638953-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23cf575638953-8\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">div </span><span class=\"crayon-v\">tal</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">condition</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"not:lunches\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23cf575638953-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Nobody </span><span class=\"crayon-e\">has </span><span class=\"crayon-e\">eaten </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">must </span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">be </span><span class=\"crayon-v\">starving</span><span class=\"crayon-o\">!</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">em</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23cf575638953-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">div</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>与Django模板类似，缺少for-else-endfor结构使得逻辑稍微的更清晰了。这种情况下，我们以if-for 和 if-not-for 语句块结尾以提供同样的功能。使用{{或{%来控制结构和条件的Django以及AngularJS类型的模板让使用XHTML标签的模板显得很外行。</p>\n<p>Chameleon模板类型的一大好处是你所选择的编辑器可以正确的使语法高亮，因为模板是有些得XHTML。对于Django和Flask模板来说，你的编辑器需要能够正确的支持这些模板语言高亮显示。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23d6490159085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;b&gt;What are YOU eating?&lt;/b&gt;\r\n\r\n&lt;form method=\"POST\" action=\"/newlunch\"&gt;\r\n  Name: ${form.text(\"submitter\", size=40)}\r\n  &lt;br/&gt;\r\n  What did you eat? ${form.text(\"food\", size=40)}\r\n  &lt;br/&gt;\r\n  &lt;input type=\"submit\" value=\"I ate this!\" /&gt;\r\n&lt;/form&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23d6490159085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23d6490159085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23d6490159085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23d6490159085-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23d6490159085-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23d6490159085-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23d6490159085-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23d6490159085-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23d6490159085-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23d6490159085-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23d6490159085-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">What </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">YOU </span><span class=\"crayon-v\">eating</span><span class=\"crayon-sy\">?</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23d6490159085-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23d6490159085-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">form </span><span class=\"crayon-v\">method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"POST\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">action</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/newlunch\"</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23d6490159085-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"submitter\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23d6490159085-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">br</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23d6490159085-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">What</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">did</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eat</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"food\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">40</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23d6490159085-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">br</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23d6490159085-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"submit\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"I ate this!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23d6490159085-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">form</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23d6490159085-10\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>Pyramid中表单得转换稍微更细致些，因为pytamid_simpleform不像Django表单的form.as_ul函数那样可以自动转换所有的表单字段。</p>\n<p>现在我们看看什么返回给应用。首先，定义我们需要得表单并呈现我们的主页。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23dd476739133\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# pyramid_wut4lunch/views.py\r\nclass LunchSchema(Schema):\r\n    submitter = validators.UnicodeString()\r\n    food = validators.UnicodeString()\r\n\r\n@view_config(route_name='home',\r\n             renderer='templates/index.pt')\r\ndef home(request):\r\n    lunches = DBSession.query(Lunch).all()\r\n    form = Form(request, schema=LunchSchema())\r\n    return {'lunches': lunches, 'form': FormRenderer(form)}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23dd476739133-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23dd476739133-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23dd476739133-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23dd476739133-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23dd476739133-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23dd476739133-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-1\"><span class=\"crayon-c\"># pyramid_wut4lunch/views.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23dd476739133-2\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LunchSchema</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Schema</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">UnicodeString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23dd476739133-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">validators</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">UnicodeString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23dd476739133-6\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">view_config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">route_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'home'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-7\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">renderer</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'templates/index.pt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23dd476739133-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">home</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DBSession</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Lunch</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23dd476739133-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">form</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Form</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">schema</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">LunchSchema</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23dd476739133-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'lunches'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lunches</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'form'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FormRenderer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">form</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>获取午餐的查询语法和Flask的很相似，这是因为这两个demo应用使用了流行的<a href=\"http://www.sqlalchemy.org/\" target=\"_blank\" rel=\"nofollow\">SQLAlchemy ORM</a>来提供持久存储。在Pyramid中，允许你直接返回模板上下文的字典，而不是要调用特殊的render函数。@view_config装饰器自动将返回的上下文传入要渲染的模板。避免调用render方法使得Pyramid写的函数更加容易测试，因为它们返回的数据没有被模板渲染对象掩盖。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebd23e3791085552\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@view_config(route_name='newlunch',\r\n             renderer='templates/index.pt',\r\n             request_method='POST')\r\ndef newlunch(request):\r\n    l = Lunch(\r\n        submitter=request.POST.get('submitter', 'nobody'),\r\n        food=request.POST.get('food', 'nothing'),\r\n    )\r\n\r\n    with transaction.manager:\r\n        DBSession.add(l)\r\n\r\n    raise exc.HTTPSeeOther('/')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebd23e3791085552-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebd23e3791085552-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">view_config</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">route_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'newlunch'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-2\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">renderer</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'templates/index.pt'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-3\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">request_method</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">newlunch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Lunch</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">submitter</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'submitter'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nobody'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">food</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'food'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nothing'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">manager</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">DBSession</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebd23e3791085552-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bebd23e3791085552-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">HTTPSeeOther</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>从Pyramid的请求对象中更加容易得到表单数据，因为在我们获取时会自动将表单POST数据解析成dict。为了阻止同一时间多并发的请求数据库，ZopeTransactions模块提供了上下文管理器，对写入逻辑事物的数据库进行分组，并阻止应用的线程在各个改变时互相影响，这在你的视图共享一个全局session并接收到大量通信的情况下将会是个问题。</p>\n<h1>7. 总结</h1>\n<p>Pyramid是三个中最灵活的。它可以用于小的应用，正如我们所见，但它也支撑着有名的网站如Dropbox。开源社区如<a href=\"https://fedoraproject.org/\" target=\"_blank\" rel=\"nofollow\">Fedora</a>选择它开发应用，如他们社区中的<a href=\"https://badges.fedoraproject.org/\" target=\"_blank\" rel=\"nofollow\">徽章系统</a>，从项目工具中接受事件的信息，并向用户奖励成就类型的徽章。对于Pyramid的一个最常见的抱怨是，它提供了这么多的选项，以至于用它开始一个新项目很吓人。</p>\n<p>目前最流行的框架是Django，使用它的网站列表也令人印象深刻。Bitbucket，Pinterest，Instagram，以及Onion完全或部分使用Django。对于有常见需求的网站，Django是非常理智的选择，也因此它成为中大型网站应用的流行选择。</p>\n<p>Flask对于那些开发小项目、需要快速制作一个简单的Python支撑的网站的开发者很有用。它提供小型的统一工具，或者在已有的API上构建的简单网络接口。可以快速开发需要简单web接口并不怎么配置的后端项目使用Flask将会在前端获益，如<a href=\"https://bitbucket.org/pypy/jitviewer\" target=\"_blank\" rel=\"nofollow\">jitviewer</a>提供了一个web接口来检测PyPy just-in-time的编译日志。</p>\n<p>这三个框架都能解决我们简单的需求，我们已经看到了它们的不同。这些区别不仅仅是装饰性的，它们将会改变你设计产品的方法，以及添加新特性和修复的速度。因为我们的例子很小，我们看到Flask的闪光点，以及Django在小规模应用上的笨重。Pyramid的灵活并未体现出来，因为我们的要求是一样的，但在真实场景中，新的需求会常常出现。</p>\n<h2>7.1 致谢</h2>\n<p>标题图像的logo来自与Flask、Django和Pyramid项目网站。</p>\n<p>这篇文章非常感谢它的评阅者，Remy DeCausemaker，Ross Delinger和Liam Middlebrook，忍受了许多初期的草稿。</p>\n<p>这篇文章的当前样式来自于Adam Chainz、bendwarn、Serger Maertens、Tom Leo和wichert的评论和修正（名字按字母表顺序）。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88447\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88447votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88447\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/6a0105126666cfc3204945b1fcd51626.png"], "tags": "工具与框架,web开发", "url_object_id": "8bd923e571197272eaa10b6cbdca45d0", "praise_nums": "1", "url": "http://python.jobbole.com/88447/", "title": "选择一个 Python Web 框架：Django vs Flask vs Pyramid", "create_date": "2017/08/31", "comment_nums": 0}
{"fav_nums": 2, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010701665\">Lin_R</a>   </div><h1>初识 return</h1>\n<p>相信每一个用过<strong>Python</strong>函数的童鞋, 肯定会用过<strong>return</strong>语句, <strong>return</strong>顾名思义, 就是用来返回值给<strong>调用者</strong>, 例如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b290093490978\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    return a\r\n\r\ns = test()\r\nprint s\r\n\r\n# 输出结果\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b290093490978-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b290093490978-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b290093490978-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b290093490978-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b290093490978-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b290093490978-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b290093490978-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b290093490978-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b290093490978-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b290093490978-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b290093490978-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b290093490978-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b290093490978-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b290093490978-5\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b290093490978-6\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b290093490978-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b290093490978-8\"><span class=\"crayon-c\"># 输出结果</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b290093490978-9\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>对于上面的结果, 相信大家都不会感到意外, 那么加大点难度, 如果在<strong>return</strong>语句还有代码呢? 那句代码会怎样呢?</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b29b169797513\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    return a\r\n    s = 3\r\n    print s\r\n\r\ns = test()\r\nprint s\r\n\r\n# 结果是什么?</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b29b169797513-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b29b169797513-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b29b169797513-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b29b169797513-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b29b169797513-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b29b169797513-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b29b169797513-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b29b169797513-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b29b169797513-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b29b169797513-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b29b169797513-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b29b169797513-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b29b169797513-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b29b169797513-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b29b169797513-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b29b169797513-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b29b169797513-7\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b29b169797513-8\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b29b169797513-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b29b169797513-10\"><span class=\"crayon-c\"># 结果是什么?</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>老司机肯定一眼就能看出结果, 但是对于尚在入门或者对<strong>return</strong>不很了解的童鞋, 可能就会懵逼了~ 后面的两句代码是否会被执行?</p>\n<p>答案是: <strong>不会执行</strong></p>\n<p><strong>return</strong>正如它的名字那样, 当执行这句代码, 整个函数都会返回, 整个调用就算结束了~ 所以在<strong>return</strong>后面的代码, 都是不会被执行的!</p>\n<p>也正因为这个特性, 所以有种编码规范叫<strong>early return</strong>的编码规范就被倡导。</p>\n<p>它的意思大概就是: <strong>当条件已经满足返回时, 就马上返回</strong></p>\n<p>举个例子来说明:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2a2707584023\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    if a &gt; 2:\r\n        result = 'more than'\r\n    else:\r\n        result = 'less than'\r\n    return result\r\n\r\ns = test()\r\nprint s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a2707584023-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a2707584023-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a2707584023-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a2707584023-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a2707584023-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a2707584023-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a2707584023-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a2707584023-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a2707584023-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a2707584023-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a2707584023-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a2707584023-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a2707584023-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a2707584023-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'more than'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a2707584023-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a2707584023-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'less than'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a2707584023-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">result</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a2707584023-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a2707584023-9\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a2707584023-10\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>上面的代码应该比较容易理解, 就是根据<strong>a</strong>的值, 来决定返回的<strong>result</strong>是什么. 这样的编码相信也是大部分童鞋喜欢用的, 因为这样比较符合我们<strong>直觉</strong>, 然而, 这样写似乎有点浪费, 因为当第一个判断结束了, 如果结果为真, 就应该返回<strong>more than</strong>, 然后结束函数, 否则肯定就是返回<strong>less than</strong>, 所以我们可以把代码调整成这样:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2a6920608947\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    if a &gt; 2:\r\n        return 'more than'\r\n    else:\r\n        return 'less than'\r\n\r\ns = test()\r\nprint s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a6920608947-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a6920608947-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a6920608947-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a6920608947-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a6920608947-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a6920608947-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a6920608947-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a6920608947-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a6920608947-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a6920608947-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a6920608947-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a6920608947-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a6920608947-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'more than'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a6920608947-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a6920608947-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'less than'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a6920608947-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a6920608947-8\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a6920608947-9\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>甚至是:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2a9656830259\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    if a &gt; 2:\r\n        return 'more than'\r\n    return 'less than'\r\n\r\ns = test()\r\nprint s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a9656830259-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a9656830259-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a9656830259-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a9656830259-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a9656830259-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a9656830259-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2a9656830259-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2a9656830259-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a9656830259-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a9656830259-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a9656830259-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a9656830259-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'more than'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a9656830259-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'less than'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a9656830259-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2a9656830259-7\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2a9656830259-8\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>结果都是和第一个写法是一样的! 第一次看到这样写法的童鞋, 可能会觉得比较难以接受, 甚至觉得可读性很差, 但是其实这样的写法, 我觉得反而会稍微好点. 因为:</p>\n<ol>\n<li>运行的代码数少了, 调用方能更快得到结果</li>\n<li>有利于减少嵌套的层数, 便于理解.</li>\n</ol>\n<p>对于第2点在这需要解释下, 很多时候我们写得代码, 嵌套很深, 都是因为<strong>if/else</strong>的锅, 因为嵌套的<strong>if/else</strong> 比较多, 所以导致一堆代码都嵌套得比较深, 这样对于其他小伙伴, 简直就是灾难, 因为他们很可能在阅读这部分代码时, 就忘了前面的逻辑….<br>\n为了更加容易理解, 举个代码例子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2ad941779198\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    if a &gt; 2:\r\n        result = 'not 2'\r\n    else:\r\n        a += 2\r\n        if a &lt; 2:\r\n            result = 'not 2'\r\n        else:\r\n            for i in range(2):\r\n                print 'test ~'\r\n            result = 'Target !'\r\n    return result\r\n\r\ns = test()\r\nprint s\r\n\r\n# 输出结果\r\ntest ~\r\ntest ~\r\nTarget !</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ad941779198-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ad941779198-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not 2'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not 2'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test ~'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Target !'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">result</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-15\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-16\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-18\"><span class=\"crayon-c\"># 输出结果</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-19\"><span class=\"crayon-k \">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ad941779198-20\"><span class=\"crayon-k \">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ad941779198-21\"><span class=\"crayon-v\">Target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>代码简化优化版:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2b0226661889\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    a = 2\r\n    if a &gt; 2:\r\n        return 'not 2'\r\n    \r\n    a += 2\r\n    if a &lt; 2:\r\n        return 'not 2'\r\n    \r\n    for i in range(2):\r\n        print 'test ~'\r\n\r\n    return 'Target !'\r\n\r\ns = test()\r\nprint s\r\n\r\n# 输出结果\r\ntest ~\r\ntest ~\r\nTarget !</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2b0226661889-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b0226661889-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not 2'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-5\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'not 2'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-9\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test ~'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Target !'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-15\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-16\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-18\"><span class=\"crayon-c\"># 输出结果</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-19\"><span class=\"crayon-k \">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2b0226661889-20\"><span class=\"crayon-k \">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b0226661889-21\"><span class=\"crayon-v\">Target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>这样对比这来看, 应该能更好地理解为什么说<strong>early return</strong>能够减少嵌套的层数吧~ 有疑问欢迎留言讨论~</p>\n<h1>谈谈深坑</h1>\n<p>刚才花了比较长的篇幅去介绍<strong>return</strong>, 相信看到这里, 对于<strong>return</strong>应该有比较基本的理解了! 所以来聊聊更加迷惑的话题:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2b4353747553\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n当 return 遇上 try..finally, 会怎样呢?</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b4353747553-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b4353747553-1\">当<span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span>遇上<span class=\"crayon-h\"> </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">finally</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>会怎样呢<span class=\"crayon-sy\">?</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>如果刚才有认真看的话, 会注意到一句话, 就是:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2b8094471173\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nreturn 代表整个函数返回, 函数调用算结束</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2b8094471173-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2b8094471173-1\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span>代表整个函数返回<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>函数调用算结束</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>但事实真的这样吗? 通常这样问, 答案一般都不是 ~~<br>\n先来看看例子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2bc393619155\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef test():\r\n    try:\r\n        a = 2\r\n        return a\r\n    except:\r\n        pass\r\n\r\n    finally:\r\n        print 'finally'\r\n\r\ns = test()\r\nprint s</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bc393619155-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bc393619155-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finally'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bc393619155-11\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bc393619155-12\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>可以猜猜这句<strong>print a</strong>会不会打印? 相信很多童鞋都想了一会, 然后说不会~ 然而这个答案是错的, 真正的输出是:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2bf374135926\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfinally\r\n2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2bf374135926-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2bf374135926-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2bf374135926-1\"><span class=\"crayon-st\">finally</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2bf374135926-2\"><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>有木有觉得仿佛看见了新大陆, 在一开始的例子中, <strong>return</strong>后面的语句没有被执行, 但是在这里, 相隔那么远, 却依旧没有忘记, 这或许就是”真爱”吧!</p>\n<p>然而就是因为这种”真爱”, 总是会让一堆新老司机掉坑里..然后还不知道为毛..</p>\n<p>为了避免它们再继续借用打着”真爱”的幌子, 欺负我们, 让我们一起来揭开这”真爱”的真面目!</p>\n<p>于是, 我们得借助偷窥神器: <strong>dis</strong>, 想想都有点小兴奋!</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2c3579368663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport dis\r\ndef test():\r\n    try:\r\n        a = 2\r\n        return a\r\n    except:\r\n        pass\r\n\r\n    finally:\r\n        print 'finally'\r\n\r\nprint dis.dis(test)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c3579368663-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c3579368663-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">dis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'finally'</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c3579368663-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c3579368663-12\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">dis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">dis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">test</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>输出比较长, 单独写:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2c6981976801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 输出结果\r\n  6           0 SETUP_FINALLY           28 (to 31)\r\n              3 SETUP_EXCEPT            14 (to 20)\r\n\r\n  7           6 LOAD_CONST               1 (2)\r\n              9 STORE_FAST               0 (a)\r\n\r\n  8          12 LOAD_FAST                0 (a)\r\n             15 RETURN_VALUE        \r\n             16 POP_BLOCK           \r\n             17 JUMP_FORWARD             7 (to 27)\r\n\r\n  9     &gt;&gt;   20 POP_TOP             \r\n             21 POP_TOP             \r\n             22 POP_TOP             \r\n\r\n 10          23 JUMP_FORWARD             1 (to 27)\r\n             26 END_FINALLY         \r\n        &gt;&gt;   27 POP_BLOCK           \r\n             28 LOAD_CONST               0 (None)\r\n\r\n 13     &gt;&gt;   31 LOAD_CONST               2 ('finally')\r\n             34 PRINT_ITEM          \r\n             35 PRINT_NEWLINE       \r\n             36 END_FINALLY         \r\n             37 LOAD_CONST               0 (None)\r\n             40 RETURN_VALUE</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2c6981976801-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2c6981976801-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-1\"><span class=\"crayon-c\"># 输出结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP</span><span class=\"crayon-sy\">_</span>FINALLY<span class=\"crayon-h\">           </span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-3\"><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP</span><span class=\"crayon-sy\">_</span>EXCEPT<span class=\"crayon-h\">            </span><span class=\"crayon-cn\">14</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>CONST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-6\"><span class=\"crayon-h\">              </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">STORE</span><span class=\"crayon-sy\">_</span>FAST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>FAST<span class=\"crayon-h\">                </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-9\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RETURN</span><span class=\"crayon-sy\">_</span>VALUE<span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-10\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POP</span><span class=\"crayon-sy\">_</span>BLOCK<span class=\"crayon-h\">           </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-11\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JUMP</span><span class=\"crayon-sy\">_</span>FORWARD<span class=\"crayon-h\">             </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POP</span><span class=\"crayon-sy\">_</span>TOP<span class=\"crayon-h\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-14\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POP</span><span class=\"crayon-sy\">_</span>TOP<span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-15\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">22</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POP</span><span class=\"crayon-sy\">_</span>TOP<span class=\"crayon-h\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">          </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JUMP</span><span class=\"crayon-sy\">_</span>FORWARD<span class=\"crayon-h\">             </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-18\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">END_FINALLY</span><span class=\"crayon-h\">         </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POP</span><span class=\"crayon-sy\">_</span>BLOCK<span class=\"crayon-h\">           </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-20\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">28</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>CONST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">&gt;&gt;</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>CONST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'finally'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-23\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">34</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PRINT</span><span class=\"crayon-sy\">_</span>ITEM<span class=\"crayon-h\">          </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-24\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">35</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PRINT</span><span class=\"crayon-sy\">_</span>NEWLINE<span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-25\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">36</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">END</span><span class=\"crayon-sy\">_</span>FINALLY<span class=\"crayon-h\">         </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2c6981976801-26\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>CONST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2c6981976801-27\"><span class=\"crayon-h\">             </span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RETURN_VALUE</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0099 seconds] -->\r\n<p>这边简单说着这些列所代表的意思:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2ca857967942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n第一列是代码在文件的行号\r\n第二列字节码的偏移量\r\n字节码的名字\r\n参数\r\n字节码处理参数最终的结果</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ca857967942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ca857967942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ca857967942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2ca857967942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2ca857967942-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ca857967942-1\">第一列是代码在文件的行号</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ca857967942-2\">第二列字节码的偏移量</div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ca857967942-3\">字节码的名字</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2ca857967942-4\">参数</div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2ca857967942-5\">字节码处理参数最终的结果</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>在字节码中可以看到, 依次是<strong>SETUP_FINALLY</strong> 和 <strong>SETUP_EXCEPT</strong>, 这个对应的就是<strong>finally</strong>和<strong>try</strong>,虽然<strong>finally</strong>在<strong>try</strong>后面, 虽然我们通常帮他们看成一个整体, 但是他们在实际上却是分开的… 因为我们重点是<strong>finally</strong>, 所以就单单看<strong>SETUP_FINALLY</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2cd526677437\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// ceval.c\r\nTARGET(SETUP_FINALLY)\r\n        _setup_finally:\r\n        {\r\n            /* NOTE: If you add any new block-setup opcodes that\r\n               are not try/except/finally handlers, you may need\r\n               to update the PyGen_NeedsFinalizing() function.\r\n               */\r\n\r\n            PyFrame_BlockSetup(f, opcode, INSTR_OFFSET() + oparg,\r\n                               STACK_LEVEL());\r\n            DISPATCH();\r\n        }\r\n\r\n\r\n// fameobject.c\r\nvoid\r\nPyFrame_BlockSetup(PyFrameObject *f, int type, int handler, int level)\r\n{\r\n    PyTryBlock *b;\r\n    if (f-&gt;f_iblock &gt;= CO_MAXBLOCKS)\r\n        Py_FatalError(\"XXX block stack overflow\");\r\n    b = &amp;f-&gt;f_blockstack[f-&gt;f_iblock++];\r\n    b-&gt;b_type = type;\r\n    b-&gt;b_level = level;\r\n    b-&gt;b_handler = handler;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2cd526677437-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2cd526677437-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ceval</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-2\"><span class=\"crayon-e\">TARGET</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SETUP_FINALLY</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">_setup_finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NOTE</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">If</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">add </span><span class=\"crayon-k \">any</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">setup </span><span class=\"crayon-e\">opcodes </span><span class=\"crayon-e\">that</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-6\"><span class=\"crayon-e\">               </span><span class=\"crayon-e\">are </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">may </span><span class=\"crayon-e\">need</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-7\"><span class=\"crayon-e\">               </span><span class=\"crayon-e\">to </span><span class=\"crayon-e\">update </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">PyGen_NeedsFinalizing</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">function</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-8\"><span class=\"crayon-h\">               </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">PyFrame_BlockSetup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">opcode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">INSTR_OFFSET</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">oparg</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-11\"><span class=\"crayon-h\">                               </span><span class=\"crayon-e\">STACK_LEVEL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">DISPATCH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-16\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fameobject</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-17\"><span class=\"crayon-e\">void</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-18\"><span class=\"crayon-e\">PyFrame_BlockSetup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">PyFrameObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-19\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">PyTryBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CO_MAXBLOCKS</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Py_FatalError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"XXX block stack overflow\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_blockstack</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_level</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">level</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2cd526677437-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_handler</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2cd526677437-27\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>从上面的代码, 很明显就能看出来, <strong>SETUP_FINALLY</strong> 就是调用下<strong>PyFrame_BlockSetup</strong>去创建一个<strong>Block</strong>, 然后为这个<strong>Block</strong>设置:</p>\n<ol>\n<li>b_type (opcode 也就是<strong>SETUP_FINALLY</strong>)</li>\n<li>b_level</li>\n<li>b_handler (<strong>INSTR_OFFSET() + oparg</strong>)</li>\n</ol>\n<p>handler 可能比较难理解, 其实看刚才的 <strong>dis</strong> 输出就能看到是哪个, 就是<strong> 13 &gt;&gt; 31 LOAD_CONST 2 (‘finally’)</strong>, 这个箭头就是告诉我们跳转的位置的, 为什么会跳转到这句呢? 因为<strong>6 0 SETUP_FINALLY 28 (to 31)</strong>已经告诉我们将要跳转到31这个位置~~~</p>\n<p>如果这个搞清楚了, 那就再来继续看 <strong>return</strong>, <strong>return</strong>对应的字节码是: <strong>RETURN_VALUE</strong>, 所以它对应的源码是:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2d1632893210\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// ceval.c\r\nTARGET_NOARG(RETURN_VALUE)\r\n        {\r\n            retval = POP();\r\n            why = WHY_RETURN;\r\n            goto fast_block_end;\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d1632893210-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d1632893210-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d1632893210-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d1632893210-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d1632893210-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d1632893210-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d1632893210-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d1632893210-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ceval</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d1632893210-2\"><span class=\"crayon-e\">TARGET_NOARG</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RETURN_VALUE</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d1632893210-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d1632893210-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">retval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">POP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d1632893210-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_RETURN</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d1632893210-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">goto </span><span class=\"crayon-v\">fast_block_end</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d1632893210-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>原来我们以前理解的<strong>return</strong>是假<strong>return</strong>! 这个<strong>return</strong>并没有直接返回嘛, 而是将堆栈的值弹出来, 赋值个<strong>retval</strong>, 然后将<strong>why</strong>设置成<strong>WHY_RETURN</strong>, 接着就跑路了! 跑到一个叫<strong>fast_block_end;</strong>的地方~, 没办法, 为了揭穿真面目, 只好掘地三尺了:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bec7b2d7155817462\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile (why != WHY_NOT &amp;&amp; f-&gt;f_iblock &gt; 0) {\r\n            fast_block_end:\r\n        while (why != WHY_NOT &amp;&amp; f-&gt;f_iblock &gt; 0) {\r\n            /* Peek at the current block. */\r\n            PyTryBlock *b = &amp;f-&gt;f_blockstack[f-&gt;f_iblock - 1];\r\n\r\n            assert(why != WHY_YIELD);\r\n            if (b-&gt;b_type == SETUP_LOOP &amp;&amp; why == WHY_CONTINUE) {\r\n                why = WHY_NOT;\r\n                JUMPTO(PyInt_AS_LONG(retval));\r\n                Py_DECREF(retval);\r\n                break;\r\n            }\r\n\r\n            /* Now we have to pop the block. */\r\n            f-&gt;f_iblock--;\r\n\r\n            while (STACK_LEVEL() &gt; b-&gt;b_level) {\r\n                v = POP();\r\n                Py_XDECREF(v);\r\n            }\r\n            if (b-&gt;b_type == SETUP_LOOP &amp;&amp; why == WHY_BREAK) {\r\n                why = WHY_NOT;\r\n                JUMPTO(b-&gt;b_handler);\r\n                break;\r\n            }\r\n            if (b-&gt;b_type == SETUP_FINALLY ||\r\n                (b-&gt;b_type == SETUP_EXCEPT &amp;&amp;\r\n                 why == WHY_EXCEPTION) ||\r\n                b-&gt;b_type == SETUP_WITH) {\r\n                if (why == WHY_EXCEPTION) {\r\n                    PyObject *exc, *val, *tb;\r\n                    PyErr_Fetch(&amp;exc, &amp;val, &amp;tb);\r\n                    if (val == NULL) {\r\n                        val = Py_None;\r\n                        Py_INCREF(val);\r\n                    }\r\n                    /* Make the raw exception data\r\n                       available to the handler,\r\n                       so a program can emulate the\r\n                       Python main loop.  Don't do\r\n                       this for 'finally'. */\r\n                    if (b-&gt;b_type == SETUP_EXCEPT ||\r\n                        b-&gt;b_type == SETUP_WITH) {\r\n                        PyErr_NormalizeException(\r\n                            &amp;exc, &amp;val, &amp;tb);\r\n                        set_exc_info(tstate,\r\n                                     exc, val, tb);\r\n                    }\r\n                    if (tb == NULL) {\r\n                        Py_INCREF(Py_None);\r\n                        PUSH(Py_None);\r\n                    } else\r\n                        PUSH(tb);\r\n                    PUSH(val);\r\n                    PUSH(exc);\r\n                }\r\n                else {\r\n                    if (why &amp; (WHY_RETURN | WHY_CONTINUE))\r\n                        PUSH(retval);\r\n                    v = PyInt_FromLong((long)why);\r\n                    PUSH(v);\r\n                }\r\n                why = WHY_NOT;\r\n                JUMPTO(b-&gt;b_handler);\r\n                break;\r\n            }\r\n        } /* unwind stack */</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bec7b2d7155817462-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bec7b2d7155817462-68\">68</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">fast_block_end</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Peek </span><span class=\"crayon-e\">at </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">current </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">PyTryBlock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_blockstack</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">assert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_YIELD</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_LOOP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_CONTINUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_NOT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">JUMPTO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">PyInt_AS_LONG</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Py_DECREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Now </span><span class=\"crayon-e\">we </span><span class=\"crayon-e\">have </span><span class=\"crayon-e\">to </span><span class=\"crayon-e\">pop </span><span class=\"crayon-e\">the </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">f_iblock</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">STACK_LEVEL</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">POP</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Py_XDECREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_LOOP</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_BREAK</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_NOT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-24\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">JUMPTO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_FINALLY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-28\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_EXCEPT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-29\"><span class=\"crayon-h\">                 </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_EXCEPTION</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_WITH</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_EXCEPTION</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-32\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">PyObject</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">tb</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-33\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">PyErr_Fetch</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-34\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-35\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Py_None</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-36\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">Py_INCREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-37\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-38\"><span class=\"crayon-h\">                    </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Make </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">raw </span><span class=\"crayon-k \">exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-39\"><span class=\"crayon-e\">                       </span><span class=\"crayon-e\">available </span><span class=\"crayon-e\">to </span><span class=\"crayon-e\">the </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-40\"><span class=\"crayon-h\">                       </span><span class=\"crayon-i\">so</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">program </span><span class=\"crayon-e\">can </span><span class=\"crayon-e\">emulate </span><span class=\"crayon-e\">the</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-41\"><span class=\"crayon-e\">                       </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">main </span><span class=\"crayon-v\">loop</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">Don</span><span class=\"crayon-s\">'t do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-42\"><span class=\"crayon-s\">                       this for '</span><span class=\"crayon-st\">finally</span>'<span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-43\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_EXCEPT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-44\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SETUP_WITH</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-45\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">PyErr_NormalizeException</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-46\"><span class=\"crayon-h\">                            </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">tb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-47\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">set_exc_info</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tstate</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-48\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-49\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-50\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-51\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">Py_INCREF</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Py_None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-52\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Py_None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-53\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-54\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-55\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-56\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">exc</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-57\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-58\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-59\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">WHY_RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_CONTINUE</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-60\"><span class=\"crayon-h\">                        </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-61\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PyInt_FromLong</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-v\">why</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-62\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">PUSH</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-63\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-64\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">why</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WHY_NOT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-65\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">JUMPTO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">b_handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-66\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04bec7b2d7155817462-67\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bec7b2d7155817462-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unwind </span><span class=\"crayon-v\">stack</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0204 seconds] -->\r\n<p>在这需要回顾下刚才的一些知识, 刚才我们看了<strong>return</strong>的代码, 看到它将<strong>why</strong>设置成了 <strong>WHY_RETURN</strong>, 所以在这么一大串判断中, 它只是走了最后面的<strong>else</strong>, 动作也很简单, 就是将刚才<strong>return</strong>储存的值<strong>retval</strong>再<strong>push</strong>压回栈, 同时将<strong>why</strong>转换成<strong>long</strong>再压回栈, 然后有设置了下<strong>why</strong>,接着就是屁颠屁颠去执行刚才<strong>SETUP_FINALLY</strong>设置的<strong>b_handler</strong>代码了~ 当这这段<strong>bhandler</strong>代码执行完, 就再通过<strong>END_FINALLY</strong>去做回该做的事, 而这里就是, <strong>return retval</strong></p>\n<h1>结论</h1>\n<p>所以, 我们应该能知道为什么当我们执行了<strong>return</strong>代码, 为什么<strong>finally</strong>的代码还会先执行了吧, 因为<strong>return</strong>的本质, 就是设置<strong>why</strong>和<strong>retval</strong>, 然后<strong>goto</strong>到一个大判断, 最后根据<strong>why</strong>的值去执行对应的操作! 所以可以说并不是真的实质性的返回. 希望我们往后再用到它们的时候, 别再掉坑里!</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88408\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88408votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88408\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"], "tags": "基础知识,坑", "url_object_id": "57a816551598676b289611aed4513602", "praise_nums": "1", "url": "http://python.jobbole.com/88408/", "title": "Python :浅析 return 和 finally 共同挖的坑", "create_date": "2017/08/25", "comment_nums": 0}
{"fav_nums": 3, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://blog.csdn.net/zouxy09/article/details/49105265\">zouxy09</a>   </div><p>众所周知，机器学习可以大体分为三大类：监督学习、非监督学习和半监督学习。监督学习可以认为是我们有非常多的labeled标注数据来train一个模型，期待这个模型能学习到数据的分布，以期对未来没有见到的样本做预测。那这个性能的源头–训练数据，就显得非常感觉。你必须有足够的训练数据，以覆盖真正现实数据中的样本分布才可以，这样学习到的模型才有意义。那非监督学习就是没有任何的labeled数据，就是平时所说的聚类了，利用他们本身的数据分布，给他们划分类别。而半监督学习，顾名思义就是处于两者之间的，只有少量的labeled数据，我们试图从这少量的labeled数据和大量的unlabeled数据中学习到有用的信息。</p>\n<h1>一、半监督学习</h1>\n<p>半监督学习（Semi-supervised learning）发挥作用的场合是：你的数据有一些有label，一些没有。而且一般是绝大部分都没有，只有少许几个有label。半监督学习算法会充分的利用unlabeled数据来捕捉我们整个数据的潜在分布。它基于三大假设：</p>\n<ol>\n<li>Smoothness平滑假设：相似的数据具有相同的label。</li>\n<li>Cluster聚类假设：处于同一个聚类下的数据具有相同label。</li>\n<li>Manifold流形假设：处于同一流形结构下的数据具有相同label。</li>\n</ol>\n<p>例如下图，只有两个labeled数据，如果直接用他们来训练一个分类器，例如LR或者SVM，那么学出来的分类面就是左图那样的。如果现实中，这个数据是右图那边分布的话，猪都看得出来，左图训练的这个分类器烂的一塌糊涂、惨不忍睹。因为我们的labeled训练数据太少了，都没办法覆盖我们未来可能遇到的情况。但是，如果右图那样，把大量的unlabeled数据（黑色的）都考虑进来，有个全局观念，牛逼的算法会发现，哎哟，原来是两个圈圈（分别处于两个圆形的流形之上）！那算法就很聪明，把大圈的数据都归类为红色类别，把内圈的数据都归类为蓝色类别。因为，实践中，labeled数据是昂贵，很难获得的，但unlabeled数据就不是了，写个脚本在网上爬就可以了，因此如果能充分利用大量的unlabeled数据来辅助提升我们的模型学习，这个价值就非常大。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/10921e07716aca4930a41a292bb8953a.png\"><img class=\"aligncenter size-full wp-image-88468\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/10921e07716aca4930a41a292bb8953a.png\" alt=\"cpp_py_medium\"></a></p>\n<p>半监督学习算法有很多，下面我们介绍最简单的标签传播算法（label propagation），最喜欢简单了，哈哈。</p>\n<h1>二、标签传播算法</h1>\n<p>标签传播算法（label propagation）的核心思想非常简单：相似的数据应该具有相同的label。LP算法包括两大步骤：1）构造相似矩阵；2）勇敢的传播吧。</p>\n<h2>2.1、相似矩阵构建</h2>\n<p>LP算法是基于Graph的，因此我们需要先构建一个图。我们为所有的数据构建一个图，图的节点就是一个数据点，包含labeled和unlabeled的数据。节点i和节点j的边表示他们的相似度。这个图的构建方法有很多，这里我们假设这个图是全连接的，节点i和节点j的边权重为：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/72a1aca986b7b6322af1e001255a784e.png\"><img class=\"aligncenter size-full wp-image-88469\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/72a1aca986b7b6322af1e001255a784e.png\" alt=\"cpp_py_medium\"></a></p>\n<p>这里，α是超参。</p>\n<p>还有个非常常用的图构建方法是knn图，也就是只保留每个节点的k近邻权重，其他的为0，也就是不存在边，因此是稀疏的相似矩阵。</p>\n<h2>2.2、LP算法</h2>\n<p>标签传播算法非常简单：通过节点之间的边传播label。边的权重越大，表示两个节点越相似，那么label越容易传播过去。我们定义一个NxN的概率转移矩阵P：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/984bccf087f9b6bc2d1fbe7fe0ebdfca.png\"><img class=\"aligncenter size-full wp-image-88470\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/984bccf087f9b6bc2d1fbe7fe0ebdfca.png\" alt=\"cpp_py_medium\"></a></p>\n<p>P<sub>ij</sub>表示从节点i转移到节点j的概率。假设有C个类和L个labeled样本，我们定义一个LxC的label矩阵Y<sub>L</sub>，第i行表示第i个样本的标签指示向量，即如果第i个样本的类别是j，那么该行的第j个元素为1，其他为0。同样，我们也给U个unlabeled样本一个UxC的label矩阵Y<sub>U</sub>。把他们合并，我们得到一个NxC的soft label矩阵F=[Y<sub>L</sub>;Y<sub>U</sub>]。soft label的意思是，我们保留样本i属于每个类别的概率，而不是互斥性的，这个样本以概率1只属于一个类。当然了，最后确定这个样本i的类别的时候，是取max也就是概率最大的那个类作为它的类别的。那F里面有个Y<sub>U</sub>，它一开始是不知道的，那最开始的值是多少？无所谓，随便设置一个值就可以了。</p>\n<p>千呼万唤始出来，简单的LP算法如下：</p>\n<ol>\n<li>执行传播：F=PF</li>\n<li>重置F中labeled样本的标签：F<sub>L</sub>=Y<sub>L</sub></li>\n<li>重复步骤1）和2）直到F收敛。</li>\n</ol>\n<p>步骤1）就是将矩阵P和矩阵F相乘，这一步，每个节点都将自己的label以P确定的概率传播给其他节点。如果两个节点越相似（在欧式空间中距离越近），那么对方的label就越容易被自己的label赋予，就是更容易拉帮结派。步骤2）非常关键，因为labeled数据的label是事先确定的，它不能被带跑，所以每次传播完，它都得回归它本来的label。随着labeled数据不断的将自己的label传播出去，最后的类边界会穿越高密度区域，而停留在低密度的间隔中。相当于每个不同类别的labeled样本划分了势力范围。</p>\n<h2>2.3、变身的LP算法</h2>\n<p>我们知道，我们每次迭代都是计算一个soft label矩阵F=[Y<sub>L</sub>;Y<sub>U</sub>]，但是Y<sub>L</sub>是已知的，计算它没有什么用，在步骤2）的时候，还得把它弄回来。我们关心的只是Y<sub>U</sub>，那我们能不能只计算Y<sub>U</sub>呢？Yes。我们将矩阵P做以下划分：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9748ebcb8e4429ff6e1c7051a2d7d16e.png\"><img class=\"aligncenter size-full wp-image-88471\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9748ebcb8e4429ff6e1c7051a2d7d16e.png\" alt=\"cpp_py_medium\"></a></p>\n<p>这时候，我们的算法就一个运算：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b8057a51e7c6d75c859f569260492af.png\"><img class=\"aligncenter size-full wp-image-88472\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b8057a51e7c6d75c859f569260492af.png\" alt=\"cpp_py_medium\"></a></p>\n<p>迭代上面这个步骤直到收敛就ok了，是不是很cool。可以看到F<sub>U</sub>不但取决于labeled数据的标签及其转移概率，还取决了unlabeled数据的当前label和转移概率。因此LP算法能额外运用unlabeled数据的分布特点。</p>\n<p>这个算法的收敛性也非常容易证明，具体见参考文献[1]。实际上，它是可以收敛到一个凸解的：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6d5bb75e145652fe7dfc902118438394.png\"><img class=\"aligncenter size-full wp-image-88473\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6d5bb75e145652fe7dfc902118438394.png\" alt=\"cpp_py_medium\"></a></p>\n<p>所以我们也可以直接这样求解，以获得最终的Y<sub>U</sub>。但是在实际的应用过程中，由于矩阵求逆需要O(n<sup>3</sup>)的复杂度，所以如果unlabeled数据非常多，那么I – P<sub>UU</sub>矩阵的求逆将会非常耗时，因此这时候一般选择迭代算法来实现。</p>\n<h1>三、LP算法的<span style=\"color: #ff0000\">Python</span>实现</h1>\n<p>Python环境的搭建就不啰嗦了，可以参考前面的博客。需要额外依赖的库是经典的numpy和matplotlib。代码中包含了两种图的构建方法：RBF和KNN指定。同时，自己生成了两个toy数据库：两条长形形状和两个圈圈的数据。第四部分我们用大点的数据库来做实验，先简单的可视化验证代码的正确性，再前线。</p>\n<p>算法代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebe1981187310496\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#***************************************************************************  \r\n#*   \r\n#* Description: label propagation  \r\n#* Author: Zou Xiaoyi (zouxy09@qq.com)  \r\n#* Date:   2015-10-15  \r\n#* HomePage: http://blog.csdn.net/zouxy09  \r\n#*   \r\n#**************************************************************************  \r\n  \r\nimport time  \r\nimport numpy as np  \r\n  \r\n# return k neighbors index  \r\ndef navie_knn(dataSet, query, k):  \r\n    numSamples = dataSet.shape[0]  \r\n  \r\n    ## step 1: calculate Euclidean distance  \r\n    diff = np.tile(query, (numSamples, 1)) - dataSet  \r\n    squaredDiff = diff ** 2  \r\n    squaredDist = np.sum(squaredDiff, axis = 1) # sum is performed by row  \r\n  \r\n    ## step 2: sort the distance  \r\n    sortedDistIndices = np.argsort(squaredDist)  \r\n    if k &gt; len(sortedDistIndices):  \r\n        k = len(sortedDistIndices)  \r\n  \r\n    return sortedDistIndices[0:k]  \r\n  \r\n  \r\n# build a big graph (normalized weight matrix)  \r\ndef buildGraph(MatX, kernel_type, rbf_sigma = None, knn_num_neighbors = None):  \r\n    num_samples = MatX.shape[0]  \r\n    affinity_matrix = np.zeros((num_samples, num_samples), np.float32)  \r\n    if kernel_type == 'rbf':  \r\n        if rbf_sigma == None:  \r\n            raise ValueError('You should input a sigma of rbf kernel!')  \r\n        for i in xrange(num_samples):  \r\n            row_sum = 0.0  \r\n            for j in xrange(num_samples):  \r\n                diff = MatX[i, :] - MatX[j, :]  \r\n                affinity_matrix[i][j] = np.exp(sum(diff**2) / (-2.0 * rbf_sigma**2))  \r\n                row_sum += affinity_matrix[i][j]  \r\n            affinity_matrix[i][:] /= row_sum  \r\n    elif kernel_type == 'knn':  \r\n        if knn_num_neighbors == None:  \r\n            raise ValueError('You should input a k of knn kernel!')  \r\n        for i in xrange(num_samples):  \r\n            k_neighbors = navie_knn(MatX, MatX[i, :], knn_num_neighbors)  \r\n            affinity_matrix[i][k_neighbors] = 1.0 / knn_num_neighbors  \r\n    else:  \r\n        raise NameError('Not support kernel type! You can use knn or rbf!')  \r\n      \r\n    return affinity_matrix  \r\n  \r\n  \r\n# label propagation  \r\ndef labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = 'rbf', rbf_sigma = 1.5, \\  \r\n                    knn_num_neighbors = 10, max_iter = 500, tol = 1e-3):  \r\n    # initialize  \r\n    num_label_samples = Mat_Label.shape[0]  \r\n    num_unlabel_samples = Mat_Unlabel.shape[0]  \r\n    num_samples = num_label_samples + num_unlabel_samples  \r\n    labels_list = np.unique(labels)  \r\n    num_classes = len(labels_list)  \r\n      \r\n    MatX = np.vstack((Mat_Label, Mat_Unlabel))  \r\n    clamp_data_label = np.zeros((num_label_samples, num_classes), np.float32)  \r\n    for i in xrange(num_label_samples):  \r\n        clamp_data_label[i][labels[i]] = 1.0  \r\n      \r\n    label_function = np.zeros((num_samples, num_classes), np.float32)  \r\n    label_function[0 : num_label_samples] = clamp_data_label  \r\n    label_function[num_label_samples : num_samples] = -1  \r\n      \r\n    # graph construction  \r\n    affinity_matrix = buildGraph(MatX, kernel_type, rbf_sigma, knn_num_neighbors)  \r\n      \r\n    # start to propagation  \r\n    iter = 0; pre_label_function = np.zeros((num_samples, num_classes), np.float32)  \r\n    changed = np.abs(pre_label_function - label_function).sum()  \r\n    while iter &lt; max_iter and changed &gt; tol:  \r\n        if iter % 1 == 0:  \r\n            print \"---&gt; Iteration %d/%d, changed: %f\" % (iter, max_iter, changed)  \r\n        pre_label_function = label_function  \r\n        iter += 1  \r\n          \r\n        # propagation  \r\n        label_function = np.dot(affinity_matrix, label_function)  \r\n          \r\n        # clamp  \r\n        label_function[0 : num_label_samples] = clamp_data_label  \r\n          \r\n        # check converge  \r\n        changed = np.abs(pre_label_function - label_function).sum()  \r\n      \r\n    # get terminate label of unlabeled data  \r\n    unlabel_data_labels = np.zeros(num_unlabel_samples)  \r\n    for i in xrange(num_unlabel_samples):  \r\n        unlabel_data_labels[i] = np.argmax(label_function[i+num_label_samples])  \r\n      \r\n    return unlabel_data_labels</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe1981187310496-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe1981187310496-101\">101</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-1\"><span class=\"crayon-p\">#***************************************************************************  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-2\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-3\"><span class=\"crayon-p\">#* Description: label propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-4\"><span class=\"crayon-p\">#* Author: Zou Xiaoyi (zouxy09@qq.com)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-5\"><span class=\"crayon-p\">#* Date:   2015-10-15  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-6\"><span class=\"crayon-p\">#* HomePage: http://blog.csdn.net/zouxy09  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-7\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-8\"><span class=\"crayon-p\">#**************************************************************************  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-9\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-10\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">time  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-11\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-12\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-13\"><span class=\"crayon-p\"># return k neighbors index  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-14\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">navie_knn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataSet</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">numSamples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-16\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## step 1: calculate Euclidean distance  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numSamples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dataSet  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-19\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">squaredDiff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">diff *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">squaredDist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">squaredDiff</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">axis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># sum is performed by row  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-21\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## step 2: sort the distance  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argsort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">squaredDist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-26\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-28\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-29\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-30\"><span class=\"crayon-p\"># build a big graph (normalized weight matrix)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-31\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">buildGraph</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rbf_sigma</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rbf'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rbf_sigma</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'You should input a sigma of rbf kernel!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">row_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">diff*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">rbf_sigma*</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-42\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">row_sum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">j</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row_sum  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-44\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">elif </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'knn'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'You should input a k of knn kernel!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">navie_knn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">knn_num_neighbors  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-50\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">NameError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Not support kernel type! You can use knn or rbf!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-52\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-54\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-55\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-56\"><span class=\"crayon-p\"># label propagation  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-57\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">labelPropagation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'rbf'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rbf_sigma</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-58\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1e</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num_unlabel_samples  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-63\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">labels_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unique</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-65\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-66\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">MatX</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">clamp_data_label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">clamp_data_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-70\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clamp_data_label  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-73\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-74\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># graph construction  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">buildGraph</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MatX</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rbf_sigma</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-77\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># start to propagation  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">abs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max_iter </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tol</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-83\"><span class=\"crayon-h\">            </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"---&gt; Iteration %d/%d, changed: %f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">label_function  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-85\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-86\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-89\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># clamp  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">clamp_data_label</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-92\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># check converge  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">abs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-95\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># get terminate label of unlabeled data  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-97\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">label_function</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe1981187310496-100\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe1981187310496-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_labels</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0227 seconds] -->\r\n<p><strong><span style=\"color: #ff0000\">测试</span></strong>代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebe199e847677090\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#***************************************************************************  \r\n#*   \r\n#* Description: label propagation  \r\n#* Author: Zou Xiaoyi (zouxy09@qq.com)  \r\n#* Date:   2015-10-15  \r\n#* HomePage: http://blog.csdn.net/zouxy09  \r\n#*   \r\n#**************************************************************************  \r\n  \r\nimport time  \r\nimport math  \r\nimport numpy as np  \r\nfrom label_propagation import labelPropagation  \r\n  \r\n# show  \r\ndef show(Mat_Label, labels, Mat_Unlabel, unlabel_data_labels):   \r\n    import matplotlib.pyplot as plt   \r\n      \r\n    for i in range(Mat_Label.shape[0]):  \r\n        if int(labels[i]) == 0:    \r\n            plt.plot(Mat_Label[i, 0], Mat_Label[i, 1], 'Dr')    \r\n        elif int(labels[i]) == 1:    \r\n            plt.plot(Mat_Label[i, 0], Mat_Label[i, 1], 'Db')  \r\n        else:  \r\n            plt.plot(Mat_Label[i, 0], Mat_Label[i, 1], 'Dy')  \r\n      \r\n    for i in range(Mat_Unlabel.shape[0]):  \r\n        if int(unlabel_data_labels[i]) == 0:    \r\n            plt.plot(Mat_Unlabel[i, 0], Mat_Unlabel[i, 1], 'or')    \r\n        elif int(unlabel_data_labels[i]) == 1:    \r\n            plt.plot(Mat_Unlabel[i, 0], Mat_Unlabel[i, 1], 'ob')  \r\n        else:  \r\n            plt.plot(Mat_Unlabel[i, 0], Mat_Unlabel[i, 1], 'oy')  \r\n      \r\n    plt.xlabel('X1'); plt.ylabel('X2')   \r\n    plt.xlim(0.0, 12.)  \r\n    plt.ylim(0.0, 12.)  \r\n    plt.show()    \r\n  \r\n  \r\ndef loadCircleData(num_data):  \r\n    center = np.array([5.0, 5.0])  \r\n    radiu_inner = 2  \r\n    radiu_outer = 4  \r\n    num_inner = num_data / 3  \r\n    num_outer = num_data - num_inner  \r\n      \r\n    data = []  \r\n    theta = 0.0  \r\n    for i in range(num_inner):  \r\n        pho = (theta % 360) * math.pi / 180  \r\n        tmp = np.zeros(2, np.float32)  \r\n        tmp[0] = radiu_inner * math.cos(pho) + np.random.rand(1) + center[0]  \r\n        tmp[1] = radiu_inner * math.sin(pho) + np.random.rand(1) + center[1]  \r\n        data.append(tmp)  \r\n        theta += 2  \r\n      \r\n    theta = 0.0  \r\n    for i in range(num_outer):  \r\n        pho = (theta % 360) * math.pi / 180  \r\n        tmp = np.zeros(2, np.float32)  \r\n        tmp[0] = radiu_outer * math.cos(pho) + np.random.rand(1) + center[0]  \r\n        tmp[1] = radiu_outer * math.sin(pho) + np.random.rand(1) + center[1]  \r\n        data.append(tmp)  \r\n        theta += 1  \r\n      \r\n    Mat_Label = np.zeros((2, 2), np.float32)  \r\n    Mat_Label[0] = center + np.array([-radiu_inner + 0.5, 0])  \r\n    Mat_Label[1] = center + np.array([-radiu_outer + 0.5, 0])  \r\n    labels = [0, 1]  \r\n    Mat_Unlabel = np.vstack(data)  \r\n    return Mat_Label, labels, Mat_Unlabel  \r\n  \r\n  \r\ndef loadBandData(num_unlabel_samples):  \r\n    #Mat_Label = np.array([[5.0, 2.], [5.0, 8.0]])  \r\n    #labels = [0, 1]  \r\n    #Mat_Unlabel = np.array([[5.1, 2.], [5.0, 8.1]])  \r\n      \r\n    Mat_Label = np.array([[5.0, 2.], [5.0, 8.0]])  \r\n    labels = [0, 1]  \r\n    num_dim = Mat_Label.shape[1]  \r\n    Mat_Unlabel = np.zeros((num_unlabel_samples, num_dim), np.float32)  \r\n    Mat_Unlabel[:num_unlabel_samples/2, :] = (np.random.rand(num_unlabel_samples/2, num_dim) - 0.5) * np.array([3, 1]) + Mat_Label[0]  \r\n    Mat_Unlabel[num_unlabel_samples/2 : num_unlabel_samples, :] = (np.random.rand(num_unlabel_samples/2, num_dim) - 0.5) * np.array([3, 1]) + Mat_Label[1]  \r\n    return Mat_Label, labels, Mat_Unlabel  \r\n  \r\n  \r\n# main function  \r\nif __name__ == \"__main__\":  \r\n    num_unlabel_samples = 800  \r\n    #Mat_Label, labels, Mat_Unlabel = loadBandData(num_unlabel_samples)  \r\n    Mat_Label, labels, Mat_Unlabel = loadCircleData(num_unlabel_samples)  \r\n      \r\n    ## Notice: when use 'rbf' as our kernel, the choice of hyper parameter 'sigma' is very import! It should be  \r\n    ## chose according to your dataset, specific the distance of two data points. I think it should ensure that  \r\n    ## each point has about 10 knn or w_i,j is large enough. It also influence the speed of converge. So, may be  \r\n    ## 'knn' kernel is better!  \r\n    #unlabel_data_labels = labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = 'rbf', rbf_sigma = 0.2)  \r\n    unlabel_data_labels = labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = 'knn', knn_num_neighbors = 10, max_iter = 400)  \r\n    show(Mat_Label, labels, Mat_Unlabel, unlabel_data_labels)  </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe199e847677090-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe199e847677090-101\">101</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-1\"><span class=\"crayon-p\">#***************************************************************************  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-2\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-3\"><span class=\"crayon-p\">#* Description: label propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-4\"><span class=\"crayon-p\">#* Author: Zou Xiaoyi (zouxy09@qq.com)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-5\"><span class=\"crayon-p\">#* Date:   2015-10-15  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-6\"><span class=\"crayon-p\">#* HomePage: http://blog.csdn.net/zouxy09  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-7\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-8\"><span class=\"crayon-p\">#**************************************************************************  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-9\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-10\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">time  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-11\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">math  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-12\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-13\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">label_propagation </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">labelPropagation</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-14\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-15\"><span class=\"crayon-p\"># show  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-16\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-18\"><span class=\"crayon-e\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-19\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Dr'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">elif </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Db'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Dy'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-26\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'or'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">elif </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-31\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ob'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">plot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'oy'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-34\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xlabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'X1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ylabel</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'X2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xlim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ylim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-39\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-40\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-41\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loadCircleData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">radiu_inner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">radiu_outer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_inner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_outer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num_inner  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-47\"><span class=\"crayon-e\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-48\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_inner</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pho</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">360</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">180</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">radiu_inner *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cos</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pho</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">radiu_inner *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pho</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-57\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_outer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pho</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">360</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">180</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">radiu_outer *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cos</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pho</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">radiu_outer *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pho</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">theta</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-66\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">radiu_inner</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">radiu_outer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Mat_Unlabel  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-73\"><span class=\"crayon-e\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-74\"><span class=\"crayon-e\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-75\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">loadBandData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-76\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#Mat_Label = np.array([[5.0, 2.], [5.0, 8.0]])  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#labels = [0, 1]  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#Mat_Unlabel = np.array([[5.1, 2.], [5.0, 8.1]])  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-79\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_dim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-84\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-85\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">rand</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_dim</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-86\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-87\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-88\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-89\"><span class=\"crayon-p\"># main function  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-90\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">800</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-92\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#Mat_Label, labels, Mat_Unlabel = loadBandData(num_unlabel_samples)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-93\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loadCircleData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-94\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## Notice: when use 'rbf' as our kernel, the choice of hyper parameter 'sigma' is very import! It should be  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## chose according to your dataset, specific the distance of two data points. I think it should ensure that  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-97\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## each point has about 10 knn or w_i,j is large enough. It also influence the speed of converge. So, may be  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## 'knn' kernel is better!  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-99\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#unlabel_data_labels = labelPropagation(Mat_Label, Mat_Unlabel, labels, kernel_type = 'rbf', rbf_sigma = 0.2)  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe199e847677090-100\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">labelPropagation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kernel_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'knn'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe199e847677090-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_labels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0265 seconds] -->\r\n<p>该注释的，代码都注释的，有看不明白的，欢迎交流。不同迭代次数时候的结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/849f491e4f7975f08b0cb8ac5de20858.png\"><img class=\"aligncenter size-full wp-image-88474\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/849f491e4f7975f08b0cb8ac5de20858.png\" alt=\"cpp_py_medium\"></a></p>\n<p>是不是很漂亮的传播过程？！在数值上也是可以看到随着迭代的进行逐渐收敛的，迭代的数值变化过程如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebe19b2251538334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n---&gt; Iteration 0/400, changed: 1602.000000  \r\n---&gt; Iteration 1/400, changed: 6.300182  \r\n---&gt; Iteration 2/400, changed: 5.129996  \r\n---&gt; Iteration 3/400, changed: 4.301994  \r\n---&gt; Iteration 4/400, changed: 3.819295  \r\n---&gt; Iteration 5/400, changed: 3.501743  \r\n---&gt; Iteration 6/400, changed: 3.277122  \r\n---&gt; Iteration 7/400, changed: 3.105952  \r\n---&gt; Iteration 8/400, changed: 2.967030  \r\n---&gt; Iteration 9/400, changed: 2.848606  \r\n---&gt; Iteration 10/400, changed: 2.743997  \r\n---&gt; Iteration 11/400, changed: 2.649270  \r\n---&gt; Iteration 12/400, changed: 2.562057  \r\n---&gt; Iteration 13/400, changed: 2.480885  \r\n---&gt; Iteration 14/400, changed: 2.404774  \r\n---&gt; Iteration 15/400, changed: 2.333075  \r\n---&gt; Iteration 16/400, changed: 2.265301  \r\n---&gt; Iteration 17/400, changed: 2.201107  \r\n---&gt; Iteration 18/400, changed: 2.140209  \r\n---&gt; Iteration 19/400, changed: 2.082354  \r\n---&gt; Iteration 20/400, changed: 2.027376  \r\n---&gt; Iteration 21/400, changed: 1.975071  \r\n---&gt; Iteration 22/400, changed: 1.925286  \r\n---&gt; Iteration 23/400, changed: 1.877894  \r\n---&gt; Iteration 24/400, changed: 1.832743  \r\n---&gt; Iteration 25/400, changed: 1.789721  \r\n---&gt; Iteration 26/400, changed: 1.748706  \r\n---&gt; Iteration 27/400, changed: 1.709593  \r\n---&gt; Iteration 28/400, changed: 1.672284  \r\n---&gt; Iteration 29/400, changed: 1.636668  \r\n---&gt; Iteration 30/400, changed: 1.602668  \r\n---&gt; Iteration 31/400, changed: 1.570200  \r\n---&gt; Iteration 32/400, changed: 1.539179  \r\n---&gt; Iteration 33/400, changed: 1.509530  \r\n---&gt; Iteration 34/400, changed: 1.481182  \r\n---&gt; Iteration 35/400, changed: 1.454066  \r\n---&gt; Iteration 36/400, changed: 1.428120  \r\n---&gt; Iteration 37/400, changed: 1.403283  \r\n---&gt; Iteration 38/400, changed: 1.379502  \r\n---&gt; Iteration 39/400, changed: 1.356734  \r\n---&gt; Iteration 40/400, changed: 1.334906  \r\n---&gt; Iteration 41/400, changed: 1.313983  \r\n---&gt; Iteration 42/400, changed: 1.293921  \r\n---&gt; Iteration 43/400, changed: 1.274681  \r\n---&gt; Iteration 44/400, changed: 1.256214  \r\n---&gt; Iteration 45/400, changed: 1.238491  \r\n---&gt; Iteration 46/400, changed: 1.221474  \r\n---&gt; Iteration 47/400, changed: 1.205126  \r\n---&gt; Iteration 48/400, changed: 1.189417  \r\n---&gt; Iteration 49/400, changed: 1.174316  \r\n---&gt; Iteration 50/400, changed: 1.159804  \r\n---&gt; Iteration 51/400, changed: 1.145844  \r\n---&gt; Iteration 52/400, changed: 1.132414  \r\n---&gt; Iteration 53/400, changed: 1.119490  \r\n---&gt; Iteration 54/400, changed: 1.107032  \r\n---&gt; Iteration 55/400, changed: 1.095054  \r\n---&gt; Iteration 56/400, changed: 1.083513  \r\n---&gt; Iteration 57/400, changed: 1.072397  \r\n---&gt; Iteration 58/400, changed: 1.061671  \r\n---&gt; Iteration 59/400, changed: 1.051324  \r\n---&gt; Iteration 60/400, changed: 1.041363  \r\n---&gt; Iteration 61/400, changed: 1.031742  \r\n---&gt; Iteration 62/400, changed: 1.022459  \r\n---&gt; Iteration 63/400, changed: 1.013494  \r\n---&gt; Iteration 64/400, changed: 1.004836  \r\n---&gt; Iteration 65/400, changed: 0.996484  \r\n---&gt; Iteration 66/400, changed: 0.988407  \r\n---&gt; Iteration 67/400, changed: 0.980592  \r\n---&gt; Iteration 68/400, changed: 0.973045  \r\n---&gt; Iteration 69/400, changed: 0.965744  \r\n---&gt; Iteration 70/400, changed: 0.958682  \r\n---&gt; Iteration 71/400, changed: 0.951848  \r\n---&gt; Iteration 72/400, changed: 0.945227  \r\n---&gt; Iteration 73/400, changed: 0.938820  \r\n---&gt; Iteration 74/400, changed: 0.932608  \r\n---&gt; Iteration 75/400, changed: 0.926590  \r\n---&gt; Iteration 76/400, changed: 0.920765  \r\n---&gt; Iteration 77/400, changed: 0.915107  \r\n---&gt; Iteration 78/400, changed: 0.909628  \r\n---&gt; Iteration 79/400, changed: 0.904309  \r\n---&gt; Iteration 80/400, changed: 0.899143  \r\n---&gt; Iteration 81/400, changed: 0.894122  \r\n---&gt; Iteration 82/400, changed: 0.889259  \r\n---&gt; Iteration 83/400, changed: 0.884530  \r\n---&gt; Iteration 84/400, changed: 0.879933  \r\n---&gt; Iteration 85/400, changed: 0.875464  \r\n---&gt; Iteration 86/400, changed: 0.871121  \r\n---&gt; Iteration 87/400, changed: 0.866888  \r\n---&gt; Iteration 88/400, changed: 0.862773  \r\n---&gt; Iteration 89/400, changed: 0.858783  \r\n---&gt; Iteration 90/400, changed: 0.854879  \r\n---&gt; Iteration 91/400, changed: 0.851084  \r\n---&gt; Iteration 92/400, changed: 0.847382  \r\n---&gt; Iteration 93/400, changed: 0.843779  \r\n---&gt; Iteration 94/400, changed: 0.840274  \r\n---&gt; Iteration 95/400, changed: 0.836842  \r\n---&gt; Iteration 96/400, changed: 0.833501  \r\n---&gt; Iteration 97/400, changed: 0.830240  \r\n---&gt; Iteration 98/400, changed: 0.827051  \r\n---&gt; Iteration 99/400, changed: 0.823950  \r\n---&gt; Iteration 100/400, changed: 0.820906  \r\n---&gt; Iteration 101/400, changed: 0.817946  \r\n---&gt; Iteration 102/400, changed: 0.815053  \r\n---&gt; Iteration 103/400, changed: 0.812217  \r\n---&gt; Iteration 104/400, changed: 0.809437  \r\n---&gt; Iteration 105/400, changed: 0.806724  \r\n---&gt; Iteration 106/400, changed: 0.804076  \r\n---&gt; Iteration 107/400, changed: 0.801480  \r\n---&gt; Iteration 108/400, changed: 0.798937  \r\n---&gt; Iteration 109/400, changed: 0.796448  \r\n---&gt; Iteration 110/400, changed: 0.794008  \r\n---&gt; Iteration 111/400, changed: 0.791612  \r\n---&gt; Iteration 112/400, changed: 0.789282  \r\n---&gt; Iteration 113/400, changed: 0.786984  \r\n---&gt; Iteration 114/400, changed: 0.784728  \r\n---&gt; Iteration 115/400, changed: 0.782516  \r\n---&gt; Iteration 116/400, changed: 0.780355  \r\n---&gt; Iteration 117/400, changed: 0.778216  \r\n---&gt; Iteration 118/400, changed: 0.776139  \r\n---&gt; Iteration 119/400, changed: 0.774087  \r\n---&gt; Iteration 120/400, changed: 0.772072  \r\n---&gt; Iteration 121/400, changed: 0.770085  \r\n---&gt; Iteration 122/400, changed: 0.768146  \r\n---&gt; Iteration 123/400, changed: 0.766232  \r\n---&gt; Iteration 124/400, changed: 0.764356  \r\n---&gt; Iteration 125/400, changed: 0.762504  \r\n---&gt; Iteration 126/400, changed: 0.760685  \r\n---&gt; Iteration 127/400, changed: 0.758889  \r\n---&gt; Iteration 128/400, changed: 0.757135  \r\n---&gt; Iteration 129/400, changed: 0.755406</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19b2251538334-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19b2251538334-130\">130</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1602.000000</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-2\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.300182</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.129996</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-4\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.301994</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-5\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.819295</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-6\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.501743</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-7\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.277122</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-8\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3.105952</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-9\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.967030</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.848606</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-11\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.743997</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-12\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.649270</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-13\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.562057</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-14\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.480885</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-15\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.404774</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-16\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.333075</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-17\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.265301</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-18\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.201107</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-19\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.140209</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-20\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.082354</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-21\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.027376</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-22\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.975071</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-23\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.925286</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-24\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.877894</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-25\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.832743</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-26\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">25</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.789721</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-27\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">26</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.748706</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-28\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.709593</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-29\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.672284</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-30\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">29</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.636668</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-31\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.602668</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-32\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.570200</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-33\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.539179</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-34\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.509530</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-35\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.481182</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-36\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.454066</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-37\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">36</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.428120</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-38\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.403283</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-39\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">38</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.379502</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-40\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">39</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.356734</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-41\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.334906</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-42\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">41</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.313983</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-43\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">42</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.293921</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-44\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">43</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.274681</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-45\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">44</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.256214</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-46\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.238491</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-47\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">46</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.221474</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-48\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">47</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.205126</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-49\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">48</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.189417</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-50\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">49</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.174316</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-51\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.159804</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-52\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">51</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.145844</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-53\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.132414</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-54\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.119490</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-55\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">54</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.107032</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-56\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.095054</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-57\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.083513</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-58\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">57</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.072397</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-59\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">58</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.061671</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-60\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">59</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.051324</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-61\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.041363</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-62\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.031742</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-63\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">62</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.022459</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-64\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">63</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.013494</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-65\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.004836</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-66\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.996484</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-67\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">66</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.988407</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-68\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">67</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.980592</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-69\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">68</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.973045</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-70\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">69</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.965744</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-71\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">70</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.958682</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-72\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">71</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.951848</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-73\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">72</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.945227</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-74\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">73</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.938820</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-75\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.932608</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-76\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">75</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.926590</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-77\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">76</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.920765</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-78\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">77</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.915107</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-79\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">78</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.909628</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-80\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">79</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.904309</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-81\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.899143</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-82\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">81</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.894122</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-83\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">82</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.889259</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-84\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">83</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.884530</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-85\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">84</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.879933</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-86\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.875464</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-87\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">86</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.871121</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-88\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">87</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.866888</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-89\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">88</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.862773</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-90\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.858783</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-91\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.854879</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-92\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">91</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.851084</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-93\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">92</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.847382</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-94\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">93</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.843779</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-95\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">94</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.840274</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-96\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.836842</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-97\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">96</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.833501</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-98\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">97</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.830240</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-99\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">98</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.827051</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-100\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">99</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.823950</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-101\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.820906</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-102\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">101</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.817946</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-103\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">102</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.815053</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-104\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">103</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.812217</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-105\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">104</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.809437</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-106\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">105</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.806724</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-107\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">106</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.804076</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-108\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">107</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.801480</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-109\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">108</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.798937</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-110\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">109</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.796448</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-111\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">110</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.794008</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-112\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">111</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.791612</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-113\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">112</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.789282</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-114\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">113</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.786984</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-115\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">114</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.784728</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-116\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">115</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.782516</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-117\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">116</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.780355</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-118\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">117</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.778216</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-119\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">118</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.776139</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-120\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">119</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.774087</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-121\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.772072</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-122\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">121</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.770085</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-123\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">122</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.768146</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-124\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">123</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.766232</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-125\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">124</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.764356</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-126\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">125</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.762504</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-127\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">126</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.760685</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-128\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.758889</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19b2251538334-129\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">128</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.757135</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19b2251538334-130\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Iteration</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">129</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.755406</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0579 seconds] -->\r\n<p></p>\n<h1>四、LP算法MPI并行实现</h1>\n<p>这里，我们测试的是LP的变身版本。从公式，我们可以看到，第二项P<sub>UL</sub>Y<sub>L</sub>迭代过程并没有发生变化，所以这部分实际上从迭代开始就可以计算好，从而避免重复计算。不过，不管怎样，LP算法都要计算一个UxU的矩阵P<sub>UU</sub>和一个UxC矩阵F<sub>U</sub>的乘积。当我们的unlabeled数据非常多，而且类别也很多的时候，计算是很慢的，同时占用的内存量也非常大。另外，构造Graph需要计算两两的相似度，也是O(n<sup>2</sup>)的复杂度，当我们数据的特征维度很大的时候，这个计算量也是非常客观的。所以我们就得考虑并行处理了。而且最好是能放到集群上并行。那如何并行呢？</p>\n<p>对算法的并行化，一般分为两种：数据并行和模型并行。</p>\n<p>数据并行很好理解，就是将数据划分，每个节点只处理一部分数据，例如我们构造图的时候，计算每个数据的k近邻。例如我们有1000个样本和20个CPU节点，那么就平均分发，让每个CPU节点计算50个样本的k近邻，然后最后再合并大家的结果。可见这个加速比也是非常可观的。</p>\n<p>模型并行一般发生在模型很大，无法放到单机的内存里面的时候。例如庞大的深度神经网络训练的时候，就需要把这个网络切开，然后分别求解梯度，最后有个leader的节点来收集大家的梯度，再反馈给大家去更新。当然了，其中存在更细致和高效的工程处理方法。在我们的LP算法中，也是可以做模型并行的。假如我们的类别数C很大，把类别数切开，让不同的CPU节点处理，实际上就相当于模型并行了。</p>\n<p>那为啥不切大矩阵P<sub>UU</sub>，而是切小点的矩阵F<sub>U</sub>，因为大矩阵P<sub>UU</sub>没法独立分块，并行的一个原则是处理必须是独立的。 矩阵F<sub>U</sub>依赖的是所有的U，而把P<sub>UU</sub>切开分发到其他节点的时候，每次F<sub>U</sub>的更新都需要和其他的节点通信，这个通信的代价是很大的（实际上，很多并行系统没法达到线性的加速度的瓶颈是通信！线性加速比是，我增加了n台机器，速度就提升了n倍）。但是对类别C也就是矩阵F<sub>U</sub>切分，就不会有这个问题，因为他们的计算是独立的。只是决定样本的最终类别的时候，将所有的F<sub>U</sub>收集回来求max就可以了。</p>\n<p>所以，在下面的代码中，是同时包含了数据并行和模型并行的雏形的。另外，还值得一提的是，我们是迭代算法，那决定什么时候迭代算法停止？除了判断收敛外，我们还可以让每迭代几步，就用测试label测试一次结果，看模型的整体训练性能如何。特别是判断训练是否过拟合的时候非常有效。因此，代码中包含了这部分内容。</p>\n<p>好了，代码终于来了。大家可以搞点大数据库来测试，如果有MPI集群条件的话就更好了。</p>\n<p>下面的代码依赖numpy、scipy（用其稀疏矩阵加速计算）和mpi4py。其中mpi4py需要依赖openmpi和Cpython，可以参考我<a href=\"http://blog.csdn.net/zouxy09/article/details/49031845\" target=\"_blank\">之前的博客</a>进行安装。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04bebe19c4643266118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#***************************************************************************  \r\n#*   \r\n#* Description: label propagation  \r\n#* Author: Zou Xiaoyi (zouxy09@qq.com)  \r\n#* Date:   2015-10-15  \r\n#* HomePage: http://blog.csdn.net/zouxy09  \r\n#*   \r\n#**************************************************************************  \r\n  \r\nimport os, sys, time  \r\nimport numpy as np  \r\nfrom scipy.sparse import csr_matrix, lil_matrix, eye  \r\nimport operator  \r\nimport cPickle as pickle  \r\nimport mpi4py.MPI as MPI  \r\n  \r\n#  \r\n#   Global variables for MPI  \r\n#  \r\n  \r\n# instance for invoking MPI related functions  \r\ncomm = MPI.COMM_WORLD  \r\n# the node rank in the whole community  \r\ncomm_rank = comm.Get_rank()  \r\n# the size of the whole community, i.e., the total number of working nodes in the MPI cluster  \r\ncomm_size = comm.Get_size()  \r\n  \r\n# load mnist dataset  \r\ndef load_MNIST():  \r\n    import gzip  \r\n    f = gzip.open(\"mnist.pkl.gz\", \"rb\")  \r\n    train, val, test = pickle.load(f)  \r\n    f.close()  \r\n      \r\n    Mat_Label = train[0]  \r\n    labels = train[1]  \r\n    Mat_Unlabel = test[0]  \r\n    groundtruth = test[1]  \r\n    labels_id = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]  \r\n  \r\n    return Mat_Label, labels, labels_id, Mat_Unlabel, groundtruth  \r\n  \r\n# return k neighbors index  \r\ndef navie_knn(dataSet, query, k):  \r\n    numSamples = dataSet.shape[0]  \r\n  \r\n    ## step 1: calculate Euclidean distance  \r\n    diff = np.tile(query, (numSamples, 1)) - dataSet  \r\n    squaredDiff = diff ** 2  \r\n    squaredDist = np.sum(squaredDiff, axis = 1) # sum is performed by row  \r\n  \r\n    ## step 2: sort the distance  \r\n    sortedDistIndices = np.argsort(squaredDist)  \r\n    if k &gt; len(sortedDistIndices):  \r\n        k = len(sortedDistIndices)  \r\n    return sortedDistIndices[0:k]  \r\n  \r\n  \r\n# build a big graph (normalized weight matrix)  \r\n# sparse U x (U + L) matrix  \r\ndef buildSubGraph(Mat_Label, Mat_Unlabel, knn_num_neighbors):  \r\n    num_unlabel_samples = Mat_Unlabel.shape[0]  \r\n    data = []; indices = []; indptr = [0]  \r\n    Mat_all = np.vstack((Mat_Label, Mat_Unlabel))  \r\n    values = np.ones(knn_num_neighbors, np.float32) / knn_num_neighbors  \r\n    for i in xrange(num_unlabel_samples):  \r\n        k_neighbors = navie_knn(Mat_all, Mat_Unlabel[i, :], knn_num_neighbors)  \r\n        indptr.append(np.int32(indptr[-1]) + knn_num_neighbors)  \r\n        indices.extend(k_neighbors)  \r\n        data.append(values)   \r\n    return csr_matrix((np.hstack(data), indices, indptr))  \r\n  \r\n  \r\n# build a big graph (normalized weight matrix)  \r\n# sparse U x (U + L) matrix  \r\ndef buildSubGraph_MPI(Mat_Label, Mat_Unlabel, knn_num_neighbors):  \r\n    num_unlabel_samples = Mat_Unlabel.shape[0]  \r\n    local_data = []; local_indices = []; local_indptr = [0]  \r\n    Mat_all = np.vstack((Mat_Label, Mat_Unlabel))  \r\n    values = np.ones(knn_num_neighbors, np.float32) / knn_num_neighbors  \r\n    sample_offset = np.linspace(0, num_unlabel_samples, comm_size + 1).astype('int')  \r\n    for i in range(sample_offset[comm_rank], sample_offset[comm_rank+1]):  \r\n        k_neighbors = navie_knn(Mat_all, Mat_Unlabel[i, :], knn_num_neighbors)  \r\n        local_indptr.append(np.int32(local_indptr[-1]) + knn_num_neighbors)  \r\n        local_indices.extend(k_neighbors)  \r\n        local_data.append(values)  \r\n    data = np.hstack(comm.allgather(local_data))  \r\n    indices = np.hstack(comm.allgather(local_indices))  \r\n    indptr_tmp = comm.allgather(local_indptr)  \r\n    indptr = []  \r\n    for i in range(len(indptr_tmp)):  \r\n        if i == 0:  \r\n            indptr.extend(indptr_tmp[i])  \r\n        else:  \r\n            last_indptr = indptr[-1]  \r\n            del(indptr[-1])  \r\n            indptr.extend(indptr_tmp[i] + last_indptr)  \r\n    return csr_matrix((np.hstack(data), indices, indptr), dtype = np.float32)  \r\n  \r\n  \r\n# label propagation  \r\ndef run_label_propagation_sparse(knn_num_neighbors = 20, max_iter = 100, tol = 1e-4, test_per_iter = 1):  \r\n    # load data and graph  \r\n    print \"Processor %d/%d loading graph file...\" % (comm_rank, comm_size)  \r\n    #Mat_Label, labels, Mat_Unlabel, groundtruth = loadFourBandData()  \r\n    Mat_Label, labels, labels_id, Mat_Unlabel, unlabel_data_id = load_MNIST()  \r\n    if comm_size &gt; len(labels_id):  \r\n        raise ValueError(\"Sorry, the processors must be less than the number of classes\")  \r\n    #affinity_matrix = buildSubGraph(Mat_Label, Mat_Unlabel, knn_num_neighbors)  \r\n    affinity_matrix = buildSubGraph_MPI(Mat_Label, Mat_Unlabel, knn_num_neighbors)  \r\n      \r\n    # get some parameters  \r\n    num_classes = len(labels_id)  \r\n    num_label_samples = len(labels)  \r\n    num_unlabel_samples = Mat_Unlabel.shape[0]  \r\n  \r\n    affinity_matrix_UL = affinity_matrix[:, 0:num_label_samples]  \r\n    affinity_matrix_UU = affinity_matrix[:, num_label_samples:num_label_samples+num_unlabel_samples]  \r\n  \r\n    if comm_rank == 0:  \r\n        print \"Have %d labeled images, %d unlabeled images and %d classes\" % (num_label_samples, num_unlabel_samples, num_classes)  \r\n      \r\n    # divide label_function_U and label_function_L to all processors  \r\n    class_offset = np.linspace(0, num_classes, comm_size + 1).astype('int')  \r\n      \r\n    # initialize local label_function_U  \r\n    local_start_class = class_offset[comm_rank]  \r\n    local_num_classes = class_offset[comm_rank+1] - local_start_class  \r\n    local_label_function_U = eye(num_unlabel_samples, local_num_classes, 0, np.float32, format='csr')  \r\n      \r\n    # initialize local label_function_L  \r\n    local_label_function_L = lil_matrix((num_label_samples, local_num_classes), dtype = np.float32)  \r\n    for i in xrange(num_label_samples):  \r\n        class_off = int(labels[i]) - local_start_class  \r\n        if class_off &gt;= 0 and class_off &lt; local_num_classes:  \r\n            local_label_function_L[i, class_off] = 1.0  \r\n    local_label_function_L = local_label_function_L.tocsr()  \r\n    local_label_info = affinity_matrix_UL.dot(local_label_function_L)  \r\n    print \"Processor %d/%d has to process %d classes...\" % (comm_rank, comm_size, local_label_function_L.shape[1])  \r\n      \r\n    # start to propagation  \r\n    iter = 1; changed = 100.0;  \r\n    evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  \r\n    while True:  \r\n        pre_label_function = local_label_function_U.copy()  \r\n          \r\n        # propagation  \r\n        local_label_function_U = affinity_matrix_UU.dot(local_label_function_U) + local_label_info  \r\n          \r\n        # check converge  \r\n        local_changed = abs(pre_label_function - local_label_function_U).sum()  \r\n        changed = comm.reduce(local_changed, root = 0, op = MPI.SUM)  \r\n        status = 'RUN'  \r\n        test = False  \r\n        if comm_rank == 0:  \r\n            if iter % 1 == 0:  \r\n                norm_changed = changed / (num_unlabel_samples * num_classes)  \r\n                print \"---&gt; Iteration %d/%d, changed: %f\" % (iter, max_iter, norm_changed)  \r\n            if iter &gt;= max_iter or changed &lt; tol:  \r\n                status = 'STOP'  \r\n                print \"************** Iteration over! ****************\"  \r\n            if iter % test_per_iter == 0:  \r\n                test = True  \r\n            iter += 1  \r\n        test = comm.bcast(test if comm_rank == 0 else None, root = 0)  \r\n        status = comm.bcast(status if comm_rank == 0 else None, root = 0)  \r\n        if status == 'STOP':  \r\n            break  \r\n        if test == True:  \r\n            evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  \r\n    evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id)  \r\n  \r\n  \r\ndef evaluation(num_unlabel_samples, local_start_class, local_label_function_U, unlabel_data_id, labels_id):  \r\n    # get local label with max score  \r\n    if comm_rank == 0:  \r\n        print \"Start to combine local result...\"  \r\n    local_max_score = np.zeros((num_unlabel_samples, 1), np.float32)   \r\n    local_max_label = np.zeros((num_unlabel_samples, 1), np.int32)  \r\n    for i in xrange(num_unlabel_samples):  \r\n        local_max_label[i, 0] = np.argmax(local_label_function_U.getrow(i).todense())  \r\n        local_max_score[i, 0] = local_label_function_U[i, local_max_label[i, 0]]  \r\n        local_max_label[i, 0] += local_start_class  \r\n          \r\n    # gather the results from all the processors  \r\n    if comm_rank == 0:  \r\n        print \"Start to gather results from all processors\"  \r\n    all_max_label = np.hstack(comm.allgather(local_max_label))  \r\n    all_max_score = np.hstack(comm.allgather(local_max_score))  \r\n      \r\n    # get terminate label of unlabeled data  \r\n    if comm_rank == 0:  \r\n        print \"Start to analysis the results...\"  \r\n        right_predict_count = 0  \r\n        for i in xrange(num_unlabel_samples):  \r\n            if i % 1000 == 0:  \r\n                print \"***\", all_max_score[i]  \r\n            max_idx = np.argmax(all_max_score[i])  \r\n            max_label = all_max_label[i, max_idx]  \r\n            if int(unlabel_data_id[i]) == int(labels_id[max_label]):  \r\n                right_predict_count += 1  \r\n        accuracy = float(right_predict_count) * 100.0 / num_unlabel_samples  \r\n        print \"Have %d samples, accuracy: %.3f%%!\" % (num_unlabel_samples, accuracy)  \r\n  \r\n  \r\nif __name__ == '__main__':  \r\n    run_label_propagation_sparse(knn_num_neighbors = 20, max_iter = 30)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04bebe19c4643266118-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-59d04bebe19c4643266118-207\">207</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-1\"><span class=\"crayon-p\">#***************************************************************************  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-2\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-3\"><span class=\"crayon-p\">#* Description: label propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-4\"><span class=\"crayon-p\">#* Author: Zou Xiaoyi (zouxy09@qq.com)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-5\"><span class=\"crayon-p\">#* Date:   2015-10-15  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-6\"><span class=\"crayon-p\">#* HomePage: http://blog.csdn.net/zouxy09  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-7\"><span class=\"crayon-p\">#*   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-8\"><span class=\"crayon-p\">#**************************************************************************  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-9\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-10\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">os</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sys</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-11\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-12\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">scipy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sparse </span><span class=\"crayon-e\">import </span><span class=\"crayon-v\">csr_matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lil_matrix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eye  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-13\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">operator  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-14\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cPickle </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pickle  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-15\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">mpi4py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">MPI </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-16\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-17\"><span class=\"crayon-p\">#  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-18\"><span class=\"crayon-p\">#   Global variables for MPI  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-19\"><span class=\"crayon-p\">#  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-20\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-21\"><span class=\"crayon-p\"># instance for invoking MPI related functions  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-22\"><span class=\"crayon-v\">comm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">COMM_WORLD</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-23\"><span class=\"crayon-p\"># the node rank in the whole community  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-24\"><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get_rank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-25\"><span class=\"crayon-p\"># the size of the whole community, i.e., the total number of working nodes in the MPI cluster  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-26\"><span class=\"crayon-v\">comm_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Get_size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-27\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-28\"><span class=\"crayon-p\"># load mnist dataset  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-29\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">load_MNIST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">import </span><span class=\"crayon-i\">gzip</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gzip</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"mnist.pkl.gz\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"rb\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pickle</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-34\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">train</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">groundtruth</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-40\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">groundtruth</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-42\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-43\"><span class=\"crayon-p\"># return k neighbors index  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-44\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">navie_knn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dataSet</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">numSamples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dataSet</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-46\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## step 1: calculate Euclidean distance  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">diff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">query</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numSamples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dataSet  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-49\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">squaredDiff</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">diff *</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">squaredDist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">squaredDiff</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">axis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># sum is performed by row  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-51\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">## step 2: sort the distance  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argsort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">squaredDist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sortedDistIndices</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-57\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-58\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-59\"><span class=\"crayon-p\"># build a big graph (normalized weight matrix)  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-60\"><span class=\"crayon-p\"># sparse U x (U + L) matrix  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-61\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">buildSubGraph</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_all</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ones</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">knn_num_neighbors  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-66\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">navie_knn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_all</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">int32</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">indices</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csr_matrix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indices</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-72\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-73\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-74\"><span class=\"crayon-p\"># build a big graph (normalized weight matrix)  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-75\"><span class=\"crayon-p\"># sparse U x (U + L) matrix  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-76\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">buildSubGraph_MPI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_indices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_indptr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_all</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">vstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ones</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">knn_num_neighbors  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-81\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sample_offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linspace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">astype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'int'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sample_offset</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sample_offset</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">navie_knn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_all</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_indptr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">int32</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_indptr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_indices</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">k_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">indices</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_indices</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">indptr_tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_indptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-91\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indptr_tmp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indptr_tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-95\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">last_indptr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-96\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">del</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">indptr_tmp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last_indptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csr_matrix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indices</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indptr</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-99\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-100\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-101\"><span class=\"crayon-p\"># label propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-102\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">run_label_propagation_sparse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1e</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_per_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># load data and graph  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-104\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processor %d/%d loading graph file...\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_size</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-105\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#Mat_Label, labels, Mat_Unlabel, groundtruth = loadFourBandData()  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">load_MNIST</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Sorry, the processors must be less than the number of classes\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-109\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\">#affinity_matrix = buildSubGraph(Mat_Label, Mat_Unlabel, knn_num_neighbors)  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-110\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">buildSubGraph_MPI</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Mat_Label</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-111\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-112\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># get some parameters  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-113\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-115\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mat_Unlabel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-116\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-117\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">affinity_matrix_UL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-118\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">affinity_matrix_UU</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-119\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-120\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-121\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Have %d labeled images, %d unlabeled images and %d classes\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-122\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># divide label_function_U and label_function_L to all processors  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">class_offset</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">linspace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_size</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">astype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'int'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-125\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-126\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize local label_function_U  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-127\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_offset</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-128\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_num_classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_offset</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">local_start_class  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-129\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eye</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_num_classes</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'csr'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-130\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-131\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize local label_function_L  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lil_matrix</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-133\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_label_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">class_off</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">local_start_class  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-135\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_off</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_off</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_num_classes</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_off</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-137\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tocsr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-138\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_label_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix_UL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Processor %d/%d has to process %d classes...\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_size</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_L</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">shape</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-140\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-141\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># start to propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-142\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100.0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">evaluation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-144\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-146\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># propagation  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">affinity_matrix_UU</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_info</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-149\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-150\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># check converge  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-151\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">abs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pre_label_function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-152\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reduce</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_changed</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">op</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MPI</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SUM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-153\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'RUN'</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-154\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-155\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-157\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">norm_changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e \">num_unlabel_samples *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-158\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"---&gt; Iteration %d/%d, changed: %f\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">iter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">norm_changed</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-159\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max_iter </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">changed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tol</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-160\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'STOP'</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-161\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"************** Iteration over! ****************\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_per_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-163\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-164\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-165\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bcast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">test </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-166\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bcast</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">status </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">status</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'STOP'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-168\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-169\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">evaluation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-171\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">evaluation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-172\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-173\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-174\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">evaluation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-175\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># get local label with max score  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-177\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Start to combine local result...\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-178\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_max_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">float32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-179\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">local_max_label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zeros</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">int32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-180\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-181\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_max_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getrow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">todense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-182\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_max_score</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_label_function_U</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_max_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-183\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">local_max_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">local_start_class</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-184\"><span class=\"crayon-h\">          </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-185\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># gather the results from all the processors  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-186\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-187\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Start to gather results from all processors\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-188\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">all_max_label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_max_label</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-189\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">all_max_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hstack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">comm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allgather</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">local_max_score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-190\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-191\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># get terminate label of unlabeled data  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-192\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comm_rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-193\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Start to analysis the results...\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-194\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">right_predict_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-195\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-197\"><span class=\"crayon-h\">                </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"***\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">all_max_score</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">max_idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">argmax</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">all_max_score</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">max_label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">all_max_label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_idx</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">unlabel_data_id</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">labels_id</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">max_label</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-201\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">right_predict_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-202\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">accuracy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">right_predict_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100.0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num_unlabel_samples  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-203\"><span class=\"crayon-e\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Have %d samples, accuracy: %.3f%%!\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num_unlabel_samples</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">accuracy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-204\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-205\"><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04bebe19c4643266118-206\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04bebe19c4643266118-207\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">run_label_propagation_sparse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">knn_num_neighbors</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max_iter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0651 seconds] -->\r\n<p></p>\n<h1>五、参考资料</h1>\n<p>[1]<a href=\"http://pages.cs.wisc.edu/~jerryzhu/pub/thesis.pdf\" target=\"_blank\">Semi-SupervisedLearning with Graphs.pdf</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88467\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88467votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88467\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/10921e07716aca4930a41a292bb8953a.png"], "tags": "基础知识,label propagation,机器学习,标签传播", "url_object_id": "a5e879607fd89a2b46eaeb1dd3a25141", "praise_nums": "1", "url": "http://python.jobbole.com/88467/", "title": "标签传播算法（Label Propagation）及 Python 实现", "create_date": "2017/08/31", "comment_nums": 0}
{"fav_nums": 1, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/86b8e78c418a\">Andrew_liu</a>   </div><hr>\n<h1>1. thread模块</h1>\n<hr>\n<ul>\n<li>python是支持多线程的, 主要是通过thread和threading这两个模块来实现的。</li>\n<li>python的thread模块是比较底层的模块(或者说轻量级)，python的threading模块是对thread做了一些包装的，可以更加方便的被使用。</li>\n</ul>\n<p>简要的看一下thread模块中含函数和常量</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f05524940138\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport thread\r\n\r\nthread.LockType  #锁对象的一种, 用于线程的同步\r\nthread.error  #线程的异常\r\n\r\nthread.start_new_thread(function, args[, kwargs])  #创建一个新的线程\r\nfunction : 线程执行函数\r\nargs : 线程执行函数的参数, 类似为tuple,\r\nkwargs : 是一个字典\r\n返回值: 返回线程的标识符\r\n\r\nthread.exit()  #线程退出函数\r\nthread.allocate_lock()  #生成一个未锁状态的锁对象\r\n返回值: 返回一个锁对象</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f05524940138-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f05524940138-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-3\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">LockType</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#锁对象的一种, 用于线程的同步</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-4\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">error</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#线程的异常</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-6\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">function</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#创建一个新的线程</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-7\"><span class=\"crayon-v\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>线程执行函数</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-8\"><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>线程执行函数的参数<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>类似为<span class=\"crayon-k \">tuple</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-9\"><span class=\"crayon-v\">kwargs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>是一个字典</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-10\">返回值<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>返回线程的标识符</div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-12\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#线程退出函数</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f05524940138-13\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allocate_lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#生成一个未锁状态的锁对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f05524940138-14\">返回值<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>返回一个锁对象</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p><strong>锁对象</strong>的方法</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f10761321932\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlock.acquire([waitflag]) #获取锁\r\n无参数时, 无条件获取锁, 无法获取时, 会被阻塞, 知道可以锁被释放\r\n有参数时, waitflag = 0 时,表示只有在不需要等待的情况下才获取锁, 非零情况与上面相同\r\n返回值 :　获得锁成功返回True, 获得锁失败返回False\r\n\r\nlock.release() #释放锁\r\n\r\nlock.locked() #获取当前锁的状态\r\n返回值 : 如果锁已经被某个线程获取,返回True, 否则为False</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f10761321932-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f10761321932-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f10761321932-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f10761321932-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f10761321932-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f10761321932-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f10761321932-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f10761321932-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f10761321932-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f10761321932-1\"><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">waitflag</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获取锁</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f10761321932-2\">无参数时<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>无条件获取锁<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>无法获取时<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>会被阻塞<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>知道可以锁被释放</div><div class=\"crayon-line\" id=\"crayon-59d04becd7f10761321932-3\">有参数时<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">waitflag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span>时<span class=\"crayon-sy\">,</span>表示只有在不需要等待的情况下才获取锁<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>非零情况与上面相同</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f10761321932-4\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span>　获得锁成功返回<span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>获得锁失败返回<span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f10761321932-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f10761321932-6\"><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#释放锁</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f10761321932-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f10761321932-8\"><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">locked</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获取当前锁的状态</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f10761321932-9\">返回值<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>如果锁已经被某个线程获取<span class=\"crayon-sy\">,</span>返回<span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>否则为<span class=\"crayon-t\">False</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<h2>1.1. thread多线程</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f14810638794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport thread\r\nimport time\r\n\r\ndef print_time(thread_name, delay) :\r\n    count = 0\r\n    while count &lt; 5 :\r\n        time.sleep(delay)\r\n        count += 1\r\n        print \"%s : %s\" % (thread_name, time.ctime(time.time()))\r\n\r\ntry :\r\n    thread.start_new_thread(print_time, (\"Thread-1\", 2, ))\r\n    thread.start_new_thread(print_time, (\"Thread-2\", 4, ))\r\nexcept : \r\n    print \"Error: unable to start the thread\"\r\n\r\nwhile True :\r\n    pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f14810638794-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f14810638794-21\">21</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-7\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"%s : %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ctime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-14\"><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">print_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Thread-1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_new_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">print_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Thread-2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-17\"><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Error: unable to start the thread\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f14810638794-20\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f14810638794-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p>\n<h1>2. threading模块</h1>\n<blockquote><p>python的threading模块是对thread做了一些包装的，可以更加方便的被使用。经常和<a href=\"https://docs.python.org/2/library/queue.html\" target=\"_blank\">Queue</a>结合使用,Queue模块中提供了同步的、线程安全的队列类，包括<strong>FIFO（先入先出)队列Queue</strong>，<strong>LIFO（后入先出）队列LifoQueue</strong>，和<strong>优先级队列PriorityQueue</strong>。这些队列都实现了<strong>锁原语</strong>，能够在多线程中直接使用。可以使用队列来实现线程间的同步</p></blockquote>\n<h2>2.1. 常用函数和对象</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f18541884829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#函数\r\nthreading.active_count()  #返回当前线程对象Thread的个数\r\nthreading.enumerate()  #返回当前运行的线程对象Thread(包括后台的)的list\r\nthreading.Condition()  #返回条件变量对象的工厂函数, 主要用户线程的并发\r\nthreading.current_thread()  #返回当前的线程对象Thread, 文档后面解释没看懂\r\nthreading.Lock()  #返回一个新的锁对象, 是在thread模块的基础上实现的 与acquire()和release()结合使用\r\n\r\n#类\r\nthreading.Thread  #一个表示线程控制的类, 这个类常被继承\r\nthraeding.Timer  #定时器,线程在一定时间后执行\r\nthreading.ThreadError  #引发中各种线程相关异常</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f18541884829-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f18541884829-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f18541884829-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f18541884829-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f18541884829-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f18541884829-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-1\"><span class=\"crayon-c\">#函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f18541884829-2\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">active_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回当前线程对象Thread的个数</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-3\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回当前运行的线程对象Thread(包括后台的)的list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f18541884829-4\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Condition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回条件变量对象的工厂函数, 主要用户线程的并发</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-5\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">current_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回当前的线程对象Thread, 文档后面解释没看懂</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f18541884829-6\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#返回一个新的锁对象, 是在thread模块的基础上实现的 与acquire()和release()结合使用</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f18541884829-8\"><span class=\"crayon-c\">#类</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-9\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#一个表示线程控制的类, 这个类常被继承</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f18541884829-10\"><span class=\"crayon-v\">thraeding</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Timer</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#定时器,线程在一定时间后执行</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f18541884829-11\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ThreadError</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#引发中各种线程相关异常</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3>2.1.1. Thread对象</h3>\n<blockquote><p>一般来说，使用线程有两种模式, 一种是创建线程要执行的函数, 把这个函数传递进Thread对象里，让它来执行. 另一种是直接从Thread继承，创建一个新的class，把线程执行的代码放到这个新的class里。</p></blockquote>\n<p>常用两种方式运行线程(线程中包含name属性) :</p>\n<ul>\n<li>在构造函数中传入用于线程运行的函数(这种方式更加灵活)</li>\n<li>在子类中重写threading.Thread基类中run()方法(<strong>只重写__init__()和run()方法</strong>)</li>\n</ul>\n<p>创建线程对象后, 通过调用start()函数运行线程, 然后会自动调用<strong>run()</strong>方法.</p>\n<blockquote><p>　通过设置｀daemon｀属性, 可以将线程设置为守护线程</p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f1d697988099\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nthreading.Thread(group = None, target = None, name = None, args = () kwars = {})\r\ngroup : 应该为None\r\ntarget : 可以传入一个函数用于run()方法调用,\r\nname : 线程名 默认使用\"Thread-N\"\r\nargs : 元组, 表示传入target函数的参数\r\nkwargs : 字典, 传入target函数中关键字参数\r\n\r\n属性:\r\nname  #线程表示, 没有任何语义\r\ndoemon  #布尔值, 如果是守护线程为True, 不是为False, 主线程不是守护线程, 默认threading.Thread.damon = False\r\n\r\n类方法: \r\nrun()  #用以表示线程活动的方法。\r\nstart()  #启动线程活动。\r\njoin([time])  #等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。\r\nisAlive(): 返回线程是否活动的。\r\ngetName(): 返回线程名。\r\nsetName(): 设置线程名。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f1d697988099-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f1d697988099-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-1\"><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">group</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kwars</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-2\"><span class=\"crayon-v\">group</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>应该为<span class=\"crayon-t\">None</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-3\"><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>可以传入一个函数用于<span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>方法调用<span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-4\"><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>线程名<span class=\"crayon-h\"> </span>默认使用<span class=\"crayon-s\">\"Thread-N\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-5\"><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>元组<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>表示传入<span class=\"crayon-i\">target</span>函数的参数</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-6\"><span class=\"crayon-v\">kwargs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>字典<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>传入<span class=\"crayon-i\">target</span>函数中关键字参数</div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-8\">属性<span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-9\"><span class=\"crayon-v\">name</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#线程表示, 没有任何语义</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-10\"><span class=\"crayon-v\">doemon</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#布尔值, 如果是守护线程为True, 不是为False, 主线程不是守护线程, 默认threading.Thread.damon = False</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-12\">类方法<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-13\"><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#用以表示线程活动的方法。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-14\"><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#启动线程活动。</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-15\"><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-16\"><span class=\"crayon-e\">isAlive</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>返回线程是否活动的。</div><div class=\"crayon-line\" id=\"crayon-59d04becd7f1d697988099-17\"><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>返回线程名。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f1d697988099-18\"><span class=\"crayon-e\">setName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>设置线程名。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>范例:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f21571730813\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport threading\r\nimport time\r\n\r\ndef test_thread(count) :\r\n    while count &gt; 0 :\r\n        print \"count = %d\" % count\r\n        count = count - 1\r\n        time.sleep(1)\r\n\r\ndef main() :\r\n    my_thread = threading.Thread(target = test_thread, args = (10, ))\r\n    my_thread.start()\r\n    my_thread.join()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f21571730813-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f21571730813-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-7\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test_thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"count = %d\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-13\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test_thread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f21571730813-18\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f21571730813-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p></p>\n<h2>2.2. 常用多线程写法</h2>\n<ul>\n<li>固定线程运行的函数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f24470272502\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport threading, thread\r\nimport time\r\n\r\n\r\nclass MyThread(threading.Thread):\r\n    \"\"\"docstring for MyThread\"\"\"\r\n\r\n    def __init__(self, thread_id, name, counter) :\r\n        super(MyThread, self).__init__()  #调用父类的构造函数 \r\n        self.thread_id = thread_id\r\n        self.name = name\r\n        self.counter = counter\r\n\r\n    def run(self) :\r\n        print \"Starting \" + self.name\r\n        print_time(self.name, self.counter, 5)\r\n        print \"Exiting \" + self.name\r\n\r\ndef print_time(thread_name, delay, counter) :\r\n    while counter :\r\n        time.sleep(delay)\r\n        print \"%s %s\" % (thread_name, time.ctime(time.time()))\r\n        counter -= 1\r\n\r\ndef main():\r\n    #创建新的线程\r\n    thread1 = MyThread(1, \"Thread-1\", 1)\r\n    thread2 = MyThread(2, \"Thread-2\", 2)\r\n\r\n    #开启线程\r\n    thread1.start()\r\n    thread2.start()\r\n\r\n\r\n    thread1.join()\r\n    thread2.join()\r\n    print \"Exiting Main Thread\"\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f24470272502-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f24470272502-43\">43</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-8\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"docstring for MyThread\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thread_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#调用父类的构造函数 </span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">thread_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">thread_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-15\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">counter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-17\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Starting \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-19\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Exiting \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-22\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"%s %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ctime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-28\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#创建新的线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Thread-1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Thread-2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-32\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#开启线程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-36\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">thread2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Exiting Main Thread\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f24470272502-42\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f24470272502-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0125 seconds] -->\r\n<p></p>\n<ul>\n<li>外部传入线程运行的函数</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f28992803325\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#/usr/bin/env python\r\n# -*- coding: utf-8 -*-\r\nimport threading\r\nimport time\r\n\r\nclass MyThread(threading.Thread):\r\n    \"\"\"\r\n    属性:\r\n    target: 传入外部函数, 用户线程调用\r\n    args: 函数参数\r\n    \"\"\"\r\n    def __init__(self, target, args):\r\n        super(MyThread, self).__init__()  #调用父类的构造函数 \r\n        self.target = target\r\n        self.args = args\r\n\r\n    def run(self) :\r\n        self.target(self.args)\r\n\r\ndef print_time(counter) :\r\n    while counter :\r\n        print \"counter = %d\" % counter\r\n        counter -= 1\r\n        time.sleep(1)\r\n\r\ndef main() :\r\n    my_thread = MyThread(print_time, 10)\r\n    my_thread.start()\r\n    my_thread.join()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f28992803325-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f28992803325-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-1\"><span class=\"crayon-c\">#/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-2\"><span class=\"crayon-c\"># -*- coding: utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-6\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-8\"><span class=\"crayon-s\">    属性:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-9\"><span class=\"crayon-s\">    target: 传入外部函数, 用户线程调用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-10\"><span class=\"crayon-s\">    args: 函数参数</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-11\"><span class=\"crayon-s\">    \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">target</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">MyThread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#调用父类的构造函数 </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">target</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">target</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-15\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-16\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-17\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">target</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-20\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"counter = %d\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">counter</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-23\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-26\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">print_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">my_thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-30\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f28992803325-31\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f28992803325-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p></p>\n<h2>2.3. 生产者消费者问题</h2>\n<blockquote><p>试着用python写了一个生产者消费者问题(伪生产者消费者), 只是使用简单的锁, 感觉有点不太对, 下面另一个程序会写出正确的生产者消费者问题</p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f2c112203253\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport thread, threading\r\nimport urllib2\r\nimport time, random\r\nimport Queue\r\n\r\nshare_queue = Queue.Queue()  #共享队列\r\nmy_lock = thread.allocate_lock()\r\nclass Producer(threading.Thread) :\r\n\r\n    def run(self) :\r\n        products = range(5)\r\n        global share_queue\r\n        while True :\r\n            num = random.choice(products)\r\n            my_lock.acquire()\r\n            share_queue.put(num)\r\n            print  \"Produce : \", num\r\n            my_lock.release()\r\n            time.sleep(random.random())\r\n\r\nclass Consumer(threading.Thread) :\r\n\r\n    def run(self) :\r\n        global share_queue\r\n        while True:\r\n            my_lock.acquire()\r\n            if share_queue.empty() : #这里没有使用信号量机制进行阻塞等待, \r\n                print \"Queue is Empty...\"  \r\n                my_lock.release()\r\n                time.sleep(random.random())\r\n                continue\r\n            num = share_queue.get()\r\n            print \"Consumer : \", num\r\n            my_lock.release()\r\n            time.sleep(random.random())\r\n\r\ndef main() :\r\n    producer = Producer()\r\n    consumer = Consumer()\r\n    producer.start()\r\n    consumer.start()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f2c112203253-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f2c112203253-47\">47</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-9\"><span class=\"crayon-v\">share_queue</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#共享队列</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-10\"><span class=\"crayon-v\">my_lock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">allocate_lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Producer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">products</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">share_queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-16\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">products</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">my_lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">share_queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">put</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"Produce : \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-21\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">my_lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-24\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Consumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">share_queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-28\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-29\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">my_lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-30\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">share_queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#这里没有使用信号量机制进行阻塞等待, </span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-31\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Queue is Empty...\"</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-32\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">my_lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-33\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">share_queue</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Consumer : \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-37\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">my_lock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-39\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-40\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">producer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Producer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">consumer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Consumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">producer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">consumer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f2c112203253-46\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f2c112203253-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0078 seconds] -->\r\n<p>杀死多线程程序方法: 使用<strong>control + z</strong>挂起程序(程序依然在后台, 可以使用<strong>ps aux</strong>查看), 获得程序的进程号, 然后使用<strong>kill -9 进程号</strong>杀死进程</p>\n<blockquote><p>参考一篇帖子解决了上述问题,重写了生产者消费者问题程序, 参考链接惯例放在最后.</p></blockquote>\n<p>使用了wait()和notify()解决</p>\n<blockquote><p>当然最简答的方法是直接使用<strong>Queue</strong>,Queue封装了Condition的行为, 如wait(), notify(), acquire(), 没看文档就这样, 使用了Queue竟然不知道封装了这些函数, 继续滚去看文档了</p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f30420786951\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*-\r\n\r\nimport threading\r\nimport random, time, Queue\r\n\r\nMAX_SIZE = 5\r\nSHARE_Q = []  #模拟共享队列\r\nCONDITION = threading.Condition()\r\n\r\nclass Producer(threading.Thread) :\r\n\r\n    def run(self) :\r\n        products = range(5)\r\n        global SHARE_Q\r\n        while True :\r\n            CONDITION.acquire()\r\n            if len(SHARE_Q) == 5 :\r\n                print \"Queue is full..\"\r\n                CONDITION.wait()\r\n                print \"Consumer have comsumed something\"\r\n            product = random.choice(products)\r\n            SHARE_Q.append(product)\r\n            print \"Producer : \", product\r\n            CONDITION.notify()\r\n            CONDITION.release()\r\n            time.sleep(random.random())\r\n\r\nclass Consumer(threading.Thread) :\r\n\r\n    def run(self) :\r\n        global SHARE_Q\r\n        while True:\r\n            CONDITION.acquire()\r\n            if not SHARE_Q :\r\n                print \"Queue is Empty...\"\r\n                CONDITION.wait()\r\n                print \"Producer have producted something\"\r\n            product = SHARE_Q.pop(0)\r\n            print \"Consumer :\", product\r\n            CONDITION.notify()\r\n            CONDITION.release()\r\n            time.sleep(random.random())\r\n\r\ndef main() :\r\n    producer = Producer()\r\n    consumer = Consumer()\r\n    producer.start()\r\n    consumer.start()\r\n\r\nif __name__ == '__main__':\r\n    main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f30420786951-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f30420786951-52\">52</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*-</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Queue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-7\"><span class=\"crayon-v\">MAX_SIZE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-8\"><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#模拟共享队列</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-9\"><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Condition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-10\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-11\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Producer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-12\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">products</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-16\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-19\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Queue is full..\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-21\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Consumer have comsumed something\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">product</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">products</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">product</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Producer : \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">product</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-25\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-28\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-29\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Consumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-30\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SHARE_Q</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-33\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-36\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Queue is Empty...\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Producer have producted something\"</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">product</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SHARE_Q</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Consumer :\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">product</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-41\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">CONDITION</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-44\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-45\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">producer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Producer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">consumer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Consumer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">producer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">consumer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-50\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f30420786951-51\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f30420786951-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0085 seconds] -->\r\n<p></p>\n<h2>2.4.简单锁</h2>\n<blockquote><p>如果只是简单的加锁解锁可以直接使用threading.Lock()生成锁对象, 然后使用acquire()和release()方法</p></blockquote>\n<p>例如:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f34270351746\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python\r\n# -*- coding:utf-8 -*- \r\n\r\nimport threading\r\nimport time\r\n\r\nclass MyThread(threading.Thread) :\r\n\r\n    def __init__(self, thread_id, name, counter) :\r\n        threading.Thread.__init__(self)\r\n        self.thread_id = thread_id\r\n        self.name = name\r\n        self.counter = counter\r\n\r\n    def run(self) :\r\n        #重写run方法, 添加线程执行逻辑, start函数运行会自动执行\r\n        print  \"Starting \" + self.name\r\n        threadLock.acquire() #获取所\r\n        print_time(self.name, self.counter, 3)\r\n        threadLock.release() #释放锁\r\n\r\ndef print_time(thread_name, delay, counter) :\r\n    while counter :\r\n        time.sleep(delay)\r\n        print \"%s %s\" % (thread_name, time.ctime(time.time()))\r\n        counter -= 1\r\n\r\nthreadLock = threading.Lock()\r\nthreads = [] #存放线程对象\r\n\r\nthread1 = MyThread(1, \"Thread-1\", 1)\r\nthread2 = MyThread(2, \"Thread-2\", 2)\r\n\r\n#开启线程\r\nthread1.start()\r\nthread2.start()\r\n\r\nfor t in threads :\r\n    t.join()  #等待线程直到终止\r\nprint \"Exiting Main Thread\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f34270351746-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f34270351746-40\">40</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-1\"><span class=\"crayon-c\">#!/usr/bin/env python</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-2\"><span class=\"crayon-c\"># -*- coding:utf-8 -*- </span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-6\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">thread_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">thread_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">thread_id</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-12\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">counter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">#重写run方法, 添加线程执行逻辑, start函数运行会自动执行</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"Starting \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">threadLock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#获取所</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">threadLock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#释放锁</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-22\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">print_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"%s %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thread_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ctime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-28\"><span class=\"crayon-v\">threadLock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">threading</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-29\"><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#存放线程对象</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-30\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-31\"><span class=\"crayon-v\">thread1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Thread-1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-32\"><span class=\"crayon-v\">thread2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyThread</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Thread-2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-34\"><span class=\"crayon-c\">#开启线程</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-35\"><span class=\"crayon-v\">thread1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-36\"><span class=\"crayon-v\">thread2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-38\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threads</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f34270351746-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#等待线程直到终止</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f34270351746-40\"><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Exiting Main Thread\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0100 seconds] -->\r\n<p></p>\n<h2>2.5. Condition</h2>\n<blockquote><p>如果是向生产者消费者类似的情形, 使用Condition类 或者直接使用<strong>Queue</strong>模块</p></blockquote>\n<p><strong>Condition</strong></p>\n<p>条件变量中有<strong>acquire()和release方法用来调用锁的方法</strong>, 有<strong>wait(), notify(), notifyAll()方法</strong>, 后面是三个方法必须在获取锁的情况下调用, 否则产生<strong>RuntimeError</strong>错误.</p>\n<ul>\n<li>当一个线程获得锁后, 发现没有期望的资源或者状态, 就会调用wait()阻塞, 并释放已经获得锁, 知道期望的资源或者状态发生改变</li>\n<li>当一个线程获得锁, 改变了资源或者状态, 就会调用notify()和notifyAll()去通知其他线程,</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f39808090806\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#官方文档中提供的生产者消费者模型\r\n# Consume one item\r\ncv.acquire()\r\nwhile not an_item_is_available():\r\n    cv.wait()\r\nget_an_available_item()\r\ncv.release()\r\n\r\n# Produce one item\r\ncv.acquire()\r\nmake_an_item_available()\r\ncv.notify()\r\ncv.release()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f39808090806-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f39808090806-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-1\"><span class=\"crayon-c\">#官方文档中提供的生产者消费者模型</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-2\"><span class=\"crayon-c\"># Consume one item</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-3\"><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-4\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">an_item_is_available</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-6\"><span class=\"crayon-e\">get_an_available_item</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-7\"><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-8\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-9\"><span class=\"crayon-c\"># Produce one item</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-10\"><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-11\"><span class=\"crayon-e\">make_an_item_available</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f39808090806-12\"><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f39808090806-13\"><span class=\"crayon-v\">cv</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becd7f3c466836136\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#threading.Condition类\r\nthread.Condition([lock])\r\n可选参数lock: 必须是Lock或者RLock对象, 并被作为underlying锁(悲观锁?), 否则, 会创建一个新的RLock对象作为underlying锁\r\n\r\n类方法:\r\nacquire()  #获得锁\r\nrelease()  #释放锁\r\nwait([timeout])  #持续等待直到被notify()或者notifyAll()通知或者超时(必须先获得锁),\r\n#wait()所做操作, 先释放获得的锁, 然后阻塞, 知道被notify或者notifyAll唤醒或者超时, 一旦被唤醒或者超时, 会重新获取锁(应该说抢锁), 然后返回\r\nnotify()  #唤醒一个wait()阻塞的线程.\r\nnotify_all()或者notifyAll()  #唤醒所有阻塞的线程</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f3c466836136-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f3c466836136-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f3c466836136-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f3c466836136-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becd7f3c466836136-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d04becd7f3c466836136-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-1\"><span class=\"crayon-c\">#threading.Condition类</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f3c466836136-2\"><span class=\"crayon-k \">thread</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Condition</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-3\">可选参数<span class=\"crayon-v\">lock</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>必须是<span class=\"crayon-i\">Lock</span>或者<span class=\"crayon-i\">RLock</span>对象<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>并被作为<span class=\"crayon-i\">underlying</span>锁<span class=\"crayon-sy\">(</span>悲观锁<span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>否则<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>会创建一个新的<span class=\"crayon-i\">RLock</span>对象作为<span class=\"crayon-i\">underlying</span>锁</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f3c466836136-4\"> </div><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-5\">类方法<span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f3c466836136-6\"><span class=\"crayon-e\">acquire</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#获得锁</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-7\"><span class=\"crayon-e\">release</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#释放锁</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f3c466836136-8\"><span class=\"crayon-e\">wait</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#持续等待直到被notify()或者notifyAll()通知或者超时(必须先获得锁),</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-9\"><span class=\"crayon-c\">#wait()所做操作, 先释放获得的锁, 然后阻塞, 知道被notify或者notifyAll唤醒或者超时, 一旦被唤醒或者超时, 会重新获取锁(应该说抢锁), 然后返回</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becd7f3c466836136-10\"><span class=\"crayon-e\">notify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#唤醒一个wait()阻塞的线程.</span></div><div class=\"crayon-line\" id=\"crayon-59d04becd7f3c466836136-11\"><span class=\"crayon-e\">notify_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span>或者<span class=\"crayon-e\">notifyAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">#唤醒所有阻塞的线程</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<blockquote><p><strong>参考程序可以查看上面的生产者消费者程序</strong></p></blockquote>\n<h1>3. 参考链接</h1>\n<hr>\n<ul>\n<li><a href=\"http://en.wikipedia.org/wiki/Producer%E2%80%93consumer_problem\" target=\"_blank\">Producer–consumer problem</a></li>\n<li><a href=\"http://blog.jobbole.com/52412/\" target=\"_blank\">Python中的生产者消费者问题</a></li>\n<li><a href=\"http://www.w3cschool.cc/python/python-multithreading.html\" target=\"_blank\">Python多线程</a></li>\n<li><a href=\"https://docs.python.org/2/library/threading.html\" target=\"_blank\">threading官方文档</a></li>\n<li><a href=\"https://docs.python.org/2/library/thread.html#module-thread\" target=\"_blank\">thread官方文档</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88411\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88411votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88411\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "tags": "系列教程,多线程", "url_object_id": "ef8c45edb214567e87fc32a9efa39580", "praise_nums": "1", "url": "http://python.jobbole.com/88411/", "title": "Python 爬虫 (四) --多线程", "create_date": "2017/08/27", "comment_nums": 1}
{"fav_nums": 6, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://codeburst.io/creating-a-full-stack-web-application-with-python-npm-webpack-and-react-beauty-and-495bfdf11841\">Angela Juvet Branæs</a>   译文出处：<a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010942617\">疯狂的技术宅</a>   </div><p>如果你遵循前面的教程中的步骤，现在应该有了一个可以工作的全栈Web应用程序框架。</p>\n<p>点击直达前文 &gt;&gt; <a href=\"http://python.jobbole.com/88394/\">【译】一个小时搭建一个全栈Web应用框架(上)</a></p>\n<p>如果没有，但还是要继续学习本教程，可以到我的GitHub页面<a href=\"https://github.com/angineering/FullStackTemplate\">下载代码</a>。</p>\n<p>对于下一个魔术，我们将把一个显示“Hello World！”的简单静态页面转换成一个漂亮的单页面WEB应用。 这个页面能够与后端通信，并且在收到新信息时立即更新，而无需用户刷新页面。我们即将创建的页面，在每次点击按钮时，会以随机的欧洲语言返回“Hello”。</p>\n<p>这是我们的页面：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/0c2f5fb2cc343b0a16533a044fa6e8e4.png\"><img class=\"aligncenter size-full wp-image-88499\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0c2f5fb2cc343b0a16533a044fa6e8e4.png\" alt=\"2372598012-59a77c7d2a7de_articlex\"></a></p>\n<p><strong>为了能够实现这一点，我们需要先弄清楚以下的问题：</strong></p>\n<ol>\n<li>每次调用 <strong>/hello</strong> 端点时，如何返回一个随机的欧洲语言“Hello”。</li>\n<li>如何从服务器请求信息。</li>\n<li>如何将返回的信息无缝显示给用户，从而无需刷新页面。</li>\n<li>如何在页面上添加样式，可以在页面上创建一个大的居中的按钮并添加文本。</li>\n<li>最后，我们必须搞清楚应该如何添加一个背景图像。</li>\n</ol>\n<h1>从服务器返回随机语言的“Hello”</h1>\n<p>每当我们与服务器上的 <strong>/hello</strong> 端点进行通话时，为了能够请求一个随机的欧洲语言“Hello”，必须更改 server/server.py 文件中的功能。每次调用它时，都不会返回静态的“Hello World”，而是从“Hello”列表中选择一个随机语言的“Hello”。为了实现这个功能，需要进行以下更改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dac078115122\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport random\r\ndef get_hello():\r\n  greeting_list = [‘Ciao’, ‘Hei’, ‘Salut’, ‘Hola’, ‘Hallo’, ‘Hej’]\r\n  return random.choice(greeting_list)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dac078115122-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dac078115122-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dac078115122-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dac078115122-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dac078115122-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dac078115122-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dac078115122-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">greeting_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span>‘<span class=\"crayon-i\">Ciao</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">Hei</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">Salut</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">Hola</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">Hallo</span>’<span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-i\">Hej</span>’<span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dac078115122-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">greeting_list</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这个函数定义了一个欧洲语言的“hello”列表， 然后我们调用这个函数时，使用 <strong>random.choice()</strong>从列表中随机选择一个项目。</p>\n<p>修改 <strong>hello()</strong> 函数，以便在每次调用它时返回<strong>get_hello()</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6db6530029786\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@app.route(\"/hello\")\r\ndef hello():\r\n  return get_hello()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6db6530029786-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6db6530029786-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6db6530029786-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6db6530029786-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/hello\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6db6530029786-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6db6530029786-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>修改 <strong>/hello</strong> 以返回我们感兴趣的信息，我们现在需要弄清楚如何从前端得到这些信息。</p>\n<h1>组件化的重要性 – 在 React 中创建一个Hello类</h1>\n<p>把问题分解被认为是良好的编程习惯。 只要有可能，你应该尽量使自己的函数只做一件事情，并且做好。这点同样适用于类。你可以考虑将每个函数或类都作为单独的组件。</p>\n<p>React是为组件化而设计的。这意味着它是用多个较小的部分来构建你的网站的。就像玩乐高一样，可以轻松地将一个组件替换成另外一个，也可以复用组件，这也能帮助其他开发人员了解你的代码。我们应该努力的编写可理解的代码，因为这样可以使我们的程序更容易维护和扩展。</p>\n<p>考虑到组件化，我们创建一个 <strong>Hello</strong> 类来处理我们网页上的问候语。该类将从服务器上的 /hello 端点点获取一个 “Hello” ，并将其显示给用户。 它也应该有一个“name”参数，这样就可以向某个具体的人进行问候。</p>\n<p>通过更改 React App 类中的render函数，使其调用<strong>Hello</strong>类，我们就可以很快的完成功能，而不是使用旧的代码。传递名称“Rimini”作为参数。出于结构化的目的，我们将把<strong>Hello</strong>类放在一个 <strong>PageHeader</strong> 中。</p>\n<h1>创建Hello类</h1>\n<p>前面我们修改了 <strong>App</strong> 类使其能够调用 <strong>hello</strong> 类, 接下来需要创建 <strong>Hello</strong> 类。在 <strong>js/</strong> 目录下创建一个名为 <strong>hello.jsx</strong> 的文件, 在此文件中定义一个名为 <strong>hello</strong> 的类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dbb946927007\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nexport default class Hello extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {greeting: 'Hello ' + this.props.name};\r\n    // This binding is necessary to make `this` work in the callback    \r\n    this.getPythonHello = this.getPythonHello.bind(this);\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dbb946927007-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dbb946927007-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dbb946927007-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dbb946927007-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dbb946927007-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dbb946927007-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dbb946927007-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dbb946927007-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dbb946927007-1\"><span class=\"crayon-e\">export </span><span class=\"crayon-e\">default </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Hello </span><span class=\"crayon-e\">extends </span><span class=\"crayon-v\">React</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">Component</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dbb946927007-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">constructor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dbb946927007-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dbb946927007-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">state</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">greeting</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hello '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dbb946927007-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">This </span><span class=\"crayon-e\">binding </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">necessary </span><span class=\"crayon-e\">to </span><span class=\"crayon-i\">make</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">work </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">callback    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dbb946927007-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">getPythonHello</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">getPythonHello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dbb946927007-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dbb946927007-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p></p>\n<h1>组件与道具</h1>\n<p>在这一点上，你可能对构造函数中发生了什么有很多疑问。</p>\n<p>在 React 中有一种叫做组件和道具的东西。 Props是创建时传递给构造函数的不可变参数。 道具是公开的，修改他们将违反 React 的基本使用原则。状态是内部的，可变的。每次更新状态时，都会在UI中重新展现。如果希望更深入地了解其运作方式，我强烈建议你阅读React文档中有关<a href=\"https://facebook.github.io/react/docs/state-and-lifecycle.html\">生命周期和状态</a>的部分。</p>\n<p>我们将在<strong>Hello</strong>类中添加一个名<strong>为personaliseGreeting()</strong> 的函数。 当我们点击按钮获得一个新的问候语时，它将会处理网页上的问候语的更新操作。 请注意，我们使用<strong>this.setState()</strong>与名为“greeting”的key。你必须使用这个语法才能让 React 自动刷新网页上的“greeting”状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dc0286552192\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npersonaliseGreeting(greeting) {\r\n  this.setState({greeting: greeting + ' ' + this.props.name + '!'});\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc0286552192-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dc0286552192-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc0286552192-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dc0286552192-1\"><span class=\"crayon-e\">personaliseGreeting</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">greeting</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dc0286552192-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">greeting</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">greeting</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">' '</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'!'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dc0286552192-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h1>渲染问候语</h1>\n<p>为了让问候语出现在页面上，必须在<strong>render</strong>函数中调用<strong>“{this.state.greeting}”</strong>。我们还必须添加一个带有回调函数的按钮，这个函数叫做<strong>getPythonHello()</strong>，我们很快就会实现它。这个函数在调用使用Python编写的后端时，将会得到一个新的“Hello”。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dc3805219227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrender () {\r\n  return (\r\n    &lt;h1&gt;{this.state.greeting}&lt;/h1&gt;\r\n    &lt;hr/&gt;\r\n    &lt;Button bsSize=\"large\" bsStyle=\"danger\" onClick={this.getPythonHello}&gt;\r\n      Say Hello!\r\n    &lt;/Button&gt;\r\n  )\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc3805219227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dc3805219227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc3805219227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dc3805219227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc3805219227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dc3805219227-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc3805219227-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dc3805219227-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc3805219227-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dc3805219227-1\"><span class=\"crayon-e\">render</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dc3805219227-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dc3805219227-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">h1</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">greeting</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">h1</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dc3805219227-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">hr</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dc3805219227-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">Button </span><span class=\"crayon-v\">bsSize</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"large\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bsStyle</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"danger\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">onClick</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">getPythonHello</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dc3805219227-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">Say </span><span class=\"crayon-v\">Hello</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dc3805219227-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Button</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dc3805219227-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dc3805219227-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>请注意，我已经将标题和按钮HTML内嵌到了我的代码中，所以可以很轻松地控制他们在页面上的最终位置。</p>\n<h1>绑定“this”</h1>\n<p>因为JavaScript中的类方法没有做默认绑定，所以当我们想在函数回调中使用“this”时，就必须在构造函数中创建一个绑定。否则“this”将会是 undefined 的。 这适用于在 JavaScript 中<a href=\"https://facebook.github.io/react/docs/handling-events.html\">调用<strong>without()</strong> </a>的情况。一个典型的例子就是 <strong>render()</strong> 中的 <strong>“onClick = {this.getPythonHello}”</strong>。</p>\n<h2>从服务器请求信息</h2>\n<p>React 没有提供执行HTTP请求的内置方式。为了能够从服务器请求信息，我们将不得不找一个可以做这件事的库。 一个最简单的方法就是引入 jQuery 库。jQuery 是一个 javascript 库，通过在$符号后面提供缩写函数来简化标准的 JavaScript 功能。</p>\n<p>首先安装jQuery依赖关系：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dc7674850756\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm i jquery --save-dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dc7674850756-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dc7674850756-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jquery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">save</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>将 jQuery 依赖添加到要使用的 React 文件中，也就是 Hello.jsx 中。应该将此依赖添加到 <strong>Hello</strong> 类的定义前面。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dcb698431767\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar $ = require(‘jquery’);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dcb698431767-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dcb698431767-1\"><span class=\"crayon-i\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span>‘<span class=\"crayon-i\">jquery</span>’<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>将查询依赖添加到React文件中意味着可以在自己的React代码中使用标准的 jQuery 函数，只要它们以我们刚刚定义的“$”变量开始。下面让我们用它来从服务器获取一个“Hello”。</p>\n<p>我们将使用 HTTP 协议的 GET 请求获取信息。GET 实质上是HTTP请求的“只读”模式。可以用来获取信息，但是不能要求服务器更改它。</p>\n<p>在 hello.jsx 文件中的<strong>Hello</strong>类中添加以下函数:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dce103191257\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ngetPythonHello() {\r\n  $.get(window.location.href + 'hello', (data) =&gt; {  \r\n    console.log(data);\r\n    this.personaliseGreeting(data);\r\n  });\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dce103191257-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dce103191257-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dce103191257-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dce103191257-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dce103191257-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dce103191257-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dce103191257-1\"><span class=\"crayon-e\">getPythonHello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dce103191257-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">window</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">location</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dce103191257-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">console</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dce103191257-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">personaliseGreeting</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dce103191257-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dce103191257-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>此函数通过jQuery 的 GET请求，连接 <strong>/hello</strong> 端点。然后得到从服务器返回的一个欧洲语言的“hello”信息，再它打印到浏览器的开发控制台，最后将它传递给<strong>Hello</strong>类中的另一个函数，调用 <strong>personaliseGreeting()</strong>。</p>\n<p>当 rebuild 前端代码（npm run watch），并重新启动 python 服务器后。 应该能看到以下内容：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e483fd5cb5168ea33cf6cc4b6cc0960.png\"><img class=\"aligncenter size-full wp-image-88500\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e483fd5cb5168ea33cf6cc4b6cc0960.png\" alt=\"2372598012-59a77c7d2a7de_articlex\"></a></p>\n<p> </p>\n<p><em>有一行问候语，一个按钮，点击按钮可以更改问候语。 这个页面看起来很不错，因为我们在index.html中包含了Bootstrap样式。</em></p>\n<h1>使用CSS样式美化页面</h1>\n<p>我们终于有了一个能够与用户交互的产品。如果我们愿意，就可以到此为止了，并对自己说：我对这些成就感到满意。不过就我个人而言，我更喜欢在我的Web应用中添加一些设计元素，让他们变得更加漂亮。所以，<strong>我们将用<a href=\"https://www.w3schools.com/css/\">CSS</a>使标题能够覆盖整个屏幕，而不是在页面的顶部。</strong>CSS是为HTML设计的一种样式语言，它的作用相当于在Word文档中更改字体大小，样式和位置。</p>\n<h2>使 Webpack 能够处理 CSS</h2>\n<p>为了能够在我们的WEB应用中使用CSS，必须安装一些加载器和插件，并将它们添加到Webpack配置文件中。这是因为 Webpack 默认只能处理JavaScript。</p>\n<p>安装下列插件：</p>\n<ul>\n<li>css-loader</li>\n<li>style-loader</li>\n<li>extract-text-webpack-plugin</li>\n</ul>\n<p>css-loader 和 style-loader 能够使 Webpack 处理 CSS。 通过添加这些加载器，Webpack 将能够将我们需要的任何 CSS 绑定到 bundle.js 中。 不过在这里存在一个问题，JavaScript 和 CSS 将不会在你的页面上单独进行加载，这可能导致 UI 组件在 JavaScript 加载之前无法显示。这点很差劲，因为在糟糕的网络上，我们辛辛苦苦设计出来的页面可能会加载的非常缓慢。</p>\n<p>不过可以通过添加 extract-text-webpack-plugin 来解决这个问题。 这个插件能够将 CSS 分解成一个单独的包，我们可以把它附加到 HTML 上。 这样就可以使 CSS 再次独立于 JavaScript 进行加载。</p>\n<p>在你的<strong>webpack.config.js</strong>文件的 <strong>modules.rules</strong> 部分添加下面的CSS规则：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dd3422858364\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  test: /\\.css$/,\r\n  use: ExtractTextPlugin.extract({\r\n         fallback: 'style-loader',\r\n         use: 'css-loader',\r\n       })\r\n},</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dd3422858364-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dd3422858364-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dd3422858364-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dd3422858364-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dd3422858364-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dd3422858364-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dd3422858364-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dd3422858364-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dd3422858364-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">test</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">css</span><span class=\"crayon-sy\">$</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dd3422858364-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">use</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ExtractTextPlugin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dd3422858364-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">fallback</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'style-loader'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dd3422858364-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">use</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'css-loader'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dd3422858364-6\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dd3422858364-7\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>将ExtractTextPlugin插件添加到 <strong>webpack.config.js</strong>（<a href=\"https://github.com/angineering/FullStackTemplate/blob/master/fullstack_template/static/webpack.config.js\">如果您感到困惑，请查看我的 webpack 文件</a>）。注意，在创建时，需要将捆绑的CSS文件名传给此插件。我们将调用文件’styles.css’。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dd6294449754\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nplugins: [ new ExtractTextPlugin('styles.css') ]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dd6294449754-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dd6294449754-1\"><span class=\"crayon-v\">plugins</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ExtractTextPlugin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'styles.css'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>最后，我们需要将 styles.css 包添加到<strong>index.html</strong>中，以确保样式被加载。将以下行添加到你的<strong>index.html</strong>文件中的 head 部分（<a href=\"https://github.com/angineering/FullStackTemplate/blob/master/fullstack_template/static/index.html\">可以参考我的代码</a>）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dda047538421\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;link rel=\"stylesheet\" href=\"dist/styles.css\"&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dda047538421-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dda047538421-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">link </span><span class=\"crayon-v\">rel</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"stylesheet\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"dist/styles.css\"</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h2>添加CSS规则</h2>\n<p>现在可以确保我们的设置可以正确处理CSS了，我们将在css文件夹中创建一个名为fullstack.css 的文件。我已经添加了几个不同的规则，以确保文本和按钮出现在正确的位置，并且文本是大号的细体。</p>\n<p>这是我的 fullstack.css 文件中的一个规则。 它使 “Hello Rimini” 文本变得越来越细：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dde789249063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.header-contents h1 { \r\n    font-size: 120px; \r\n    font-weight: 300;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dde789249063-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dde789249063-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dde789249063-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6dde789249063-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dde789249063-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">header</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">contents</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">h1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dde789249063-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120px</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6dde789249063-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">weight</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6dde789249063-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>在创建 fullstack.css 文件之后，我们需要将它添加到使用规则的 React 组件中，这样它们才能生效。由于标题在 App.jsx 中定义，所以需要添加以下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6de1844352009\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrequire('../css/fullstack.css');</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6de1844352009-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6de1844352009-1\"><span class=\"crayon-e\">require</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../css/fullstack.css'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>fullstack.css 文件中的标题样式现在将由 Webpack 拾取，并绑定到 styles.css 文件中。当我们刷新页面时，应该如下图所示。注意，如果你用的浏览器不是 Chrome 的话，字体可能和图中不一样：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/09d50f28eba916bc7796a5ed8761abb6.png\"><img class=\"aligncenter size-full wp-image-88501\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/09d50f28eba916bc7796a5ed8761abb6.png\" alt=\"2372598012-59a77c7d2a7de_articlex\"></a></p>\n<p> </p>\n<p><em>被CSS装饰后的页面</em></p>\n<h1>完成 – 添加背景图</h1>\n<p>Webpack 本身并不理解图像的概念。因此，我们还需要添加一个可以在Web应用程序中使用它们的加载程序。我们需要安装名为“file-loader”的loader。</p>\n<p>安装 file-loader：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6de4349014367\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ npm i file-loader --save-dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6de4349014367-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6de4349014367-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">npm</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">file</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">loader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">save</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>将file-loader规则添加到 webpack.config.js 文件中的modules.rules部分：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6de8217245157\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  test: /\\.(png|svg|jpg|gif)$/,\r\n  use: 'file-loader'\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6de8217245157-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6de8217245157-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6de8217245157-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6de8217245157-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6de8217245157-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6de8217245157-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-k \">test</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">png</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">svg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">jpg</span><span class=\"crayon-o\">|</span><span class=\"crayon-v\">gif</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6de8217245157-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">use</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'file-loader'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6de8217245157-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>将要使用的图像添加到images/ folder。将其命名为“header.jpg”。</p>\n<p>为了能够使图像成为网页头部的背景，我们需要将其作为背景图像添加到 <a href=\"https://github.com/angineering/FullStackTemplate/blob/master/fullstack_template/static/css/fullstack.css\">fullstack.css</a> 文件的页眉部分。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6deb418996720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.page-header {\r\n  background-image: url('../images/header.jpg');\r\n  background-repeat: no-repeat;\r\n  background-position: center;\r\n  background-size: cover;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6deb418996720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6deb418996720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6deb418996720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6deb418996720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6deb418996720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6deb418996720-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6deb418996720-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">page</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">header</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6deb418996720-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">image</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'../images/header.jpg'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6deb418996720-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repeat</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">repeat</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6deb418996720-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">position</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">center</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6deb418996720-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cover</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6deb418996720-6\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>接下来要做的是把图像加载到使用它的 React 文件中。如果没有在 React 中显式加载图片，Webpack 将不会棒的它，也不会把它显示在页面上。这种行为不是很直观，在我第一次在自己的应用中添加一个背景图像时，曾经犯过这个错误。</p>\n<p>在App.jsx中进行如下更改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6dee237752991\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport HeaderBackgroundImage from '../images/header.jpg';</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6dee237752991-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6dee237752991-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HeaderBackgroundImage </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'../images/header.jpg'</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>将此函数添加到你的App类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6df2339291982\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\naddHeaderImg() {\r\n  let headerBg = new Image();\r\n  headerBg.src = HeaderBackgroundImage;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6df2339291982-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6df2339291982-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d04becc6df2339291982-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d04becc6df2339291982-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6df2339291982-1\"><span class=\"crayon-e\">addHeaderImg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6df2339291982-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">headerBg</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Image</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59d04becc6df2339291982-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">headerBg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">src</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HeaderBackgroundImage</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d04becc6df2339291982-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这个函数创建了一个新的Image对象，并将源设置为你的标题图片。</p>\n<p>我们需要做的最后一件事是，确保在渲染页面时加载图像。 这意味着我们必须在<strong>render()</strong>函数中调用 addHeaderImg()函数。</p>\n<p>将下列代码添加到<strong>render()</strong>函数中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d04becc6df5044555135\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{this.addHeaderImg()}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d04becc6df5044555135-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d04becc6df5044555135-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeaderImg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>刷新浏览器窗口时，应该看到以下内容：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/de5c4bebc428bbe28a54470eda69fac3.png\"><img class=\"aligncenter size-full wp-image-88502\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/de5c4bebc428bbe28a54470eda69fac3.png\" alt=\"2372598012-59a77c7d2a7de_articlex\"></a></p>\n<p><em>恭喜你！你已成功创建了一个全栈 Web 应用程序！</em></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88498\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88498votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88498\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/0c2f5fb2cc343b0a16533a044fa6e8e4.png"], "tags": "实践项目,web开发", "url_object_id": "be517e719d2bb08ebf63ddc49102515a", "praise_nums": "2", "url": "http://python.jobbole.com/88498/", "title": "一个小时搭建一个全栈 Web 应用框架（下）——美化与功能", "create_date": "2017/09/05", "comment_nums": 0}
{"fav_nums": 21, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010473819\">hang</a>   </div><h1>简介</h1>\n<p><strong>刚接触python不久，做一个小项目来练练手。前几天看了《战狼2》，发现它在最新上映的电影里面是排行第一的，如下图所示。准备把豆瓣上对它的影评做一个分析。</strong><br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png\"><img class=\"aligncenter wp-image-88326 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"631\" height=\"332\"></a></p>\n<h1>目标总览</h1>\n<p>主要做了三件事：</p>\n<ul>\n<li>抓取网页数据</li>\n<li>清理数据</li>\n<li>用词云进行展示<br>\n使用的python版本是3.5.</li>\n</ul>\n<h2>一、抓取网页数据</h2>\n<p><strong>第一步要对网页进行访问，python中使用的是urllib库。代码如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c05164c552045294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom urllib import request\r\nresp = request.urlopen('https://movie.douban.com/nowplaying/hangzhou/')\r\nhtml_data = resp.read().decode('utf-8')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c05164c552045294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c05164c552045294-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c05164c552045294-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c05164c552045294-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c05164c552045294-2\"><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'https://movie.douban.com/nowplaying/hangzhou/'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c05164c552045294-3\"><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>其中<a href=\"https://movie.douban.com/nowplaying/hangzhou/\">https://movie.douban.com/nowp…</a>是豆瓣最新上映的电影页面，可以在浏览器中输入该网址进行查看。</p>\n<p>html_data是字符串类型的变量，里面存放了网页的html代码。<br>\n输入<span style=\"color: #ff0000\"><strong>print(html_data)</strong></span>可以查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/5c8197f4552247a94732373f359df514.png\"><img class=\"aligncenter wp-image-88327 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5c8197f4552247a94732373f359df514.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"596\" height=\"251\"></a></p>\n<p><strong>第二步，需要对得到的html代码进行解析，得到里面提取我们需要的数据。</strong><br>\n在python中使用BeautifulSoup库进行html代码的解析。<br>\n（注：如果没有安装此库，则使用<span style=\"color: #ff0000\"><strong>pip install BeautifulSoup</strong></span>进行安装即可！）<br>\nBeautifulSoup使用的格式如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051658913561015\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nBeautifulSoup(html,\"html.parser\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051658913561015-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051658913561015-1\"><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"html.parser\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>第一个参数为需要提取数据的html，第二个参数是指定解析器，然后使用<span style=\"color: #ff0000\"><strong>find_all()</strong></span>读取html标签中的内容。</p>\n<p>但是html中有这么多的标签，该读取哪些标签呢？其实，最简单的办法是我们可以打开我们爬取网页的html代码，然后查看我们需要的数据在哪个html标签里面，再进行读取就可以了。如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c9668d5c635cd363549238604d48a780.png\"><img class=\"aligncenter wp-image-88328 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c9668d5c635cd363549238604d48a780.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"428\" height=\"355\"></a></p>\n<p>从上图中可以看出在<strong><span style=\"color: #ff0000\">div id=”nowplaying</span>“</strong>标签开始是我们想要的数据，里面有电影的名称、评分、主演等信息。所以相应的代码编写如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c05165d771498100\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom bs4 import BeautifulSoup as bs\r\nsoup = bs(html_data, 'html.parser')    \r\nnowplaying_movie = soup.find_all('div', id='nowplaying')\r\nnowplaying_movie_list = nowplaying_movie[0].find_all('li', class_='list-item')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c05165d771498100-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c05165d771498100-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c05165d771498100-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c05165d771498100-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c05165d771498100-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c05165d771498100-2\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d044c05165d771498100-3\"><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'nowplaying'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c05165d771498100-4\"><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'li'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'list-item'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>nowplaying_movie_list </strong></span>是一个列表，可以用<span style=\"color: #000000\"><strong><span style=\"color: #ff0000\">print(nowplaying_movie_list[0]</span>)</strong></span>查看里面的内容，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa1ecd08775eb68490881bd69ec26722.png\"><img class=\"aligncenter wp-image-88329 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fa1ecd08775eb68490881bd69ec26722.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"400\"></a></p>\n<p>在上图中可以看到data-subject属性里面放了电影的id号码，而在img标签的alt属性里面放了电影的名字，因此我们就通过这两个属性来得到电影的id和名称。（注：打开电影短评的网页时需要用到电影的id，所以需要对它进行解析），编写代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051661111898307\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnowplaying_list = [] \r\nfor item in nowplaying_movie_list:        \r\n        nowplaying_dict = {}        \r\n        nowplaying_dict['id'] = item['data-subject']       \r\n        for tag_img_item in item.find_all('img'):            \r\n            nowplaying_dict['name'] = tag_img_item['alt']            \r\n            nowplaying_list.append(nowplaying_dict)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051661111898307-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051661111898307-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051661111898307-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051661111898307-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051661111898307-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051661111898307-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051661111898307-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051661111898307-1\"><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051661111898307-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051661111898307-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051661111898307-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data-subject'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051661111898307-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tag_img_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'img'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051661111898307-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tag_img_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'alt'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051661111898307-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>其中列表nowplaying_list中就存放了最新电影的id和名称，可以使用<span style=\"color: #ff0000\"><strong>print(nowplaying_list)</strong></span>进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9d5b868c1c8010ccf4506ce93024123.png\"><img class=\"aligncenter wp-image-88330 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9d5b868c1c8010ccf4506ce93024123.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"389\"></a></p>\n<p>可以看到和豆瓣网址上面是匹配的。这样就得到了最新电影的信息了。接下来就要进行对最新电影短评进行分析了。例如《战狼2》的短评网址为：<span style=\"color: #ff0000\"><strong>https://movie.douban.com/subject/26363254/comments?start=0&amp;limit=20</strong></span></p>\n<p>其中<span style=\"color: #ff0000\"><strong>26363254</strong></span>就是电影的id，<span style=\"color: #ff0000\"><strong>start=0</strong></span>表示评论的第0条评论。</p>\n<p>接下来接对该网址进行解析了。打开上图中的短评页面的html代码，我们发现关于评论的数据是在<span style=\"color: #ff0000\"><strong>div</strong></span>标签的<span style=\"color: #ff0000\"><strong>comment</strong></span>属性下面，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e22ca4bece5fdc49bbb57793044dc2e1.png\"><img class=\"aligncenter wp-image-88331 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e22ca4bece5fdc49bbb57793044dc2e1.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"560\" height=\"282\"></a></p>\n<p>因此对此标签进行解析，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051666998015715\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nrequrl = 'https://movie.douban.com/subject/' + nowplaying_list[0]['id'] + '/comments' +'?' +'start=0' + '&amp;limit=20' \r\nresp = request.urlopen(requrl) \r\nhtml_data = resp.read().decode('utf-8') \r\nsoup = bs(html_data, 'html.parser') \r\ncomment_div_lits = soup.find_all('div', class_='comment')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051666998015715-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051666998015715-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051666998015715-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051666998015715-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051666998015715-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051666998015715-1\"><span class=\"crayon-v\">requrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://movie.douban.com/subject/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/comments'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'start=0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&amp;limit=20'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051666998015715-2\"><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051666998015715-3\"><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051666998015715-4\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051666998015715-5\"><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'comment'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>此时在<span style=\"color: #ff0000\"><strong>comment_div_lits </strong></span>列表中存放的就是div标签和comment属性下面的html代码了。在上图中还可以发现在p标签下面存放了网友对电影的评论，如下图所示:</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/48a58e87311958ac0214afde471585fe.png\"><img class=\"aligncenter wp-image-88332 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/48a58e87311958ac0214afde471585fe.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"333\" height=\"24\"></a></p>\n<p>因此对<span style=\"color: #ff0000\"><strong>comment_div_lits </strong></span>代码中的html代码继续进行解析，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051669645356058\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\neachCommentList = []; \r\nfor item in comment_div_lits: \r\n        if item.find_all('p')[0].string is not None:     \r\n            eachCommentList.append(item.find_all('p')[0].string)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051669645356058-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051669645356058-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051669645356058-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051669645356058-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051669645356058-1\"><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051669645356058-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051669645356058-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051669645356058-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>使用<span style=\"color: #ff0000\"><strong>print(eachCommentList)</strong></span>查看eachCommentList列表中的内容，可以看到里面存里我们想要的影评。如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9be8902ec90675c7e87e857a8a520f4.png\"><img class=\"aligncenter wp-image-88333 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e9be8902ec90675c7e87e857a8a520f4.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"777\" height=\"52\"></a></p>\n<p>好的，至此我们已经爬取了豆瓣最近播放电影的评论数据，接下来就要对数据进行清洗和词云显示了。</p>\n<h1>二、数据清洗</h1>\n<p>为了方便进行数据进行清洗，我们将列表中的数据放在一个字符串数组中，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c05166d481811198\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncomments = ''\r\nfor k in range(len(eachCommentList)):\r\n    comments = comments + (str(eachCommentList[k])).strip()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c05166d481811198-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c05166d481811198-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c05166d481811198-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c05166d481811198-1\"><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c05166d481811198-2\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d044c05166d481811198-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>使用<span style=\"color: #ff0000\"><strong>print(comments)</strong></span>进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/13b063b5dfe4f22eeb86f794408219d3.png\"><img class=\"aligncenter wp-image-88334 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/13b063b5dfe4f22eeb86f794408219d3.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"57\"></a></p>\n<p>可以看到所有的评论已经变成一个字符串了，但是我们发现评论中还有不少的标点符号等。这些符号对我们进行词频统计时根本没有用，因此要将它们清除。所用的方法是正则表达式。python中正则表达式是通过re模块来实现的。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051671042572753\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport re\r\n\r\npattern = re.compile(r'[\\u4e00-\\u9fa5]+')\r\nfilterdata = re.findall(pattern, comments)\r\ncleaned_comments = ''.join(filterdata)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051671042572753-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051671042572753-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051671042572753-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051671042572753-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051671042572753-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051671042572753-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051671042572753-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051671042572753-3\"><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">compile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'[\\u4e00-\\u9fa5]+'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051671042572753-4\"><span class=\"crayon-v\">filterdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051671042572753-5\"><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>继续使用<span style=\"color: #ff0000\"><strong>print(cleaned_comments)</strong></span>语句进行查看，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/2b2a94bc16cc3b581407f49ca570a941.png\"><img class=\"aligncenter wp-image-88335 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/2b2a94bc16cc3b581407f49ca570a941.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"800\" height=\"84\"></a><br>\n我们可以看到此时评论数据中已经没有那些标点符号了，数据变得“干净”了很多。</p>\n<p>因此要进行词频统计，所以先要进行中文分词操作。在这里我使用的是结巴分词。如果没有安装结巴分词，可以在控制台使用<span style=\"color: #ff0000\"><strong>pip install jieba</strong></span>进行安装。（注：可以使用<span style=\"color: #ff0000\"><strong>pip list</strong></span>查看是否安装了这些库）。代码如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051675105430006\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport jieba    #分词包\r\nimport pandas as pd  \r\n\r\nsegment = jieba.lcut(cleaned_comments)\r\nwords_df=pd.DataFrame({'segment':segment})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051675105430006-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051675105430006-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051675105430006-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051675105430006-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051675105430006-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051675105430006-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#分词包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051675105430006-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd  </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051675105430006-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051675105430006-4\"><span class=\"crayon-v\">segment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lcut</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051675105430006-5\"><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>因为结巴分词要用到pandas，所以我们这里加载了pandas包。可以使用<span style=\"color: #ff0000\"><strong>words_df.head()</strong></span>查看分词之后的结果，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d2941e803004b245b40477ed9959a060.png\"><img class=\"aligncenter wp-image-88336 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d2941e803004b245b40477ed9959a060.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"107\" height=\"153\"></a></p>\n<p>从上图可以看到我们的数据中有“看”、“太”、“的”等虚词（停用词），而这些词在任何场景中都是高频时，并且没有实际的含义，所以我们要他们进行清除。</p>\n<p>我把停用词放在一个<span style=\"color: #ff0000\"><strong>stopwords.txt</strong></span>文件中，将我们的数据与停用词进行比对即可（注：只要在百度中输入<span style=\"color: #ff0000\"><strong>stopwords.txt</strong></span>，就可以下载到该文件）。去停用词代码如下代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051679954677411\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstopwords=pd.read_csv(\"stopwords.txt\",index_col=False,quoting=3,sep=\"\\t\",names=['stopword'], encoding='utf-8')#quoting=3全不引用\r\nwords_df=words_df[~words_df.segment.isin(stopwords.stopword)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051679954677411-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051679954677411-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051679954677411-1\"><span class=\"crayon-v\">stopwords</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stopwords.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index_col</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">quoting</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\t\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'stopword'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#quoting=3全不引用</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051679954677411-2\"><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stopword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>继续使用<span style=\"color: #ff0000\"><strong>words_df.head()</strong></span>语句来查看结果，如下图所示，停用词已经被出去了。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0c0eaacff86e9cf7026dd15f4559c8.png\"><img class=\"aligncenter wp-image-88337 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6a0c0eaacff86e9cf7026dd15f4559c8.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"113\" height=\"171\"></a></p>\n<p>接下来就要进行词频统计了，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c05167c434826113\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy    #numpy计算包\r\nwords_stat=words_df.groupby(by=['segment'])['segment'].agg({\"计数\":numpy.size})\r\nwords_stat=words_stat.reset_index().sort_values(by=[\"计数\"],ascending=False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c05167c434826113-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c05167c434826113-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c05167c434826113-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c05167c434826113-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numpy</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#numpy计算包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c05167c434826113-2\"><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">agg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">numpy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c05167c434826113-3\"><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reset_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>用<span style=\"color: #ff0000\"><strong>words_stat.head()</strong></span>进行查看，结果如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/04f72074b0acf979fafe97e6a3750e81.png\"><img class=\"aligncenter wp-image-88338 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/04f72074b0acf979fafe97e6a3750e81.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"153\" height=\"167\"></a></p>\n<p>由于我们前面只是爬取了第一页的评论，所以数据有点少，在最后给出的完整代码中，我爬取了10页的评论，所数据还是有参考价值。</p>\n<h1>三、用词云进行显示</h1>\n<p>代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051680699424762\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport matplotlib.pyplot as plt\r\n%matplotlib inline\r\nimport matplotlib\r\nmatplotlib.rcParams['figure.figsize'] = (10.0, 5.0)\r\nfrom wordcloud import WordCloud#词云包\r\n\r\nwordcloud=WordCloud(font_path=\"simhei.ttf\",background_color=\"white\",max_font_size=80) #指定字体类型、字体大小和字体颜色\r\nword_frequence = {x[0]:x[1] for x in words_stat.head(1000).values}\r\nword_frequence_list = []\r\nfor key in word_frequence:\r\n    temp = (key,word_frequence[key])\r\n    word_frequence_list.append(temp)\r\n\r\nwordcloud=wordcloud.fit_words(word_frequence_list)\r\nplt.imshow(wordcloud)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051680699424762-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051680699424762-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-2\"><span class=\"crayon-ta\">%</span><span class=\"crayon-i\">matplotlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inline</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">matplotlib</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-5\"><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rcParams</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'figure.figsize'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wordcloud </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WordCloud</span><span class=\"crayon-c\">#词云包</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-8\"><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">WordCloud</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">font_path</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"simhei.ttf\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">background_color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"white\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">max_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#指定字体类型、字体大小和字体颜色</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-9\"><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-10\"><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-11\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-14\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051680699424762-15\"><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_words</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051680699424762-16\"><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imshow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>simhei.ttf</strong></span>使用来指定字体的，可以在百度上输入<span style=\"color: #ff0000\"><strong>simhei.ttf</strong></span>进行下载后，放入程序的根目录即可。显示的图像如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3074bf71cd9dad3ab76c5c345a541392.png\"><img class=\"aligncenter wp-image-88339 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3074bf71cd9dad3ab76c5c345a541392.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"597\" height=\"298\"></a></p>\n<p><strong>到此为止，整个项目的介绍就结束了。由于自己也还是个初学者，接触python不久，代码写的并不好。而且第一次写技术博客，表达的有些冗余，请大家多多包涵，有不对的地方，请大家批评指正。以后我也会将自己做的小项目以这种形式写在博客上和大家一起交流！最后贴上完整的代码。</strong></p>\n<h1>完整代码</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d044c051684237266892\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#coding:utf-8\r\n__author__ = 'hang'\r\n\r\nimport warnings\r\nwarnings.filterwarnings(\"ignore\")\r\nimport jieba    #分词包\r\nimport numpy    #numpy计算包\r\nimport codecs   #codecs提供的open方法来指定打开的文件的语言编码，它会在读取的时候自动转换为内部unicode \r\nimport re\r\nimport pandas as pd  \r\nimport matplotlib.pyplot as plt\r\nfrom urllib import request\r\nfrom bs4 import BeautifulSoup as bs\r\n%matplotlib inline\r\nimport matplotlib\r\nmatplotlib.rcParams['figure.figsize'] = (10.0, 5.0)\r\nfrom wordcloud import WordCloud#词云包\r\n\r\n#分析网页函数\r\ndef getNowPlayingMovie_list():   \r\n    resp = request.urlopen('https://movie.douban.com/nowplaying/hangzhou/')        \r\n    html_data = resp.read().decode('utf-8')    \r\n    soup = bs(html_data, 'html.parser')    \r\n    nowplaying_movie = soup.find_all('div', id='nowplaying')        \r\n    nowplaying_movie_list = nowplaying_movie[0].find_all('li', class_='list-item')    \r\n    nowplaying_list = []    \r\n    for item in nowplaying_movie_list:        \r\n        nowplaying_dict = {}        \r\n        nowplaying_dict['id'] = item['data-subject']       \r\n        for tag_img_item in item.find_all('img'):            \r\n            nowplaying_dict['name'] = tag_img_item['alt']            \r\n            nowplaying_list.append(nowplaying_dict)    \r\n    return nowplaying_list\r\n\r\n#爬取评论函数\r\ndef getCommentsById(movieId, pageNum): \r\n    eachCommentList = []; \r\n    if pageNum&gt;0: \r\n         start = (pageNum-1) * 20 \r\n    else: \r\n        return False \r\n    requrl = 'https://movie.douban.com/subject/' + movieId + '/comments' +'?' +'start=' + str(start) + '&amp;limit=20' \r\n    print(requrl)\r\n    resp = request.urlopen(requrl) \r\n    html_data = resp.read().decode('utf-8') \r\n    soup = bs(html_data, 'html.parser') \r\n    comment_div_lits = soup.find_all('div', class_='comment') \r\n    for item in comment_div_lits: \r\n        if item.find_all('p')[0].string is not None:     \r\n            eachCommentList.append(item.find_all('p')[0].string)\r\n    return eachCommentList\r\n\r\ndef main():\r\n    #循环获取第一个电影的前10页评论\r\n    commentList = []\r\n    NowPlayingMovie_list = getNowPlayingMovie_list()\r\n    for i in range(10):    \r\n        num = i + 1 \r\n        commentList_temp = getCommentsById(NowPlayingMovie_list[0]['id'], num)\r\n        commentList.append(commentList_temp)\r\n\r\n    #将列表中的数据转换为字符串\r\n    comments = ''\r\n    for k in range(len(commentList)):\r\n        comments = comments + (str(commentList[k])).strip()\r\n\r\n    #使用正则表达式去除标点符号\r\n    pattern = re.compile(r'[\\u4e00-\\u9fa5]+')\r\n    filterdata = re.findall(pattern, comments)\r\n    cleaned_comments = ''.join(filterdata)\r\n\r\n    #使用结巴分词进行中文分词\r\n    segment = jieba.lcut(cleaned_comments)\r\n    words_df=pd.DataFrame({'segment':segment})\r\n\r\n    #去掉停用词\r\n    stopwords=pd.read_csv(\"stopwords.txt\",index_col=False,quoting=3,sep=\"\\t\",names=['stopword'], encoding='utf-8')#quoting=3全不引用\r\n    words_df=words_df[~words_df.segment.isin(stopwords.stopword)]\r\n\r\n    #统计词频\r\n    words_stat=words_df.groupby(by=['segment'])['segment'].agg({\"计数\":numpy.size})\r\n    words_stat=words_stat.reset_index().sort_values(by=[\"计数\"],ascending=False)\r\n\r\n    #用词云进行显示\r\n    wordcloud=WordCloud(font_path=\"simhei.ttf\",background_color=\"white\",max_font_size=80)\r\n    word_frequence = {x[0]:x[1] for x in words_stat.head(1000).values}\r\n\r\n    word_frequence_list = []\r\n    for key in word_frequence:\r\n        temp = (key,word_frequence[key])\r\n        word_frequence_list.append(temp)\r\n\r\n    wordcloud=wordcloud.fit_words(word_frequence_list)\r\n    plt.imshow(wordcloud)\r\n\r\n#主函数\r\nmain()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59d044c051684237266892-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d044c051684237266892-98\">98</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-1\"><span class=\"crayon-c\">#coding:utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-2\"><span class=\"crayon-v\">__author__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hang'</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">warnings</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-5\"><span class=\"crayon-k \">warnings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">filterwarnings</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"ignore\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#分词包</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-7\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numpy</span><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#numpy计算包</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-8\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">codecs</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">#codecs提供的open方法来指定打开的文件的语言编码，它会在读取的时候自动转换为内部unicode </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-9\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-10\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pandas </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pd  </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-11\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pyplot </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">plt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-12\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-13\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-14\"><span class=\"crayon-ta\">%</span><span class=\"crayon-i\">matplotlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">inline</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-16\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">matplotlib</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-17\"><span class=\"crayon-v\">matplotlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rcParams</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'figure.figsize'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-18\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wordcloud </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WordCloud</span><span class=\"crayon-c\">#词云包</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-20\"><span class=\"crayon-c\">#分析网页函数</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-21\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNowPlayingMovie_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">   </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'https://movie.douban.com/nowplaying/hangzhou/'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'nowplaying'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'li'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'list-item'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_movie_list</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data-subject'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tag_img_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'img'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-32\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tag_img_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'alt'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">nowplaying_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nowplaying_dict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nowplaying_list</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-35\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-36\"><span class=\"crayon-c\">#爬取评论函数</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-37\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCommentsById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">movieId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-40\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pageNum</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">requrl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://movie.douban.com/subject/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">movieId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/comments'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'start='</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&amp;limit=20'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urlopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">requrl</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">resp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">class_</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'comment'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comment_div_lits</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">     </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">eachCommentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'p'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">eachCommentList</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-54\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#循环获取第一个电影的前10页评论</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">commentList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">NowPlayingMovie_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getNowPlayingMovie_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">commentList_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCommentsById</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">NowPlayingMovie_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'id'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList_temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-62\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#将列表中的数据转换为字符串</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">commentList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">strip</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-68\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#使用正则表达式去除标点符号</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">compile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">'[\\u4e00-\\u9fa5]+'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filterdata</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-72\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-73\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#使用结巴分词进行中文分词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">segment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jieba</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lcut</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cleaned_comments</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DataFrame</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-76\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-77\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#去掉停用词</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">pd</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read_csv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"stopwords.txt\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">index_col</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">quoting</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sep</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\t\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">names</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'stopword'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-c\">#quoting=3全不引用</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_df</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">~</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">segment</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">isin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stopwords</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stopword</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-80\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-81\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#统计词频</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-82\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_df</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">groupby</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'segment'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">agg</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">numpy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">size</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">reset_index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort_values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">by</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"计数\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">ascending</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-84\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-85\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">#用词云进行显示</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-86\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">WordCloud</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">font_path</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"simhei.ttf\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">background_color</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"white\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">max_font_size</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-87\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words_stat</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">head</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-88\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">word_frequence</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-93\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-94\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fit_words</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">word_frequence_list</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">plt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">imshow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wordcloud</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-96\"> </div><div class=\"crayon-line\" id=\"crayon-59d044c051684237266892-97\"><span class=\"crayon-c\">#主函数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d044c051684237266892-98\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0243 seconds] -->\r\n<p>结果显示如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/05a3876d1a9c27b22ab48900bdbad449.png\"><img class=\"aligncenter wp-image-88340 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/05a3876d1a9c27b22ab48900bdbad449.png\" alt=\"1531315665-598193ac5c9bb_articlex\" width=\"597\" height=\"297\"></a></p>\n<p><strong>上图基本反映了《战狼2》这部电影的情况。PS:我本人并不喜欢这部电影，内容太空洞、太假，为了爱国而爱国，没意思。哎，这两年真是国产电影的低谷啊，没有一部拿得出手的国产电影，看看人家印度拍的《摔跤吧，爸爸》那才是拍的有深度，同样是表现爱国，国产电影还是需要向别的国家好好学学。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88325\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88325votetotal\">4</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88325\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 21 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 39 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/4a86e0544d1e4a0667de13449f388d7a.png"], "tags": "实践项目,爬虫", "url_object_id": "86206811adbc0f0c2a9bd5db3973a181", "praise_nums": "4", "url": "http://python.jobbole.com/88325/", "title": "Python 爬虫实战（1）：分析豆瓣中最新电影的影评", "create_date": "2017/08/11", "comment_nums": 39}
{"fav_nums": 11, "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://segmentfault.com/a/1190000010520835\">hang</a>   </div><h1>功能简介</h1>\n<p><strong>目标：</strong> 获取上交所和深交所所有股票的名称和交易信息。<br>\n<strong>输出：</strong> 保存到文件中。<br>\n<strong>技术路线：</strong> <span style=\"color: #ff0000\"><strong>requests—bs4–re</strong></span><br>\n<strong>语言：python3.5</strong></p>\n<h2>说明</h2>\n<p><strong>网站选择原则：</strong> 股票信息静态存在于html页面中，非js代码生成，没有Robbts协议限制。<br>\n<strong>选取方法：</strong> 打开网页，查看源代码，搜索网页的股票价格数据是否存在于源代码中。<br>\n如打开新浪股票网址：<a href=\"http://finance.sina.com.cn/realstock/company/sz000877/nc.shtml\">链接描述</a>，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png\"><img class=\"aligncenter wp-image-88351 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"609\" height=\"146\"></a></p>\n<p>上图中左边为网页的界面，显示了天山股份的股票价格是13.06。右边为该网页的源代码，在源代码中查询13.06发现没有找到。所以判断该网页的数据使用js生成的，不适合本项目。因此换一个网页。</p>\n<p>再打开百度股票的网址：<a href=\"https://gupiao.baidu.com/stock/sz300023.html\">链接描述</a>，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/aad76450e2f545d67619659a71a420fc.png\"><img class=\"aligncenter wp-image-88352 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/aad76450e2f545d67619659a71a420fc.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"670\" height=\"94\"></a></p>\n<p>从上图中可以发现百度股票的数据是html代码生成的，符合我们本项目的要求，所以在本项目中选择百度股票的网址。</p>\n<p>由于百度股票只有单个股票的信息，所以还需要当前股票市场中所有股票的列表，在这里我们选择东方财富网，网址为：<a href=\"http://quote.eastmoney.com/stocklist.html\">链接描述</a>，界面如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/79e952720ce03bff5b28e3092edba336.png\"><img class=\"aligncenter wp-image-88353 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/79e952720ce03bff5b28e3092edba336.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"666\" height=\"224\"></a></p>\n<h1>原理分析</h1>\n<p>查看百度股票每只股票的网址：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/sz300023.html</strong></span>，可以发现网址中有一个编号<span style=\"color: #ff0000\"><strong>300023</strong></span>正好是这只股票的编号，<span style=\"color: #ff0000\"><strong>sz</strong></span>表示的深圳交易所。因此我们构造的程序结构如下：</p>\n<ul>\n<li><strong>步骤1：</strong> 从东方财富网获取股票列表；</li>\n<li><strong>步骤2：</strong> 逐一获取股票代码，并增加到百度股票的链接中，最后对这些链接进行逐个的访问获得股票的信息；</li>\n<li><strong>步骤3：</strong> 将结果存储到文件。</li>\n</ul>\n<p>接着查看百度个股信息网页的源代码，发现每只股票的信息在html代码中的存储方式如下：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5d61524f2de99088419b3ec5740a3b6.png\"><img class=\"aligncenter wp-image-88354 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5d61524f2de99088419b3ec5740a3b6.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"417\" height=\"216\"></a></p>\n<p>因此，在我们存储每只股票的信息时，可以参考上图中html代码的存储方式。每一个信息源对应一个信息值，即采用键值对的方式进行存储。在python中键值对的方式可以用<strong>字典</strong>类型。因此，在本项目中，使用字典来存储每只股票的信息，然后再用字典把所有股票的信息记录起来，最后将字典中的数据输出到文件中。</p>\n<h1>代码编写</h1>\n<p><span style=\"color: #ff0000\"><strong>首先是获得html网页数据的程序</strong></span>，在这里不多做介绍了，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1a98647877147\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#获得html文本\r\ndef getHTMLText(url):\r\n    try:\r\n        r = requests.get(url)\r\n        r.raise_for_status()\r\n        r.encoding = r.apparent_encoding\r\n        return r.text\r\n    except:\r\n        return \"\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1a98647877147-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1a98647877147-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1a98647877147-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1a98647877147-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1a98647877147-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1a98647877147-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1a98647877147-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1a98647877147-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1a98647877147-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1a98647877147-1\"><span class=\"crayon-c\">#获得html文本</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1a98647877147-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1a98647877147-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1a98647877147-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1a98647877147-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">raise_for_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1a98647877147-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apparent_encoding</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1a98647877147-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1a98647877147-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1a98647877147-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p><span style=\"color: #ff0000\"><strong>接下来是html代码解析程序</strong></span>，在这里首先需要解析的是东方财富网页面：<a href=\"http://quote.eastmoney.com/stocklist.html\">链接描述</a>，我们打开其源代码，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5866605d0bcdefdb66cb02ebcee5ea0.png\"><img class=\"aligncenter wp-image-88355 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5866605d0bcdefdb66cb02ebcee5ea0.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"607\" height=\"79\"></a></p>\n<p>由上图可以看到，<span style=\"color: #ff0000\"><strong>a</strong></span>标签的<span style=\"color: #ff0000\"><strong>href</strong></span>属性中的网址链接里面有每只股票的对应的号码，因此我们只要把网址里面对应股票的号码解析出来即可。解析步骤如下：</p>\n<p><strong>第一步，获得一个页面：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1aa2558429883\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhtml = getHTMLText(stockURL)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aa2558429883-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1aa2558429883-1\"><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><strong>第二步，解析页面，找到所有的a标签：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1aa6457114741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoup = BeautifulSoup(html, 'html.parser') \r\na = soup.find_all('a')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aa6457114741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aa6457114741-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1aa6457114741-1\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aa6457114741-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><strong>第三步，对<span style=\"color: #ff0000\"><strong>a</strong></span>标签中的每一个进行遍历来进行相关的处理。处理过程如下：</strong></p>\n<p>1.找到<span style=\"color: #ff0000\"><strong>a</strong></span>标签中的<span style=\"color: #ff0000\"><strong>href</strong></span>属性，并且判断属性中间的链接，把链接后面的数字取出来，在这里可以使用正则表达式来进行匹配。由于深圳交易所的代码以<span style=\"color: #ff0000\"><strong>sz</strong></span>开头，上海交易所的代码以<span style=\"color: #ff0000\"><strong>sh</strong></span>开头，股票的数字有<span style=\"color: #ff0000\"><strong>6</strong></span>位构成，所以正则表达式可以写为<span style=\"color: #ff0000\"><strong>[s][hz]\\d{6}</strong></span>。也就是说构造一个正则表达式，在链接中去寻找满足这个正则表达式的字符串，并把它提取出来。代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1aaa302178445\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in a:\r\n    href = i.attrs['href']\r\n    lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aaa302178445-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aaa302178445-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aaa302178445-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1aaa302178445-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aaa302178445-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1aaa302178445-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>2.由于在<span style=\"color: #ff0000\"><strong>html</strong></span>中有很多的<span style=\"color: #ff0000\"><strong>a</strong></span>标签，但是有些<span style=\"color: #ff0000\"><strong>a</strong></span>标签中没有<span style=\"color: #ff0000\"><strong>href</strong></span>属性，因此上述程序在运行的时候出现异常，所有对上述的程序还要进行<span style=\"color: #ff0000\"><strong>try…except</strong></span>来对程序进行异常处理，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1aae202065611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in a:\r\n    try:\r\n        href = i.attrs['href']\r\n        lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n    except:\r\n        continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aae202065611-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aae202065611-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aae202065611-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aae202065611-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aae202065611-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aae202065611-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1aae202065611-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aae202065611-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1aae202065611-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aae202065611-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1aae202065611-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aae202065611-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>从上面代码可以看出，对于出现异常的情况我们使用了<span style=\"color: #ff0000\"><strong>continue</strong></span>语句，直接让其跳过，继续执行下面的语句。通过上面的程序我们就可以把东方财富网上股票的代码信息全部保存下来了。</p>\n<p><strong>将上述的代码封装成一个函数，对东方财富网页面解析的完整代码如下所示：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ab2515426082\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getStockList(lst, stockURL):\r\n    html = getHTMLText(stockURL)\r\n    soup = BeautifulSoup(html, 'html.parser') \r\n    a = soup.find_all('a')\r\n    for i in a:\r\n        try:\r\n            href = i.attrs['href']\r\n            lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n        except:\r\n            continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab2515426082-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab2515426082-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab2515426082-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab2515426082-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab2515426082-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab2515426082-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab2515426082-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab2515426082-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab2515426082-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab2515426082-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab2515426082-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab2515426082-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab2515426082-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab2515426082-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab2515426082-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab2515426082-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab2515426082-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab2515426082-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab2515426082-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab2515426082-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p><strong>接下来是获得百度股票网<a href=\"https://gupiao.baidu.com/stock/sz300023.html\">链接描述</a>单只股票的信息。</strong>我们先查看该页面的源代码，如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7742e9536a095384a3b609d59b9d33c9.png\"><img class=\"aligncenter wp-image-88356 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7742e9536a095384a3b609d59b9d33c9.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"562\" height=\"735\"></a></p>\n<p>股票的信息就存在上图所示的html代码中，因此我们需要对这段html代码进行解析。过程如下：</p>\n<p>1.百度股票网的网址为：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/</strong></span><br>\n一只股票信息的网址为：<span style=\"color: #ff0000\"><strong>https://gupiao.baidu.com/stock/sz300023.html</strong></span></p>\n<p>所以只要<span style=\"color: #ff0000\"><strong>百度股票网的网址+每只股票的代码</strong></span>即可，而每只股票的代码我们已经有前面的程序<span style=\"color: #ff0000\"><strong>getStockList</strong></span>从东方财富网解析出来了，因此对<span style=\"color: #ff0000\"><strong>getStockList</strong></span>函数返回的列表进行遍历即可，代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ab6428258334\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor stock in lst:\r\n        url = stockURL + stock + \".html\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab6428258334-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ab6428258334-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab6428258334-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ab6428258334-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>2.获得网址后，就要访问网页获得网页的<span style=\"color: #ff0000\"><strong>html</strong></span>代码了，程序如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ab9143347070\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhtml = getHTMLText(url)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ab9143347070-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ab9143347070-1\"><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>3.获得了<span style=\"color: #ff0000\"><strong>html</strong></span>代码后就需要对<span style=\"color: #ff0000\"><strong>html</strong></span>代码进行解析，由上图我们可以看到单个股票的信息存放在标签为<span style=\"color: #ff0000\"><strong>div</strong></span>,属性为<span style=\"color: #ff0000\"><strong>stock-bets</strong></span>的<span style=\"color: #ff0000\"><strong>html</strong></span>代码中，因此对其进行解析：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1abd635810155\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsoup = BeautifulSoup(html, 'html.parser')\r\nstockInfo = soup.find('div',attrs={'class':'stock-bets'})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1abd635810155-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1abd635810155-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1abd635810155-1\"><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1abd635810155-2\"><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>4.我们又发现股票名称在<span style=\"color: #ff0000\"><strong>bets-name</strong></span>标签内，继续解析，存入字典中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ac0475630504\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninfoDict = {}\r\nname = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\ninfoDict.update({'股票名称': name.text.split()[0]})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ac0475630504-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ac0475630504-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ac0475630504-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ac0475630504-1\"><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ac0475630504-2\"><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ac0475630504-3\"><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p><span style=\"color: #ff0000\"><strong>split()</strong></span>的意思是股票名称空格后面的部分不需要了。</p>\n<p>5.我们从<span style=\"color: #ff0000\"><strong>html</strong></span>代码中还可以观察到股票的其他信息存放在<span style=\"color: #ff0000\"><strong>dt</strong></span>和<span style=\"color: #ff0000\"><strong>dd</strong></span>标签中，其中dt表示股票信息的键域，dd标签是值域。获取全部的键和值：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ac3832962097\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkeyList = stockInfo.find_all('dt')\r\nvalueList = stockInfo.find_all('dd')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ac3832962097-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ac3832962097-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ac3832962097-1\"><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ac3832962097-2\"><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>并把获得的键和值按键值对的方式村放入字典中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ac6148161235\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfor i in range(len(keyList)):\r\n    key = keyList[i].text\r\n    val = valueList[i].text\r\n    infoDict[key] = val</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ac6148161235-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ac6148161235-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ac6148161235-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ac6148161235-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ac6148161235-1\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ac6148161235-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ac6148161235-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ac6148161235-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>6.最后把字典中的数据存入外部文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1aca530502229\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith open(fpath, 'a', encoding='utf-8') as f:\r\nf.write( str(infoDict) + '\\n' )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1aca530502229-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1aca530502229-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1aca530502229-1\"><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1aca530502229-2\"><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><strong>将上述过程封装成完成的函数，代码如下：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1acd249984118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef getStockInfo(lst, stockURL, fpath):\r\n    for stock in lst:\r\n        url = stockURL + stock + \".html\"\r\n        html = getHTMLText(url)\r\n        try:\r\n            if html==\"\":\r\n                continue\r\n            infoDict = {}\r\n            soup = BeautifulSoup(html, 'html.parser')\r\n            stockInfo = soup.find('div',attrs={'class':'stock-bets'})\r\n \r\n            name = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\n            infoDict.update({'股票名称': name.text.split()[0]})\r\n             \r\n            keyList = stockInfo.find_all('dt')\r\n            valueList = stockInfo.find_all('dd')\r\n            for i in range(len(keyList)):\r\n                key = keyList[i].text\r\n                val = valueList[i].text\r\n                infoDict[key] = val\r\n             \r\n            with open(fpath, 'a', encoding='utf-8') as f:\r\n                f.write( str(infoDict) + '\\n' )\r\n        except:\r\n            continue</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1acd249984118-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1acd249984118-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-11\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-14\"><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-18\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-19\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-20\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-21\"><span class=\"crayon-e\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-22\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1acd249984118-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1acd249984118-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0065 seconds] -->\r\n<p>其中<span style=\"color: #ff0000\"><strong>try…except</strong></span>用于异常处理。</p>\n<p><strong>接下来编写主函数，调用上述函数即可：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ad1213917177\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef main():\r\n    stock_list_url = 'http://quote.eastmoney.com/stocklist.html'\r\n    stock_info_url = 'https://gupiao.baidu.com/stock/'\r\n    output_file = 'D:/BaiduStockInfo.txt'\r\n    slist=[]\r\n    getStockList(slist, stock_list_url)\r\n    getStockInfo(slist, stock_info_url, output_file)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad1213917177-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad1213917177-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad1213917177-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad1213917177-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad1213917177-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad1213917177-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad1213917177-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad1213917177-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad1213917177-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://quote.eastmoney.com/stocklist.html'</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad1213917177-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://gupiao.baidu.com/stock/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad1213917177-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/BaiduStockInfo.txt'</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad1213917177-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">slist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad1213917177-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad1213917177-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h1>项目完整程序</h1>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59d03f88f1ad4705727423\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# -*- coding: utf-8 -*-\r\n\r\nimport requests\r\nfrom bs4 import BeautifulSoup\r\nimport traceback\r\nimport re\r\n \r\ndef getHTMLText(url):\r\n    try:\r\n        r = requests.get(url)\r\n        r.raise_for_status()\r\n        r.encoding = r.apparent_encoding\r\n        return r.text\r\n    except:\r\n        return \"\"\r\n \r\ndef getStockList(lst, stockURL):\r\n    html = getHTMLText(stockURL)\r\n    soup = BeautifulSoup(html, 'html.parser') \r\n    a = soup.find_all('a')\r\n    for i in a:\r\n        try:\r\n            href = i.attrs['href']\r\n            lst.append(re.findall(r\"[s][hz]\\d{6}\", href)[0])\r\n        except:\r\n            continue\r\n \r\ndef getStockInfo(lst, stockURL, fpath):\r\n    count = 0\r\n    for stock in lst:\r\n        url = stockURL + stock + \".html\"\r\n        html = getHTMLText(url)\r\n        try:\r\n            if html==\"\":\r\n                continue\r\n            infoDict = {}\r\n            soup = BeautifulSoup(html, 'html.parser')\r\n            stockInfo = soup.find('div',attrs={'class':'stock-bets'})\r\n \r\n            name = stockInfo.find_all(attrs={'class':'bets-name'})[0]\r\n            infoDict.update({'股票名称': name.text.split()[0]})\r\n             \r\n            keyList = stockInfo.find_all('dt')\r\n            valueList = stockInfo.find_all('dd')\r\n            for i in range(len(keyList)):\r\n                key = keyList[i].text\r\n                val = valueList[i].text\r\n                infoDict[key] = val\r\n             \r\n            with open(fpath, 'a', encoding='utf-8') as f:\r\n                f.write( str(infoDict) + '\\n' )\r\n                count = count + 1\r\n                print(\"\\r当前进度: {:.2f}%\".format(count*100/len(lst)),end=\"\")\r\n        except:\r\n            count = count + 1\r\n            print(\"\\r当前进度: {:.2f}%\".format(count*100/len(lst)),end=\"\")\r\n            continue\r\n \r\ndef main():\r\n    stock_list_url = 'http://quote.eastmoney.com/stocklist.html'\r\n    stock_info_url = 'https://gupiao.baidu.com/stock/'\r\n    output_file = 'D:/BaiduStockInfo.txt'\r\n    slist=[]\r\n    getStockList(slist, stock_list_url)\r\n    getStockInfo(slist, stock_info_url, output_file)\r\n \r\nmain()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59d03f88f1ad4705727423-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59d03f88f1ad4705727423-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-1\"><span class=\"crayon-c\"># -*- coding: utf-8 -*-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-2\"> </div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">requests</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bs4 </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">traceback</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-6\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-7\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">raise_for_status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">apparent_encoding</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-14\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-17\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">href</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">r</span><span class=\"crayon-s\">\"[s][hz]\\d{6}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-27\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-28\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stock </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lst</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockURL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".html\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">html</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getHTMLText</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'html.parser'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'div'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'stock-bets'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'bets-name'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'股票名称'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-42\"><span class=\"crayon-h\">             </span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stockInfo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'dd'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-46\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keyList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-47\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">val</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">valueList</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-48\"><span class=\"crayon-e\">                </span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-49\"><span class=\"crayon-e\">             </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-50\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fpath</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-51\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">infoDict</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-53\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r当前进度: {:.2f}%\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">end</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\r当前进度: {:.2f}%\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">count</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lst</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">end</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-58\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-59\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-60\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://quote.eastmoney.com/stocklist.html'</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-61\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://gupiao.baidu.com/stock/'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'D:/BaiduStockInfo.txt'</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">slist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockList</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_list_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">getStockInfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">slist</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stock_info_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output_file</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59d03f88f1ad4705727423-66\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59d03f88f1ad4705727423-67\"><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0152 seconds] -->\r\n<p><strong>上述代码中的<span style=\"color: #ff0000\"><strong>print</strong></span>语句用于打印爬取的进度。执行完上述代码后在<span style=\"color: #ff0000\"><strong>D盘</strong></span>会出现<span style=\"color: #ff0000\"><strong>BaiduStockInfo.txt</strong></span>文件，里面存放了股票的信息。</strong></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"88350\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"88350votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"88350\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 11 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/6b30322fa6b042eff6d3f60a95b8220b.png"], "tags": "实践项目,爬虫", "url_object_id": "4d65df19aae500c1c2fe349d112bd7f1", "praise_nums": "2", "url": "http://python.jobbole.com/88350/", "title": "Python 爬虫实战(2)：股票数据定向爬虫", "create_date": "2017/08/12", "comment_nums": 0}
